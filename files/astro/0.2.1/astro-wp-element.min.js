/*!
 * Astro Framework - WordPress v0.2.1
 * Copyright 2016 Ting Yang and Hector Jarquin
 * Released under the MIT license
 */
!function(e,t){"use strict";function n(t,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var o=e.createEvent("CustomEvent");return o.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),o}n.prototype=t.CustomEvent.prototype,t.CustomEvent=n}(document,window),function(e,t){"use strict";function n(){var t;return t=e.querySelectorAll(m.source),t||[]}function o(e){var t,n={blogs:[]};for(t=0;t<e.length;t+=1)n.blogs.push({url:e[t].dataset[d.source],elements:e[t].querySelectorAll(m.element),jsoncontent:[]});return n}function r(e,t){function n(){return i[d.layout]?-1!==i[d.layout].search(v)?i[d.layout]:void 0:"single"}function o(){var e=i[d.options]||null;return e}function r(){var e=i[d.element]||null;return e}function l(){var e="",t=o();return"/"!==c.slice(-1)&&(c+="/"),e+=c+r(),null!==t&&(e+="?"+t),e}function u(){return t.querySelector("*")}function s(){return t}function a(){return t.querySelectorAll(m.template)}var c=e,i=t.dataset;return{url:l,layout:n,childnodes:u,elementNode:s,templates:a}}function l(e){for(var t=0,n=0;n<e.wpElements.blogs.length;n++)t+=e.wpElements.blogs[n].elements.length;return t}function u(){var e=n(),t=o(e);y.wpElements=t}function s(t){var n,o,u=0,s=l(y);y.wpElements.blogs.forEach(function(l){for(n=0;n<l.elements.length;n+=1)o=r(l.url,l.elements[n]),function(n,o){A.GetContentFromWordpress(n.url(),function(r,l){r&&t(n,l),Array.isArray(l)&&o.jsoncontent.push([l]),l.posts?o.jsoncontent.push(l.posts):o.jsoncontent.push([l]),t(n,l),u+=1,u===s&&e.dispatchEvent(f)})}(o,l)})}function a(e,t){if("list"===e.layout()){var n,o,r=e.childnodes(),l=t.posts||t;for(n=1;n<l.length;n+=1)o=r.cloneNode(!0),e.elementNode().appendChild(o)}c(e,l)}function c(e,t){var n,o;Array.isArray(t)?i(e,t):(n=e.elementNode(),o=n.querySelectorAll(m.template),p(t,o))}function i(e,t){var n,o,r;for(o=0;o<t.length;o+=1)n=e.elementNode().children[o],r=n.querySelectorAll(m.template),p(t[o],r)}function p(e,t){var n,o;for(n=0;n<t.length;n+=1)o=A.ExtractJsonValueByKey(t[n].dataset.wpTemplate,e),"IMG"===t[n].tagName?t[n].setAttribute("src",o):"A"===t[n].tagName?t[n].setAttribute("href",o):t[n].innerHTML=o}var f=new CustomEvent("AstroWP-render"),m={source:"[data-wp-source]",element:"[data-wp-element]",template:"[data-wp-template]"},d={source:"wpSource",element:"wpElement",options:"wpOptions",layout:"wpLayout",singlePage:"partialView"},v=/list|single/,y={},A={GetContentFromWordpress:function(e,n){var o;o=t.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),o.onreadystatechange=function(){4===o.readyState&&200===o.status&&n(null,JSON.parse(o.responseText))},o.open("GET",e,!0),o.send()},ExtractJsonValueByKey:function(e,t){var n=e,o=n.split(".");console.log(o);for(var r=0;r<o.length;r+=1)t=t[o[r]];return t}};u(),s(function(e,t){a(e,t)}),y.Util=A,t.AstroWP=y,t.ASTRO_QUERY_DATASET=m,t.ASTRO_DATASET_ATTRIBUTE=d}(document,window);
