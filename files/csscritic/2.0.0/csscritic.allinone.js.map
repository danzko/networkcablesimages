{"version":3,"sources":["node_modules/grunt-browserify/node_modules/browserify/node_modules/browser-pack/_prelude.js","build/csscritic.concat.css","build/csscritic.umd.js","node_modules/ayepromise/ayepromise.js","node_modules/cssify/lib/browser.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/base64-js/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/ieee754/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/isarray/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/punycode/punycode.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/querystring-es3/decode.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/querystring-es3/encode.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/querystring-es3/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/url/url.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/url/util.js","node_modules/imagediff/browser/canvas.js","node_modules/imagediff/imagediff.js","node_modules/rasterizehtml/dist/rasterizeHTML.js","node_modules/rasterizehtml/node_modules/css-mediaquery/index.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/css-font-face-src/lib/grammar/index.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/css-font-face-src/lib/index.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/css-font-face-src/lib/util.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/CSSDocumentRule.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/CSSFontFaceRule.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/CSSImportRule.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/CSSKeyframeRule.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/CSSKeyframesRule.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/CSSMediaRule.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/CSSRule.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/CSSStyleDeclaration.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/CSSStyleRule.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/CSSStyleSheet.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/CSSValue.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/CSSValueExpression.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/MatcherList.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/MediaList.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/StyleSheet.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/clone.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/index.js","node_modules/rasterizehtml/node_modules/inlineresources/node_modules/cssom/lib/parse.js","node_modules/rasterizehtml/node_modules/inlineresources/src/backgroundValueParser.js","node_modules/rasterizehtml/node_modules/inlineresources/src/cssSupport.js","node_modules/rasterizehtml/node_modules/inlineresources/src/inline.js","node_modules/rasterizehtml/node_modules/inlineresources/src/inlineCss.js","node_modules/rasterizehtml/node_modules/inlineresources/src/inlineImage.js","node_modules/rasterizehtml/node_modules/inlineresources/src/inlineScript.js","node_modules/rasterizehtml/node_modules/inlineresources/src/util.js","node_modules/rasterizehtml/node_modules/sane-domparser-error/index.js","node_modules/rasterizehtml/node_modules/xmlserializer/lib/serializer.js"],"names":["root","factory","define","amd","a0","b1","c2","exports","module","require","this","ayepromise","imagediff","rasterizeHTML","csscriticLib","browserRenderer","util","jobQueue","queue","cache","getOrCreateJobQueue","extractErrorMessages","errors","map","error","msg","logErrorToConsole","e","console","doRenderHtml","parameters","drawOptions","cacheBucket","width","height","executeJs","executeJsTimeout","baseUrl","forEach","key","drawHTML","html","then","result","renderErrors","image","renderHtmlFromBlob","blob","loadBlobAsText","content","url","hover","active","focus","target","loadImageFromBlob","loadBlobAsDataURI","getImageForUrl","render","execute","loadAsBlob","indexeddbstorage","createDb","db","createObjectStore","keyPath","getDb","defer","request","indexedDB","open","onsuccess","event","resolve","onupgradeneeded","promise","buildKey","testCase","testCaseParameters","excludeKeys","serializedParameters","serializeMap","storeReferenceImage","referenceImage","viewport","imageUri","getDataURIForImage","transaction","objectStore","put","reference","close","readReferenceImage","get","undefined","reject","dataObj","img","busy","runJob","job","func","nextInQueue","length","shift","constructJob","push","main","regression","reporting","storage","selectionFilter","currentComponentLabel","testCases","component","componentLabel","supportUrlAsOnlyTestCaseInput","add","augmentedTestCase","clone","fetchStartingComparisons","all","referenceImageRecord","selectComparisons","configuredComparisons","configuredComparison","selected","isComparisonSelected","reportConfiguredComparisons","comparisonSelection","selection","isSelected","doReportConfiguredComparison","executeTestCase","startingComparison","compare","comparison","doReportComparison","allPassed","startingComp","selectedComparisons","filter","comparisons","hasTestSuitePassed","doReportTestSuite","renderer","toleranceToWorkAroundFirefoxRenderingAFewPixelsIndeterministicallyOnLinux","workAroundFirefoxResourcesSporadicallyMissing","htmlImage","diff","workAroundBrowserIssues","pageImage","workAroundTransparencyIssueInFirefox","compareRenderingAndReference","isEqual","adaptedHtmlImage","equal","comparisonResult","textualStatus","status","extractErrorMessage","originalError","message","loadPageAndCompare","renderResult","viewportFallback","fallbackWidth","fallbackHeight","reporters","addReporter","reporter","testCaseIsResizable","attachPageAcceptHelpers","viewportWidth","viewportHeight","resizePageImage","acceptPage","reportingMethod","reportSelectedComparison","reportDeselectedComparison","reportingFunc","reportComparison","passed","reportTestSuite","success","canvas","window","document","createElement","context","getContext","naturalWidth","naturalHeight","drawImage","toDataURL","Image","onload","onerror","src","getUncachableURL","delimiter","indexOf","Date","now","ajax","xhr","XMLHttpRequest","response","send","Error","statusText","responseType","reader","FileReader","readAsText","readAsDataURL","theMap","Array","prototype","slice","call","arguments","newMap","Object","keys","serializationEntries","sort","join","object","i","theClone","hasOwnProperty","successfulPromise","value","dataUri","nonPassingTestCases","hasValidTestSetup","functionReturnValues","pendingFunctionCalls","resolvedValues","functionCallResolved","idx","returnValue","fallbackFilter","windowLocation","storageKey","fullDescription","desc","sessionStorage","getItem","filterFor","setItem","reload","filterForComponent","clearFilter","removeItem","niceReporter","pageNavigationHandlingFallback","packageVersion","originalTitle","escapeValue","toString","replace","RegExp","template","templateStr","values","_","param","elementFor","htmlString","tmp","insertAdjacentHTML","firstChild","findElementIn","container","elementClassName","querySelector","escapeId","id","headerClassName","timeTakenClassName","progressBarClassName","statusTextClassName","headerOptionalClassName","elementDimensions","element","initialPosition","getBoundingClientRect","scrollOffsetTop","body","scrollTop","documentElement","scrollOffsetLeft","scrollLeft","top","left","right","px","makeElementFixedOnScroll","dimensions","scrollingClass","smallClass","smallScrollThreshold","isScrolling","isSmall","pseudoInlineElement","addEventListener","scrollY","classList","style","position","parentElement","insertBefore","remove","removeChild","showHeader","header","appendChild","createContainer","parentContainer","reportBody","updateStatusInDocumentTitle","totalCount","doneCount","title","padNumber","number","renderMilliseconds","time","seconds","Math","floor","milliSeconds","showTimeTaken","timeTakenInMillis","timeTaken","textContent","setOutcomeOnHeader","successful","getOrCreateToc","tocClassName","toc","className","addTocEntry","linkTarget","entry","headline","install","installFallbackComponentSelectionHandler","onclick","preventDefault","addComponentHeading","filterUrl","filterUrlForComponent","headlineElement","comparisonKey","runningComparisonClassName","referenceImageContainerClassName","errorContainerClassName","imageWrapper","wrapper","serializeValue","installFallbackSelectionHandler","addComparison","titleLinkClassName","filterUrlFor","anchorTarget","referenceImageContainer","titleLink","canvasForImageCanvas","imageData","putImageData","diffPageImages","imageA","imageB","align","embossChanges","d","data","getDifferenceCanvas","differenceImageData","canvasForImage","addImageDiff","imageForDiff","toggleViewClassName","acceptClassName","acceptComparison","acceptButton","setAttribute","button","pageAsIframe","testCaseUrl","iframe","scrolling","showPageImage","realView","imageContainer","innerHTML","pageImageContainer","acceptButtonElement","pageImageContainerClassName","outerPageImageContainer","toggleButton","showRealView","accepted","removeAttribute","showComparisonWithDiff","showComparisonWithoutReference","sameOriginWarning","showComparisonWithError","errorMsg","errorContainer","showRenderErrors","listElement","li","updateComparisonStatus","progressBarPendingClassName","testDescription","addTickToProgressBar","progressBar","clickableTickTemplate","deactivatedTickTemplate","tickTemplate","tick","markTickDone","renderErrorCount","tickElement","singularPlural","singularForm","pluralForm","statusTotalText","selectedCount","totalContent","total","statusIssueText","issueCount","issueContent","doneContent","noTestsContent","doneWithoutErrors","issues","acceptAllClassName","acceptAllButton","showAcceptAllButtonIfNeccessary","acceptableEntries","acceptableEntry","installFallbackClearSelectionHandler","updateStatusBar","runAllUrl","clearFilterUrl","runAll","supportsReadingHtmlFromCanvas","browserIssueChecked","showBrowserWarningIfNeeded","supported","NiceReporter","outerContainer","containerElement","timeStarted","lastComponentLabel","progressTickElements","runningComparisonEntries","acceptableComparisons","registerComparison","comparisonElement","fakeTargetClassName","clearFakeActiveClass","previousTargets","querySelectorAll","elem","triggerFakeActiveClass","targetElement","scrollTo","getElementById","scrollIntoView","globalNavigationHandlingInstalled","installGlobalNavigationHandling","onpopstate","state","targetLink","decodeURIComponent","href","targetId","substr","history","pushState","urlQueryFilter","filterParam","parseUrlSearch","search","paramString","split","keyValue","equalsIdx","serializeKeyValuePair","pair","getFilterValue","filterKeyValue","entryPair","pop","existingQueryParams","queryPart","queryParams","encodeURIComponent","csscritic","installCallChain","self","apply","startsWith","str","prefix","needsFallback","location","indexedDbStorage","queryFilter","once","wasCalled","wrappedFunction","getThenableIfExists","obj","aThenHandler","onFulfilled","onRejected","doHandlerCall","setTimeout","TypeError","callFulfilled","callRejected","handle","FULFILLED","PENDING","REJECTED","outcome","thenHandlers","doSettle","settledState","doFulfill","doReject","registerThenHandler","thenHandler","safelyResolveThenable","thenable","onceWrapper","transparentlyResolveThenablesAndSettle","fail","injectStyleTag","fileName","cb","head","getElementsByTagName","css","customDocument","doc","createStyleSheet","sheet","cssText","ownerNode","styleSheet","byUrl","link","rel","typedArraySupport","arr","Uint8Array","__proto__","foo","subarray","byteLength","kMaxLength","Buffer","TYPED_ARRAY_SUPPORT","createBuffer","that","RangeError","arg","encodingOrOffset","allocUnsafe","from","ArrayBuffer","fromArrayBuffer","fromString","fromObject","assertSize","size","alloc","fill","encoding","checked","string","isEncoding","actual","write","fromArrayLike","array","byteOffset","isBuffer","len","copy","buffer","isnan","type","isArray","SlowBuffer","isView","loweredCase","utf8ToBytes","base64ToBytes","toLowerCase","slowToString","start","end","hexSlice","utf8Slice","asciiSlice","latin1Slice","base64Slice","utf16leSlice","swap","b","n","m","bidirectionalIndexOf","val","dir","isNaN","arrayIndexOf","lastIndexOf","read","buf","indexSize","readUInt16BE","arrLength","valLength","String","foundIndex","found","j","hexWrite","offset","Number","remaining","strLen","parsed","parseInt","utf8Write","blitBuffer","asciiWrite","asciiToBytes","latin1Write","base64Write","ucs2Write","utf16leToBytes","base64","fromByteArray","min","res","firstByte","codePoint","bytesPerSequence","secondByte","thirdByte","fourthByte","tempCodePoint","decodeCodePointsArray","codePoints","MAX_ARGUMENTS_LENGTH","fromCharCode","ret","out","toHex","bytes","checkOffset","ext","checkInt","max","objectWriteUInt16","littleEndian","objectWriteUInt32","checkIEEE754","writeFloat","noAssert","ieee754","writeDouble","base64clean","stringtrim","INVALID_BASE64_RE","trim","units","Infinity","leadSurrogate","charCodeAt","byteArray","c","hi","lo","toByteArray","dst","INSPECT_MAX_BYTES","global","poolSize","_augment","Symbol","species","defineProperty","configurable","allocUnsafeSlow","_isBuffer","a","x","y","concat","list","pos","swap16","swap32","swap64","equals","inspect","match","thisStart","thisEnd","thisCopy","targetCopy","includes","isFinite","toJSON","_arr","newBuf","sliceLen","readUIntLE","mul","readUIntBE","readUInt8","readUInt16LE","readUInt32LE","readUInt32BE","readIntLE","pow","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","readFloatBE","readDoubleLE","readDoubleBE","writeUIntLE","maxBytes","writeUIntBE","writeUInt8","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeIntLE","limit","sub","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","targetStart","set","code","placeHoldersCount","b64","l","placeHolders","Arr","L","revLookup","tripletToBase64","num","lookup","encodeChunk","uint8","output","extraBytes","parts","maxChunkLength","len2","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","s","NaN","rt","abs","log","LN2","fn","mapDomain","regexSeparators","labels","encoded","ucs2decode","extra","counter","ucs2encode","stringFromCharCode","basicToDigit","base","digitToBasic","digit","flag","adapt","delta","numPoints","firstTime","k","damp","baseMinusTMin","tMax","skew","decode","input","basic","index","oldi","w","t","baseMinusT","inputLength","initialN","bias","initialBias","maxInt","tMin","splice","encode","handledCPCount","basicLength","q","currentValue","handledCPCountPlusOne","qMinusT","toUnicode","regexPunycode","test","toASCII","regexNonASCII","freeExports","nodeType","freeModule","freeGlobal","punycode","overflow","not-basic","invalid-input","version","ucs2","prop","qs","sep","eq","options","regexp","maxKeys","kstr","vstr","v","xs","f","stringifyPrimitive","name","objectKeys","ks","parse","stringify","Url","protocol","slashes","auth","host","port","hostname","hash","query","pathname","path","urlParse","parseQueryString","slashesDenoteHost","isObject","u","urlFormat","isString","format","urlResolve","source","relative","urlResolveObject","resolveObject","protocolPattern","portPattern","simplePathPattern","delims","unwise","autoEscape","nonHostChars","hostEndingChars","hostnameMaxLen","hostnamePartPattern","hostnamePartStart","unsafeProtocol","javascript","javascript:","hostlessProtocol","slashedProtocol","http","https","ftp","gopher","file","http:","https:","ftp:","gopher:","file:","querystring","queryIndex","splitter","uSplit","slashRegex","rest","simplePath","exec","proto","lowerProto","hostEnd","hec","atSign","parseHost","ipv6Hostname","hostparts","part","newpart","validParts","notHost","bit","unshift","p","h","ae","esc","escape","qm","charAt","tkeys","tk","tkey","rkeys","rk","rkey","relPath","isSourceAbs","isRelAbs","mustEndAbs","removeAllDots","srcPath","psychotic","isNullOrUndefined","authInHost","isNull","last","hasTrailingSlash","up","isAbsolute","definition","Canvas","getCanvas","getImageData","clearRect","createImageData","getCanvasRef","isImage","isType","TYPE_IMAGE","isCanvas","TYPE_CANVAS","isContext","TYPE_CONTEXT","isImageData","TYPE_IMAGE_DATA","UNDEFINED","isImageType","copyImageData","newImageData","newData","toImageData","toImageDataFromImage","toImageDataFromCanvas","toImageDataFromContext","toCanvas","equalWidth","equalHeight","equalDimensions","tolerance","aData","bData","diffEqual","diffUnequal","cData","offsets","rowOffset","columnOffset","row","column","checkType","imageDataToPNG","outputFile","callback","base64Data","decodedImage","Function","writeFile","jasmine","previous","toBeImageData","toImageDiffEqual","expected","div","float","createCanvas","noConflict","d3","e4","f5","cssMediaQuery","xmlserializer","sanedomparsererror","inlineresources","uniqueIdList","joinUrl","relUrl","getConstantUniqueIdFor","parseOptionalParameters","args","proxies","monkeyPatchInstanceMethod","methodName","proxyFunc","originalFunc","baseUrlRespectingXhr","XHRObject","xhrConstructor","originalOpen","method","joinedUrl","finishNotifyingXhr","totalXhrCount","doneXhrCount","waitingForPendingToClose","checkAllRequestsFinished","pendingXhrCount","originalSend","waitForRequestsToFinish","documentUtil","asArray","arrayLike","addClassName","addClassNameRecursively","parentNode","ownerDocument","changeCssRule","rule","newRuleText","parentStyleSheet","ruleIdx","cssRules","insertRule","deleteRule","updateRuleSelector","updatedSelector","styleDefinitions","newRule","cssRulesToText","reduce","rewriteStyleContent","styleElement","addSheetPropertyToSvgStyleElement","svgStyleElement","implementation","createHTMLDocument","cssStyleElement","matchingSimpleSelectorsRegex","simpleSelectorList","replaceSimpleSelectorsBy","caseInsensitiveReplaceFunc","selectorRegex","matchingRules","selectorText","newSelector","prefixMatch","selectorMatch","rewriteCssSelectorWith","oldSelector","lowercaseCssTypeSelectors","matchingTagNames","findHtmlOnlyNodeNames","currentTagName","treeWalker","createTreeWalker","NodeFilter","SHOW_ELEMENT","htmlNodeNames","nonHtmlNodeNames","currentNode","tagName","namespaceURI","nextNode","documentHelper","cascadingAction","fakeUserAction","selector","action","pseudoClass","fakeActionClass","persistInputValues","inputs","textareas","isCheckable","textarea","rewriteTagNameSelectorsToLowerCase","mediaQueryHelper","hasEmIssue","svgImgBlueByEmMediaQuery","svg","firstPixelHasColor","r","g","hasEmMediaQueryIssue","needsEmWorkaround","mediaQueryRule","mediaQuery","exchangeRuleWithNewContent","serializeExpression","exp","feature","modifier","serializeQueryPart","segments","inverse","expressions","serializeQuery","queryParts","transformEmIntoPx","em","replaceEmValueWithPx","parseFloat","substituteEmWithPx","parsedQuery","hasChanges","rewrittenValue","replaceEmsWithPx","mediaQueryRules","anyRuleHasChanges","rewrittenMediaQuery","media","mediaText","workAroundWebKitEmSizeIssue","styles","CSSRule","MEDIA_RULE","browser","theWindow","createHiddenElement","visibility","executeJavascript","outerHTML","iframeErrorsMessages","timeout","doResolve","contentDocument","waitForJavaScriptToRun","contentWindow","finishNotifyXhrProxy","baseUrlXhrProxy","resourceType","createHiddenSandboxedIFrame","sandbox","createIframeWithSizeAtZoomLevel1","zoom","scaledViewportWidth","scaledViewportHeight","calculateZoomedContentSizeAndRoundUp","actualViewport","requestedWidth","requestedHeight","selectElementOrDescendant","descendant","calculateContentSize","rootElement","originalWidth","originalHeight","rootFontSize","rect","contentSize","actualViewportWidth","scrollWidth","clientWidth","actualViewportHeight","scrollHeight","clientHeight","getComputedStyle","fontSize","findCorrelatingElement","documentClone","elementToFullHtmlDocument","calculateDocumentContentSize","clip","parseHtmlFragment","htmlFragment","addHTMLTagAttributes","htmlTagSubstitute","elementSubstitute","attribute","attributeMatch","helperDoc","attributes","parseHTML","failOnInvalidSource","failOnParseError","validateXHTML","xhtml","DOMParser","parseFromString","lastCacheDate","doDocumentLoad","augmentedUrl","responseXML","loadDocument","svg2image","checkForBlobsResult","urlForSvg","useBlobs","URL","createObjectURL","Blob","cleanUpUrl","revokeObjectURL","simpleForeignObjectSvg","supportsReadingObjectFromCanvas","readingBackFromCanvasBenefitsFromOldSchoolDataUris","blobUrl","supportsReadingFromBlobs","supportsBlobBuilding","err","checkBlobSupport","doesBenefit","checkForBlobs","buildImageUrl","renderSvg","resetEventHandlers","cleanUp","imageUrl","document2svg","svgAttributes","zoomFactor","font-size","foreignObjectAttributes","closestScaledWith","closestScaledHeight","offsetX","offsetY","round","workAroundCollapsingMarginsAcrossSVGElementInWebKitLike","workAroundSafariSometimesNotShowingExternalResources","externalResourcesRequired","workAroundChromeShowingScrollbarsUnderLinuxIfHtmlIsOverflowScroll","serializeAttributes","convertElementToSvg","serializeToString","foreignObjectAttrs","getSvgForDocument","needsWorkaround","drawDocumentAsSvg","rasterize","generalDrawError","drawSvgAsImg","drawImageOnCanvas","doDraw","operateJavaScriptOnDocument","inlineOptions","inlineScripts","inlineReferences","drawResult","getViewportSize","defaultWidth","defaultHeight","constructOptions","params","drawDocument","optionalArguments","workAroundFirefoxNotLoadingStylesheetStyles","replaceChild","extendedOptions","drawURL","workaround","matchQuery","parseQuery","some","typeMatch","expressionsMatch","every","expression","expValue","toPx","toDpi","toDecimal","captures","RE_MEDIA_QUERY","RE_MQ_EXPRESSION","RE_MQ_FEATURE","ratio","numbers","decimal","resolution","RE_RESOLUTION_UNIT","RE_LENGTH_UNIT","peg$subclass","child","parent","ctor","constructor","SyntaxError","line","peg$computePosDetails","advance","details","startPos","endPos","ch","seenCR","peg$cachedPos","peg$cachedPosDetails","peg$fail","peg$currPos","peg$maxFailPos","peg$maxFailExpected","peg$buildException","cleanupExpected","description","buildMessage","stringEscape","hex","toUpperCase","expectedDesc","foundDesc","expectedDescs","posDetails","peg$parsestart","s0","s1","peg$parsesourceEntries","peg$FAILED","peg$reportedPos","peg$c1","s2","s3","s4","s5","peg$parsesourceEntry","peg$parsewhitespace","peg$c3","peg$silentFails","peg$c4","peg$c5","peg$c2","peg$c6","peg$parseurlEntry","peg$parselocalEntry","peg$parseurl","peg$parseformat","peg$c7","peg$c8","peg$c9","peg$c10","peg$parsevalue","peg$c11","peg$c12","peg$c13","peg$c14","peg$c15","peg$c16","peg$c17","peg$c18","peg$c19","peg$c20","peg$c21","peg$c22","peg$c23","peg$result","peg$startRuleFunctions","peg$startRuleFunction","local","chars","extractValue","startRule","grammar","fontFaceSourceValue","serialize","parsedFontFaceSources","sourceItem","itemValue","trimCSSWhitespace","whitespaceRegex","unquoteString","quotedUrl","doubleQuoteRegex","singleQuoteRegex","CSSOM","MatcherList","CSSDocumentRule","matcher","cssTexts","matcherText","CSSStyleDeclaration","CSSFontFaceRule","parentRule","CSSStyleSheet","MediaList","CSSImportRule","character","CSSKeyframeRule","keyText","CSSKeyframesRule","_vendorPrefix","CSSMediaRule","UNKNOWN_RULE","STYLE_RULE","CHARSET_RULE","IMPORT_RULE","FONT_FACE_RULE","PAGE_RULE","KEYFRAMES_RULE","KEYFRAME_RULE","MARGIN_RULE","NAMESPACE_RULE","COUNTER_STYLE_RULE","SUPPORTS_RULE","DOCUMENT_RULE","FONT_FEATURE_VALUES_RULE","VIEWPORT_RULE","REGION_STYLE_RULE","_importants","getPropertyValue","setProperty","priority","removeProperty","prevValue","getPropertyCSSValue","getPropertyPriority","getPropertyShorthand","isPropertyImplicit","properties","text","dummyRule","CSSStyleRule","ruleText","SIGNIFICANT_WHITESPACE","styleRule","StyleSheet","cssRule","rules","CSSValue","_getConstructorName","CSSValueExpression","token","_token","_idx","info","paren","_parseJSComment","_parseJSRexExp","_parseJSString","nextChar","endIdx","commentEndChar","startIdx","substring","_findMatchedIdx","before","legalRegx","isLegal","reg","NOT_FOUND","matched","nextNewLineIdx","appendMatcher","deleteMatcher","appendMedium","medium","deleteMedium","stylesheet","cloned","RULE_TYPES","1","4","8","9","rulesLength","ruleClone","styleClone","styleLength","mediaRule","importRule","fontFaceRule","keyframesRule","documentRule","atRule","importRule-begin","atBlock","documentRule-begin","currentScope","atKeyframesRegExp","parseError","lines","lineCount","charCount","__starts","lastIndex","matchKeyframes","__ends","cssSupport","extractCssUrl","cssUrl","urlRegex","sliceBackgroundDeclaration","backgroundDeclarationText","outerRepeatedMatch","functionParamRegexS","valueRegexS","simpleSingularBackgroundRegexS","simpleBackgroundRegexS","simpleSingularBackgroundRegex","backgroundLayers","getValues","singularBackgroundDeclaration","repeatedMatch","valueRegex","backgroundValues","findBackgroundImageUrlInValues","backgroundValue","backgroundLayerValues","urlMatch","preUrl","postUrl","parsedBackground","backgroundLayer","cssom","rulesForCssTextFromBrowser","styleContent","browserHasBackgroundImageUrlIssue","browserHasFontFaceUrlIssue","browserHasBackgroundImageUrlSetIssue","rulesForCssText","exchangeRule","changeFontFaceRuleSrc","newSrc","inlineImage","inlineScript","inlineCss","getUrlBasePath","parameterHashFunction","JSON","memoizeFunctionOnCaching","memoize","requestExternalsForStylesheet","alreadyLoadedCssUrls","loadCSSImportsForRules","cssImportResult","loadAndInlineCSSResourcesForRules","cssResourcesResult","loadAndInlineCssForStyle","processExternals","childNodes","nodeValue","cloneArray","getCssStyleElements","loadAndInlineStyles","allErrors","getDocumentBaseUrl","substituteLinkWithInlineStyle","oldLinkNode","styleNode","createTextNode","requestStylesheetAndInlineResources","hasChangesFromPathAdjustment","adjustPathsOfCssResources","loadLinkedCSS","cssHref","documentBaseUrl","ajaxOptions","processStylesheet","getCssStylesheetLinks","links","loadAndInlineCssLinks","loadAndInlineImages","inline","loadAndInlineScript","inlineFuncs","backgroundValueParser","fontFaceSrcValueParser","updateCssPropertyValue","property","findBackgroundImageRules","findBackgroundDeclarations","backgroundDeclarations","findFontFaceRules","findCSSImportRules","findExternalBackgroundUrls","matchIndices","isDataUri","findExternalFontFaceUrls","sourceIndices","backgroundRules","change","declaration","externalBackgroundIndices","backgroundLayerIndex","relativeUrl","externalFontFaceUrlIndices","fontFaceSrcDeclaration","fontFaceUrlIndex","substituteRule","newCssRules","fulfilledPromise","loadAndInlineCSSImport","cssHrefRelativeToDoc","externalCssRules","rulesToInline","moreErrors","loadAndInlineBackgroundImages","externalBackgroundLayerIndices","collectAndReportErrors","getDataURIForImageURL","dataURI","iterateOverRulesAndInlineBackgroundImages","cssHasChanges","loadAndInlineFontFace","srcDeclarationValue","urlIndex","fontSrc","binaryAjax","base64Content","btoa","iterateOverRulesAndInlineFontFace","encodeImageAsDataURI","hasAttribute","getAttribute","hasAttributeNS","getAttributeNS","documentBase","filterExternalImages","images","filterInputsForImageType","toArray","svgImages","imageInputs","externalImages","loadLinkedScript","script","escapeClosingTags","substituteExternalScriptWithInline","scriptNode","jsCode","removeNamedItem","getScripts","scripts","baseURI","nodeList","promises","pendingPromiseCount","ajaxRequest","overrideMimeType","mimeType","binaryContent","detectMimeType","constantUniqueIdFor","hasher","memo","retValue","argumentHash","funcHash","innerXML","node","XMLSerializer","getParseError","nodeName","errorMessagePatterns","extractParseError","errorNode","errorMessage","removeInvalidCharacters","serializeAttributeValue","serializeTextContent","serializeAttribute","attr","getTagName","serializeNamespace","isRootNode","nodeHasXmlnsAttr","attrs","serializeChildren","childNode","nodeTreeToXHTML","serializeTag","serializeText","serializeComment","serializeCDATA","rootNode"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","var inject = require('./../node_modules/cssify');\nvar css = \".cssCriticNiceReporter{font-family:sans-serif;font-size:16px}.cssCriticNiceReporter a{text-decoration:none;color:inherit}.cssCriticNiceReporter .comparison .title .titleLink:hover,.cssCriticNiceReporter .componentLabel:hover,.cssCriticNiceReporter .errorText a{text-decoration:underline}.cssCriticNiceReporter button{padding:2px 10px;border-radius:3px;border:none;background-color:#00c04e;font-size:inherit;font-family:inherit}.cssCriticNiceReporter button[disabled]{background-color:#ddd}.cssCriticNiceReporter button:hover{background-color:#24d66c}.cssCriticNiceReporter button:not([disabled]):active{background-color:#4cec8d}.cssCriticNiceReporter .errorText{color:#591100;margin-bottom:1em}.cssCriticNiceReporter .errorText:not(:empty)::before{content:\\\" \\\";margin-right:5px;margin-top:-.3rem;width:1.4rem;height:1.4rem;vertical-align:top;display:inline-block;background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTc5MiIgaGVpZ2h0PSIxNzkyIiB2aWV3Qm94PSIwIDAgMTc5MiAxNzkyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik04OTYgMTI4cTIwOSAwIDM4NS41IDEwM3QyNzkuNSAyNzkuNSAxMDMgMzg1LjUtMTAzIDM4NS41LTI3OS41IDI3OS41LTM4NS41IDEwMy0zODUuNS0xMDMtMjc5LjUtMjc5LjUtMTAzLTM4NS41IDEwMy0zODUuNSAyNzkuNS0yNzkuNSAzODUuNS0xMDN6bTEyOCAxMjQ3di0xOTBxMC0xNC05LTIzLjV0LTIyLTkuNWgtMTkycS0xMyAwLTIzIDEwdC0xMCAyM3YxOTBxMCAxMyAxMCAyM3QyMyAxMGgxOTJxMTMgMCAyMi05LjV0OS0yMy41em0tMi0zNDRsMTgtNjIxcTAtMTItMTAtMTgtMTAtOC0yNC04aC0yMjBxLTE0IDAtMjQgOC0xMCA2LTEwIDE4bDE3IDYyMXEwIDEwIDEwIDE3LjV0MjQgNy41aDE4NXExNCAwIDIzLjUtNy41dDEwLjUtMTcuNXoiLz48L3N2Zz4K) center center/90% no-repeat}.cssCriticNiceReporter .errorText ul{margin:.2em 0}.cssCriticNiceReporter .header{padding:15px;opacity:1;transition-property:background-color,opacity;transition-duration:1s,0s;transition-delay:0s,0s}.cssCriticNiceReporter .header.scrolling{z-index:1;background-color:#fff;margin-top:-8px;margin-bottom:-8px;border-top:8px solid #fff}.cssCriticNiceReporter .fixedHeaderAnchorTarget{height:130px;margin-top:-130px;display:block;visibility:hidden}.cssCriticNiceReporter .header.pass{background-color:#00c04e}.cssCriticNiceReporter .header.fail{background-color:#ff3100}.cssCriticNiceReporter .timeTaken{float:right;padding:.5em 0 0 1em}.cssCriticNiceReporter .statusText{margin-top:.55rem;display:inline-block}.cssCriticNiceReporter .statusText .runAll{display:block;margin-top:.5em;text-decoration:underline}.cssCriticNiceReporter .acceptAll{display:none;margin:-4px 0 -4px 1em}.cssCriticNiceReporter .acceptAll.active{display:inline-block}.cssCriticNiceReporter .cssCriticVersion{display:block;margin:0 0 .3rem;font-size:.7rem}.cssCriticNiceReporter .header.small:not(:hover){opacity:.85;transition-duration:1s,1s;transition-delay:0s,.5s}.cssCriticNiceReporter .header .optional{max-height:200px;transition:max-height .2s;margin:0 -3px -4px;padding:0 3px 4px;overflow:hidden}.cssCriticNiceReporter .header.small:not(:hover) .optional{max-height:0}.cssCriticNiceReporter .header.small:not(:hover) .timeTaken{display:none}.cssCriticNiceReporter .progressBar{margin:0;list-style:none;padding:0}.cssCriticNiceReporter .progressBar:empty::after{content:'';width:0;height:0;border:.63rem solid;border-radius:50%;display:inline-block;opacity:.15}.cssCriticNiceReporter .progressBar li{display:inline-block;vertical-align:top;margin-right:-.4rem;transition:color 1s}.cssCriticNiceReporter .progressBar a{width:0;height:0;border:.63rem solid;border-radius:50%;display:block}.cssCriticNiceReporter .progressBar .pending{color:grey}.cssCriticNiceReporter .progressBar .passed{color:#048337}.cssCriticNiceReporter .progressBar .failed{color:#b62705}.cssCriticNiceReporter .progressBar .error{color:#591100}.cssCriticNiceReporter .progressBar .referenceMissing{color:#ff0}.cssCriticNiceReporter .progressBar a:focus{outline:0}.cssCriticNiceReporter .progressBar .hasRenderErrors{position:relative}.cssCriticNiceReporter .progressBar .hasRenderErrors a::after{content:' ';position:absolute;top:0;left:0;right:0;bottom:0;background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTc5MiIgaGVpZ2h0PSIxNzkyIiB2aWV3Qm94PSIwIDAgMTc5MiAxNzkyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xMDg4IDEyNDh2MjI0cTAgMjYtMTkgNDV0LTQ1IDE5aC0yNTZxLTI2IDAtNDUtMTl0LTE5LTQ1di0yMjRxMC0yNiAxOS00NXQ0NS0xOWgyNTZxMjYgMCA0NSAxOXQxOSA0NXptMzAtMTA1NmwtMjggNzY4cS0xIDI2LTIwLjUgNDV0LTQ1LjUgMTloLTI1NnEtMjYgMC00NS41LTE5dC0yMC41LTQ1bC0yOC03NjhxLTEtMjYgMTcuNS00NXQ0NC41LTE5aDMyMHEyNiAwIDQ0LjUgMTl0MTcuNSA0NXoiLz48L3N2Zz4K) center center/70% no-repeat}.cssCriticNiceReporter .componentLabel{margin:1.8em 0 .5em 15px;font-size:1.15rem}.cssCriticNiceReporter .toc{display:inline-block;list-style:none;padding:3px;margin:1rem -3px 0;font-size:.9rem;background:rgba(255,255,255,.3)}.cssCriticNiceReporter .tocEntry{display:inline-block;margin-right:.8rem}.cssCriticNiceReporter .tocEntry:last-child{margin-right:0}.cssCriticNiceReporter .comparison{background-color:#f5f5f5;padding:15px;margin:4px 0 0}.cssCriticNiceReporter .comparison .title{font-weight:400}.cssCriticNiceReporter .fakeTarget+.comparison,.cssCriticNiceReporter :target+.comparison{padding-left:10px;border-left:5px solid rgba(0,0,0,.15)}.cssCriticNiceReporter .comparison .title .externalLink{vertical-align:top;display:inline-block;width:18px;height:18px;margin-left:.2rem;background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTc5MiIgaGVpZ2h0PSIxNzkyIiB2aWV3Qm94PSIwIDAgMTc5MiAxNzkyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xNDA4IDkyOHYzMjBxMCAxMTktODQuNSAyMDMuNXQtMjAzLjUgODQuNWgtODMycS0xMTkgMC0yMDMuNS04NC41dC04NC41LTIwMy41di04MzJxMC0xMTkgODQuNS0yMDMuNXQyMDMuNS04NC41aDcwNHExNCAwIDIzIDl0OSAyM3Y2NHEwIDE0LTkgMjN0LTIzIDloLTcwNHEtNjYgMC0xMTMgNDd0LTQ3IDExM3Y4MzJxMCA2NiA0NyAxMTN0MTEzIDQ3aDgzMnE2NiAwIDExMy00N3Q0Ny0xMTN2LTMyMHEwLTE0IDktMjN0MjMtOWg2NHExNCAwIDIzIDl0OSAyM3ptMzg0LTg2NHY1MTJxMCAyNi0xOSA0NXQtNDUgMTktNDUtMTlsLTE3Ni0xNzYtNjUyIDY1MnEtMTAgMTAtMjMgMTB0LTIzLTEwbC0xMTQtMTE0cS0xMC0xMC0xMC0yM3QxMC0yM2w2NTItNjUyLTE3Ni0xNzZxLTE5LTE5LTE5LTQ1dDE5LTQ1IDQ1LTE5aDUxMnEyNiAwIDQ1IDE5dDE5IDQ1eiIvPjwvc3ZnPgo=) center center/90% no-repeat;opacity:.3}.cssCriticNiceReporter .comparison .title .externalLink:hover{opacity:.5}.cssCriticNiceReporter .comparison .parameters,.cssCriticNiceReporter .comparison .parameters dd,.cssCriticNiceReporter .comparison .parameters dt{display:inline-block;margin:0}.cssCriticNiceReporter .comparison .parameters{margin-left:1.5em;color:#444}.cssCriticNiceReporter .comparison .parameters dt{font-style:italic}.cssCriticNiceReporter .comparison .parameters dt::after{content:\\\":\\\"}.cssCriticNiceReporter .comparison .parameters dd{margin-left:.5em;margin-right:.7em}.cssCriticNiceReporter .comparison .parameters dd::after{content:\\\",\\\"}.cssCriticNiceReporter .comparison .parameters dd:last-child::after{content:\\\"\\\"}.cssCriticNiceReporter .running.comparison .referenceImageContainer{opacity:.2}.cssCriticNiceReporter .comparison .referenceImageContainer:empty{display:none}.cssCriticNiceReporter .comparison .imageWrapper{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAKUlEQVQ4jWNYt27df2Lwo0ePiMIMowaOGjgsDSRWIbEWjxo4auCwNBAAenk4PB4atggAAAAASUVORK5CYII=) -5px -5px;-webkit-user-select:none;-moz-user-select:none;user-select:none}.cssCriticNiceReporter .comparison canvas,.cssCriticNiceReporter .comparison img{display:block}.cssCriticNiceReporter .comparison .pageImageContainer,.cssCriticNiceReporter .comparison .referenceImageContainer{border:1px solid #000}.cssCriticNiceReporter .comparison .outerPageImageContainer,.cssCriticNiceReporter .comparison .referenceImageContainer{position:relative;display:inline-block}.cssCriticNiceReporter .comparison .referenceImageContainer .diff{max-height:0;max-width:0;opacity:0}.cssCriticNiceReporter .passed.comparison .referenceImageContainer{display:none}.cssCriticNiceReporter .failed.comparison .referenceImageContainer{margin-bottom:4px}.cssCriticNiceReporter .failed.comparison .referenceImageContainer:hover .diff{max-height:none;max-width:none;opacity:1;transition:opacity 1s}.cssCriticNiceReporter .failed.comparison .referenceImageContainer:hover .imageWrapper{opacity:.5;transition:opacity 1s;position:absolute;top:0;left:0;right:0;bottom:0}.cssCriticNiceReporter .failed.comparison .pageImageContainer,.cssCriticNiceReporter .failed.comparison .referenceImageContainer,.cssCriticNiceReporter .referenceMissing.comparison .pageImageContainer,.cssCriticNiceReporter .referenceMissing.comparison .referenceImageContainer{margin-left:65px}.cssCriticNiceReporter .comparison iframe{border:none;display:block;background:0 0}.cssCriticNiceReporter .comparison.realView .pageImageContainer{border-style:dashed}.cssCriticNiceReporter .comparison .toggleView{vertical-align:top;position:absolute;top:0;height:30px;right:-45px;width:30px;font-size:.7rem;background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTc5MiIgaGVpZ2h0PSIxNzkyIiB2aWV3Qm94PSIwIDAgMTc5MiAxNzkyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xNjY0IDk2MHEtMTUyLTIzNi0zODEtMzUzIDYxIDEwNCA2MSAyMjUgMCAxODUtMTMxLjUgMzE2LjV0LTMxNi41IDEzMS41LTMxNi41LTEzMS41LTEzMS41LTMxNi41cTAtMTIxIDYxLTIyNS0yMjkgMTE3LTM4MSAzNTMgMTMzIDIwNSAzMzMuNSAzMjYuNXQ0MzQuNSAxMjEuNSA0MzQuNS0xMjEuNSAzMzMuNS0zMjYuNXptLTcyMC0zODRxMC0yMC0xNC0zNHQtMzQtMTRxLTEyNSAwLTIxNC41IDg5LjV0LTg5LjUgMjE0LjVxMCAyMCAxNCAzNHQzNCAxNCAzNC0xNCAxNC0zNHEwLTg2IDYxLTE0N3QxNDctNjFxMjAgMCAzNC0xNHQxNC0zNHptODQ4IDM4NHEwIDM0LTIwIDY5LTE0MCAyMzAtMzc2LjUgMzY4LjV0LTQ5OS41IDEzOC41LTQ5OS41LTEzOS0zNzYuNS0zNjhxLTIwLTM1LTIwLTY5dDIwLTY5cTE0MC0yMjkgMzc2LjUtMzY4dDQ5OS41LTEzOSA0OTkuNSAxMzkgMzc2LjUgMzY4cTIwIDM1IDIwIDY5eiIvPjwvc3ZnPgo=) center center/80% no-repeat;opacity:.3}.cssCriticNiceReporter .comparison .toggleView:hover{opacity:.5}.cssCriticNiceReporter .comparison.realView .toggleView{background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTc5MiIgaGVpZ2h0PSIxNzkyIiB2aWV3Qm94PSIwIDAgMTc5MiAxNzkyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik01NTUgMTMzNWw3OC0xNDFxLTg3LTYzLTEzNi0xNTl0LTQ5LTIwM3EwLTEyMSA2MS0yMjUtMjI5IDExNy0zODEgMzUzIDE2NyAyNTggNDI3IDM3NXptMzg5LTc1OXEwLTIwLTE0LTM0dC0zNC0xNHEtMTI1IDAtMjE0LjUgODkuNXQtODkuNSAyMTQuNXEwIDIwIDE0IDM0dDM0IDE0IDM0LTE0IDE0LTM0cTAtODYgNjEtMTQ3dDE0Ny02MXEyMCAwIDM0LTE0dDE0LTM0em0zNjMtMTkxcTAgNy0xIDktMTA1IDE4OC0zMTUgNTY2dC0zMTYgNTY3bC00OSA4OXEtMTAgMTYtMjggMTYtMTIgMC0xMzQtNzAtMTYtMTAtMTYtMjggMC0xMiA0NC04Ny0xNDMtNjUtMjYzLjUtMTczdC0yMDguNS0yNDVxLTIwLTMxLTIwLTY5dDIwLTY5cTE1My0yMzUgMzgwLTM3MXQ0OTYtMTM2cTg5IDAgMTgwIDE3bDU0LTk3cTEwLTE2IDI4LTE2IDUgMCAxOCA2dDMxIDE1LjUgMzMgMTguNSAzMS41IDE4LjUgMTkuNSAxMS41cTE2IDEwIDE2IDI3em0zNyA0NDdxMCAxMzktNzkgMjUzLjV0LTIwOSAxNjQuNWwyODAtNTAycTggNDUgOCA4NHptNDQ4IDEyOHEwIDM1LTIwIDY5LTM5IDY0LTEwOSAxNDUtMTUwIDE3Mi0zNDcuNSAyNjd0LTQxOS41IDk1bDc0LTEzMnEyMTItMTggMzkyLjUtMTM3dDMwMS41LTMwN3EtMTE1LTE3OS0yODItMjk0bDYzLTExMnE5NSA2NCAxODIuNSAxNTN0MTQ0LjUgMTg0cTIwIDM0IDIwIDY5eiIvPjwvc3ZnPgo=);opacity:1}.cssCriticNiceReporter .comparison .accept{vertical-align:top;position:absolute;top:0;bottom:0;left:0;width:50px;font-size:.7rem}.cssCriticNiceReporter .accepted.comparison .accept{font-size:1.4rem}.cssCriticNiceReporter .comparison button span{transform:rotate(-90deg);display:block}.cssCriticNiceReporter .comparison .referenceImageContainer{opacity:1;max-height:1000000px}.cssCriticNiceReporter .accepted.comparison .referenceImageContainer{opacity:0;max-height:0;border-width:0;transition:max-height 1ms ease 1s,opacity 1s,border-width 1ms ease 1s}.cssCriticNiceReporter .comparison:hover .referenceImageContainer::after{position:absolute;top:0;right:0;transform:translateX(100%);margin-right:-8px;padding:4px;white-space:nowrap;background-color:#000;opacity:.55;color:#fff;font-size:.9rem;border-radius:5px}.cssCriticNiceReporter .failed.comparison:hover .referenceImageContainer::after{content:\\\"< Hover over the reference image to highlight changes\\\"}.cssCriticNiceReporter .failed.comparison .referenceImageContainer:hover::after{display:none}.cssCriticNiceReporter .browserWarning::before{content:\\\"⚠\\\";font-size:1.2rem;padding-right:5px;vertical-align:middle}.cssCriticNiceReporter .browserWarning{position:fixed;top:0;left:0;width:100%;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;z-index:2;background-color:rgba(182,39,5,.85);color:#fff;font-size:1.2rem;border:2px solid #000;padding:20px}\";\ninject(css, undefined, '_1c4ids2');\nmodule.exports = css;\n","(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module unless amdModuleId is set\n    define([\"ayepromise\",\"imagediff\",\"rasterizeHTML\"], function (a0,b1,c2) {\n      return (root['csscritic'] = factory(a0,b1,c2));\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like environments that support module.exports,\n    // like Node.\n    module.exports = factory(require(\"ayepromise\"),require(\"imagediff\"),require(\"rasterizehtml\"),require(\"../build/csscritic.concat.css\"));\n  } else {\n    root['csscritic'] = factory(root[\"ayepromise\"],root[\"imagediff\"],root[\"rasterizeHTML\"]);\n  }\n}(this, function (ayepromise, imagediff, rasterizeHTML) {\n\nvar csscriticLib = {};\n\ncsscriticLib.browserRenderer = function (util, jobQueue, rasterizeHTML) {\n    \"use strict\";\n\n    var module = {};\n\n    var cache = {};\n\n    var queue;\n\n    var getOrCreateJobQueue = function () {\n        if (!queue) {\n            queue = jobQueue();\n        }\n        return queue;\n    };\n\n    var extractErrorMessages = function (errors) {\n        return errors.map(function (error) {\n            return error.msg;\n        });\n    };\n\n    var logErrorToConsole = function (e) {\n        console.error(e);\n\n        throw e;\n    };\n\n    var doRenderHtml = function (parameters) {\n        var drawOptions = {\n            cache: 'repeated',\n            cacheBucket: cache,\n            width: parameters.width,\n            height: parameters.height,\n            executeJs: true,\n            executeJsTimeout: 50,\n            baseUrl: parameters.baseUrl\n        };\n        ['hover', 'active', 'focus', 'target'].forEach(function (key) {\n            if (parameters[key]) {\n                drawOptions[key] = parameters[key];\n            }\n        });\n\n        return rasterizeHTML.drawHTML(parameters.html, drawOptions).then(function (result) {\n            var renderErrors = extractErrorMessages(result.errors);\n\n            return {\n                image: result.image,\n                errors: renderErrors\n            };\n        }, logErrorToConsole);\n    };\n\n    var renderHtmlFromBlob = function (blob, parameters) {\n        return util.loadBlobAsText(blob).then(function (content) {\n            return doRenderHtml({\n                html: content,\n                baseUrl: parameters.url,\n                width: parameters.width,\n                height: parameters.height,\n                hover: parameters.hover,\n                active: parameters.active,\n                focus: parameters.focus,\n                target: parameters.target\n            });\n        });\n    };\n\n    var loadImageFromBlob = function (blob, parameters) {\n        return util.loadBlobAsDataURI(blob)\n            .then(util.getImageForUrl)\n            .then(function (image) {\n                return {\n                    image: image,\n                    errors: []\n                };\n            }, function () {\n                // It's not an image, so it must be a HTML page\n                return renderHtmlFromBlob(blob, parameters);\n            });\n    };\n\n    module.render = function (parameters) {\n        // Execute render jobs one after another to stabilise rendering (especially JS execution).\n        // Also provides a more fluid response. Performance seems not to be affected.\n        return getOrCreateJobQueue().execute(function () {\n            return util.loadAsBlob(parameters.url)\n                .then(function (blob) {\n                    return loadImageFromBlob(blob, parameters);\n                });\n        });\n    };\n\n    return module;\n};\n\ncsscriticLib.indexeddbstorage = function (util) {\n    \"use strict\";\n\n    var module = {};\n\n    var createDb = function(db) {\n        db.createObjectStore('references', { keyPath: \"testCase\" });\n    };\n\n    var getDb = function () {\n        var defer = ayepromise.defer(),\n            request = indexedDB.open('csscritic', 1);\n\n        request.onsuccess = function (event) {\n            var db = event.target.result;\n            defer.resolve(db);\n        };\n        request.onupgradeneeded = function (event) {\n            var db = event.target.result;\n            createDb(db);\n        };\n        return defer.promise;\n    };\n\n    var buildKey = function (testCase) {\n        var testCaseParameters = util.excludeKeys(testCase, 'url'),\n            serializedParameters = util.serializeMap(testCaseParameters),\n            key = testCase.url;\n\n        if (serializedParameters) {\n            key += ',' + serializedParameters;\n        }\n\n        return key;\n    };\n\n    module.storeReferenceImage = function (testCase, referenceImage, viewport) {\n        var defer = ayepromise.defer(),\n            imageUri;\n\n        imageUri = util.getDataURIForImage(referenceImage);\n\n        var key = buildKey(testCase);\n\n        getDb().then(function (db) {\n            var request = db.transaction(['references'], 'readwrite')\n                .objectStore('references')\n                .put({\n                    testCase: key,\n                    reference: {\n                        imageUri: imageUri,\n                        viewport: viewport\n                    }\n                });\n\n            request.onsuccess = function () {\n                db.close();\n\n                defer.resolve();\n            };\n        });\n\n        return defer.promise;\n    };\n\n    module.readReferenceImage = function (testCase) {\n        var defer = ayepromise.defer(),\n            key = buildKey(testCase);\n\n        getDb().then(function (db) {\n            var request = db.transaction(['references'])\n                .objectStore('references')\n                .get(key);\n\n            request.onsuccess = function () {\n                db.close();\n\n                if (request.result === undefined || request.result.reference === undefined || request.result.reference.imageUri === undefined) {\n                    defer.reject();\n                    return;\n                }\n\n                var dataObj = request.result.reference;\n\n                util.getImageForUrl(dataObj.imageUri).then(function (img) {\n                    var viewport = dataObj.viewport || {\n                        width: img.width,\n                        height: img.height\n                    };\n\n                    defer.resolve({\n                        image: img,\n                        viewport: viewport\n                    });\n                }, defer.reject);\n            };\n        });\n\n        return defer.promise;\n    };\n\n    return module;\n};\n\ncsscriticLib.jobQueue = function () {\n    \"use strict\";\n\n    var module = {};\n\n    var jobQueue = [],\n        busy = false;\n\n    var runJob = function (job) {\n        var result = job.func();\n\n        job.resolve(result);\n        return result;\n    };\n\n    var nextInQueue = function () {\n        var job;\n        if (jobQueue.length > 0) {\n            busy = true;\n\n            job = jobQueue.shift();\n\n            runJob(job)\n                .then(nextInQueue, nextInQueue);\n        } else {\n            busy = false;\n        }\n    };\n\n    var constructJob = function (func) {\n        var defer = ayepromise.defer();\n\n        return {\n            func: func,\n            resolve: defer.resolve,\n            promise: defer.promise\n        };\n    };\n\n    module.execute = function (func) {\n        var job = constructJob(func);\n\n        jobQueue.push(job);\n        if (!busy) {\n            nextInQueue();\n        }\n\n        return job.promise;\n    };\n\n    return module;\n};\n\ncsscriticLib.main = function (regression, reporting, util, storage, selectionFilter) {\n    \"use strict\";\n\n    var module = {};\n\n    var testCases = [],\n        currentComponentLabel;\n\n\n    module.component = function (componentLabel) {\n        currentComponentLabel = componentLabel;\n    };\n\n\n    var supportUrlAsOnlyTestCaseInput = function (testCase) {\n        if (typeof testCase === 'string') {\n            return {\n                url: testCase\n            };\n        }\n        return testCase;\n    };\n\n    module.add = function (testCase) {\n        var augmentedTestCase = util.clone(supportUrlAsOnlyTestCaseInput(testCase));\n\n        if (currentComponentLabel && augmentedTestCase.component === undefined) {\n            augmentedTestCase.component = currentComponentLabel;\n        }\n\n        testCases.push(augmentedTestCase);\n    };\n\n\n    var fetchStartingComparisons = function (testCases) {\n        return util.all(testCases.map(function (testCase) {\n            return storage.readReferenceImage(testCase)\n                .then(function (referenceImageRecord) {\n                    return {\n                        testCase: testCase,\n                        referenceImage: referenceImageRecord.image,\n                        viewport: referenceImageRecord.viewport\n                    };\n                }, function () {\n                    // no referenceImage found\n                    return {\n                        testCase: testCase\n                    };\n                });\n        }));\n    };\n\n    var selectComparisons = function (configuredComparisons) {\n        return configuredComparisons.map(function (configuredComparison) {\n            return {\n                configuredComparison: configuredComparison,\n                selected: !selectionFilter || selectionFilter.isComparisonSelected(configuredComparison)\n            };\n        });\n    };\n\n    var reportConfiguredComparisons = function (comparisonSelection) {\n        return util.all(comparisonSelection.map(function (selection) {\n            var isSelected = selection.selected;\n            return reporting.doReportConfiguredComparison(selection.configuredComparison, isSelected);\n        }));\n    };\n\n    var executeTestCase = function (startingComparison) {\n        return regression.compare(startingComparison).then(function (comparison) {\n            return reporting.doReportComparison(comparison).then(function () {\n                return comparison;\n            });\n        });\n    };\n\n    module.execute = function () {\n        var comparisonSelection, allPassed;\n\n        return fetchStartingComparisons(testCases)\n            .then(function (startingComp) {\n                comparisonSelection = selectComparisons(startingComp);\n\n                return reportConfiguredComparisons(comparisonSelection);\n            })\n            .then(function () {\n                var selectedComparisons = comparisonSelection.filter(function (selection) {\n                    return selection.selected;\n                }).map(function (selection) {\n                    return selection.configuredComparison;\n                });\n\n                return util.all(selectedComparisons.map(\n                    executeTestCase\n                ));\n            })\n            .then(function (comparisons) {\n                allPassed = util.hasTestSuitePassed(comparisons);\n            })\n            .then(function () {\n                return reporting.doReportTestSuite(allPassed);\n            })\n            .then(function () {\n                return allPassed;\n            });\n    };\n\n    return module;\n};\n\ncsscriticLib.regression = function (renderer, util, imagediff) {\n    \"use strict\";\n\n    var module = {};\n\n    var toleranceToWorkAroundFirefoxRenderingAFewPixelsIndeterministicallyOnLinux = 1;\n\n    var workAroundFirefoxResourcesSporadicallyMissing = function (htmlImage, referenceImage) {\n        if (referenceImage) {\n            // This does nothing meaningful for us, but seems to trigger Firefox to load any missing resources.\n            imagediff.diff(htmlImage, referenceImage);\n        }\n    };\n\n    var workAroundBrowserIssues = function (pageImage, referenceImage) {\n        workAroundFirefoxResourcesSporadicallyMissing(pageImage, referenceImage);\n\n        return util.workAroundTransparencyIssueInFirefox(pageImage);\n    };\n\n    var compareRenderingAndReference = function (pageImage, referenceImage) {\n        var isEqual;\n\n        return workAroundBrowserIssues(pageImage, referenceImage).then(function (adaptedHtmlImage) {\n            if (referenceImage) {\n                isEqual = imagediff.equal(\n                    adaptedHtmlImage,\n                    referenceImage,\n                    toleranceToWorkAroundFirefoxRenderingAFewPixelsIndeterministicallyOnLinux\n                );\n                return isEqual ? \"passed\" : \"failed\";\n            } else {\n                return \"referenceMissing\";\n            }\n        });\n    };\n\n    var comparisonResult = function (textualStatus, testCase, viewport, renderErrors, pageImage, referenceImage) {\n        var result = {\n            status: textualStatus,\n            testCase: testCase,\n            viewport: util.clone(viewport),\n            renderErrors: renderErrors\n        };\n\n        if (pageImage) {\n            result.pageImage = pageImage;\n        }\n        if (referenceImage) {\n            result.referenceImage = referenceImage;\n        }\n        return result;\n    };\n\n    var extractErrorMessage = function (e) {\n        if (e.originalError && e.originalError.message) {\n            return e.message +': ' + e.originalError.message;\n        }\n\n        return e.message;\n    };\n\n    var loadPageAndCompare = function (testCase, viewport, referenceImage) {\n        return renderer.render({\n            url: testCase.url,\n            hover: testCase.hover,\n            active: testCase.active,\n            focus: testCase.focus,\n            target: testCase.target,\n            width: viewport.width,\n            height: viewport.height\n        }).then(function (renderResult) {\n            return compareRenderingAndReference(renderResult.image, referenceImage).then(function (textualStatus) {\n                return comparisonResult(textualStatus,\n                                        testCase,\n                                        viewport,\n                                        renderResult.errors,\n                                        renderResult.image,\n                                        referenceImage);\n            });\n        }, function (e) {\n            var errors = [];\n            if (e) {\n                errors.push(extractErrorMessage(e));\n            }\n            return comparisonResult(\"error\",\n                                    testCase,\n                                    viewport,\n                                    errors);\n        });\n    };\n\n    var viewportFallback = function (testCase) {\n        var fallbackWidth = 800,\n            fallbackHeight = 100;\n        return {\n            width: testCase.width || fallbackWidth,\n            height: testCase.height || fallbackHeight\n        };\n    };\n\n    module.compare = function (startingComparison) {\n        var viewport = startingComparison.viewport;\n\n        if (startingComparison.referenceImage === undefined) {\n            viewport = viewportFallback(startingComparison.testCase);\n        }\n\n        return loadPageAndCompare(startingComparison.testCase, viewport, startingComparison.referenceImage);\n    };\n\n    return module;\n};\n\ncsscriticLib.reporting = function (renderer, storage, util) {\n    \"use strict\";\n\n    var module = {};\n\n    var reporters = [];\n\n    module.addReporter = function (reporter) {\n        reporters.push(reporter);\n    };\n\n    var testCaseIsResizable = function (testCase) {\n        return testCase.width === undefined && testCase.height === undefined;\n    };\n\n    var attachPageAcceptHelpers = function (comparison) {\n        var viewportWidth, viewportHeight;\n\n        if (comparison.pageImage) {\n            viewportWidth = comparison.viewport.width;\n            viewportHeight = comparison.viewport.height;\n\n            if (testCaseIsResizable(comparison.testCase)) {\n                comparison.resizePageImage = function (width, height) {\n                    viewportWidth = width;\n                    viewportHeight = height;\n\n                    return renderer.render({\n                        url: comparison.testCase.url,\n                        hover: comparison.testCase.hover,\n                        active: comparison.testCase.active,\n                        width: width,\n                        height: height\n                    }).then(function (renderResult) {\n                        comparison.pageImage = renderResult.image;\n                        return renderResult.image;\n                    });\n                };\n            }\n            comparison.acceptPage = function () {\n                storage.storeReferenceImage(comparison.testCase, comparison.pageImage, {\n                    width: viewportWidth,\n                    height: viewportHeight\n                });\n            };\n        }\n    };\n\n    var reportingMethod = function (reporter, isSelected) {\n        if (isSelected) {\n            return reporter.reportSelectedComparison;\n        } else {\n            return reporter.reportDeselectedComparison;\n        }\n    };\n\n    module.doReportConfiguredComparison = function (configuredComparison, isSelected) {\n        return util.all(reporters.map(function (reporter) {\n            var reportingFunc = reportingMethod(reporter, isSelected);\n            if (reportingFunc) {\n                return reportingFunc(configuredComparison);\n            }\n        }));\n    };\n\n    module.doReportComparison = function (comparison) {\n        var result = util.clone(comparison);\n\n        attachPageAcceptHelpers(result);\n\n        return util.all(reporters.map(function (reporter) {\n            if (reporter.reportComparison) {\n                return reporter.reportComparison(result);\n            }\n        }));\n    };\n\n    module.doReportTestSuite = function (passed) {\n        return util.all(reporters.map(function (reporter) {\n            if (reporter.reportTestSuite) {\n                return reporter.reportTestSuite({success: passed});\n            }\n        }));\n    };\n\n    return module;\n};\n\ncsscriticLib.util = function () {\n    \"use strict\";\n\n    var module = {};\n\n    module.getDataURIForImage = function (image) {\n        var canvas = window.document.createElement(\"canvas\"),\n            context = canvas.getContext(\"2d\");\n\n        canvas.width = image.naturalWidth;\n        canvas.height = image.naturalHeight;\n\n        context.drawImage(image, 0, 0);\n\n        return canvas.toDataURL(\"image/png\");\n    };\n\n    module.getImageForUrl = function (url) {\n        var defer = ayepromise.defer(),\n            image = new window.Image();\n\n        image.onload = function () {\n            defer.resolve(image);\n        };\n        image.onerror = function () {\n            defer.reject();\n        };\n        image.src = url;\n\n        return defer.promise;\n    };\n\n    var getUncachableURL = function (url) {\n        var delimiter;\n        if (url.indexOf(\"?\") < 0) {\n            delimiter = \"?\";\n        } else {\n            delimiter = \"&\";\n        }\n        return url + delimiter + \"_=\" + Date.now();\n    };\n\n    module.ajax = function (url) {\n        var defer = ayepromise.defer(),\n            xhr = new XMLHttpRequest();\n\n        xhr.onload = function () {\n            if (xhr.status === 200 || xhr.status === 0) {\n                defer.resolve(xhr.response);\n            } else {\n                defer.reject();\n            }\n        };\n\n        xhr.onerror = function () {\n            defer.reject();\n        };\n\n        try {\n            xhr.open('get', getUncachableURL(url), true);\n            xhr.send();\n        } catch (e) {\n            defer.reject();\n        }\n\n        return defer.promise;\n    };\n\n    module.loadAsBlob = function (url) {\n        var defer = ayepromise.defer(),\n            xhr = new XMLHttpRequest();\n\n        xhr.onload = function () {\n            if (xhr.status === 200 || xhr.status === 0) {\n                defer.resolve(xhr.response);\n            } else {\n                defer.reject(new Error(xhr.statusText));\n            }\n        };\n\n        xhr.onerror = function (e) {\n            defer.reject(e);\n        };\n\n        try {\n            xhr.open('get', getUncachableURL(url), true);\n            xhr.responseType = 'blob';\n            xhr.send();\n        } catch (e) {\n            defer.reject(e);\n        }\n\n        return defer.promise;\n    };\n\n    module.loadBlobAsText = function (blob) {\n        var defer = ayepromise.defer(),\n            reader = new FileReader();\n\n        reader.onload = function (e) {\n            defer.resolve(e.target.result);\n        };\n\n        reader.onerror = function () {\n            defer.reject();\n        };\n\n        reader.readAsText(blob);\n\n        return defer.promise;\n    };\n\n    module.loadBlobAsDataURI = function (blob) {\n        var defer = ayepromise.defer(),\n            reader = new FileReader();\n\n        reader.onload = function (e) {\n            defer.resolve(e.target.result);\n        };\n\n        reader.onerror = function () {\n            defer.reject();\n        };\n\n        reader.readAsDataURL(blob);\n\n        return defer.promise;\n\n    };\n\n    // excludeKeys(theMap, excludeKey...)\n    module.excludeKeys = function (theMap) {\n        var excludeKeys = Array.prototype.slice.call(arguments, 1),\n            newMap = {};\n\n        Object.keys(theMap).forEach(function (key) {\n            if (excludeKeys.indexOf(key) === -1) {\n                newMap[key] = theMap[key];\n            }\n        });\n\n        return newMap;\n    };\n\n    module.serializeMap = function (theMap) {\n        var serializationEntries = [],\n            keys = Object.keys(theMap);\n\n        keys.sort();\n        keys.forEach(function (key) {\n            serializationEntries.push(key + '=' + theMap[key]);\n        });\n        return serializationEntries.join(',');\n    };\n\n    module.clone = function (object) {\n        var theClone = {},\n            i;\n        for (i in object) {\n            if (object.hasOwnProperty(i)) {\n               theClone[i] = object[i];\n            }\n        }\n        return theClone;\n    };\n\n    var successfulPromise = function (value) {\n        var defer = ayepromise.defer();\n        defer.resolve(value);\n        return defer.promise;\n    };\n\n    module.workAroundTransparencyIssueInFirefox = function (image) {\n        // Work around bug https://bugzilla.mozilla.org/show_bug.cgi?id=790468 where the content of a canvas\n        //   drawn to another one will be slightly different if transparency is involved.\n        // Here the reference image has been drawn to a canvas once (to serialize it to localStorage), while the\n        //   image of the newly rendered page hasn't.  Solution: apply the same transformation to the second image, too.\n        var dataUri;\n        try {\n            dataUri = module.getDataURIForImage(image);\n        } catch (e) {\n            // Fallback for Chrome & Safari\n            return successfulPromise(image);\n        }\n\n        return module.getImageForUrl(dataUri);\n    };\n\n    module.hasTestSuitePassed = function (comparisons) {\n        var nonPassingTestCases = comparisons.filter(function (comparison) {\n                return comparison.status !== \"passed\";\n            }),\n            allPassed = nonPassingTestCases.length === 0,\n            hasValidTestSetup = comparisons.length > 0;\n\n        return hasValidTestSetup && allPassed;\n    };\n\n    module.all = function (functionReturnValues) {\n        var defer = ayepromise.defer(),\n            pendingFunctionCalls = functionReturnValues.length,\n            resolvedValues = [];\n\n        var functionCallResolved = function (value, idx) {\n            pendingFunctionCalls -= 1;\n            resolvedValues[idx] = value;\n\n            if (pendingFunctionCalls === 0) {\n                defer.resolve(resolvedValues);\n            }\n        };\n\n        if (functionReturnValues.length === 0) {\n            defer.resolve([]);\n            return defer.promise;\n        }\n\n        functionReturnValues.forEach(function (returnValue, idx) {\n            if (returnValue && returnValue.then) {\n                returnValue.then(function (result) {\n                    functionCallResolved(result, idx);\n                }, function (e) {\n                    defer.reject(e);\n                });\n            } else {\n                functionCallResolved(returnValue, idx);\n            }\n        });\n        return defer.promise;\n    };\n\n    return module;\n};\n\ncsscriticLib.fallbackFilter = function (windowLocation) {\n    \"use strict\";\n\n    var module = {};\n\n    var storageKey = 'csscriticFallbackFilter';\n\n    var fullDescription = function (testCase) {\n        return testCase.component ? testCase.component + ' ' + testCase.desc : testCase.desc;\n    };\n\n    module.isComparisonSelected = function (comparison) {\n        var filter = sessionStorage.getItem(storageKey);\n\n        if (!filter) {\n            return true;\n        }\n\n        if (comparison.testCase.desc && fullDescription(comparison.testCase) === filter) {\n            return true;\n        }\n        if (comparison.testCase.component && comparison.testCase.component === filter) {\n            return true;\n        }\n\n        return !filter || comparison.testCase.url === filter;\n    };\n\n    module.filterFor = function (testCase) {\n        var filter;\n\n        if (testCase.desc) {\n            filter = fullDescription(testCase);\n        } else {\n            filter = testCase.url;\n        }\n        sessionStorage.setItem(storageKey, filter);\n\n        windowLocation.reload();\n    };\n\n    module.filterForComponent = function (componentLabel) {\n        sessionStorage.setItem(storageKey, componentLabel);\n\n        windowLocation.reload();\n    };\n\n    module.clearFilter = function () {\n        sessionStorage.removeItem(storageKey);\n\n        windowLocation.reload();\n    };\n\n    return module;\n};\n\ncsscriticLib.niceReporter = function (window, util, selectionFilter, pageNavigationHandlingFallback, rasterizeHTML, packageVersion) {\n    \"use strict\";\n\n    var module = {};\n\n    // our very own templating implementation\n\n    var escapeValue = function (value) {\n        return value.toString()\n            .replace(/&/g, '&amp;')\n            .replace(new RegExp('<'), '&lt;', 'g') // work around https://github.com/cburgmer/inlineresources/issues/2\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&apos;');\n    };\n\n    var template = function (templateStr, values) {\n        return templateStr.replace(/\\{\\{(\\w+)\\}\\}/g, function (_, param) {\n            var value = values[param] !== undefined ? values[param] : '';\n            return escapeValue(value);\n        });\n    };\n\n    var elementFor = function (htmlString) {\n        var tmp = document.createElement('body');\n        tmp.insertAdjacentHTML('beforeend', htmlString);\n        return tmp.firstChild;\n    };\n\n    var findElementIn = function (container, elementClassName) {\n        return container.querySelector('.' + elementClassName);\n    };\n\n    var escapeId = function (id) {\n        return id.replace(/ /g, '_');\n    };\n\n    // container\n\n    var headerClassName = 'header',\n        timeTakenClassName = 'timeTaken',\n        progressBarClassName = 'progressBar',\n        statusTextClassName = 'statusText',\n        headerOptionalClassName = 'optional';\n\n    var elementDimensions = function (element) {\n        var initialPosition = element.getBoundingClientRect(),\n            scrollOffsetTop = document.body.scrollTop || document.documentElement.scrollTop,\n            scrollOffsetLeft = document.body.scrollLeft || document.documentElement.scrollLeft;\n\n        return {\n            top: initialPosition.top + scrollOffsetTop,\n            left: initialPosition.left + scrollOffsetLeft,\n            right: initialPosition.right - initialPosition.width + scrollOffsetLeft,\n            height: initialPosition.height\n        };\n    };\n\n    var px = function (value) {\n        return value + 'px';\n    };\n\n    var makeElementFixedOnScroll = function (element) {\n        var scrollingClass = 'scrolling',\n            smallClass = 'small',\n            smallScrollThreshold = 50,\n            isScrolling = false,\n            isSmall = false,\n            pseudoInlineElement = document.createElement('div'),\n            dimensions;\n\n        window.addEventListener(\"scroll\", function () {\n            if (window.scrollY > 0) {\n                if (! isScrolling) {\n                    isScrolling = true;\n\n                    dimensions = elementDimensions(element);\n\n                    element.classList.add(scrollingClass);\n\n                    element.style.position = 'fixed';\n                    element.style.top = px(dimensions.top);\n                    element.style.left = px(dimensions.left);\n                    element.style.right = px(dimensions.right);\n\n                    pseudoInlineElement.style.height = px(dimensions.height);\n                    element.parentElement.insertBefore(pseudoInlineElement, element);\n                }\n                if (! isSmall && window.scrollY > smallScrollThreshold) {\n                    isSmall = true;\n                    element.classList.add(smallClass);\n                } else if (isSmall && window.scrollY <= smallScrollThreshold) {\n                    isSmall = false;\n                    element.classList.remove(smallClass);\n                }\n            } else {\n                if (isScrolling) {\n                    isScrolling = false;\n\n                    element.classList.remove(scrollingClass);\n                    element.classList.remove(smallClass);\n\n                    element.style.position = '';\n                    element.style.top = '';\n                    element.style.left = '';\n                    element.style.right = '';\n\n                    element.parentElement.removeChild(pseudoInlineElement);\n                }\n            }\n        });\n    };\n\n    var showHeader = function (container) {\n        var header = elementFor(template('<header class=\"{{headerClassName}}\">' +\n                                         '<span class=\"{{timeTakenClassName}}\"></span>' +\n                                         '<a href=\"http://cburgmer.github.io/csscritic/\" class=\"cssCriticVersion\">' +\n                                         'CSS Critic {{packageVersion}}' +\n                                         '</a>' +\n                                         '<ul class=\"{{progressBarClassName}}\"></ul>' +\n                                         '<div class=\"{{headerOptionalClassName}}\">' +\n                                         '<div class=\"{{statusTextClassName}}\" class=\"statusText\"></div>' +\n                                         '</div>' +\n                                         '</header>', {\n                                             headerClassName: headerClassName,\n                                             timeTakenClassName: timeTakenClassName,\n                                             progressBarClassName: progressBarClassName,\n                                             headerOptionalClassName: headerOptionalClassName,\n                                             statusTextClassName: statusTextClassName,\n                                             packageVersion: packageVersion\n                                         }));\n\n        makeElementFixedOnScroll(header);\n        container.appendChild(header);\n    };\n\n    var createContainer = function (parentContainer) {\n        var reportBody = elementFor('<div class=\"cssCriticNiceReporter\"></div>');\n\n        showHeader(reportBody);\n\n        parentContainer.appendChild(reportBody);\n\n        return reportBody;\n    };\n\n    // document title\n\n    var originalTitle;\n\n    var updateStatusInDocumentTitle = function (totalCount, doneCount) {\n        if (originalTitle === undefined) {\n            originalTitle = document.title;\n        }\n\n        document.title = \"(\" + doneCount + \"/\" + totalCount + \") \" + originalTitle;\n    };\n\n    // header\n\n    var padNumber = function (number, length) {\n        number += '';\n        while (number.length < length) {\n            number = \"0\" + number;\n        }\n        return number;\n    };\n\n    var renderMilliseconds = function (time) {\n        var seconds = Math.floor(time / 1000),\n            milliSeconds = time % 1000;\n        return seconds + '.' + padNumber(milliSeconds, 3);\n    };\n\n    var showTimeTaken = function (container, timeTakenInMillis) {\n        var timeTaken = findElementIn(container, timeTakenClassName);\n        timeTaken.textContent = \"finished in \" + renderMilliseconds(timeTakenInMillis) + \"s\";\n    };\n\n    var setOutcomeOnHeader = function (container, successful) {\n        var header = findElementIn(container, headerClassName);\n\n        header.classList.add(successful ? 'pass' : 'fail');\n    };\n\n    // ToC\n\n    var getOrCreateToc = function (container) {\n        var tocClassName = 'tocParent',\n            toc = container.querySelector('.' + tocClassName);\n\n        if (!toc) {\n            toc = elementFor(template('<div class=\"{{className}}\"><ul class=\"toc\"></ul></div>', {\n                className: tocClassName\n            }));\n            container.querySelector('.' + headerOptionalClassName).appendChild(toc);\n        }\n        return toc.querySelector('ul');\n    };\n\n    var addTocEntry = function (container, componentLabel, linkTarget) {\n        var toc = getOrCreateToc(container),\n            entry = elementFor(template('<li class=\"tocEntry\">' +\n                                        '<a href=\"#{{linkTarget}}\">{{headline}}</a>' +\n                                        '</li>', {\n                                            linkTarget: escapeId(linkTarget),\n                                            headline: componentLabel\n                                        }));\n\n        if (pageNavigationHandlingFallback) {\n            pageNavigationHandlingFallback.install(entry.querySelector('a'));\n        }\n\n        toc.appendChild(entry);\n    };\n\n    // component headline\n\n    var installFallbackComponentSelectionHandler = function (element, componentLabel) {\n        if (selectionFilter.filterForComponent) {\n            element.onclick = function (e) {\n                selectionFilter.filterForComponent(componentLabel);\n                e.preventDefault();\n            };\n        }\n    };\n\n    var addComponentHeading = function (container, componentLabel) {\n        var filterUrl = selectionFilter.filterUrlForComponent ? selectionFilter.filterUrlForComponent(componentLabel) : '#',\n            headlineElement = elementFor(template('<h2 class=\"componentLabel\"><a href=\"{{filterUrl}}\">{{headline}}</a></h2>', {\n                headline: componentLabel,\n                filterUrl: filterUrl\n            }));\n\n        installFallbackComponentSelectionHandler(headlineElement, componentLabel);\n        container.appendChild(headlineElement);\n    };\n\n    // comparisons\n\n    var comparisonKey = function (testCase) {\n        var testCaseParameters = util.excludeKeys(testCase, 'url'),\n            serializedParameters = util.serializeMap(testCaseParameters),\n            key = testCase.url;\n\n        if (serializedParameters) {\n            return key + ',' + serializedParameters;\n        }\n\n        return key;\n    };\n\n    var runningComparisonClassName = 'running',\n        referenceImageContainerClassName = 'referenceImageContainer',\n        errorContainerClassName = 'errorText';\n\n    var imageWrapper = function (image) {\n        var wrapper = elementFor('<div class=\"imageWrapper\"></div>');\n        wrapper.appendChild(image);\n        return wrapper;\n    };\n\n    var serializeValue = function (value) {\n        if (typeof value === 'string') {\n            return \"'\" + value + \"'\";\n        }\n        return value;\n    };\n\n    var testCaseParameters = function (testCase) {\n        var parameters = util.excludeKeys(testCase, 'url', 'desc', 'component'),\n            keys = Object.keys(parameters);\n\n        if (!keys.length) {\n            return '';\n        }\n        keys.sort();\n\n        return '<dl class=\"parameters\">' +\n            keys.map(function (key) {\n                return template('<dt>{{key}}</dt><dd>{{value}}</dd>', {\n                    key: key,\n                    value: serializeValue(parameters[key])\n                });\n            }).join('\\n') +\n            '</dl>';\n    };\n\n    var installFallbackSelectionHandler = function (element, testCase) {\n        if (selectionFilter.filterFor) {\n            element.onclick = function (e) {\n                selectionFilter.filterFor(testCase);\n                e.preventDefault();\n            };\n        }\n    };\n\n    var addComparison = function (container, testCase, referenceImage, key) {\n        var titleLinkClassName = 'titleLink',\n            filterUrl = selectionFilter.filterUrlFor ? selectionFilter.filterUrlFor(testCase) : '#',\n            comparison = elementFor(template('<section class=\"comparison {{runningComparisonClassName}}\">' +\n                                             '<h3 class=\"title\">' +\n                                             '<a class=\"{{titleLinkClassName}}\" href=\"{{filterUrl}}\">{{title}}</a> ' +\n                                             '<a class=\"externalLink\" href=\"{{url}}\"></a>' +\n                                             testCaseParameters(testCase) +\n                                             '</h3>' +\n                                             '<div class=\"{{errorContainerClassName}}\"></div>' +\n                                             '<div>' +\n                                             '<div class=\"{{referenceImageContainerClassName}}\"></div>' +\n                                             '</div>' +\n                                             '</section>', {\n                                                 url: testCase.url,\n                                                 title: testCase.desc ? testCase.desc : testCase.url,\n                                                 filterUrl: filterUrl,\n                                                 runningComparisonClassName: runningComparisonClassName,\n                                                 errorContainerClassName: errorContainerClassName,\n                                                 referenceImageContainerClassName: referenceImageContainerClassName,\n                                                 titleLinkClassName: titleLinkClassName\n                                             })),\n            anchorTarget = elementFor(template('<span class=\"fixedHeaderAnchorTarget\" id=\"{{id}}\"></span>', {\n                id: escapeId(key)\n            })),\n            referenceImageContainer = comparison.querySelector('.' + referenceImageContainerClassName),\n            titleLink = comparison.querySelector('.' + titleLinkClassName);\n\n        if (referenceImage) {\n            referenceImageContainer.appendChild(imageWrapper(referenceImage));\n        }\n        installFallbackSelectionHandler(titleLink, testCase);\n\n        container.appendChild(anchorTarget);\n        container.appendChild(comparison);\n\n        return comparison;\n    };\n\n    var canvasForImageCanvas = function (imageData) {\n        var canvas = document.createElement(\"canvas\"),\n            context;\n\n        canvas.height = imageData.height;\n        canvas.width  = imageData.width;\n\n        context = canvas.getContext(\"2d\");\n        context.putImageData(imageData, 0, 0);\n\n        return canvas;\n    };\n\n    var diffPageImages = function (imageA, imageB) {\n        return imagediff.diff(imageA, imageB, {align: 'top'});\n    };\n\n    var embossChanges = function (imageData) {\n        var d = imageData.data,\n            i;\n        for (i = 0; i < d.length; i += 4) {\n            if (d[i] === 0 && d[i+1] === 0 && d[i+2] === 0) {\n                d[i+3] = 0;\n            } else {\n                d[i] = 0;\n                d[i+1] = 0;\n                d[i+2] = 255;\n                d[i+3] = 255;\n            }\n        }\n        return imageData;\n    };\n\n    var getDifferenceCanvas = function (imageA, imageB) {\n        var differenceImageData = diffPageImages(imageA, imageB),\n            canvas = canvasForImageCanvas(embossChanges(differenceImageData));\n\n        canvas.classList.add('diff');\n        return canvas;\n    };\n\n    // Use a canvas for display to work around https://bugzilla.mozilla.org/show_bug.cgi?id=986403\n    var canvasForImage = function (image) {\n        var canvas = document.createElement(\"canvas\"),\n            width  = image.naturalWidth,\n            height = image.naturalHeight,\n            context;\n\n        canvas.width  = width;\n        canvas.height = height;\n\n        context = canvas.getContext(\"2d\");\n        context.drawImage(image, 0, 0, width, height);\n\n        // fix size in css so the tests will show something (canvas is not supported so far)\n        canvas.style.width = width + 'px';\n        canvas.style.height = height + 'px';\n\n        return canvas;\n    };\n\n    var addImageDiff = function (image, imageForDiff, container) {\n        var referenceImageContainer = container.querySelector('.' + referenceImageContainerClassName);\n\n        referenceImageContainer.appendChild(getDifferenceCanvas(image, imageForDiff));\n    };\n\n    var toggleViewClassName = 'toggleView',\n        acceptClassName = 'accept';\n\n    var acceptComparison = function (container) {\n        var acceptButton = container.querySelector('.' + acceptClassName);\n        acceptButton.setAttribute('disabled', 'disabled');\n        acceptButton.textContent = \"✓\";\n        container.classList.add('accepted');\n    };\n\n    var acceptButton = function (acceptPage, container) {\n        var button = elementFor(template('<button class=\"{{acceptClassName}}\">' +\n                                         '<span>Accept</span>' +\n                                         '</button>', {\n                                             acceptClassName: acceptClassName\n                                         }));\n        button.onclick = function () {\n            acceptPage();\n            acceptComparison(container);\n        };\n        return button;\n    };\n\n    var pageAsIframe = function (pageImage, testCaseUrl) {\n        var iframe = document.createElement('iframe');\n        iframe.width = pageImage.width;\n        iframe.height = pageImage.height;\n        iframe.src = testCaseUrl;\n        iframe.scrolling = \"no\";\n        return iframe;\n    };\n\n    var showPageImage = function (pageImage, testCaseUrl, realView, imageContainer, container) {\n        imageContainer.innerHTML = '';\n        if (realView) {\n            imageContainer.appendChild(imageWrapper(pageAsIframe(pageImage, testCaseUrl)));\n\n            container.classList.add('realView');\n        } else {\n            imageContainer.appendChild(imageWrapper(pageImage));\n\n            container.classList.remove('realView');\n        }\n    };\n\n    var pageImageContainer = function (pageImage, acceptPage, testCaseUrl, container) {\n        var pageImageContainerClassName = 'pageImageContainer',\n            outerPageImageContainer = elementFor(template('<div class=\"outerPageImageContainer\">' +\n                                                          '<div class=\"{{pageImageContainerClassName}}\"></div>' +\n                                                          '<button class=\"{{toggleViewClassName}}\" title=\"Toggle DOM view\"></button>' +\n                                                          '</div>', {\n                                                              pageImageContainerClassName: pageImageContainerClassName,\n                                                              toggleViewClassName: toggleViewClassName\n                                                          })),\n            pageImageContainer = outerPageImageContainer.querySelector('.' + pageImageContainerClassName),\n            toggleButton = outerPageImageContainer.querySelector('.' + toggleViewClassName),\n            showRealView = false,\n            accepted = false,\n            acceptButtonElement;\n\n        if (acceptPage) {\n            acceptButtonElement = acceptButton(function () {\n                accepted = true;\n                acceptPage();\n            }, container);\n\n            outerPageImageContainer.appendChild(acceptButtonElement);\n        }\n\n        showPageImage(pageImage, testCaseUrl, showRealView, pageImageContainer, container);\n\n        toggleButton.onclick = function () {\n            showRealView = !showRealView;\n            showPageImage(pageImage, testCaseUrl, showRealView, pageImageContainer, container);\n\n            if (acceptPage) {\n                if (showRealView) {\n                    acceptButtonElement.setAttribute('disabled', 'disabled');\n                } else if (!accepted) {\n                    acceptButtonElement.removeAttribute('disabled');\n                }\n            }\n        };\n\n        return outerPageImageContainer;\n    };\n\n    var showComparisonWithDiff = function (pageImage, referenceImage, acceptPage, testCaseUrl, container) {\n        addImageDiff(referenceImage, pageImage, container);\n        container.appendChild(pageImageContainer(canvasForImage(pageImage), acceptPage, testCaseUrl, container));\n    };\n\n    var showComparisonWithoutReference = function (pageImage, acceptPage, testCaseUrl, container) {\n        container.appendChild(pageImageContainer(canvasForImage(pageImage), acceptPage, testCaseUrl, container));\n    };\n\n    var sameOriginWarning = 'Make sure the path lies within the ' +\n        '<a href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\">' +\n        'same origin' +\n        '</a> ' +\n        'as this document.';\n\n    var showComparisonWithError = function (url, container) {\n        var errorMsg = elementFor(template('<span>' +\n                                           'The page \"{{url}}\" could not be rendered. ' +\n                                           '</span>', {\n                                               url: url\n                                           })),\n            errorContainer = container.querySelector('.' + errorContainerClassName);\n        errorContainer.appendChild(errorMsg);\n    };\n\n    var showRenderErrors = function (errors, container) {\n        var errorMsg = elementFor(template('<span>' +\n                                           'Had the following errors rendering the page:' +\n                                           '<ul></ul>' +\n                                           sameOriginWarning +\n                                           '</span>')),\n            listElement = errorMsg.querySelector('ul'),\n            errorContainer = container.querySelector('.' + errorContainerClassName);\n\n        errors.map(function (error) {\n            return elementFor(template('<li>{{msg}}</li>', {msg: error}));\n        }).forEach(function (li) {\n            listElement.appendChild(li);\n        });\n\n        errorContainer.appendChild(errorMsg);\n    };\n\n    var updateComparisonStatus = function (status, container) {\n        container.classList.remove(runningComparisonClassName);\n        container.classList.add(status);\n    };\n\n    // progress bar\n\n    var progressBarPendingClassName = 'pending';\n\n    var testDescription = function (testCase) {\n        var component;\n        if (testCase.desc) {\n            component = testCase.component ? testCase.component + ' ' : '';\n            return component + testCase.desc;\n        } else {\n            return comparisonKey(testCase);\n        }\n    };\n\n    var addTickToProgressBar = function (container, testCase, linkTarget) {\n        var progressBar = findElementIn(container, progressBarClassName),\n            clickableTickTemplate = '<li><a href=\"#{{linkTarget}}\" title=\"{{title}}\"></a></li>',\n            deactivatedTickTemplate = '<li><a title=\"{{title}}\"></a></li>',\n            tickTemplate = linkTarget ? clickableTickTemplate : deactivatedTickTemplate;\n\n        var tick = elementFor(template(tickTemplate, {\n            linkTarget: linkTarget ? escapeId(linkTarget) : '',\n            title: testDescription(testCase)\n        }));\n        tick.classList.add(progressBarPendingClassName);\n        progressBar.appendChild(tick);\n\n        if (pageNavigationHandlingFallback) {\n            pageNavigationHandlingFallback.install(tick.querySelector('a'));\n        }\n\n        return tick;\n    };\n\n    var markTickDone = function (status, renderErrorCount, tickElement) {\n        tickElement.classList.remove(progressBarPendingClassName);\n        tickElement.classList.add(status);\n        if (renderErrorCount > 0) {\n            tickElement.classList.add('hasRenderErrors');\n        }\n    };\n\n    // status bar\n\n    var singularPlural = function (value, singularForm, pluralForm) {\n        if (value === 1) {\n            return singularForm;\n        } else {\n            return pluralForm;\n        }\n    };\n\n    var statusTotalText = function (totalCount, selectedCount) {\n        var totalContent = '{{total}} ' + singularPlural(totalCount, 'entry', 'entries') + ', ';\n        if (selectedCount < totalCount) {\n            totalContent = '{{selected}} of ' + totalContent;\n        }\n        return template('<span>' +\n                        totalContent +\n                        '</span>', {\n            total: totalCount,\n            selected: selectedCount\n        });\n    };\n\n    var statusIssueText = function (issueCount, selectedCount, doneCount) {\n        var issueContent = '{{issues}} ' + singularPlural(issueCount, 'needs', 'need') + ' some love',\n            doneContent = 'all good',\n            noTestsContent = \"nothing here yet\",\n            doneWithoutErrors = selectedCount === doneCount && issueCount === 0,\n            content;\n        if (selectedCount === 0) {\n            content = noTestsContent;\n        } else if (doneWithoutErrors) {\n            content = doneContent;\n        } else {\n            content = issueContent;\n        }\n        return template('<span>' +\n                        content +\n                        '</span>', {\n                            issues: issueCount\n                        });\n    };\n\n    var acceptAllClassName = 'acceptAll';\n\n    var acceptAllButton = function () {\n        return elementFor(template('<button class=\"{{acceptAllClassName}}\">... accept all (I know what I\\'m doing)</button>', {\n            acceptAllClassName: acceptAllClassName\n        }));\n    };\n\n    var showAcceptAllButtonIfNeccessary = function (container, acceptableEntries) {\n        var statusText = findElementIn(container, statusTextClassName),\n            button = statusText.querySelector('.' + acceptAllClassName);\n\n        if (acceptableEntries.length > 2) {\n            button.classList.add('active');\n            button.onclick = function () {\n                acceptableEntries.forEach(function (acceptableEntry) {\n                    acceptableEntry.acceptPage();\n                    acceptComparison(acceptableEntry.entry);\n                });\n\n                button.setAttribute('disabled', 'disabled');\n            };\n        }\n    };\n\n    var installFallbackClearSelectionHandler = function (element) {\n        if (selectionFilter.clearFilter) {\n            element.onclick = function (e) {\n                selectionFilter.clearFilter();\n                e.preventDefault();\n            };\n        }\n    };\n\n    var updateStatusBar = function (container, totalCount, selectedCount, issueCount, doneCount) {\n        var runAllUrl = selectionFilter.clearFilterUrl ? selectionFilter.clearFilterUrl() : '#',\n            runAll = elementFor(template('<a class=\"runAll\" href=\"{{url}}\">Run all</a>', {\n                url: runAllUrl\n            })),\n            statusText = findElementIn(container, statusTextClassName);\n\n        statusText.innerHTML = '';\n        statusText.appendChild(elementFor(statusTotalText(totalCount, selectedCount)));\n        statusText.appendChild(elementFor(statusIssueText(issueCount, selectedCount, doneCount)));\n        statusText.appendChild(acceptAllButton());\n        if (totalCount > selectedCount) {\n            installFallbackClearSelectionHandler(runAll);\n            statusText.appendChild(runAll);\n        }\n    };\n\n    // browser warning\n\n    var supportsReadingHtmlFromCanvas = function () {\n        return rasterizeHTML.drawHTML('<b></b>').then(function (result) {\n            var canvas = document.createElement(\"canvas\"),\n                context = canvas.getContext(\"2d\");\n            try {\n                context.drawImage(result.image, 0, 0);\n                // This will fail in Chrome & Safari\n                canvas.toDataURL(\"image/png\");\n                return true;\n            } catch (e) {\n                return false;\n            }\n        });\n    };\n\n    var browserIssueChecked = false;\n\n    var showBrowserWarningIfNeeded = function (container) {\n        if (browserIssueChecked) {\n            return;\n        }\n        browserIssueChecked = true;\n\n        supportsReadingHtmlFromCanvas().then(function (supported) {\n            if (supported) {\n                return;\n            }\n\n            container.appendChild(elementFor(\n                '<div class=\"browserWarning\">' +\n                    'Your browser is currently not supported, ' +\n                    'as it does not support reading rendered HTML from the canvas ' +\n                    '(<a href=\"https://code.google.com/p/chromium/issues/detail?id=294129\">Chrome #294129</a>, ' +\n                    '<a href=\"https://bugs.webkit.org/show_bug.cgi?id=17352\">Safari #17352</a>). How about trying Firefox?' +\n                    '</div>'\n            ));\n        });\n    };\n\n    // the reporter\n\n    module.NiceReporter = function (outerContainer) {\n        var totalCount = 0,\n            selectedCount = 0,\n            doneCount = 0,\n            issueCount = 0,\n            progressTickElements = {},\n            runningComparisonEntries = {},\n            acceptableComparisons = [],\n            containerElement, timeStarted, lastComponentLabel;\n\n        var container = function () {\n            if (!containerElement) {\n                containerElement = createContainer(outerContainer || document.body);\n            }\n            return containerElement;\n        };\n\n        var registerComparison = function () {\n            totalCount += 1;\n            if (!timeStarted) {\n                timeStarted = Date.now();\n            }\n\n            showBrowserWarningIfNeeded(container());\n            updateStatusInDocumentTitle(totalCount, doneCount);\n            updateStatusBar(container(), totalCount, selectedCount, issueCount);\n        };\n\n        return {\n            reportDeselectedComparison: function (comparison) {\n                registerComparison();\n\n                addTickToProgressBar(container(), comparison.testCase);\n            },\n            reportSelectedComparison: function (comparison) {\n                var key = comparisonKey(comparison.testCase);\n                selectedCount += 1;\n\n                if (comparison.testCase.component && comparison.testCase.component !== lastComponentLabel) {\n                    lastComponentLabel = comparison.testCase.component;\n                    addComponentHeading(container(), comparison.testCase.component);\n                    addTocEntry(container(), comparison.testCase.component, key);\n                }\n\n                registerComparison();\n\n                var tickElement = addTickToProgressBar(container(), comparison.testCase, key);\n                progressTickElements[key] = tickElement;\n\n                var comparisonElement = addComparison(container(),\n                                                      comparison.testCase,\n                                                      comparison.referenceImage,\n                                                      key);\n                runningComparisonEntries[key] = comparisonElement;\n            },\n            reportComparison: function (comparison) {\n                var key = comparisonKey(comparison.testCase),\n                    tickElement = progressTickElements[key],\n                    entry = runningComparisonEntries[key];\n\n                doneCount += 1;\n                if (comparison.status !== 'passed') {\n                    issueCount += 1;\n                }\n\n                updateStatusInDocumentTitle(totalCount, doneCount);\n                updateStatusBar(container(), totalCount, selectedCount, issueCount, doneCount);\n                markTickDone(comparison.status, comparison.renderErrors.length, tickElement);\n\n                if (comparison.status === 'failed') {\n                    showComparisonWithDiff(comparison.pageImage,\n                                           comparison.referenceImage,\n                                           comparison.acceptPage,\n                                           comparison.testCase.url,\n                                           entry);\n                    acceptableComparisons.push(comparison);\n                } else if (comparison.status === 'referenceMissing') {\n                    showComparisonWithoutReference(comparison.pageImage,\n                                                   comparison.acceptPage,\n                                                   comparison.testCase.url,\n                                                   entry);\n                    acceptableComparisons.push(comparison);\n                } else if (comparison.status === 'passed') {\n                    showComparisonWithoutReference(comparison.pageImage,\n                                                   undefined,\n                                                   comparison.testCase.url,\n                                                   entry);\n                } else if (comparison.status === 'error') {\n                    showComparisonWithError(comparison.testCase.url,\n                                            entry);\n                }\n\n                if (comparison.renderErrors.length > 0) {\n                    showRenderErrors(comparison.renderErrors, entry);\n                }\n\n                updateComparisonStatus(comparison.status, entry);\n            },\n            reportTestSuite: function (result) {\n                var acceptableEntries = acceptableComparisons.map(function (comparison) {\n                    var key = comparisonKey(comparison.testCase);\n                    return {\n                        acceptPage: comparison.acceptPage,\n                        entry: runningComparisonEntries[key]\n                    };\n                });\n\n                updateStatusInDocumentTitle(totalCount, doneCount);\n                updateStatusBar(container(), totalCount, selectedCount, issueCount, doneCount);\n\n                showTimeTaken(container(), timeStarted ? Date.now() - timeStarted : 0);\n                setOutcomeOnHeader(container(), result.success);\n                showAcceptAllButtonIfNeccessary(container(), acceptableEntries);\n            }\n        };\n    };\n\n    return module;\n};\n\n/* Work around https://bugzilla.mozilla.org/show_bug.cgi?id=1005634\n * Replaces anchors with inner page targets with a JavaScript navigation handling implementation.\n */\ncsscriticLib.pageNavigationHandlingFallback = function () {\n    \"use strict\";\n\n    var module = {};\n\n    var fakeTargetClassName = 'fakeTarget';\n\n    var clearFakeActiveClass = function () {\n        var previousTargets = Array.prototype.slice.call(document.querySelectorAll('.' + fakeTargetClassName));\n        previousTargets.forEach(function (elem) {\n            elem.classList.remove(fakeTargetClassName);\n        });\n    };\n\n    var triggerFakeActiveClass = function (targetElement) {\n        targetElement.classList.add(fakeTargetClassName);\n    };\n\n    var scrollTo = function (id) {\n        var targetElement;\n\n        clearFakeActiveClass();\n        if (id) {\n            targetElement = document.getElementById(id);\n            targetElement.scrollIntoView();\n            triggerFakeActiveClass(targetElement);\n        } else {\n            window.scrollTo(0, 0);\n        }\n    };\n\n    var globalNavigationHandlingInstalled = false;\n\n    var installGlobalNavigationHandling = function () {\n        if (!globalNavigationHandlingInstalled) {\n            globalNavigationHandlingInstalled = true;\n\n            window.onpopstate = function (e) {\n                scrollTo(e.state);\n            };\n        }\n    };\n\n    module.install = function (element) {\n        installGlobalNavigationHandling();\n\n        element.onclick = function (e) {\n            var targetLink = decodeURIComponent(e.target.href),\n                targetId = targetLink.substr(targetLink.indexOf('#')+1);\n\n            scrollTo(targetId);\n            history.pushState(targetId, targetId);\n            e.preventDefault();\n        };\n    };\n\n    return module;\n};\n\ncsscriticLib.urlQueryFilter = function (windowLocation) {\n    \"use strict\";\n\n    var module = {};\n\n    var filterParam = 'filter';\n\n    var parseUrlSearch = function (search) {\n        var paramString = search.replace(/^\\?/, '');\n        if (!paramString) {\n            return [];\n        }\n        return paramString\n            .split('&')\n            .map(function (keyValue) {\n                var equalsIdx = keyValue.indexOf('='),\n                    key, value;\n\n                if (equalsIdx >= 0) {\n                    key = keyValue.substr(0, equalsIdx);\n                    value = keyValue.substr(equalsIdx + 1);\n                } else {\n                    key = keyValue;\n                }\n                return {\n                    key: key,\n                    value: value\n                };\n            });\n    };\n\n    var serializeKeyValuePair = function (pair) {\n        if (pair.value) {\n            return pair.key + '=' + pair.value;\n        }\n        return pair.key;\n    };\n\n    var getFilterValue = function () {\n        var filterKeyValue = parseUrlSearch(windowLocation.search)\n                .filter(function (entryPair) {\n                    return entryPair.key === filterParam;\n                })\n                .pop();\n\n        if (filterKeyValue) {\n            return decodeURIComponent(filterKeyValue.value);\n        }\n    };\n\n    var fullDescription = function (testCase) {\n        return testCase.component ? testCase.component + ' ' + testCase.desc : testCase.desc;\n    };\n\n    var filter = getFilterValue(),\n        existingQueryParams = parseUrlSearch(windowLocation.search);\n\n    // interface towards main.js\n\n    module.isComparisonSelected = function (comparison) {\n        if (!filter) {\n            return true;\n        }\n\n        if (comparison.testCase.desc && fullDescription(comparison.testCase) === filter) {\n            return true;\n        }\n        if (comparison.testCase.component && comparison.testCase.component === filter) {\n            return true;\n        }\n        return comparison.testCase.url === filter;\n    };\n\n    // interface towards browser reporters\n\n    var queryPart = function (selection) {\n        var queryParams = existingQueryParams\n                .filter(function (pair) {\n                    return pair.key !== filterParam;\n                });\n        if (selection) {\n            queryParams.push({\n                key: filterParam,\n                value: encodeURIComponent(selection)\n            });\n        }\n\n        return '?' + queryParams.map(serializeKeyValuePair).join('&');\n    };\n\n    module.filterUrlForComponent = function (componentLabel) {\n        return queryPart(componentLabel);\n    };\n\n    module.filterUrlFor = function (testCase) {\n        if (testCase.desc) {\n            return queryPart(fullDescription(testCase));\n        }\n        return queryPart(testCase.url);\n    };\n\n    module.clearFilterUrl = function () {\n        return queryPart();\n    };\n\n    return module;\n};\n\ncsscriticLib.packageVersion = '2.0.0';\n\n/* exported csscritic */\nvar csscritic = (function () {\n    \"use strict\";\n\n    var installCallChain = function (func, self) {\n        return function chainableProxy() {\n            func.apply(null, arguments);\n            return self;\n        };\n    };\n\n    var startsWith = function (str, prefix) {\n        // PhantomJS has no startsWith\n        return str.substr(0, prefix.length) === prefix;\n    };\n\n    // Work around https://bugzilla.mozilla.org/show_bug.cgi?id=1005634\n    var needsFallback = function () {\n        return startsWith(window.location.href, 'file://');\n    };\n\n    var packageVersion = csscriticLib.packageVersion || 'dev',\n        util = csscriticLib.util();\n\n    var indexedDbStorage = csscriticLib.indexeddbstorage(util);\n\n    var browserRenderer = csscriticLib.browserRenderer(util, csscriticLib.jobQueue, rasterizeHTML),\n        reporting = csscriticLib.reporting(browserRenderer, indexedDbStorage, util),\n        regression = csscriticLib.regression(browserRenderer, util, imagediff),\n        queryFilter = csscriticLib.urlQueryFilter(window.location),\n        fallbackFilter = csscriticLib.fallbackFilter(window.location);\n\n    var filter = needsFallback() ? fallbackFilter : queryFilter;\n\n    var main = csscriticLib.main(\n        regression,\n        reporting,\n        util,\n        indexedDbStorage,\n        filter\n    );\n\n    var pageNavigationHandlingFallback = csscriticLib.pageNavigationHandlingFallback(window.location),\n        niceReporter = csscriticLib.niceReporter(\n            window,\n            util,\n            filter,\n            needsFallback() ? pageNavigationHandlingFallback : undefined,\n            rasterizeHTML,\n            packageVersion\n        );\n\n\n    var self = {};\n\n    self.add = installCallChain(main.add, self);\n    self.component = installCallChain(main.component, self);\n    self.execute = main.execute;\n\n    self.addReporter = installCallChain(reporting.addReporter, self);\n\n    self.NiceReporter = niceReporter.NiceReporter;\n\n    return self;\n}());\n\nreturn csscritic;\n\n}));\n","// UMD header\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define(factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory();\n    } else {\n        root.ayepromise = factory();\n    }\n}(this, function () {\n    'use strict';\n\n    var ayepromise = {};\n\n    /* Wrap an arbitrary number of functions and allow only one of them to be\n       executed and only once */\n    var once = function () {\n        var wasCalled = false;\n\n        return function wrapper(wrappedFunction) {\n            return function () {\n                if (wasCalled) {\n                    return;\n                }\n                wasCalled = true;\n                wrappedFunction.apply(null, arguments);\n            };\n        };\n    };\n\n    var getThenableIfExists = function (obj) {\n        // Make sure we only access the accessor once as required by the spec\n        var then = obj && obj.then;\n\n        if (typeof obj === \"object\" && typeof then === \"function\") {\n            // Bind function back to it's object (so fan's of 'this' don't get sad)\n            return function() { return then.apply(obj, arguments); };\n        }\n    };\n\n    var aThenHandler = function (onFulfilled, onRejected) {\n        var defer = ayepromise.defer();\n\n        var doHandlerCall = function (func, value) {\n            setTimeout(function () {\n                var returnValue;\n                try {\n                    returnValue = func(value);\n                } catch (e) {\n                    defer.reject(e);\n                    return;\n                }\n\n                if (returnValue === defer.promise) {\n                    defer.reject(new TypeError('Cannot resolve promise with itself'));\n                } else {\n                    defer.resolve(returnValue);\n                }\n            }, 1);\n        };\n\n        var callFulfilled = function (value) {\n            if (onFulfilled && onFulfilled.call) {\n                doHandlerCall(onFulfilled, value);\n            } else {\n                defer.resolve(value);\n            }\n        };\n\n        var callRejected = function (value) {\n            if (onRejected && onRejected.call) {\n                doHandlerCall(onRejected, value);\n            } else {\n                defer.reject(value);\n            }\n        };\n\n        return {\n            promise: defer.promise,\n            handle: function (state, value) {\n                if (state === FULFILLED) {\n                    callFulfilled(value);\n                } else {\n                    callRejected(value);\n                }\n            }\n        };\n    };\n\n    // States\n    var PENDING = 0,\n        FULFILLED = 1,\n        REJECTED = 2;\n\n    ayepromise.defer = function () {\n        var state = PENDING,\n            outcome,\n            thenHandlers = [];\n\n        var doSettle = function (settledState, value) {\n            state = settledState;\n            // persist for handlers registered after settling\n            outcome = value;\n\n            thenHandlers.forEach(function (then) {\n                then.handle(state, outcome);\n            });\n\n            // Discard all references to handlers to be garbage collected\n            thenHandlers = null;\n        };\n\n        var doFulfill = function (value) {\n            doSettle(FULFILLED, value);\n        };\n\n        var doReject = function (error) {\n            doSettle(REJECTED, error);\n        };\n\n        var registerThenHandler = function (onFulfilled, onRejected) {\n            var thenHandler = aThenHandler(onFulfilled, onRejected);\n\n            if (state === PENDING) {\n                thenHandlers.push(thenHandler);\n            } else {\n                thenHandler.handle(state, outcome);\n            }\n\n            return thenHandler.promise;\n        };\n\n        var safelyResolveThenable = function (thenable) {\n            // Either fulfill, reject or reject with error\n            var onceWrapper = once();\n            try {\n                thenable(\n                    onceWrapper(transparentlyResolveThenablesAndSettle),\n                    onceWrapper(doReject)\n                );\n            } catch (e) {\n                onceWrapper(doReject)(e);\n            }\n        };\n\n        var transparentlyResolveThenablesAndSettle = function (value) {\n            var thenable;\n\n            try {\n                thenable = getThenableIfExists(value);\n            } catch (e) {\n                doReject(e);\n                return;\n            }\n\n            if (thenable) {\n                safelyResolveThenable(thenable);\n            } else {\n                doFulfill(value);\n            }\n        };\n\n        var onceWrapper = once();\n        return {\n            resolve: onceWrapper(transparentlyResolveThenablesAndSettle),\n            reject: onceWrapper(doReject),\n            promise: {\n                then: registerThenHandler,\n                fail: function (onRejected) {\n                    return registerThenHandler(null, onRejected);\n                }\n            }\n        };\n    };\n\n    return ayepromise;\n}));\n","'use strict'\n\nfunction injectStyleTag (document, fileName, cb) {\n  var style = document.getElementById(fileName)\n\n  if (style) {\n    cb(style)\n  } else {\n    var head = document.getElementsByTagName('head')[0]\n\n    style = document.createElement('style')\n    if (fileName != null) style.id = fileName\n    cb(style)\n    head.appendChild(style)\n  }\n\n  return style\n}\n\nmodule.exports = function (css, customDocument, fileName) {\n  var doc = customDocument || document\n  /* istanbul ignore if: not supported by Electron */\n  if (doc.createStyleSheet) {\n    var sheet = doc.createStyleSheet()\n    sheet.cssText = css\n    return sheet.ownerNode\n  } else {\n    return injectStyleTag(doc, fileName, function (style) {\n      /* istanbul ignore if: not supported by Electron */\n      if (style.styleSheet) {\n        style.styleSheet.cssText = css\n      } else {\n        style.innerHTML = css\n      }\n    })\n  }\n}\n\nmodule.exports.byUrl = function (url) {\n  /* istanbul ignore if: not supported by Electron */\n  if (document.createStyleSheet) {\n    return document.createStyleSheet(url).ownerNode\n  } else {\n    var head = document.getElementsByTagName('head')[0]\n    var link = document.createElement('link')\n\n    link.rel = 'stylesheet'\n    link.href = url\n\n    head.appendChild(link)\n    return link\n  }\n}\n","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n'use strict'\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar isArray = require('isarray')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Due to various browser bugs, sometimes the Object implementation will be used even\n * when the browser supports typed arrays.\n *\n * Note:\n *\n *   - Firefox 4-29 lacks support for adding new properties to `Uint8Array` instances,\n *     See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *   - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *   - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *     incorrect length in some situations.\n\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they\n * get the Object implementation, which is slower but behaves correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = global.TYPED_ARRAY_SUPPORT !== undefined\n  ? global.TYPED_ARRAY_SUPPORT\n  : typedArraySupport()\n\n/*\n * Export kMaxLength after typed array support is determined.\n */\nexports.kMaxLength = kMaxLength()\n\nfunction typedArraySupport () {\n  try {\n    var arr = new Uint8Array(1)\n    arr.__proto__ = {__proto__: Uint8Array.prototype, foo: function () { return 42 }}\n    return arr.foo() === 42 && // typed array instances can be augmented\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        arr.subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n}\n\nfunction kMaxLength () {\n  return Buffer.TYPED_ARRAY_SUPPORT\n    ? 0x7fffffff\n    : 0x3fffffff\n}\n\nfunction createBuffer (that, length) {\n  if (kMaxLength() < length) {\n    throw new RangeError('Invalid typed array length')\n  }\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = new Uint8Array(length)\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    if (that === null) {\n      that = new Buffer(length)\n    }\n    that.length = length\n  }\n\n  return that\n}\n\n/**\n * The Buffer constructor returns instances of `Uint8Array` that have their\n * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of\n * `Uint8Array`, so the returned instances will have all the node `Buffer` methods\n * and the `Uint8Array` methods. Square bracket notation works as expected -- it\n * returns a single octet.\n *\n * The `Uint8Array` prototype remains unmodified.\n */\n\nfunction Buffer (arg, encodingOrOffset, length) {\n  if (!Buffer.TYPED_ARRAY_SUPPORT && !(this instanceof Buffer)) {\n    return new Buffer(arg, encodingOrOffset, length)\n  }\n\n  // Common case.\n  if (typeof arg === 'number') {\n    if (typeof encodingOrOffset === 'string') {\n      throw new Error(\n        'If encoding is specified then the first argument must be a string'\n      )\n    }\n    return allocUnsafe(this, arg)\n  }\n  return from(this, arg, encodingOrOffset, length)\n}\n\nBuffer.poolSize = 8192 // not used by this implementation\n\n// TODO: Legacy, not needed anymore. Remove in next major version.\nBuffer._augment = function (arr) {\n  arr.__proto__ = Buffer.prototype\n  return arr\n}\n\nfunction from (that, value, encodingOrOffset, length) {\n  if (typeof value === 'number') {\n    throw new TypeError('\"value\" argument must not be a number')\n  }\n\n  if (typeof ArrayBuffer !== 'undefined' && value instanceof ArrayBuffer) {\n    return fromArrayBuffer(that, value, encodingOrOffset, length)\n  }\n\n  if (typeof value === 'string') {\n    return fromString(that, value, encodingOrOffset)\n  }\n\n  return fromObject(that, value)\n}\n\n/**\n * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError\n * if value is a number.\n * Buffer.from(str[, encoding])\n * Buffer.from(array)\n * Buffer.from(buffer)\n * Buffer.from(arrayBuffer[, byteOffset[, length]])\n **/\nBuffer.from = function (value, encodingOrOffset, length) {\n  return from(null, value, encodingOrOffset, length)\n}\n\nif (Buffer.TYPED_ARRAY_SUPPORT) {\n  Buffer.prototype.__proto__ = Uint8Array.prototype\n  Buffer.__proto__ = Uint8Array\n  if (typeof Symbol !== 'undefined' && Symbol.species &&\n      Buffer[Symbol.species] === Buffer) {\n    // Fix subarray() in ES2016. See: https://github.com/feross/buffer/pull/97\n    Object.defineProperty(Buffer, Symbol.species, {\n      value: null,\n      configurable: true\n    })\n  }\n}\n\nfunction assertSize (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('\"size\" argument must be a number')\n  } else if (size < 0) {\n    throw new RangeError('\"size\" argument must not be negative')\n  }\n}\n\nfunction alloc (that, size, fill, encoding) {\n  assertSize(size)\n  if (size <= 0) {\n    return createBuffer(that, size)\n  }\n  if (fill !== undefined) {\n    // Only pay attention to encoding if it's a string. This\n    // prevents accidentally sending in a number that would\n    // be interpretted as a start offset.\n    return typeof encoding === 'string'\n      ? createBuffer(that, size).fill(fill, encoding)\n      : createBuffer(that, size).fill(fill)\n  }\n  return createBuffer(that, size)\n}\n\n/**\n * Creates a new filled Buffer instance.\n * alloc(size[, fill[, encoding]])\n **/\nBuffer.alloc = function (size, fill, encoding) {\n  return alloc(null, size, fill, encoding)\n}\n\nfunction allocUnsafe (that, size) {\n  assertSize(size)\n  that = createBuffer(that, size < 0 ? 0 : checked(size) | 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < size; ++i) {\n      that[i] = 0\n    }\n  }\n  return that\n}\n\n/**\n * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.\n * */\nBuffer.allocUnsafe = function (size) {\n  return allocUnsafe(null, size)\n}\n/**\n * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.\n */\nBuffer.allocUnsafeSlow = function (size) {\n  return allocUnsafe(null, size)\n}\n\nfunction fromString (that, string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') {\n    encoding = 'utf8'\n  }\n\n  if (!Buffer.isEncoding(encoding)) {\n    throw new TypeError('\"encoding\" must be a valid string encoding')\n  }\n\n  var length = byteLength(string, encoding) | 0\n  that = createBuffer(that, length)\n\n  var actual = that.write(string, encoding)\n\n  if (actual !== length) {\n    // Writing a hex string, for example, that contains invalid characters will\n    // cause everything after the first invalid character to be ignored. (e.g.\n    // 'abxxcd' will be treated as 'ab')\n    that = that.slice(0, actual)\n  }\n\n  return that\n}\n\nfunction fromArrayLike (that, array) {\n  var length = array.length < 0 ? 0 : checked(array.length) | 0\n  that = createBuffer(that, length)\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\nfunction fromArrayBuffer (that, array, byteOffset, length) {\n  array.byteLength // this throws if `array` is not a valid ArrayBuffer\n\n  if (byteOffset < 0 || array.byteLength < byteOffset) {\n    throw new RangeError('\\'offset\\' is out of bounds')\n  }\n\n  if (array.byteLength < byteOffset + (length || 0)) {\n    throw new RangeError('\\'length\\' is out of bounds')\n  }\n\n  if (byteOffset === undefined && length === undefined) {\n    array = new Uint8Array(array)\n  } else if (length === undefined) {\n    array = new Uint8Array(array, byteOffset)\n  } else {\n    array = new Uint8Array(array, byteOffset, length)\n  }\n\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = array\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    that = fromArrayLike(that, array)\n  }\n  return that\n}\n\nfunction fromObject (that, obj) {\n  if (Buffer.isBuffer(obj)) {\n    var len = checked(obj.length) | 0\n    that = createBuffer(that, len)\n\n    if (that.length === 0) {\n      return that\n    }\n\n    obj.copy(that, 0, 0, len)\n    return that\n  }\n\n  if (obj) {\n    if ((typeof ArrayBuffer !== 'undefined' &&\n        obj.buffer instanceof ArrayBuffer) || 'length' in obj) {\n      if (typeof obj.length !== 'number' || isnan(obj.length)) {\n        return createBuffer(that, 0)\n      }\n      return fromArrayLike(that, obj)\n    }\n\n    if (obj.type === 'Buffer' && isArray(obj.data)) {\n      return fromArrayLike(that, obj.data)\n    }\n  }\n\n  throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < kMaxLength()` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= kMaxLength()) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + kMaxLength().toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (length) {\n  if (+length != length) { // eslint-disable-line eqeqeq\n    length = 0\n  }\n  return Buffer.alloc(+length)\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function compare (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError('Arguments must be Buffers')\n  }\n\n  if (a === b) return 0\n\n  var x = a.length\n  var y = b.length\n\n  for (var i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i]\n      y = b[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'latin1':\n    case 'binary':\n    case 'base64':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!isArray(list)) {\n    throw new TypeError('\"list\" argument must be an Array of Buffers')\n  }\n\n  if (list.length === 0) {\n    return Buffer.alloc(0)\n  }\n\n  var i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; ++i) {\n      length += list[i].length\n    }\n  }\n\n  var buffer = Buffer.allocUnsafe(length)\n  var pos = 0\n  for (i = 0; i < list.length; ++i) {\n    var buf = list[i]\n    if (!Buffer.isBuffer(buf)) {\n      throw new TypeError('\"list\" argument must be an Array of Buffers')\n    }\n    buf.copy(buffer, pos)\n    pos += buf.length\n  }\n  return buffer\n}\n\nfunction byteLength (string, encoding) {\n  if (Buffer.isBuffer(string)) {\n    return string.length\n  }\n  if (typeof ArrayBuffer !== 'undefined' && typeof ArrayBuffer.isView === 'function' &&\n      (ArrayBuffer.isView(string) || string instanceof ArrayBuffer)) {\n    return string.byteLength\n  }\n  if (typeof string !== 'string') {\n    string = '' + string\n  }\n\n  var len = string.length\n  if (len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return len\n      case 'utf8':\n      case 'utf-8':\n      case undefined:\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) return utf8ToBytes(string).length // assume utf8\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  var loweredCase = false\n\n  // No need to verify that \"this.length <= MAX_UINT32\" since it's a read-only\n  // property of a typed array.\n\n  // This behaves neither like String nor Uint8Array in that we set start/end\n  // to their upper/lower bounds if the value passed is out of range.\n  // undefined is handled specially as per ECMA-262 6th Edition,\n  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.\n  if (start === undefined || start < 0) {\n    start = 0\n  }\n  // Return early if start > this.length. Done here to prevent potential uint32\n  // coercion fail below.\n  if (start > this.length) {\n    return ''\n  }\n\n  if (end === undefined || end > this.length) {\n    end = this.length\n  }\n\n  if (end <= 0) {\n    return ''\n  }\n\n  // Force coersion to uint32. This will also coerce falsey/NaN values to 0.\n  end >>>= 0\n  start >>>= 0\n\n  if (end <= start) {\n    return ''\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Slice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\n// The property is used by `Buffer.isBuffer` and `is-buffer` (in Safari 5-7) to detect\n// Buffer instances.\nBuffer.prototype._isBuffer = true\n\nfunction swap (b, n, m) {\n  var i = b[n]\n  b[n] = b[m]\n  b[m] = i\n}\n\nBuffer.prototype.swap16 = function swap16 () {\n  var len = this.length\n  if (len % 2 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 16-bits')\n  }\n  for (var i = 0; i < len; i += 2) {\n    swap(this, i, i + 1)\n  }\n  return this\n}\n\nBuffer.prototype.swap32 = function swap32 () {\n  var len = this.length\n  if (len % 4 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 32-bits')\n  }\n  for (var i = 0; i < len; i += 4) {\n    swap(this, i, i + 3)\n    swap(this, i + 1, i + 2)\n  }\n  return this\n}\n\nBuffer.prototype.swap64 = function swap64 () {\n  var len = this.length\n  if (len % 8 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 64-bits')\n  }\n  for (var i = 0; i < len; i += 8) {\n    swap(this, i, i + 7)\n    swap(this, i + 1, i + 6)\n    swap(this, i + 2, i + 5)\n    swap(this, i + 3, i + 4)\n  }\n  return this\n}\n\nBuffer.prototype.toString = function toString () {\n  var length = this.length | 0\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max) str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {\n  if (!Buffer.isBuffer(target)) {\n    throw new TypeError('Argument must be a Buffer')\n  }\n\n  if (start === undefined) {\n    start = 0\n  }\n  if (end === undefined) {\n    end = target ? target.length : 0\n  }\n  if (thisStart === undefined) {\n    thisStart = 0\n  }\n  if (thisEnd === undefined) {\n    thisEnd = this.length\n  }\n\n  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {\n    throw new RangeError('out of range index')\n  }\n\n  if (thisStart >= thisEnd && start >= end) {\n    return 0\n  }\n  if (thisStart >= thisEnd) {\n    return -1\n  }\n  if (start >= end) {\n    return 1\n  }\n\n  start >>>= 0\n  end >>>= 0\n  thisStart >>>= 0\n  thisEnd >>>= 0\n\n  if (this === target) return 0\n\n  var x = thisEnd - thisStart\n  var y = end - start\n  var len = Math.min(x, y)\n\n  var thisCopy = this.slice(thisStart, thisEnd)\n  var targetCopy = target.slice(start, end)\n\n  for (var i = 0; i < len; ++i) {\n    if (thisCopy[i] !== targetCopy[i]) {\n      x = thisCopy[i]\n      y = targetCopy[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\n// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,\n// OR the last index of `val` in `buffer` at offset <= `byteOffset`.\n//\n// Arguments:\n// - buffer - a Buffer to search\n// - val - a string, Buffer, or number\n// - byteOffset - an index into `buffer`; will be clamped to an int32\n// - encoding - an optional encoding, relevant is val is a string\n// - dir - true for indexOf, false for lastIndexOf\nfunction bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {\n  // Empty buffer means no match\n  if (buffer.length === 0) return -1\n\n  // Normalize byteOffset\n  if (typeof byteOffset === 'string') {\n    encoding = byteOffset\n    byteOffset = 0\n  } else if (byteOffset > 0x7fffffff) {\n    byteOffset = 0x7fffffff\n  } else if (byteOffset < -0x80000000) {\n    byteOffset = -0x80000000\n  }\n  byteOffset = +byteOffset  // Coerce to Number.\n  if (isNaN(byteOffset)) {\n    // byteOffset: it it's undefined, null, NaN, \"foo\", etc, search whole buffer\n    byteOffset = dir ? 0 : (buffer.length - 1)\n  }\n\n  // Normalize byteOffset: negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = buffer.length + byteOffset\n  if (byteOffset >= buffer.length) {\n    if (dir) return -1\n    else byteOffset = buffer.length - 1\n  } else if (byteOffset < 0) {\n    if (dir) byteOffset = 0\n    else return -1\n  }\n\n  // Normalize val\n  if (typeof val === 'string') {\n    val = Buffer.from(val, encoding)\n  }\n\n  // Finally, search either indexOf (if dir is true) or lastIndexOf\n  if (Buffer.isBuffer(val)) {\n    // Special case: looking for empty string/buffer always fails\n    if (val.length === 0) {\n      return -1\n    }\n    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)\n  } else if (typeof val === 'number') {\n    val = val & 0xFF // Search for a byte value [0-255]\n    if (Buffer.TYPED_ARRAY_SUPPORT &&\n        typeof Uint8Array.prototype.indexOf === 'function') {\n      if (dir) {\n        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)\n      } else {\n        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)\n      }\n    }\n    return arrayIndexOf(buffer, [ val ], byteOffset, encoding, dir)\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\nfunction arrayIndexOf (arr, val, byteOffset, encoding, dir) {\n  var indexSize = 1\n  var arrLength = arr.length\n  var valLength = val.length\n\n  if (encoding !== undefined) {\n    encoding = String(encoding).toLowerCase()\n    if (encoding === 'ucs2' || encoding === 'ucs-2' ||\n        encoding === 'utf16le' || encoding === 'utf-16le') {\n      if (arr.length < 2 || val.length < 2) {\n        return -1\n      }\n      indexSize = 2\n      arrLength /= 2\n      valLength /= 2\n      byteOffset /= 2\n    }\n  }\n\n  function read (buf, i) {\n    if (indexSize === 1) {\n      return buf[i]\n    } else {\n      return buf.readUInt16BE(i * indexSize)\n    }\n  }\n\n  var i\n  if (dir) {\n    var foundIndex = -1\n    for (i = byteOffset; i < arrLength; i++) {\n      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize\n      } else {\n        if (foundIndex !== -1) i -= i - foundIndex\n        foundIndex = -1\n      }\n    }\n  } else {\n    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength\n    for (i = byteOffset; i >= 0; i--) {\n      var found = true\n      for (var j = 0; j < valLength; j++) {\n        if (read(arr, i + j) !== read(val, j)) {\n          found = false\n          break\n        }\n      }\n      if (found) return i\n    }\n  }\n\n  return -1\n}\n\nBuffer.prototype.includes = function includes (val, byteOffset, encoding) {\n  return this.indexOf(val, byteOffset, encoding) !== -1\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)\n}\n\nBuffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new TypeError('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; ++i) {\n    var parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(parsed)) return i\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction latin1Write (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset | 0\n    if (isFinite(length)) {\n      length = length | 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  // legacy write(string, encoding, offset, length) - remove in v0.13\n  } else {\n    throw new Error(\n      'Buffer.write(string, encoding, offset[, length]) is no longer supported'\n    )\n  }\n\n  var remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('Attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n        return asciiWrite(this, string, offset, length)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Write(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  var res = []\n\n  var i = start\n  while (i < end) {\n    var firstByte = buf[i]\n    var codePoint = null\n    var bytesPerSequence = (firstByte > 0xEF) ? 4\n      : (firstByte > 0xDF) ? 3\n      : (firstByte > 0xBF) ? 2\n      : 1\n\n    if (i + bytesPerSequence <= end) {\n      var secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nvar MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  var len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  var res = ''\n  var i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction latin1Slice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; ++i) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  var newBuf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    newBuf = this.subarray(start, end)\n    newBuf.__proto__ = Buffer.prototype\n  } else {\n    var sliceLen = end - start\n    newBuf = new Buffer(sliceLen, undefined)\n    for (var i = 0; i < sliceLen; ++i) {\n      newBuf[i] = this[i + start]\n    }\n  }\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  var val = this[offset + --byteLength]\n  var mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var i = byteLength\n  var mul = 1\n  var val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('\"buffer\" argument must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('\"value\" argument is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n}\n\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var mul = 1\n  var i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; ++i) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; ++i) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = 0\n  var mul = 1\n  var sub = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  var sub = 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n  if (offset < 0) throw new RangeError('Index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  var len = end - start\n  var i\n\n  if (this === target && start < targetStart && targetStart < end) {\n    // descending copy from end\n    for (i = len - 1; i >= 0; --i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    // ascending copy from start\n    for (i = 0; i < len; ++i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else {\n    Uint8Array.prototype.set.call(\n      target,\n      this.subarray(start, start + len),\n      targetStart\n    )\n  }\n\n  return len\n}\n\n// Usage:\n//    buffer.fill(number[, offset[, end]])\n//    buffer.fill(buffer[, offset[, end]])\n//    buffer.fill(string[, offset[, end]][, encoding])\nBuffer.prototype.fill = function fill (val, start, end, encoding) {\n  // Handle string cases:\n  if (typeof val === 'string') {\n    if (typeof start === 'string') {\n      encoding = start\n      start = 0\n      end = this.length\n    } else if (typeof end === 'string') {\n      encoding = end\n      end = this.length\n    }\n    if (val.length === 1) {\n      var code = val.charCodeAt(0)\n      if (code < 256) {\n        val = code\n      }\n    }\n    if (encoding !== undefined && typeof encoding !== 'string') {\n      throw new TypeError('encoding must be a string')\n    }\n    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {\n      throw new TypeError('Unknown encoding: ' + encoding)\n    }\n  } else if (typeof val === 'number') {\n    val = val & 255\n  }\n\n  // Invalid ranges are not set to a default, so can range check early.\n  if (start < 0 || this.length < start || this.length < end) {\n    throw new RangeError('Out of range index')\n  }\n\n  if (end <= start) {\n    return this\n  }\n\n  start = start >>> 0\n  end = end === undefined ? this.length : end >>> 0\n\n  if (!val) val = 0\n\n  var i\n  if (typeof val === 'number') {\n    for (i = start; i < end; ++i) {\n      this[i] = val\n    }\n  } else {\n    var bytes = Buffer.isBuffer(val)\n      ? val\n      : utf8ToBytes(new Buffer(val, encoding).toString())\n    var len = bytes.length\n    for (i = 0; i < end - start; ++i) {\n      this[i + start] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  var codePoint\n  var length = string.length\n  var leadSurrogate = null\n  var bytes = []\n\n  for (var i = 0; i < length; ++i) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; ++i) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\nfunction isnan (val) {\n  return val !== val // eslint-disable-line no-self-compare\n}\n","'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction placeHoldersCount (b64) {\n  var len = b64.length\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // the number of equal signs (place holders)\n  // if there are two placeholders, than the two characters before it\n  // represent one byte\n  // if there is only one, then the three characters before it represent 2 bytes\n  // this is just a cheap hack to not do indexOf twice\n  return b64[len - 2] === '=' ? 2 : b64[len - 1] === '=' ? 1 : 0\n}\n\nfunction byteLength (b64) {\n  // base64 is 4/3 + up to two characters of the original data\n  return b64.length * 3 / 4 - placeHoldersCount(b64)\n}\n\nfunction toByteArray (b64) {\n  var i, j, l, tmp, placeHolders, arr\n  var len = b64.length\n  placeHolders = placeHoldersCount(b64)\n\n  arr = new Arr(len * 3 / 4 - placeHolders)\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  l = placeHolders > 0 ? len - 4 : len\n\n  var L = 0\n\n  for (i = 0, j = 0; i < l; i += 4, j += 3) {\n    tmp = (revLookup[b64.charCodeAt(i)] << 18) | (revLookup[b64.charCodeAt(i + 1)] << 12) | (revLookup[b64.charCodeAt(i + 2)] << 6) | revLookup[b64.charCodeAt(i + 3)]\n    arr[L++] = (tmp >> 16) & 0xFF\n    arr[L++] = (tmp >> 8) & 0xFF\n    arr[L++] = tmp & 0xFF\n  }\n\n  if (placeHolders === 2) {\n    tmp = (revLookup[b64.charCodeAt(i)] << 2) | (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[L++] = tmp & 0xFF\n  } else if (placeHolders === 1) {\n    tmp = (revLookup[b64.charCodeAt(i)] << 10) | (revLookup[b64.charCodeAt(i + 1)] << 4) | (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[L++] = (tmp >> 8) & 0xFF\n    arr[L++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] + lookup[num >> 12 & 0x3F] + lookup[num >> 6 & 0x3F] + lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2])\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var output = ''\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    output += lookup[tmp >> 2]\n    output += lookup[(tmp << 4) & 0x3F]\n    output += '=='\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + (uint8[len - 1])\n    output += lookup[tmp >> 10]\n    output += lookup[(tmp >> 4) & 0x3F]\n    output += lookup[(tmp << 2) & 0x3F]\n    output += '='\n  }\n\n  parts.push(output)\n\n  return parts.join('')\n}\n","exports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = nBytes * 8 - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = e * 256 + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = m * 256 + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = nBytes * 8 - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = (value * c - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n","/*! https://mths.be/punycode v1.4.1 by @mathias */\n;(function(root) {\n\n\t/** Detect free variables */\n\tvar freeExports = typeof exports == 'object' && exports &&\n\t\t!exports.nodeType && exports;\n\tvar freeModule = typeof module == 'object' && module &&\n\t\t!module.nodeType && module;\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (\n\t\tfreeGlobal.global === freeGlobal ||\n\t\tfreeGlobal.window === freeGlobal ||\n\t\tfreeGlobal.self === freeGlobal\n\t) {\n\t\troot = freeGlobal;\n\t}\n\n\t/**\n\t * The `punycode` object.\n\t * @name punycode\n\t * @type Object\n\t */\n\tvar punycode,\n\n\t/** Highest positive signed 32-bit float value */\n\tmaxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1\n\n\t/** Bootstring parameters */\n\tbase = 36,\n\ttMin = 1,\n\ttMax = 26,\n\tskew = 38,\n\tdamp = 700,\n\tinitialBias = 72,\n\tinitialN = 128, // 0x80\n\tdelimiter = '-', // '\\x2D'\n\n\t/** Regular expressions */\n\tregexPunycode = /^xn--/,\n\tregexNonASCII = /[^\\x20-\\x7E]/, // unprintable ASCII chars + non-ASCII chars\n\tregexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g, // RFC 3490 separators\n\n\t/** Error messages */\n\terrors = {\n\t\t'overflow': 'Overflow: input needs wider integers to process',\n\t\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t\t'invalid-input': 'Invalid input'\n\t},\n\n\t/** Convenience shortcuts */\n\tbaseMinusTMin = base - tMin,\n\tfloor = Math.floor,\n\tstringFromCharCode = String.fromCharCode,\n\n\t/** Temporary variable */\n\tkey;\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/**\n\t * A generic error utility function.\n\t * @private\n\t * @param {String} type The error type.\n\t * @returns {Error} Throws a `RangeError` with the applicable error message.\n\t */\n\tfunction error(type) {\n\t\tthrow new RangeError(errors[type]);\n\t}\n\n\t/**\n\t * A generic `Array#map` utility function.\n\t * @private\n\t * @param {Array} array The array to iterate over.\n\t * @param {Function} callback The function that gets called for every array\n\t * item.\n\t * @returns {Array} A new array of values returned by the callback function.\n\t */\n\tfunction map(array, fn) {\n\t\tvar length = array.length;\n\t\tvar result = [];\n\t\twhile (length--) {\n\t\t\tresult[length] = fn(array[length]);\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * A simple `Array#map`-like wrapper to work with domain name strings or email\n\t * addresses.\n\t * @private\n\t * @param {String} domain The domain name or email address.\n\t * @param {Function} callback The function that gets called for every\n\t * character.\n\t * @returns {Array} A new string of characters returned by the callback\n\t * function.\n\t */\n\tfunction mapDomain(string, fn) {\n\t\tvar parts = string.split('@');\n\t\tvar result = '';\n\t\tif (parts.length > 1) {\n\t\t\t// In email addresses, only the domain name should be punycoded. Leave\n\t\t\t// the local part (i.e. everything up to `@`) intact.\n\t\t\tresult = parts[0] + '@';\n\t\t\tstring = parts[1];\n\t\t}\n\t\t// Avoid `split(regex)` for IE8 compatibility. See #17.\n\t\tstring = string.replace(regexSeparators, '\\x2E');\n\t\tvar labels = string.split('.');\n\t\tvar encoded = map(labels, fn).join('.');\n\t\treturn result + encoded;\n\t}\n\n\t/**\n\t * Creates an array containing the numeric code points of each Unicode\n\t * character in the string. While JavaScript uses UCS-2 internally,\n\t * this function will convert a pair of surrogate halves (each of which\n\t * UCS-2 exposes as separate characters) into a single code point,\n\t * matching UTF-16.\n\t * @see `punycode.ucs2.encode`\n\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode.ucs2\n\t * @name decode\n\t * @param {String} string The Unicode input string (UCS-2).\n\t * @returns {Array} The new array of code points.\n\t */\n\tfunction ucs2decode(string) {\n\t\tvar output = [],\n\t\t    counter = 0,\n\t\t    length = string.length,\n\t\t    value,\n\t\t    extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Creates a string based on an array of numeric code points.\n\t * @see `punycode.ucs2.decode`\n\t * @memberOf punycode.ucs2\n\t * @name encode\n\t * @param {Array} codePoints The array of numeric code points.\n\t * @returns {String} The new Unicode string (UCS-2).\n\t */\n\tfunction ucs2encode(array) {\n\t\treturn map(array, function(value) {\n\t\t\tvar output = '';\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t\treturn output;\n\t\t}).join('');\n\t}\n\n\t/**\n\t * Converts a basic code point into a digit/integer.\n\t * @see `digitToBasic()`\n\t * @private\n\t * @param {Number} codePoint The basic numeric code point value.\n\t * @returns {Number} The numeric value of a basic code point (for use in\n\t * representing integers) in the range `0` to `base - 1`, or `base` if\n\t * the code point does not represent a value.\n\t */\n\tfunction basicToDigit(codePoint) {\n\t\tif (codePoint - 48 < 10) {\n\t\t\treturn codePoint - 22;\n\t\t}\n\t\tif (codePoint - 65 < 26) {\n\t\t\treturn codePoint - 65;\n\t\t}\n\t\tif (codePoint - 97 < 26) {\n\t\t\treturn codePoint - 97;\n\t\t}\n\t\treturn base;\n\t}\n\n\t/**\n\t * Converts a digit/integer into a basic code point.\n\t * @see `basicToDigit()`\n\t * @private\n\t * @param {Number} digit The numeric value of a basic code point.\n\t * @returns {Number} The basic code point whose value (when used for\n\t * representing integers) is `digit`, which needs to be in the range\n\t * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n\t * used; else, the lowercase form is used. The behavior is undefined\n\t * if `flag` is non-zero and `digit` has no uppercase form.\n\t */\n\tfunction digitToBasic(digit, flag) {\n\t\t//  0..25 map to ASCII a..z or A..Z\n\t\t// 26..35 map to ASCII 0..9\n\t\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n\t}\n\n\t/**\n\t * Bias adaptation function as per section 3.4 of RFC 3492.\n\t * https://tools.ietf.org/html/rfc3492#section-3.4\n\t * @private\n\t */\n\tfunction adapt(delta, numPoints, firstTime) {\n\t\tvar k = 0;\n\t\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\t\tdelta += floor(delta / numPoints);\n\t\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\t\tdelta = floor(delta / baseMinusTMin);\n\t\t}\n\t\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n\t}\n\n\t/**\n\t * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The Punycode string of ASCII-only symbols.\n\t * @returns {String} The resulting string of Unicode symbols.\n\t */\n\tfunction decode(input) {\n\t\t// Don't use UCS-2\n\t\tvar output = [],\n\t\t    inputLength = input.length,\n\t\t    out,\n\t\t    i = 0,\n\t\t    n = initialN,\n\t\t    bias = initialBias,\n\t\t    basic,\n\t\t    j,\n\t\t    index,\n\t\t    oldi,\n\t\t    w,\n\t\t    k,\n\t\t    digit,\n\t\t    t,\n\t\t    /** Cached calculation results */\n\t\t    baseMinusT;\n\n\t\t// Handle the basic code points: let `basic` be the number of input code\n\t\t// points before the last delimiter, or `0` if there is none, then copy\n\t\t// the first basic code points to the output.\n\n\t\tbasic = input.lastIndexOf(delimiter);\n\t\tif (basic < 0) {\n\t\t\tbasic = 0;\n\t\t}\n\n\t\tfor (j = 0; j < basic; ++j) {\n\t\t\t// if it's not a basic code point\n\t\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\t\terror('not-basic');\n\t\t\t}\n\t\t\toutput.push(input.charCodeAt(j));\n\t\t}\n\n\t\t// Main decoding loop: start just after the last delimiter if any basic code\n\t\t// points were copied; start at the beginning otherwise.\n\n\t\tfor (index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t\t// `index` is the index of the next character to be consumed.\n\t\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t\t// which gets added to `i`. The overflow checking is easier\n\t\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t\t// value at the end to obtain `delta`.\n\t\t\tfor (oldi = i, w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\t\tif (index >= inputLength) {\n\t\t\t\t\terror('invalid-input');\n\t\t\t\t}\n\n\t\t\t\tdigit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\ti += digit * w;\n\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\t\tif (digit < t) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbaseMinusT = base - t;\n\t\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tw *= baseMinusT;\n\n\t\t\t}\n\n\t\t\tout = output.length + 1;\n\t\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t\t// incrementing `n` each time, so we'll fix that now:\n\t\t\tif (floor(i / out) > maxInt - n) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tn += floor(i / out);\n\t\t\ti %= out;\n\n\t\t\t// Insert `n` at position `i` of the output\n\t\t\toutput.splice(i++, 0, n);\n\n\t\t}\n\n\t\treturn ucs2encode(output);\n\t}\n\n\t/**\n\t * Converts a string of Unicode symbols (e.g. a domain name label) to a\n\t * Punycode string of ASCII-only symbols.\n\t * @memberOf punycode\n\t * @param {String} input The string of Unicode symbols.\n\t * @returns {String} The resulting Punycode string of ASCII-only symbols.\n\t */\n\tfunction encode(input) {\n\t\tvar n,\n\t\t    delta,\n\t\t    handledCPCount,\n\t\t    basicLength,\n\t\t    bias,\n\t\t    j,\n\t\t    m,\n\t\t    q,\n\t\t    k,\n\t\t    t,\n\t\t    currentValue,\n\t\t    output = [],\n\t\t    /** `inputLength` will hold the number of code points in `input`. */\n\t\t    inputLength,\n\t\t    /** Cached calculation results */\n\t\t    handledCPCountPlusOne,\n\t\t    baseMinusT,\n\t\t    qMinusT;\n\n\t\t// Convert the input in UCS-2 to Unicode\n\t\tinput = ucs2decode(input);\n\n\t\t// Cache the length\n\t\tinputLength = input.length;\n\n\t\t// Initialize the state\n\t\tn = initialN;\n\t\tdelta = 0;\n\t\tbias = initialBias;\n\n\t\t// Handle the basic code points\n\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\tcurrentValue = input[j];\n\t\t\tif (currentValue < 0x80) {\n\t\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t\t}\n\t\t}\n\n\t\thandledCPCount = basicLength = output.length;\n\n\t\t// `handledCPCount` is the number of code points that have been handled;\n\t\t// `basicLength` is the number of basic code points.\n\n\t\t// Finish the basic string - if it is not empty - with a delimiter\n\t\tif (basicLength) {\n\t\t\toutput.push(delimiter);\n\t\t}\n\n\t\t// Main encoding loop:\n\t\twhile (handledCPCount < inputLength) {\n\n\t\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t\t// larger one:\n\t\t\tfor (m = maxInt, j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\t\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\t\tm = currentValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t\t// but guard against overflow\n\t\t\thandledCPCountPlusOne = handledCPCount + 1;\n\t\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\t\tn = m;\n\n\t\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\n\t\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tif (currentValue == n) {\n\t\t\t\t\t// Represent delta as a generalized variable-length integer\n\t\t\t\t\tfor (q = delta, k = base; /* no condition */; k += base) {\n\t\t\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tqMinusT = q - t;\n\t\t\t\t\t\tbaseMinusT = base - t;\n\t\t\t\t\t\toutput.push(\n\t\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t\t);\n\t\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\t\tdelta = 0;\n\t\t\t\t\t++handledCPCount;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t++delta;\n\t\t\t++n;\n\n\t\t}\n\t\treturn output.join('');\n\t}\n\n\t/**\n\t * Converts a Punycode string representing a domain name or an email address\n\t * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n\t * it doesn't matter if you call it on a string that has already been\n\t * converted to Unicode.\n\t * @memberOf punycode\n\t * @param {String} input The Punycoded domain name or email address to\n\t * convert to Unicode.\n\t * @returns {String} The Unicode representation of the given Punycode\n\t * string.\n\t */\n\tfunction toUnicode(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexPunycode.test(string)\n\t\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/**\n\t * Converts a Unicode string representing a domain name or an email address to\n\t * Punycode. Only the non-ASCII parts of the domain name will be converted,\n\t * i.e. it doesn't matter if you call it with a domain that's already in\n\t * ASCII.\n\t * @memberOf punycode\n\t * @param {String} input The domain name or email address to convert, as a\n\t * Unicode string.\n\t * @returns {String} The Punycode representation of the given domain name or\n\t * email address.\n\t */\n\tfunction toASCII(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexNonASCII.test(string)\n\t\t\t\t? 'xn--' + encode(string)\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/** Define the public API */\n\tpunycode = {\n\t\t/**\n\t\t * A string representing the current Punycode.js version number.\n\t\t * @memberOf punycode\n\t\t * @type String\n\t\t */\n\t\t'version': '1.4.1',\n\t\t/**\n\t\t * An object of methods to convert from JavaScript's internal character\n\t\t * representation (UCS-2) to Unicode code points, and back.\n\t\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t\t * @memberOf punycode\n\t\t * @type Object\n\t\t */\n\t\t'ucs2': {\n\t\t\t'decode': ucs2decode,\n\t\t\t'encode': ucs2encode\n\t\t},\n\t\t'decode': decode,\n\t\t'encode': encode,\n\t\t'toASCII': toASCII,\n\t\t'toUnicode': toUnicode\n\t};\n\n\t/** Expose `punycode` */\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine('punycode', function() {\n\t\t\treturn punycode;\n\t\t});\n\t} else if (freeExports && freeModule) {\n\t\tif (module.exports == freeExports) {\n\t\t\t// in Node.js, io.js, or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = punycode;\n\t\t} else {\n\t\t\t// in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (key in punycode) {\n\t\t\t\tpunycode.hasOwnProperty(key) && (freeExports[key] = punycode[key]);\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// in Rhino or a web browser\n\t\troot.punycode = punycode;\n\t}\n\n}(this));\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return map(objectKeys(obj), function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (isArray(obj[k])) {\n        return map(obj[k], function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nfunction map (xs, f) {\n  if (xs.map) return xs.map(f);\n  var res = [];\n  for (var i = 0; i < xs.length; i++) {\n    res.push(f(xs[i], i));\n  }\n  return res;\n}\n\nvar objectKeys = Object.keys || function (obj) {\n  var res = [];\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);\n  }\n  return res;\n};\n","'use strict';\n\nexports.decode = exports.parse = require('./decode');\nexports.encode = exports.stringify = require('./encode');\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar punycode = require('punycode');\nvar util = require('./util');\n\nexports.parse = urlParse;\nexports.resolve = urlResolve;\nexports.resolveObject = urlResolveObject;\nexports.format = urlFormat;\n\nexports.Url = Url;\n\nfunction Url() {\n  this.protocol = null;\n  this.slashes = null;\n  this.auth = null;\n  this.host = null;\n  this.port = null;\n  this.hostname = null;\n  this.hash = null;\n  this.search = null;\n  this.query = null;\n  this.pathname = null;\n  this.path = null;\n  this.href = null;\n}\n\n// Reference: RFC 3986, RFC 1808, RFC 2396\n\n// define these here so at least they only have to be\n// compiled once on the first module load.\nvar protocolPattern = /^([a-z0-9.+-]+:)/i,\n    portPattern = /:[0-9]*$/,\n\n    // Special case for a simple path URL\n    simplePathPattern = /^(\\/\\/?(?!\\/)[^\\?\\s]*)(\\?[^\\s]*)?$/,\n\n    // RFC 2396: characters reserved for delimiting URLs.\n    // We actually just auto-escape these.\n    delims = ['<', '>', '\"', '`', ' ', '\\r', '\\n', '\\t'],\n\n    // RFC 2396: characters not allowed for various reasons.\n    unwise = ['{', '}', '|', '\\\\', '^', '`'].concat(delims),\n\n    // Allowed by RFCs, but cause of XSS attacks.  Always escape these.\n    autoEscape = ['\\''].concat(unwise),\n    // Characters that are never ever allowed in a hostname.\n    // Note that any invalid chars are also handled, but these\n    // are the ones that are *expected* to be seen, so we fast-path\n    // them.\n    nonHostChars = ['%', '/', '?', ';', '#'].concat(autoEscape),\n    hostEndingChars = ['/', '?', '#'],\n    hostnameMaxLen = 255,\n    hostnamePartPattern = /^[+a-z0-9A-Z_-]{0,63}$/,\n    hostnamePartStart = /^([+a-z0-9A-Z_-]{0,63})(.*)$/,\n    // protocols that can allow \"unsafe\" and \"unwise\" chars.\n    unsafeProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that never have a hostname.\n    hostlessProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that always contain a // bit.\n    slashedProtocol = {\n      'http': true,\n      'https': true,\n      'ftp': true,\n      'gopher': true,\n      'file': true,\n      'http:': true,\n      'https:': true,\n      'ftp:': true,\n      'gopher:': true,\n      'file:': true\n    },\n    querystring = require('querystring');\n\nfunction urlParse(url, parseQueryString, slashesDenoteHost) {\n  if (url && util.isObject(url) && url instanceof Url) return url;\n\n  var u = new Url;\n  u.parse(url, parseQueryString, slashesDenoteHost);\n  return u;\n}\n\nUrl.prototype.parse = function(url, parseQueryString, slashesDenoteHost) {\n  if (!util.isString(url)) {\n    throw new TypeError(\"Parameter 'url' must be a string, not \" + typeof url);\n  }\n\n  // Copy chrome, IE, opera backslash-handling behavior.\n  // Back slashes before the query string get converted to forward slashes\n  // See: https://code.google.com/p/chromium/issues/detail?id=25916\n  var queryIndex = url.indexOf('?'),\n      splitter =\n          (queryIndex !== -1 && queryIndex < url.indexOf('#')) ? '?' : '#',\n      uSplit = url.split(splitter),\n      slashRegex = /\\\\/g;\n  uSplit[0] = uSplit[0].replace(slashRegex, '/');\n  url = uSplit.join(splitter);\n\n  var rest = url;\n\n  // trim before proceeding.\n  // This is to support parse stuff like \"  http://foo.com  \\n\"\n  rest = rest.trim();\n\n  if (!slashesDenoteHost && url.split('#').length === 1) {\n    // Try fast path regexp\n    var simplePath = simplePathPattern.exec(rest);\n    if (simplePath) {\n      this.path = rest;\n      this.href = rest;\n      this.pathname = simplePath[1];\n      if (simplePath[2]) {\n        this.search = simplePath[2];\n        if (parseQueryString) {\n          this.query = querystring.parse(this.search.substr(1));\n        } else {\n          this.query = this.search.substr(1);\n        }\n      } else if (parseQueryString) {\n        this.search = '';\n        this.query = {};\n      }\n      return this;\n    }\n  }\n\n  var proto = protocolPattern.exec(rest);\n  if (proto) {\n    proto = proto[0];\n    var lowerProto = proto.toLowerCase();\n    this.protocol = lowerProto;\n    rest = rest.substr(proto.length);\n  }\n\n  // figure out if it's got a host\n  // user@server is *always* interpreted as a hostname, and url\n  // resolution will treat //foo/bar as host=foo,path=bar because that's\n  // how the browser resolves relative URLs.\n  if (slashesDenoteHost || proto || rest.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)) {\n    var slashes = rest.substr(0, 2) === '//';\n    if (slashes && !(proto && hostlessProtocol[proto])) {\n      rest = rest.substr(2);\n      this.slashes = true;\n    }\n  }\n\n  if (!hostlessProtocol[proto] &&\n      (slashes || (proto && !slashedProtocol[proto]))) {\n\n    // there's a hostname.\n    // the first instance of /, ?, ;, or # ends the host.\n    //\n    // If there is an @ in the hostname, then non-host chars *are* allowed\n    // to the left of the last @ sign, unless some host-ending character\n    // comes *before* the @-sign.\n    // URLs are obnoxious.\n    //\n    // ex:\n    // http://a@b@c/ => user:a@b host:c\n    // http://a@b?@c => user:a host:c path:/?@c\n\n    // v0.12 TODO(isaacs): This is not quite how Chrome does things.\n    // Review our test case against browsers more comprehensively.\n\n    // find the first instance of any hostEndingChars\n    var hostEnd = -1;\n    for (var i = 0; i < hostEndingChars.length; i++) {\n      var hec = rest.indexOf(hostEndingChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n\n    // at this point, either we have an explicit point where the\n    // auth portion cannot go past, or the last @ char is the decider.\n    var auth, atSign;\n    if (hostEnd === -1) {\n      // atSign can be anywhere.\n      atSign = rest.lastIndexOf('@');\n    } else {\n      // atSign must be in auth portion.\n      // http://a@b/c@d => host:b auth:a path:/c@d\n      atSign = rest.lastIndexOf('@', hostEnd);\n    }\n\n    // Now we have a portion which is definitely the auth.\n    // Pull that off.\n    if (atSign !== -1) {\n      auth = rest.slice(0, atSign);\n      rest = rest.slice(atSign + 1);\n      this.auth = decodeURIComponent(auth);\n    }\n\n    // the host is the remaining to the left of the first non-host char\n    hostEnd = -1;\n    for (var i = 0; i < nonHostChars.length; i++) {\n      var hec = rest.indexOf(nonHostChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n    // if we still have not hit it, then the entire thing is a host.\n    if (hostEnd === -1)\n      hostEnd = rest.length;\n\n    this.host = rest.slice(0, hostEnd);\n    rest = rest.slice(hostEnd);\n\n    // pull out port.\n    this.parseHost();\n\n    // we've indicated that there is a hostname,\n    // so even if it's empty, it has to be present.\n    this.hostname = this.hostname || '';\n\n    // if hostname begins with [ and ends with ]\n    // assume that it's an IPv6 address.\n    var ipv6Hostname = this.hostname[0] === '[' &&\n        this.hostname[this.hostname.length - 1] === ']';\n\n    // validate a little.\n    if (!ipv6Hostname) {\n      var hostparts = this.hostname.split(/\\./);\n      for (var i = 0, l = hostparts.length; i < l; i++) {\n        var part = hostparts[i];\n        if (!part) continue;\n        if (!part.match(hostnamePartPattern)) {\n          var newpart = '';\n          for (var j = 0, k = part.length; j < k; j++) {\n            if (part.charCodeAt(j) > 127) {\n              // we replace non-ASCII char with a temporary placeholder\n              // we need this to make sure size of hostname is not\n              // broken by replacing non-ASCII by nothing\n              newpart += 'x';\n            } else {\n              newpart += part[j];\n            }\n          }\n          // we test again with ASCII char only\n          if (!newpart.match(hostnamePartPattern)) {\n            var validParts = hostparts.slice(0, i);\n            var notHost = hostparts.slice(i + 1);\n            var bit = part.match(hostnamePartStart);\n            if (bit) {\n              validParts.push(bit[1]);\n              notHost.unshift(bit[2]);\n            }\n            if (notHost.length) {\n              rest = '/' + notHost.join('.') + rest;\n            }\n            this.hostname = validParts.join('.');\n            break;\n          }\n        }\n      }\n    }\n\n    if (this.hostname.length > hostnameMaxLen) {\n      this.hostname = '';\n    } else {\n      // hostnames are always lower case.\n      this.hostname = this.hostname.toLowerCase();\n    }\n\n    if (!ipv6Hostname) {\n      // IDNA Support: Returns a punycoded representation of \"domain\".\n      // It only converts parts of the domain name that\n      // have non-ASCII characters, i.e. it doesn't matter if\n      // you call it with a domain that already is ASCII-only.\n      this.hostname = punycode.toASCII(this.hostname);\n    }\n\n    var p = this.port ? ':' + this.port : '';\n    var h = this.hostname || '';\n    this.host = h + p;\n    this.href += this.host;\n\n    // strip [ and ] from the hostname\n    // the host field still retains them, though\n    if (ipv6Hostname) {\n      this.hostname = this.hostname.substr(1, this.hostname.length - 2);\n      if (rest[0] !== '/') {\n        rest = '/' + rest;\n      }\n    }\n  }\n\n  // now rest is set to the post-host stuff.\n  // chop off any delim chars.\n  if (!unsafeProtocol[lowerProto]) {\n\n    // First, make 100% sure that any \"autoEscape\" chars get\n    // escaped, even if encodeURIComponent doesn't think they\n    // need to be.\n    for (var i = 0, l = autoEscape.length; i < l; i++) {\n      var ae = autoEscape[i];\n      if (rest.indexOf(ae) === -1)\n        continue;\n      var esc = encodeURIComponent(ae);\n      if (esc === ae) {\n        esc = escape(ae);\n      }\n      rest = rest.split(ae).join(esc);\n    }\n  }\n\n\n  // chop off from the tail first.\n  var hash = rest.indexOf('#');\n  if (hash !== -1) {\n    // got a fragment string.\n    this.hash = rest.substr(hash);\n    rest = rest.slice(0, hash);\n  }\n  var qm = rest.indexOf('?');\n  if (qm !== -1) {\n    this.search = rest.substr(qm);\n    this.query = rest.substr(qm + 1);\n    if (parseQueryString) {\n      this.query = querystring.parse(this.query);\n    }\n    rest = rest.slice(0, qm);\n  } else if (parseQueryString) {\n    // no query string, but parseQueryString still requested\n    this.search = '';\n    this.query = {};\n  }\n  if (rest) this.pathname = rest;\n  if (slashedProtocol[lowerProto] &&\n      this.hostname && !this.pathname) {\n    this.pathname = '/';\n  }\n\n  //to support http.request\n  if (this.pathname || this.search) {\n    var p = this.pathname || '';\n    var s = this.search || '';\n    this.path = p + s;\n  }\n\n  // finally, reconstruct the href based on what has been validated.\n  this.href = this.format();\n  return this;\n};\n\n// format a parsed object into a url string\nfunction urlFormat(obj) {\n  // ensure it's an object, and not a string url.\n  // If it's an obj, this is a no-op.\n  // this way, you can call url_format() on strings\n  // to clean up potentially wonky urls.\n  if (util.isString(obj)) obj = urlParse(obj);\n  if (!(obj instanceof Url)) return Url.prototype.format.call(obj);\n  return obj.format();\n}\n\nUrl.prototype.format = function() {\n  var auth = this.auth || '';\n  if (auth) {\n    auth = encodeURIComponent(auth);\n    auth = auth.replace(/%3A/i, ':');\n    auth += '@';\n  }\n\n  var protocol = this.protocol || '',\n      pathname = this.pathname || '',\n      hash = this.hash || '',\n      host = false,\n      query = '';\n\n  if (this.host) {\n    host = auth + this.host;\n  } else if (this.hostname) {\n    host = auth + (this.hostname.indexOf(':') === -1 ?\n        this.hostname :\n        '[' + this.hostname + ']');\n    if (this.port) {\n      host += ':' + this.port;\n    }\n  }\n\n  if (this.query &&\n      util.isObject(this.query) &&\n      Object.keys(this.query).length) {\n    query = querystring.stringify(this.query);\n  }\n\n  var search = this.search || (query && ('?' + query)) || '';\n\n  if (protocol && protocol.substr(-1) !== ':') protocol += ':';\n\n  // only the slashedProtocols get the //.  Not mailto:, xmpp:, etc.\n  // unless they had them to begin with.\n  if (this.slashes ||\n      (!protocol || slashedProtocol[protocol]) && host !== false) {\n    host = '//' + (host || '');\n    if (pathname && pathname.charAt(0) !== '/') pathname = '/' + pathname;\n  } else if (!host) {\n    host = '';\n  }\n\n  if (hash && hash.charAt(0) !== '#') hash = '#' + hash;\n  if (search && search.charAt(0) !== '?') search = '?' + search;\n\n  pathname = pathname.replace(/[?#]/g, function(match) {\n    return encodeURIComponent(match);\n  });\n  search = search.replace('#', '%23');\n\n  return protocol + host + pathname + search + hash;\n};\n\nfunction urlResolve(source, relative) {\n  return urlParse(source, false, true).resolve(relative);\n}\n\nUrl.prototype.resolve = function(relative) {\n  return this.resolveObject(urlParse(relative, false, true)).format();\n};\n\nfunction urlResolveObject(source, relative) {\n  if (!source) return relative;\n  return urlParse(source, false, true).resolveObject(relative);\n}\n\nUrl.prototype.resolveObject = function(relative) {\n  if (util.isString(relative)) {\n    var rel = new Url();\n    rel.parse(relative, false, true);\n    relative = rel;\n  }\n\n  var result = new Url();\n  var tkeys = Object.keys(this);\n  for (var tk = 0; tk < tkeys.length; tk++) {\n    var tkey = tkeys[tk];\n    result[tkey] = this[tkey];\n  }\n\n  // hash is always overridden, no matter what.\n  // even href=\"\" will remove it.\n  result.hash = relative.hash;\n\n  // if the relative url is empty, then there's nothing left to do here.\n  if (relative.href === '') {\n    result.href = result.format();\n    return result;\n  }\n\n  // hrefs like //foo/bar always cut to the protocol.\n  if (relative.slashes && !relative.protocol) {\n    // take everything except the protocol from relative\n    var rkeys = Object.keys(relative);\n    for (var rk = 0; rk < rkeys.length; rk++) {\n      var rkey = rkeys[rk];\n      if (rkey !== 'protocol')\n        result[rkey] = relative[rkey];\n    }\n\n    //urlParse appends trailing / to urls like http://www.example.com\n    if (slashedProtocol[result.protocol] &&\n        result.hostname && !result.pathname) {\n      result.path = result.pathname = '/';\n    }\n\n    result.href = result.format();\n    return result;\n  }\n\n  if (relative.protocol && relative.protocol !== result.protocol) {\n    // if it's a known url protocol, then changing\n    // the protocol does weird things\n    // first, if it's not file:, then we MUST have a host,\n    // and if there was a path\n    // to begin with, then we MUST have a path.\n    // if it is file:, then the host is dropped,\n    // because that's known to be hostless.\n    // anything else is assumed to be absolute.\n    if (!slashedProtocol[relative.protocol]) {\n      var keys = Object.keys(relative);\n      for (var v = 0; v < keys.length; v++) {\n        var k = keys[v];\n        result[k] = relative[k];\n      }\n      result.href = result.format();\n      return result;\n    }\n\n    result.protocol = relative.protocol;\n    if (!relative.host && !hostlessProtocol[relative.protocol]) {\n      var relPath = (relative.pathname || '').split('/');\n      while (relPath.length && !(relative.host = relPath.shift()));\n      if (!relative.host) relative.host = '';\n      if (!relative.hostname) relative.hostname = '';\n      if (relPath[0] !== '') relPath.unshift('');\n      if (relPath.length < 2) relPath.unshift('');\n      result.pathname = relPath.join('/');\n    } else {\n      result.pathname = relative.pathname;\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    result.host = relative.host || '';\n    result.auth = relative.auth;\n    result.hostname = relative.hostname || relative.host;\n    result.port = relative.port;\n    // to support http.request\n    if (result.pathname || result.search) {\n      var p = result.pathname || '';\n      var s = result.search || '';\n      result.path = p + s;\n    }\n    result.slashes = result.slashes || relative.slashes;\n    result.href = result.format();\n    return result;\n  }\n\n  var isSourceAbs = (result.pathname && result.pathname.charAt(0) === '/'),\n      isRelAbs = (\n          relative.host ||\n          relative.pathname && relative.pathname.charAt(0) === '/'\n      ),\n      mustEndAbs = (isRelAbs || isSourceAbs ||\n                    (result.host && relative.pathname)),\n      removeAllDots = mustEndAbs,\n      srcPath = result.pathname && result.pathname.split('/') || [],\n      relPath = relative.pathname && relative.pathname.split('/') || [],\n      psychotic = result.protocol && !slashedProtocol[result.protocol];\n\n  // if the url is a non-slashed url, then relative\n  // links like ../.. should be able\n  // to crawl up to the hostname, as well.  This is strange.\n  // result.protocol has already been set by now.\n  // Later on, put the first path part into the host field.\n  if (psychotic) {\n    result.hostname = '';\n    result.port = null;\n    if (result.host) {\n      if (srcPath[0] === '') srcPath[0] = result.host;\n      else srcPath.unshift(result.host);\n    }\n    result.host = '';\n    if (relative.protocol) {\n      relative.hostname = null;\n      relative.port = null;\n      if (relative.host) {\n        if (relPath[0] === '') relPath[0] = relative.host;\n        else relPath.unshift(relative.host);\n      }\n      relative.host = null;\n    }\n    mustEndAbs = mustEndAbs && (relPath[0] === '' || srcPath[0] === '');\n  }\n\n  if (isRelAbs) {\n    // it's absolute.\n    result.host = (relative.host || relative.host === '') ?\n                  relative.host : result.host;\n    result.hostname = (relative.hostname || relative.hostname === '') ?\n                      relative.hostname : result.hostname;\n    result.search = relative.search;\n    result.query = relative.query;\n    srcPath = relPath;\n    // fall through to the dot-handling below.\n  } else if (relPath.length) {\n    // it's relative\n    // throw away the existing file, and take the new path instead.\n    if (!srcPath) srcPath = [];\n    srcPath.pop();\n    srcPath = srcPath.concat(relPath);\n    result.search = relative.search;\n    result.query = relative.query;\n  } else if (!util.isNullOrUndefined(relative.search)) {\n    // just pull out the search.\n    // like href='?foo'.\n    // Put this after the other two cases because it simplifies the booleans\n    if (psychotic) {\n      result.hostname = result.host = srcPath.shift();\n      //occationaly the auth can get stuck only in host\n      //this especially happens in cases like\n      //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n      var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                       result.host.split('@') : false;\n      if (authInHost) {\n        result.auth = authInHost.shift();\n        result.host = result.hostname = authInHost.shift();\n      }\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    //to support http.request\n    if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n      result.path = (result.pathname ? result.pathname : '') +\n                    (result.search ? result.search : '');\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  if (!srcPath.length) {\n    // no path at all.  easy.\n    // we've already handled the other stuff above.\n    result.pathname = null;\n    //to support http.request\n    if (result.search) {\n      result.path = '/' + result.search;\n    } else {\n      result.path = null;\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  // if a url ENDs in . or .., then it must get a trailing slash.\n  // however, if it ends in anything else non-slashy,\n  // then it must NOT get a trailing slash.\n  var last = srcPath.slice(-1)[0];\n  var hasTrailingSlash = (\n      (result.host || relative.host || srcPath.length > 1) &&\n      (last === '.' || last === '..') || last === '');\n\n  // strip single dots, resolve double dots to parent dir\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = srcPath.length; i >= 0; i--) {\n    last = srcPath[i];\n    if (last === '.') {\n      srcPath.splice(i, 1);\n    } else if (last === '..') {\n      srcPath.splice(i, 1);\n      up++;\n    } else if (up) {\n      srcPath.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (!mustEndAbs && !removeAllDots) {\n    for (; up--; up) {\n      srcPath.unshift('..');\n    }\n  }\n\n  if (mustEndAbs && srcPath[0] !== '' &&\n      (!srcPath[0] || srcPath[0].charAt(0) !== '/')) {\n    srcPath.unshift('');\n  }\n\n  if (hasTrailingSlash && (srcPath.join('/').substr(-1) !== '/')) {\n    srcPath.push('');\n  }\n\n  var isAbsolute = srcPath[0] === '' ||\n      (srcPath[0] && srcPath[0].charAt(0) === '/');\n\n  // put the host back\n  if (psychotic) {\n    result.hostname = result.host = isAbsolute ? '' :\n                                    srcPath.length ? srcPath.shift() : '';\n    //occationaly the auth can get stuck only in host\n    //this especially happens in cases like\n    //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n    var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                     result.host.split('@') : false;\n    if (authInHost) {\n      result.auth = authInHost.shift();\n      result.host = result.hostname = authInHost.shift();\n    }\n  }\n\n  mustEndAbs = mustEndAbs || (result.host && srcPath.length);\n\n  if (mustEndAbs && !isAbsolute) {\n    srcPath.unshift('');\n  }\n\n  if (!srcPath.length) {\n    result.pathname = null;\n    result.path = null;\n  } else {\n    result.pathname = srcPath.join('/');\n  }\n\n  //to support request.http\n  if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n    result.path = (result.pathname ? result.pathname : '') +\n                  (result.search ? result.search : '');\n  }\n  result.auth = relative.auth || result.auth;\n  result.slashes = result.slashes || relative.slashes;\n  result.href = result.format();\n  return result;\n};\n\nUrl.prototype.parseHost = function() {\n  var host = this.host;\n  var port = portPattern.exec(host);\n  if (port) {\n    port = port[0];\n    if (port !== ':') {\n      this.port = port.substr(1);\n    }\n    host = host.substr(0, host.length - port.length);\n  }\n  if (host) this.hostname = host;\n};\n","'use strict';\n\nmodule.exports = {\n  isString: function(arg) {\n    return typeof(arg) === 'string';\n  },\n  isObject: function(arg) {\n    return typeof(arg) === 'object' && arg !== null;\n  },\n  isNull: function(arg) {\n    return arg === null;\n  },\n  isNullOrUndefined: function(arg) {\n    return arg == null;\n  }\n};\n","\"use strict\";\n\nmodule.exports = function Canvas () {\n  return document.createElement('canvas');\n};\n","// js-imagediff 1.0.3\n// (c) 2011-2012 Carl Sutherland, Humble Software\n// Distributed under the MIT License\n// For original source and documentation visit:\n// http://www.github.com/HumbleSoftware/js-imagediff\n\n(function (name, definition) {\n  var root = this;\n  if (typeof module !== 'undefined') {\n    try {\n      var Canvas = require('canvas');\n    } catch (e) {\n      throw new Error(\n        e.message + '\\n' +\n        'Please see https://github.com/HumbleSoftware/js-imagediff#cannot-find-module-canvas\\n'\n      );\n    }\n    module.exports = definition(root, name, Canvas);\n  } else if (typeof define === 'function' && typeof define.amd === 'object') {\n    define(definition);\n  } else {\n    root[name] = definition(root, name);\n  }\n})('imagediff', function (root, name, Canvas) {\n\n  var\n    TYPE_ARRAY        = /\\[object Array\\]/i,\n    TYPE_CANVAS       = /\\[object (Canvas|HTMLCanvasElement)\\]/i,\n    TYPE_CONTEXT      = /\\[object CanvasRenderingContext2D\\]/i,\n    TYPE_IMAGE        = /\\[object (Image|HTMLImageElement)\\]/i,\n    TYPE_IMAGE_DATA   = /\\[object ImageData\\]/i,\n\n    UNDEFINED         = 'undefined',\n\n    canvas            = getCanvas(),\n    context           = canvas.getContext('2d'),\n    previous          = root[name],\n    imagediff, jasmine;\n\n  // Creation\n  function getCanvas (width, height) {\n    var\n      canvas = Canvas ?\n        new Canvas() :\n        document.createElement('canvas');\n    if (width) canvas.width = width;\n    if (height) canvas.height = height;\n    return canvas;\n  }\n  function getImageData (width, height) {\n    canvas.width = width;\n    canvas.height = height;\n    context.clearRect(0, 0, width, height);\n    return context.createImageData(width, height);\n  }\n  // expost canvas module\n  function getCanvasRef() {\n    return Canvas;\n  }\n\n\n  // Type Checking\n  function isImage (object) {\n    return isType(object, TYPE_IMAGE);\n  }\n  function isCanvas (object) {\n    return isType(object, TYPE_CANVAS);\n  }\n  function isContext (object) {\n    return isType(object, TYPE_CONTEXT);\n  }\n  function isImageData (object) {\n    return !!(object &&\n      isType(object, TYPE_IMAGE_DATA) &&\n      typeof(object.width) !== UNDEFINED &&\n      typeof(object.height) !== UNDEFINED &&\n      typeof(object.data) !== UNDEFINED);\n  }\n  function isImageType (object) {\n    return (\n      isImage(object) ||\n      isCanvas(object) ||\n      isContext(object) ||\n      isImageData(object)\n    );\n  }\n  function isType (object, type) {\n    return typeof (object) === 'object' && !!Object.prototype.toString.apply(object).match(type);\n  }\n\n\n  // Type Conversion\n  function copyImageData (imageData) {\n    var\n      height = imageData.height,\n      width = imageData.width,\n      data = imageData.data,\n      newImageData, newData, i;\n\n    canvas.width = width;\n    canvas.height = height;\n    newImageData = context.getImageData(0, 0, width, height);\n    newData = newImageData.data;\n\n    for (i = imageData.data.length; i--;) {\n        newData[i] = data[i];\n    }\n\n    return newImageData;\n  }\n  function toImageData (object) {\n    if (isImage(object)) { return toImageDataFromImage(object); }\n    if (isCanvas(object)) { return toImageDataFromCanvas(object); }\n    if (isContext(object)) { return toImageDataFromContext(object); }\n    if (isImageData(object)) { return object; }\n  }\n  function toImageDataFromImage (image) {\n    var\n      height = image.height,\n      width = image.width;\n    canvas.width = width;\n    canvas.height = height;\n    context.clearRect(0, 0, width, height);\n    context.drawImage(image, 0, 0);\n    return context.getImageData(0, 0, width, height);\n  }\n  function toImageDataFromCanvas (canvas) {\n    var\n      height = canvas.height,\n      width = canvas.width,\n      context = canvas.getContext('2d');\n    return context.getImageData(0, 0, width, height);\n  }\n  function toImageDataFromContext (context) {\n    var\n      canvas = context.canvas,\n      height = canvas.height,\n      width = canvas.width;\n    return context.getImageData(0, 0, width, height);\n  }\n  function toCanvas (object) {\n    var\n      data = toImageData(object),\n      canvas = getCanvas(data.width, data.height),\n      context = canvas.getContext('2d');\n\n    context.putImageData(data, 0, 0);\n    return canvas;\n  }\n\n\n  // ImageData Equality Operators\n  function equalWidth (a, b) {\n    return a.width === b.width;\n  }\n  function equalHeight (a, b) {\n    return a.height === b.height;\n  }\n  function equalDimensions (a, b) {\n    return equalHeight(a, b) && equalWidth(a, b);\n  }\n  function equal (a, b, tolerance) {\n\n    var\n      aData     = a.data,\n      bData     = b.data,\n      length    = aData.length,\n      i;\n\n    tolerance = tolerance || 0;\n\n    if (!equalDimensions(a, b)) return false;\n    for (i = length; i--;) if (aData[i] !== bData[i] && Math.abs(aData[i] - bData[i]) > tolerance) return false;\n\n    return true;\n  }\n\n\n  // Diff\n  function diff (a, b, options) {\n    return (equalDimensions(a, b) ? diffEqual : diffUnequal)(a, b, options);\n  }\n  function diffEqual (a, b, options) {\n\n    var\n      height  = a.height,\n      width   = a.width,\n      c       = getImageData(width, height), // c = a - b\n      aData   = a.data,\n      bData   = b.data,\n      cData   = c.data,\n      length  = cData.length,\n      row, column,\n      i, j, k, v;\n\n    for (i = 0; i < length; i += 4) {\n      cData[i] = Math.abs(aData[i] - bData[i]);\n      cData[i+1] = Math.abs(aData[i+1] - bData[i+1]);\n      cData[i+2] = Math.abs(aData[i+2] - bData[i+2]);\n      cData[i+3] = Math.abs(255 - Math.abs(aData[i+3] - bData[i+3]));\n    }\n\n    return c;\n  }\n  function diffUnequal (a, b, options) {\n\n    var\n      height  = Math.max(a.height, b.height),\n      width   = Math.max(a.width, b.width),\n      c       = getImageData(width, height), // c = a - b\n      aData   = a.data,\n      bData   = b.data,\n      cData   = c.data,\n      align   = options && options.align,\n      rowOffset,\n      columnOffset,\n      row, column,\n      i, j, k, v;\n\n\n    for (i = cData.length - 1; i > 0; i = i - 4) {\n      cData[i] = 255;\n    }\n\n    // Add First Image\n    offsets(a);\n    for (row = a.height; row--;){\n      for (column = a.width; column--;) {\n        i = 4 * ((row + rowOffset) * width + (column + columnOffset));\n        j = 4 * (row * a.width + column);\n        cData[i+0] = aData[j+0]; // r\n        cData[i+1] = aData[j+1]; // g\n        cData[i+2] = aData[j+2]; // b\n        // cData[i+3] = aData[j+3]; // a\n      }\n    }\n\n    // Subtract Second Image\n    offsets(b);\n    for (row = b.height; row--;){\n      for (column = b.width; column--;) {\n        i = 4 * ((row + rowOffset) * width + (column + columnOffset));\n        j = 4 * (row * b.width + column);\n        cData[i+0] = Math.abs(cData[i+0] - bData[j+0]); // r\n        cData[i+1] = Math.abs(cData[i+1] - bData[j+1]); // g\n        cData[i+2] = Math.abs(cData[i+2] - bData[j+2]); // b\n      }\n    }\n\n    // Helpers\n    function offsets (imageData) {\n      if (align === 'top') {\n        rowOffset = 0;\n        columnOffset = 0;\n      } else {\n        rowOffset = Math.floor((height - imageData.height) / 2);\n        columnOffset = Math.floor((width - imageData.width) / 2);\n      }\n    }\n\n    return c;\n  }\n\n\n  // Validation\n  function checkType () {\n    var i;\n    for (i = 0; i < arguments.length; i++) {\n      if (!isImageType(arguments[i])) {\n        throw {\n          name : 'ImageTypeError',\n          message : 'Submitted object was not an image.'\n        };\n      }\n    }\n  }\n\n\n  // Jasmine Matchers\n  function get (element, content) {\n    element = document.createElement(element);\n    if (element && content) {\n      element.innerHTML = content;\n    }\n    return element;\n  }\n\n  jasmine = {\n\n    toBeImageData : function () {\n      return imagediff.isImageData(this.actual);\n    },\n\n    toImageDiffEqual : function (expected, tolerance) {\n\n      if (typeof (document) !== UNDEFINED) {\n        this.message = function () {\n          var\n            div     = get('div'),\n            a       = get('div', '<div>Actual:</div>'),\n            b       = get('div', '<div>Expected:</div>'),\n            c       = get('div', '<div>Diff:</div>'),\n            diff    = imagediff.diff(this.actual, expected),\n            canvas  = getCanvas(),\n            context;\n\n          canvas.height = diff.height;\n          canvas.width  = diff.width;\n\n          div.style.overflow = 'hidden';\n          a.style.float = 'left';\n          b.style.float = 'left';\n          c.style.float = 'left';\n\n          context = canvas.getContext('2d');\n          context.putImageData(diff, 0, 0);\n\n          a.appendChild(toCanvas(this.actual));\n          b.appendChild(toCanvas(expected));\n          c.appendChild(canvas);\n\n          div.appendChild(a);\n          div.appendChild(b);\n          div.appendChild(c);\n\n          return [\n            div,\n            \"Expected not to be equal.\"\n          ];\n        };\n      }\n\n      return imagediff.equal(this.actual, expected, tolerance);\n    }\n  };\n\n\n  // Image Output\n  function imageDataToPNG (imageData, outputFile, callback) {\n\n    var\n      canvas = toCanvas(imageData),\n      base64Data,\n      decodedImage;\n\n    callback = callback || Function;\n\n    base64Data = canvas.toDataURL().replace(/^data:image\\/\\w+;base64,/,\"\");\n    decodedImage = new Buffer(base64Data, 'base64');\n    require('fs').writeFile(outputFile, decodedImage, callback);\n  }\n\n\n  // Definition\n  imagediff = {\n\n    createCanvas : getCanvas,\n    createImageData : getImageData,\n    getCanvasRef: getCanvasRef,\n\n    isImage : isImage,\n    isCanvas : isCanvas,\n    isContext : isContext,\n    isImageData : isImageData,\n    isImageType : isImageType,\n\n    toImageData : function (object) {\n      checkType(object);\n      if (isImageData(object)) { return copyImageData(object); }\n      return toImageData(object);\n    },\n\n    equal : function (a, b, tolerance) {\n      checkType(a, b);\n      a = toImageData(a);\n      b = toImageData(b);\n      return equal(a, b, tolerance);\n    },\n    diff : function (a, b, options) {\n      checkType(a, b);\n      a = toImageData(a);\n      b = toImageData(b);\n      return diff(a, b, options);\n    },\n\n    jasmine : jasmine,\n\n    // Compatibility\n    noConflict : function () {\n      root[name] = previous;\n      return imagediff;\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    imagediff.imageDataToPNG = imageDataToPNG;\n  }\n\n  return imagediff;\n});\n","/*! rasterizeHTML.js - v1.2.4 - 2016-10-30\n* http://www.github.com/cburgmer/rasterizeHTML.js\n* Copyright (c) 2016 Christoph Burgmer; Licensed MIT */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module unless amdModuleId is set\n    define([\"url\",\"css-mediaquery\",\"xmlserializer\",\"sane-domparser-error\",\"ayepromise\",\"inlineresources\"], function (a0,b1,c2,d3,e4,f5) {\n      return (root['rasterizeHTML'] = factory(a0,b1,c2,d3,e4,f5));\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like environments that support module.exports,\n    // like Node.\n    module.exports = factory(require(\"url\"),require(\"css-mediaquery\"),require(\"xmlserializer\"),require(\"sane-domparser-error\"),require(\"ayepromise\"),require(\"inlineresources\"));\n  } else {\n    root['rasterizeHTML'] = factory(root[\"url\"],root[\"cssMediaQuery\"],root[\"xmlserializer\"],root[\"sanedomparsererror\"],root[\"ayepromise\"],root[\"inlineresources\"]);\n  }\n}(this, function (url, cssMediaQuery, xmlserializer, sanedomparsererror, ayepromise, inlineresources) {\n\nvar util = (function (url) {\n    \"use strict\";\n\n    var module = {};\n\n    var uniqueIdList = [];\n\n    module.joinUrl = function (baseUrl, relUrl) {\n        if (!baseUrl) {\n            return relUrl;\n        }\n        return url.resolve(baseUrl, relUrl);\n    };\n\n    module.getConstantUniqueIdFor = function (element) {\n        // HACK, using a list results in O(n), but how do we hash e.g. a DOM node?\n        if (uniqueIdList.indexOf(element) < 0) {\n            uniqueIdList.push(element);\n        }\n        return uniqueIdList.indexOf(element);\n    };\n\n    module.clone = function (object) {\n        var theClone = {},\n            i;\n        for (i in object) {\n            if (object.hasOwnProperty(i)) {\n                theClone[i] = object[i];\n            }\n        }\n        return theClone;\n    };\n\n    var isObject = function (obj) {\n        return typeof obj === \"object\" && obj !== null;\n    };\n\n    var isCanvas = function (obj) {\n        return isObject(obj) &&\n            Object.prototype.toString.apply(obj).match(/\\[object (Canvas|HTMLCanvasElement)\\]/i);\n    };\n\n    // args: canvas, options\n    module.parseOptionalParameters = function (args) {\n        var parameters = {\n            canvas: null,\n            options: {}\n        };\n\n        if (args[0] == null || isCanvas(args[0])) {\n            parameters.canvas = args[0] || null;\n\n            parameters.options = module.clone(args[1]);\n        } else {\n            parameters.options = module.clone(args[0]);\n        }\n\n        return parameters;\n    };\n\n    return module;\n}(url));\n\n// Proxy objects by monkey patching\nvar proxies = (function (util, ayepromise) {\n    \"use strict\";\n\n    var module = {};\n\n    var monkeyPatchInstanceMethod = function (object, methodName, proxyFunc) {\n        var originalFunc = object[methodName];\n\n        object[methodName] = function () {\n            var args = Array.prototype.slice.call(arguments);\n\n            return proxyFunc.apply(this, [args, originalFunc]);\n        };\n\n        return originalFunc;\n    };\n\n    // Bases all XHR calls on the given base URL\n    module.baseUrlRespectingXhr = function (XHRObject, baseUrl) {\n        var xhrConstructor = function () {\n            var xhr = new XHRObject();\n\n            monkeyPatchInstanceMethod(xhr, 'open', function (args, originalOpen) {\n                var method = args.shift(),\n                    url = args.shift(),\n                    joinedUrl = util.joinUrl(baseUrl, url);\n\n                return originalOpen.apply(this, [method, joinedUrl].concat(args));\n            });\n\n            return xhr;\n        };\n\n        return xhrConstructor;\n    };\n\n    // Provides a convenient way of being notified when all pending XHR calls are finished\n    module.finishNotifyingXhr = function (XHRObject) {\n        var totalXhrCount = 0,\n            doneXhrCount = 0,\n            waitingForPendingToClose = false,\n            defer = ayepromise.defer();\n\n        var checkAllRequestsFinished = function () {\n            var pendingXhrCount = totalXhrCount - doneXhrCount;\n\n            if (pendingXhrCount <= 0 && waitingForPendingToClose) {\n                defer.resolve({totalCount: totalXhrCount});\n            }\n        };\n\n        var xhrConstructor = function () {\n            var xhr = new XHRObject();\n\n            monkeyPatchInstanceMethod(xhr, 'send', function (_, originalSend) {\n                totalXhrCount += 1;\n                return originalSend.apply(this, arguments);\n            });\n\n            xhr.addEventListener('load', function () {\n                doneXhrCount += 1;\n\n                checkAllRequestsFinished();\n            });\n\n            return xhr;\n        };\n\n        xhrConstructor.waitForRequestsToFinish = function () {\n            waitingForPendingToClose = true;\n            checkAllRequestsFinished();\n            return defer.promise;\n        };\n\n        return xhrConstructor;\n    };\n\n    return module;\n}(util, ayepromise));\n\nvar documentUtil = (function () {\n    \"use strict\";\n\n    var module = {};\n\n    var asArray = function (arrayLike) {\n        return Array.prototype.slice.call(arrayLike);\n    };\n\n    module.addClassName = function (element, className) {\n        element.className += ' ' + className;\n    };\n\n    module.addClassNameRecursively = function (element, className) {\n        module.addClassName(element, className);\n\n        if (element.parentNode !== element.ownerDocument) {\n            module.addClassNameRecursively(element.parentNode, className);\n        }\n    };\n\n    var changeCssRule = function (rule, newRuleText) {\n        var styleSheet = rule.parentStyleSheet,\n            ruleIdx = asArray(styleSheet.cssRules).indexOf(rule);\n\n        // Exchange rule with the new text\n        styleSheet.insertRule(newRuleText, ruleIdx+1);\n        styleSheet.deleteRule(ruleIdx);\n    };\n\n    var updateRuleSelector = function (rule, updatedSelector) {\n        var styleDefinitions = rule.cssText.replace(/^[^\\{]+/, ''),\n            newRule = updatedSelector + ' ' + styleDefinitions;\n\n        changeCssRule(rule, newRule);\n    };\n\n    var cssRulesToText = function (cssRules) {\n        return asArray(cssRules).reduce(function (cssText, rule) {\n            return cssText + rule.cssText;\n        }, '');\n    };\n\n    var rewriteStyleContent = function (styleElement) {\n        styleElement.textContent = cssRulesToText(styleElement.sheet.cssRules);\n    };\n\n    var addSheetPropertyToSvgStyleElement = function (svgStyleElement) {\n        var doc = document.implementation.createHTMLDocument(''),\n            cssStyleElement = document.createElement('style');\n\n        cssStyleElement.textContent = svgStyleElement.textContent;\n        // the style will only be parsed once it is added to a document\n        doc.body.appendChild(cssStyleElement);\n\n        svgStyleElement.sheet = cssStyleElement.sheet;\n    };\n\n    var matchingSimpleSelectorsRegex = function (simpleSelectorList) {\n        return '(' +\n            '(?:^|[^.#:\\\\w])' +            // start of string or not a simple selector character,\n            '|' +                          // ... or ...\n            '(?=\\\\W)' +                    // the next character parsed is not an alphabetic character (and thus a natural boundary)\n            ')' +\n            '(' +\n            simpleSelectorList.join('|') + // one out of the given simple selectors\n            ')' +\n            '(?=\\\\W|$)';                   // followed either by a non-alphabetic character or the end of the string\n    };\n\n    var replaceSimpleSelectorsBy = function (element, simpleSelectorList, caseInsensitiveReplaceFunc) {\n        var selectorRegex = matchingSimpleSelectorsRegex(simpleSelectorList);\n\n        asArray(element.querySelectorAll('style')).forEach(function (styleElement) {\n            // SVGStyleElement doesn't have a property sheet in Safari, we need some workaround here\n            // more details can be found here: https://github.com/cburgmer/rasterizeHTML.js/issues/158\n            if (typeof styleElement.sheet === 'undefined') {\n                addSheetPropertyToSvgStyleElement(styleElement);\n            }\n\n            var matchingRules = asArray(styleElement.sheet.cssRules).filter(function (rule) {\n                return rule.selectorText && new RegExp(selectorRegex, 'i').test(rule.selectorText);\n            });\n\n            if (matchingRules.length) {\n                matchingRules.forEach(function (rule) {\n                    var newSelector = rule.selectorText.replace(new RegExp(selectorRegex, 'gi'),\n                                                             function (_, prefixMatch, selectorMatch) {\n                        return prefixMatch + caseInsensitiveReplaceFunc(selectorMatch);\n                    });\n\n                    if (newSelector !== rule.selectorText) {\n                        updateRuleSelector(rule, newSelector);\n                    }\n                });\n\n                rewriteStyleContent(styleElement);\n            }\n        });\n    };\n\n    module.rewriteCssSelectorWith = function (element, oldSelector, newSelector) {\n        replaceSimpleSelectorsBy(element, [oldSelector], function () {\n            return newSelector;\n        });\n    };\n\n    module.lowercaseCssTypeSelectors = function (element, matchingTagNames) {\n        replaceSimpleSelectorsBy(element, matchingTagNames, function (match) {\n            return match.toLowerCase();\n        });\n    };\n\n    module.findHtmlOnlyNodeNames = function (element) {\n        var treeWalker = element.ownerDocument.createTreeWalker(element, NodeFilter.SHOW_ELEMENT),\n            htmlNodeNames = {},\n            nonHtmlNodeNames = {},\n            currentTagName;\n\n        do {\n            currentTagName = treeWalker.currentNode.tagName.toLowerCase();\n            if (treeWalker.currentNode.namespaceURI === 'http://www.w3.org/1999/xhtml') {\n                htmlNodeNames[currentTagName] = true;\n            } else {\n                nonHtmlNodeNames[currentTagName] = true;\n            }\n        } while(treeWalker.nextNode());\n\n        return Object.keys(htmlNodeNames).filter(function (tagName) {\n            return !nonHtmlNodeNames[tagName];\n        });\n    };\n\n    return module;\n}());\n\nvar documentHelper = (function (documentUtil) {\n    \"use strict\";\n\n    var module = {};\n\n    var asArray = function (arrayLike) {\n        return Array.prototype.slice.call(arrayLike);\n    };\n\n    var cascadingAction = {\n        active: true,\n        hover: true,\n        focus: false,\n        target: false\n    };\n\n    module.fakeUserAction = function (element, selector, action) {\n        var elem = element.querySelector(selector),\n            pseudoClass = ':' + action,\n            fakeActionClass = 'rasterizehtml' + action;\n        if (! elem) {\n            return;\n        }\n\n        if (cascadingAction[action]) {\n            documentUtil.addClassNameRecursively(elem, fakeActionClass);\n        } else {\n            documentUtil.addClassName(elem, fakeActionClass);\n        }\n        documentUtil.rewriteCssSelectorWith(element, pseudoClass, '.' + fakeActionClass);\n    };\n\n    module.persistInputValues = function (doc) {\n        var inputs = doc.querySelectorAll('input'),\n            textareas = doc.querySelectorAll('textarea'),\n            isCheckable = function (input) {\n                return input.type === 'checkbox' || input.type === 'radio';\n            };\n\n        asArray(inputs).filter(isCheckable)\n            .forEach(function (input) {\n                if (input.checked) {\n                    input.setAttribute('checked', '');\n                } else {\n                    input.removeAttribute('checked');\n                }\n            });\n\n        asArray(inputs).filter(function (input) { return !isCheckable(input); })\n            .forEach(function (input) {\n                input.setAttribute('value', input.value);\n            });\n\n        asArray(textareas)\n            .forEach(function (textarea) {\n                textarea.textContent = textarea.value;\n            });\n    };\n\n    module.rewriteTagNameSelectorsToLowerCase = function (element) {\n        documentUtil.lowercaseCssTypeSelectors(element, documentUtil.findHtmlOnlyNodeNames(element));\n    };\n\n    return module;\n}(documentUtil));\n\nvar mediaQueryHelper = (function (cssMediaQuery) {\n    \"use strict\";\n\n    var module = {};\n\n    var svgImgBlueByEmMediaQuery = function () {\n        var svg = '<svg id=\"svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"10\" height=\"10\">' +\n                '<style>@media (max-width: 1em) { svg { background: #00f; } }</style>' +\n                '</svg>';\n\n        var url = \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(svg),\n            img = document.createElement('img');\n\n        img.src = url;\n\n        return img;\n    };\n\n    var firstPixelHasColor = function (img, r, g, b) {\n        var canvas = document.createElement(\"canvas\");\n        canvas.width = img.width;\n        canvas.height = img.height;\n\n        var context = canvas.getContext(\"2d\"),\n            data;\n\n        context.drawImage(img, 0, 0);\n        data = context.getImageData(0, 0, 1, 1).data;\n        return data[0] === r && data[1] === g && data[2] === b;\n    };\n\n    var hasEmMediaQueryIssue = function () {\n        var img = svgImgBlueByEmMediaQuery(),\n            defer = ayepromise.defer();\n\n        document.querySelector('body').appendChild(img);\n\n        img.onload = function () {\n            document.querySelector('body').removeChild(img);\n            try {\n                defer.resolve(!firstPixelHasColor(img, 0, 0, 255));\n            } catch (e) {\n                // Fails in PhantomJS, let's assume the issue exists\n                defer.resolve(true);\n            }\n        };\n        img.onerror = function () {\n            defer.reject();\n        };\n\n        return defer.promise;\n    };\n\n    var hasEmIssue;\n\n    module.needsEmWorkaround = function () {\n        if (hasEmIssue === undefined) {\n            hasEmIssue = hasEmMediaQueryIssue();\n        }\n        return hasEmIssue;\n    };\n\n    var asArray = function (arrayLike) {\n        return Array.prototype.slice.call(arrayLike);\n    };\n\n    var cssRulesToText = function (cssRules) {\n        return asArray(cssRules).map(function (rule) {\n            return rule.cssText;\n        }).join('\\n');\n    };\n\n    var mediaQueryRule = function (mediaQuery, cssRules) {\n        return '@media ' + mediaQuery + '{' +\n            cssRulesToText(cssRules) +\n            '}';\n    };\n\n    var exchangeRuleWithNewContent = function (styleSheet, ruleIdx, newRuleText) {\n        try {\n            styleSheet.insertRule(newRuleText, ruleIdx+1);\n        } catch (e) {\n            // In case the browser does not like our new rule we just keep the existing one and quietly leave\n            return;\n        }\n        styleSheet.deleteRule(ruleIdx);\n    };\n\n    var changeCssRule = function (rule, newRuleText) {\n        var styleSheet = rule.parentStyleSheet,\n            ruleIdx = asArray(styleSheet.cssRules).indexOf(rule);\n\n        exchangeRuleWithNewContent(styleSheet, ruleIdx, newRuleText);\n    };\n\n    var rewriteStyleContent = function (styleElement) {\n        styleElement.textContent = cssRulesToText(styleElement.sheet.cssRules);\n    };\n\n    var serializeExpression = function (exp) {\n        var feature = exp.modifier ? exp.modifier + '-' + exp.feature : exp.feature;\n        if (exp.value) {\n            return '(' + feature + ': ' + exp.value + ')';\n        } else {\n            return '(' + feature + ')';\n        }\n    };\n\n    var serializeQueryPart = function (q) {\n        var segments = [];\n\n        if (q.inverse) {\n            segments.push(\"not\");\n        }\n\n        segments.push(q.type);\n\n        if (q.expressions.length > 0) {\n            segments.push('and ' + q.expressions.map(serializeExpression).join(' and '));\n        }\n\n        return segments.join(' ');\n    };\n\n    // poor man's testability\n    module.serializeQuery = function (q) {\n        var queryParts = q.map(serializeQueryPart);\n        return queryParts.join(', ');\n    };\n\n    var transformEmIntoPx = function (em) {\n        return em * 16;\n    };\n\n    var replaceEmValueWithPx = function (value) {\n        // Match a number with em unit. Doesn't match all, but should be enough for now\n        var match = /^((?:\\d+\\.)?\\d+)em/.exec(value);\n        if (match) {\n            return transformEmIntoPx(parseFloat(match[1])) + 'px';\n        }\n        return value;\n    };\n\n    var substituteEmWithPx = function (mediaQuery) {\n        var parsedQuery = cssMediaQuery.parse(mediaQuery),\n            hasChanges = false;\n\n        parsedQuery.forEach(function (q) {\n            q.expressions.forEach(function (exp) {\n                var rewrittenValue = replaceEmValueWithPx(exp.value);\n\n                hasChanges |= rewrittenValue !== exp.value;\n                exp.value = rewrittenValue;\n            });\n        });\n\n        if (hasChanges) {\n            return module.serializeQuery(parsedQuery);\n        }\n    };\n\n    var replaceEmsWithPx = function (mediaQueryRules) {\n        var anyRuleHasChanges = false;\n\n        mediaQueryRules.forEach(function (rule) {\n            var rewrittenMediaQuery = substituteEmWithPx(rule.media.mediaText);\n\n            if (rewrittenMediaQuery) {\n                changeCssRule(rule, mediaQueryRule(rewrittenMediaQuery, rule.cssRules));\n            }\n\n            anyRuleHasChanges |= !!rewrittenMediaQuery;\n        });\n\n        return anyRuleHasChanges;\n    };\n\n    module.workAroundWebKitEmSizeIssue = function (element) {\n        var styles = element.querySelectorAll('style');\n\n        asArray(styles).forEach(function (style) {\n            var mediaQueryRules = asArray(style.sheet.cssRules).filter(function (rule) {\n                return rule.type === window.CSSRule.MEDIA_RULE;\n            });\n\n            var hasChanges = replaceEmsWithPx(mediaQueryRules);\n            if (hasChanges) {\n                rewriteStyleContent(style);\n            }\n        });\n    };\n\n    return module;\n}(cssMediaQuery));\n\nvar browser = (function (util, proxies, ayepromise, sanedomparsererror, theWindow) {\n    \"use strict\";\n\n    var module = {};\n\n    var createHiddenElement = function (doc, tagName, width, height) {\n        var element = doc.createElement(tagName);\n        // 'display: none' doesn't cut it, as browsers seem to be lazy loading CSS\n        element.style.visibility = \"hidden\";\n        element.style.width = width + \"px\";\n        element.style.height = height + \"px\";\n        element.style.position = \"absolute\";\n        element.style.top = (-10000 - height) + \"px\";\n        element.style.left = (-10000 - width) + \"px\";\n        // We need to add the element to the document so that its content gets loaded\n        doc.getElementsByTagName(\"body\")[0].appendChild(element);\n        return element;\n    };\n\n    module.executeJavascript = function (element, options) {\n        var iframe = createHiddenElement(theWindow.document, \"iframe\", options.width, options.height),\n            html = element.outerHTML,\n            iframeErrorsMessages = [],\n            defer = ayepromise.defer(),\n            timeout = options.executeJsTimeout || 0;\n\n        var doResolve = function () {\n            var doc = iframe.contentDocument;\n            theWindow.document.getElementsByTagName(\"body\")[0].removeChild(iframe);\n            defer.resolve({\n                document: doc,\n                errors: iframeErrorsMessages\n            });\n        };\n\n        var waitForJavaScriptToRun = function () {\n            var d = ayepromise.defer();\n            if (timeout > 0) {\n                setTimeout(d.resolve, timeout);\n            } else {\n                d.resolve();\n            }\n            return d.promise;\n        };\n\n        var xhr = iframe.contentWindow.XMLHttpRequest,\n            finishNotifyXhrProxy = proxies.finishNotifyingXhr(xhr),\n            baseUrlXhrProxy = proxies.baseUrlRespectingXhr(finishNotifyXhrProxy, options.baseUrl);\n\n        iframe.onload = function () {\n            waitForJavaScriptToRun()\n                .then(finishNotifyXhrProxy.waitForRequestsToFinish)\n                .then(doResolve);\n        };\n\n        iframe.contentDocument.open();\n        iframe.contentWindow.XMLHttpRequest = baseUrlXhrProxy;\n        iframe.contentWindow.onerror = function (msg) {\n            iframeErrorsMessages.push({\n                resourceType: \"scriptExecution\",\n                msg: msg\n            });\n        };\n\n        iframe.contentDocument.write('<!DOCTYPE html>');\n        iframe.contentDocument.write(html);\n        iframe.contentDocument.close();\n\n        return defer.promise;\n    };\n\n    var createHiddenSandboxedIFrame = function (doc, width, height) {\n        var iframe = doc.createElement('iframe');\n        iframe.style.width = width + \"px\";\n        iframe.style.height = height + \"px\";\n        // 'display: none' doesn't cut it, as browsers seem to be lazy loading content\n        iframe.style.visibility = \"hidden\";\n        iframe.style.position = \"absolute\";\n        iframe.style.top = (-10000 - height) + \"px\";\n        iframe.style.left = (-10000 - width) + \"px\";\n        // Don't execute JS, all we need from sandboxing is access to the iframe's document\n        iframe.sandbox = 'allow-same-origin';\n        // Don't include a scrollbar on Linux\n        iframe.scrolling = 'no';\n        return iframe;\n    };\n\n    var createIframeWithSizeAtZoomLevel1 = function (width, height, zoom) {\n        var scaledViewportWidth = Math.floor(width / zoom),\n            scaledViewportHeight = Math.floor(height / zoom);\n\n        return createHiddenSandboxedIFrame(theWindow.document, scaledViewportWidth, scaledViewportHeight);\n    };\n\n    var calculateZoomedContentSizeAndRoundUp = function (actualViewport, requestedWidth, requestedHeight, zoom) {\n        return {\n            width: Math.max(actualViewport.width * zoom, requestedWidth),\n            height: Math.max(actualViewport.height * zoom, requestedHeight)\n        };\n    };\n\n    var selectElementOrDescendant = function (element, selector) {\n        var descendant = element.querySelector(selector);\n        if (descendant) {\n            return descendant;\n        } else if (element.ownerDocument.querySelector(selector) === element) {\n            return element;\n        }\n\n        throw {\n            message: \"Clipping selector not found\"\n        };\n    };\n\n    var calculateContentSize = function (rootElement, selector, requestedWidth, requestedHeight, zoom) {\n        // clientWidth/clientHeight needed for PhantomJS\n        var actualViewportWidth = Math.max(rootElement.scrollWidth, rootElement.clientWidth),\n            actualViewportHeight = Math.max(rootElement.scrollHeight, rootElement.clientHeight),\n            top, left, originalWidth, originalHeight, rootFontSize,\n            element, rect, contentSize;\n\n        if (selector) {\n            element = selectElementOrDescendant(rootElement, selector);\n\n            rect = element.getBoundingClientRect();\n\n            top = rect.top;\n            left = rect.left;\n            originalWidth = rect.width;\n            originalHeight = rect.height;\n        } else {\n            top = 0;\n            left = 0;\n            originalWidth = actualViewportWidth;\n            originalHeight = actualViewportHeight;\n        }\n\n        contentSize = calculateZoomedContentSizeAndRoundUp({\n                width: originalWidth,\n                height: originalHeight\n            },\n            requestedWidth,\n            requestedHeight,\n            zoom);\n\n        rootFontSize = theWindow.getComputedStyle(rootElement.ownerDocument.documentElement).fontSize;\n\n        return {\n            left: left,\n            top: top,\n            width: contentSize.width,\n            height: contentSize.height,\n            viewportWidth: actualViewportWidth,\n            viewportHeight: actualViewportHeight,\n\n            rootFontSize: rootFontSize\n        };\n    };\n\n    var findCorrelatingElement = function (element, documentClone) {\n        var tagName = element.tagName;\n        // Stupid but simple method: find first match. Should work for a single HTML element, and any other element given as root\n        return documentClone.querySelector(tagName);\n    };\n\n    var elementToFullHtmlDocument = function (element) {\n        var tagName = element.tagName.toLowerCase();\n        if (tagName === 'html' || tagName === 'body') {\n            return element.outerHTML;\n        }\n\n        // Simple hack: hide the body from sizing, otherwise browser would apply a 8px margin\n        return '<body style=\"margin: 0;\">' + element.outerHTML + '</body>';\n    };\n\n    module.calculateDocumentContentSize = function (element, options) {\n        var defer = ayepromise.defer(),\n            zoom = options.zoom || 1,\n            iframe;\n\n\n        iframe = createIframeWithSizeAtZoomLevel1(options.width, options.height, zoom);\n        // We need to add the element to the document so that its content gets loaded\n        theWindow.document.getElementsByTagName(\"body\")[0].appendChild(iframe);\n\n        iframe.onload = function () {\n            var doc = iframe.contentDocument,\n                size;\n\n            try {\n                size = calculateContentSize(findCorrelatingElement(element, doc), options.clip, options.width, options.height, zoom);\n\n                defer.resolve(size);\n            } catch (e) {\n                defer.reject(e);\n            } finally {\n                theWindow.document.getElementsByTagName(\"body\")[0].removeChild(iframe);\n            }\n        };\n\n        // srcdoc doesn't work in PhantomJS yet\n        iframe.contentDocument.open();\n        iframe.contentDocument.write('<!DOCTYPE html>');\n        iframe.contentDocument.write(elementToFullHtmlDocument(element));\n        iframe.contentDocument.close();\n\n        return defer.promise;\n    };\n\n    module.parseHtmlFragment = function (htmlFragment) {\n        var doc = theWindow.document.implementation.createHTMLDocument('');\n        doc.documentElement.innerHTML = htmlFragment;\n\n        var element = doc.querySelector('body').firstChild;\n\n        if (!element) {\n            throw \"Invalid source\";\n        }\n\n        return element;\n    };\n\n    var addHTMLTagAttributes = function (doc, html) {\n        var attributeMatch = /<html((?:\\s+[^>]*)?)>/im.exec(html),\n            helperDoc = theWindow.document.implementation.createHTMLDocument(''),\n            htmlTagSubstitute,\n            i, elementSubstitute, attribute;\n\n        if (!attributeMatch) {\n            return;\n        }\n\n        htmlTagSubstitute = '<div' + attributeMatch[1] + '></div>';\n        helperDoc.documentElement.innerHTML = htmlTagSubstitute;\n        elementSubstitute = helperDoc.querySelector('div');\n\n        for (i = 0; i < elementSubstitute.attributes.length; i++) {\n            attribute = elementSubstitute.attributes[i];\n            doc.documentElement.setAttribute(attribute.name, attribute.value);\n        }\n    };\n\n    module.parseHTML = function (html) {\n        // We should be using the DOMParser, but it is not supported in older browsers\n        var doc = theWindow.document.implementation.createHTMLDocument('');\n        doc.documentElement.innerHTML = html;\n\n        addHTMLTagAttributes(doc, html);\n        return doc;\n    };\n\n    var failOnInvalidSource = function (doc) {\n        try {\n            return sanedomparsererror.failOnParseError(doc);\n        } catch (e) {\n            throw {\n                message: \"Invalid source\",\n                originalError: e\n            };\n        }\n    };\n\n    module.validateXHTML = function (xhtml) {\n        var p = new DOMParser(),\n            doc = p.parseFromString(xhtml, \"application/xml\");\n\n        failOnInvalidSource(doc);\n    };\n\n    var lastCacheDate = null;\n\n    var getUncachableURL = function (url, cache) {\n        if (cache === 'none' || cache === 'repeated') {\n            if (lastCacheDate === null || cache !== 'repeated') {\n                lastCacheDate = Date.now();\n            }\n            return url + \"?_=\" + lastCacheDate;\n        } else {\n            return url;\n        }\n    };\n\n    var doDocumentLoad = function (url, options) {\n        var xhr = new window.XMLHttpRequest(),\n            joinedUrl = util.joinUrl(options.baseUrl, url),\n            augmentedUrl = getUncachableURL(joinedUrl, options.cache),\n            defer = ayepromise.defer(),\n            doReject = function (e) {\n                defer.reject({\n                    message: \"Unable to load page\",\n                    originalError: e\n                });\n            };\n\n        xhr.addEventListener(\"load\", function () {\n            if (xhr.status === 200 || xhr.status === 0) {\n                defer.resolve(xhr.responseXML);\n            } else {\n                doReject(xhr.statusText);\n            }\n        }, false);\n\n        xhr.addEventListener(\"error\", function (e) {\n            doReject(e);\n        }, false);\n\n        try {\n            xhr.open('GET', augmentedUrl, true);\n            xhr.responseType = \"document\";\n            xhr.send(null);\n        } catch (e) {\n            doReject(e);\n        }\n\n        return defer.promise;\n    };\n\n    module.loadDocument = function (url, options) {\n        return doDocumentLoad(url, options)\n            .then(function (doc) {\n                return failOnInvalidSource(doc);\n            });\n    };\n\n    return module;\n}(util, proxies, ayepromise, sanedomparsererror, window));\n\nvar svg2image = (function (ayepromise, window) {\n    \"use strict\";\n\n    var module = {};\n\n    var urlForSvg = function (svg, useBlobs) {\n        if (useBlobs) {\n            return URL.createObjectURL(new Blob([svg], {\"type\": \"image/svg+xml\"}));\n        } else {\n            return \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(svg);\n        }\n    };\n\n    var cleanUpUrl = function (url) {\n        if (url instanceof Blob) {\n            URL.revokeObjectURL(url);\n        }\n    };\n\n    var simpleForeignObjectSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"1\" height=\"1\"><foreignObject></foreignObject></svg>';\n\n    var supportsReadingObjectFromCanvas = function (url) {\n        var canvas = document.createElement(\"canvas\"),\n            image = new Image(),\n            defer = ayepromise.defer();\n\n        image.onload = function () {\n            var context = canvas.getContext(\"2d\");\n            try {\n                context.drawImage(image, 0, 0);\n                // This will fail in Chrome & Safari\n                canvas.toDataURL(\"image/png\");\n                defer.resolve(true);\n            } catch (e) {\n                defer.resolve(false);\n            }\n        };\n        image.onerror = defer.reject;\n        image.src = url;\n\n        return defer.promise;\n    };\n\n    var readingBackFromCanvasBenefitsFromOldSchoolDataUris = function () {\n        // Check for work around for https://code.google.com/p/chromium/issues/detail?id=294129\n        var blobUrl = urlForSvg(simpleForeignObjectSvg, true);\n        return supportsReadingObjectFromCanvas(blobUrl)\n            .then(function (supportsReadingFromBlobs) {\n                cleanUpUrl(blobUrl);\n                if (supportsReadingFromBlobs) {\n                    return false;\n                }\n                return supportsReadingObjectFromCanvas(urlForSvg(simpleForeignObjectSvg, false))\n                    .then(function (s) {\n                        return s;\n                    });\n            }, function () {\n                return false;\n            });\n    };\n\n    var supportsBlobBuilding = function () {\n        if (window.Blob) {\n            // Available as constructor only in newer builds for all browsers\n            try {\n                new Blob(['<b></b>'], { \"type\" : \"text/xml\" });\n                return true;\n            } catch (err) {}\n        }\n        return false;\n    };\n\n    var checkBlobSupport = function () {\n        var defer = ayepromise.defer();\n\n        if (supportsBlobBuilding && window.URL) {\n            readingBackFromCanvasBenefitsFromOldSchoolDataUris()\n                .then(function (doesBenefit) {\n                    defer.resolve(! doesBenefit);\n                }, function () {\n                    defer.reject();\n                });\n        } else {\n            defer.resolve(false);\n        }\n\n        return defer.promise;\n    };\n\n    var checkForBlobsResult;\n\n    var checkForBlobs = function () {\n        if (checkForBlobsResult === undefined) {\n            checkForBlobsResult = checkBlobSupport();\n        }\n\n        return checkForBlobsResult;\n    };\n\n    var buildImageUrl = function (svg) {\n        return checkForBlobs().then(function (useBlobs) {\n            return urlForSvg(svg, useBlobs);\n        });\n    };\n\n    module.renderSvg = function (svg) {\n        var url, image,\n            defer = ayepromise.defer(),\n            resetEventHandlers = function () {\n                image.onload = null;\n                image.onerror = null;\n            },\n            cleanUp = function () {\n                if (url) {\n                    cleanUpUrl(url);\n                }\n            };\n\n        image = new Image();\n        image.onload = function() {\n            resetEventHandlers();\n            cleanUp();\n\n            defer.resolve(image);\n        };\n        image.onerror = function () {\n            cleanUp();\n\n            // Webkit calls the onerror handler if the SVG is faulty\n            defer.reject();\n        };\n\n        buildImageUrl(svg).then(function (imageUrl) {\n            url = imageUrl;\n            image.src = url;\n        }, defer.reject);\n\n        return defer.promise;\n    };\n\n    return module;\n}(ayepromise, window));\n\nvar document2svg = (function (util, browser, documentHelper, mediaQueryHelper, xmlserializer) {\n    \"use strict\";\n\n    var module = {};\n\n    var svgAttributes = function (size, zoom) {\n        var zoomFactor = zoom || 1;\n\n        var attributes = {\n            width: size.width,\n            height: size.height,\n            'font-size': size.rootFontSize\n        };\n\n        if (zoomFactor !== 1) {\n            attributes.style = 'transform:scale(' + zoomFactor + '); transform-origin: 0 0;';\n        }\n\n        return attributes;\n    };\n\n    var foreignObjectAttributes = function (size) {\n        var closestScaledWith, closestScaledHeight,\n            offsetX, offsetY;\n\n        closestScaledWith = Math.round(size.viewportWidth);\n        closestScaledHeight = Math.round(size.viewportHeight);\n\n        offsetX = -size.left;\n        offsetY = -size.top;\n\n        var attributes = {\n             'x': offsetX,\n             'y': offsetY,\n             'width': closestScaledWith,\n             'height': closestScaledHeight\n        };\n\n        return attributes;\n    };\n\n    var workAroundCollapsingMarginsAcrossSVGElementInWebKitLike = function (attributes) {\n        var style = attributes.style || '';\n        attributes.style = style + 'float: left;';\n    };\n\n    var workAroundSafariSometimesNotShowingExternalResources = function (attributes) {\n        /* Let's hope that works some magic. The spec says SVGLoad only fires\n         * now when all externals are available.\n         * http://www.w3.org/TR/SVG/struct.html#ExternalResourcesRequired */\n        attributes.externalResourcesRequired = true;\n    };\n\n    var workAroundChromeShowingScrollbarsUnderLinuxIfHtmlIsOverflowScroll = function () {\n        return '<style scoped=\"\">html::-webkit-scrollbar { display: none; }</style>';\n    };\n\n    var serializeAttributes = function (attributes) {\n        var keys = Object.keys(attributes);\n        if (!keys.length) {\n            return '';\n        }\n\n        return ' ' + keys.map(function (key) {\n            return key + '=\"' + attributes[key] + '\"';\n        }).join(' ');\n    };\n\n    var convertElementToSvg = function (element, size, zoomFactor) {\n        var xhtml = xmlserializer.serializeToString(element);\n\n        browser.validateXHTML(xhtml);\n\n        var foreignObjectAttrs = foreignObjectAttributes(size);\n        workAroundCollapsingMarginsAcrossSVGElementInWebKitLike(foreignObjectAttrs);\n        workAroundSafariSometimesNotShowingExternalResources(foreignObjectAttrs);\n\n        return (\n            '<svg xmlns=\"http://www.w3.org/2000/svg\"' +\n                serializeAttributes(svgAttributes(size, zoomFactor)) +\n                '>' +\n                workAroundChromeShowingScrollbarsUnderLinuxIfHtmlIsOverflowScroll() +\n                '<foreignObject' + serializeAttributes(foreignObjectAttrs) + '>' +\n                xhtml +\n                '</foreignObject>' +\n                '</svg>'\n        );\n    };\n\n    module.getSvgForDocument = function (element, size, zoomFactor) {\n        documentHelper.rewriteTagNameSelectorsToLowerCase(element);\n\n        return mediaQueryHelper.needsEmWorkaround().then(function (needsWorkaround) {\n            if (needsWorkaround) {\n                mediaQueryHelper.workAroundWebKitEmSizeIssue(element);\n            }\n\n            return convertElementToSvg(element, size, zoomFactor);\n        });\n    };\n\n    module.drawDocumentAsSvg = function (element, options) {\n        ['hover', 'active', 'focus', 'target'].forEach(function (action) {\n            if (options[action]) {\n                documentHelper.fakeUserAction(element, options[action], action);\n            }\n        });\n\n        return browser.calculateDocumentContentSize(element, options)\n            .then(function (size) {\n                return module.getSvgForDocument(element, size, options.zoom);\n            });\n    };\n\n    return module;\n}(util, browser, documentHelper, mediaQueryHelper, xmlserializer));\n\nvar rasterize = (function (util, browser, documentHelper, document2svg, svg2image, inlineresources) {\n    \"use strict\";\n\n    var module = {};\n\n    var generalDrawError = function (e) {\n        return {\n            message: \"Error rendering page\",\n            originalError: e\n        };\n    };\n\n    var drawSvgAsImg = function (svg) {\n        return svg2image.renderSvg(svg)\n            .then(function (image) {\n                return {\n                    image: image,\n                    svg: svg\n                };\n            }, function (e) {\n                throw generalDrawError(e);\n            });\n    };\n\n    var drawImageOnCanvas = function (image, canvas) {\n        try {\n            canvas.getContext(\"2d\").drawImage(image, 0, 0);\n        } catch (e) {\n            // Firefox throws a 'NS_ERROR_NOT_AVAILABLE' if the SVG is faulty\n            throw generalDrawError(e);\n        }\n    };\n\n    var doDraw = function (element, canvas, options) {\n        return document2svg.drawDocumentAsSvg(element, options)\n            .then(drawSvgAsImg)\n            .then(function (result) {\n                if (canvas) {\n                    drawImageOnCanvas(result.image, canvas);\n                }\n\n                return result;\n            });\n    };\n\n    var operateJavaScriptOnDocument = function (element, options) {\n        return browser.executeJavascript(element, options)\n            .then(function (result) {\n                var document = result.document;\n                documentHelper.persistInputValues(document);\n\n                return {\n                    document: document,\n                    errors: result.errors\n                };\n            });\n    };\n\n    module.rasterize = function (element, canvas, options) {\n        var inlineOptions;\n\n        inlineOptions = util.clone(options);\n        inlineOptions.inlineScripts = options.executeJs === true;\n\n        return inlineresources.inlineReferences(element, inlineOptions)\n            .then(function (errors) {\n                if (options.executeJs) {\n                    return operateJavaScriptOnDocument(element, options)\n                        .then(function (result) {\n                            return {\n                                element: result.document.documentElement,\n                                errors: errors.concat(result.errors)\n                            };\n                        });\n                } else {\n                    return {\n                        element: element,\n                        errors: errors\n                    };\n                }\n            }).then(function (result) {\n                return doDraw(result.element, canvas, options)\n                    .then(function (drawResult) {\n                        return {\n                            image: drawResult.image,\n                            svg: drawResult.svg,\n                            errors: result.errors\n                        };\n                    });\n            });\n    };\n\n    return module;\n}(util, browser, documentHelper, document2svg, svg2image, inlineresources));\n\nvar rasterizeHTML = (function (util, browser, rasterize) {\n    \"use strict\";\n\n    var module = {};\n\n    var getViewportSize = function (canvas, options) {\n        var defaultWidth = 300,\n            defaultHeight = 200,\n            fallbackWidth = canvas ? canvas.width : defaultWidth,\n            fallbackHeight = canvas ? canvas.height : defaultHeight,\n            width = options.width !== undefined ? options.width : fallbackWidth,\n            height = options.height !== undefined ? options.height : fallbackHeight;\n\n        return {\n            width: width,\n            height: height\n        };\n    };\n\n    var constructOptions = function (params) {\n        var viewport = getViewportSize(params.canvas, params.options),\n            options;\n\n        options = util.clone(params.options);\n        options.width = viewport.width;\n        options.height = viewport.height;\n\n        return options;\n    };\n\n    /**\n     * Draws a Document to the canvas.\n     * rasterizeHTML.drawDocument( document [, canvas] [, options] ).then(function (result) { ... });\n     */\n    module.drawDocument = function () {\n        var doc = arguments[0],\n            optionalArguments = Array.prototype.slice.call(arguments, 1),\n            params = util.parseOptionalParameters(optionalArguments);\n\n        var element = doc.documentElement ? doc.documentElement : doc;\n\n        return rasterize.rasterize(element, params.canvas, constructOptions(params));\n    };\n\n    var drawHTML = function (html, canvas, options) {\n        var doc = browser.parseHTML(html);\n\n        return module.drawDocument(doc, canvas, options);\n    };\n\n    /**\n     * Draws a HTML string to the canvas.\n     * rasterizeHTML.drawHTML( html [, canvas] [, options] ).then(function (result) { ... });\n     */\n    module.drawHTML = function () {\n        var html = arguments[0],\n            optionalArguments = Array.prototype.slice.call(arguments, 1),\n            params = util.parseOptionalParameters(optionalArguments);\n\n        return drawHTML(html, params.canvas, params.options);\n    };\n\n    // work around https://bugzilla.mozilla.org/show_bug.cgi?id=925493\n    var workAroundFirefoxNotLoadingStylesheetStyles = function (doc, url, options) {\n        var d = document.implementation.createHTMLDocument('');\n        d.replaceChild(doc.documentElement, d.documentElement);\n\n        var extendedOptions = options ? util.clone(options) : {};\n\n        if (!options.baseUrl) {\n            extendedOptions.baseUrl = url;\n        }\n\n        return {\n            document: d,\n            options: extendedOptions\n        };\n    };\n\n    var drawURL = function (url, canvas, options) {\n        return browser.loadDocument(url, options)\n            .then(function (doc) {\n                var workaround = workAroundFirefoxNotLoadingStylesheetStyles(doc, url, options);\n                return module.drawDocument(workaround.document, canvas, workaround.options);\n            });\n    };\n\n    /**\n     * Draws a page to the canvas.\n     * rasterizeHTML.drawURL( url [, canvas] [, options] ).then(function (result) { ... });\n     */\n    module.drawURL = function () {\n        var url = arguments[0],\n            optionalArguments = Array.prototype.slice.call(arguments, 1),\n            params = util.parseOptionalParameters(optionalArguments);\n\n        return drawURL(url, params.canvas, params.options);\n    };\n\n    return module;\n}(util, browser, rasterize));\n\nreturn rasterizeHTML;\n\n}));\n","/*\nCopyright (c) 2014, Yahoo! Inc. All rights reserved.\nCopyrights licensed under the New BSD License.\nSee the accompanying LICENSE file for terms.\n*/\n\n'use strict';\n\nexports.match = matchQuery;\nexports.parse = parseQuery;\n\n// -----------------------------------------------------------------------------\n\nvar RE_MEDIA_QUERY     = /(?:(only|not)?\\s*([^\\s\\(\\)]+)(?:\\s*and)?\\s*)?(.+)?/i,\n    RE_MQ_EXPRESSION   = /\\(\\s*([^\\s\\:\\)]+)\\s*(?:\\:\\s*([^\\s\\)]+))?\\s*\\)/,\n    RE_MQ_FEATURE      = /^(?:(min|max)-)?(.+)/,\n    RE_LENGTH_UNIT     = /(em|rem|px|cm|mm|in|pt|pc)?$/,\n    RE_RESOLUTION_UNIT = /(dpi|dpcm|dppx)?$/;\n\nfunction matchQuery(mediaQuery, values) {\n    return parseQuery(mediaQuery).some(function (query) {\n        var inverse = query.inverse;\n\n        // Either the parsed or specified `type` is \"all\", or the types must be\n        // equal for a match.\n        var typeMatch = query.type === 'all' || values.type === query.type;\n\n        // Quit early when `type` doesn't match, but take \"not\" into account.\n        if ((typeMatch && inverse) || !(typeMatch || inverse)) {\n            return false;\n        }\n\n        var expressionsMatch = query.expressions.every(function (expression) {\n            var feature  = expression.feature,\n                modifier = expression.modifier,\n                expValue = expression.value,\n                value    = values[feature];\n\n            // Missing or falsy values don't match.\n            if (!value) { return false; }\n\n            switch (feature) {\n                case 'orientation':\n                case 'scan':\n                    return value.toLowerCase() === expValue.toLowerCase();\n\n                case 'width':\n                case 'height':\n                case 'device-width':\n                case 'device-height':\n                    expValue = toPx(expValue);\n                    value    = toPx(value);\n                    break;\n\n                case 'resolution':\n                    expValue = toDpi(expValue);\n                    value    = toDpi(value);\n                    break;\n\n                case 'aspect-ratio':\n                case 'device-aspect-ratio':\n                case /* Deprecated */ 'device-pixel-ratio':\n                    expValue = toDecimal(expValue);\n                    value    = toDecimal(value);\n                    break;\n\n                case 'grid':\n                case 'color':\n                case 'color-index':\n                case 'monochrome':\n                    expValue = parseInt(expValue, 10) || 1;\n                    value    = parseInt(value, 10) || 0;\n                    break;\n            }\n\n            switch (modifier) {\n                case 'min': return value >= expValue;\n                case 'max': return value <= expValue;\n                default   : return value === expValue;\n            }\n        });\n\n        return (expressionsMatch && !inverse) || (!expressionsMatch && inverse);\n    });\n}\n\nfunction parseQuery(mediaQuery) {\n    return mediaQuery.split(',').map(function (query) {\n        query = query.trim();\n\n        var captures    = query.match(RE_MEDIA_QUERY),\n            modifier    = captures[1],\n            type        = captures[2],\n            expressions = captures[3] || '',\n            parsed      = {};\n\n        parsed.inverse = !!modifier && modifier.toLowerCase() === 'not';\n        parsed.type    = type ? type.toLowerCase() : 'all';\n\n        // Split expressions into a list.\n        expressions = expressions.match(/\\([^\\)]+\\)/g) || [];\n\n        parsed.expressions = expressions.map(function (expression) {\n            var captures = expression.match(RE_MQ_EXPRESSION),\n                feature  = captures[1].toLowerCase().match(RE_MQ_FEATURE);\n\n            return {\n                modifier: feature[1],\n                feature : feature[2],\n                value   : captures[2]\n            };\n        });\n\n        return parsed;\n    });\n}\n\n// -- Utilities ----------------------------------------------------------------\n\nfunction toDecimal(ratio) {\n    var decimal = Number(ratio),\n        numbers;\n\n    if (!decimal) {\n        numbers = ratio.match(/^(\\d+)\\s*\\/\\s*(\\d+)$/);\n        decimal = numbers[1] / numbers[2];\n    }\n\n    return decimal;\n}\n\nfunction toDpi(resolution) {\n    var value = parseFloat(resolution),\n        units = String(resolution).match(RE_RESOLUTION_UNIT)[1];\n\n    switch (units) {\n        case 'dpcm': return value / 2.54;\n        case 'dppx': return value * 96;\n        default    : return value;\n    }\n}\n\nfunction toPx(length) {\n    var value = parseFloat(length),\n        units = String(length).match(RE_LENGTH_UNIT)[1];\n\n    switch (units) {\n        case 'em' : return value * 16;\n        case 'rem': return value * 16;\n        case 'cm' : return value * 96 / 2.54;\n        case 'mm' : return value * 96 / 2.54 / 10;\n        case 'in' : return value * 96;\n        case 'pt' : return value * 72;\n        case 'pc' : return value * 72 / 12;\n        default   : return value;\n    }\n}\n","module.exports = (function() {\n  /*\n   * Generated by PEG.js 0.8.0.\n   *\n   * http://pegjs.majda.cz/\n   */\n\n  function peg$subclass(child, parent) {\n    function ctor() { this.constructor = child; }\n    ctor.prototype = parent.prototype;\n    child.prototype = new ctor();\n  }\n\n  function SyntaxError(message, expected, found, offset, line, column) {\n    this.message  = message;\n    this.expected = expected;\n    this.found    = found;\n    this.offset   = offset;\n    this.line     = line;\n    this.column   = column;\n\n    this.name     = \"SyntaxError\";\n  }\n\n  peg$subclass(SyntaxError, Error);\n\n  function parse(input) {\n    var options = arguments.length > 1 ? arguments[1] : {},\n\n        peg$FAILED = {},\n\n        peg$startRuleFunctions = { start: peg$parsestart },\n        peg$startRuleFunction  = peg$parsestart,\n\n        peg$c0 = [],\n        peg$c1 = function() { return []},\n        peg$c2 = peg$FAILED,\n        peg$c3 = \",\",\n        peg$c4 = { type: \"literal\", value: \",\", description: \"\\\",\\\"\" },\n        peg$c5 = function(x, xs) { return [x].concat(xs); },\n        peg$c6 = function(entry) { return [entry]; },\n        peg$c7 = function(url, format) { return {url: url, format: format}; },\n        peg$c8 = function(url) { return {url: url}; },\n        peg$c9 = \"url(\",\n        peg$c10 = { type: \"literal\", value: \"url(\", description: \"\\\"url(\\\"\" },\n        peg$c11 = \")\",\n        peg$c12 = { type: \"literal\", value: \")\", description: \"\\\")\\\"\" },\n        peg$c13 = function(value) { return value; },\n        peg$c14 = \"format(\",\n        peg$c15 = { type: \"literal\", value: \"format(\", description: \"\\\"format(\\\"\" },\n        peg$c16 = \"local(\",\n        peg$c17 = { type: \"literal\", value: \"local(\", description: \"\\\"local(\\\"\" },\n        peg$c18 = function(value) { return {local: value}; },\n        peg$c19 = /^[^)]/,\n        peg$c20 = { type: \"class\", value: \"[^)]\", description: \"[^)]\" },\n        peg$c21 = function(chars) { return util.extractValue(chars.join(\"\")); },\n        peg$c22 = /^[ \\t\\r\\n\\f]/,\n        peg$c23 = { type: \"class\", value: \"[ \\\\t\\\\r\\\\n\\\\f]\", description: \"[ \\\\t\\\\r\\\\n\\\\f]\" },\n\n        peg$currPos          = 0,\n        peg$reportedPos      = 0,\n        peg$cachedPos        = 0,\n        peg$cachedPosDetails = { line: 1, column: 1, seenCR: false },\n        peg$maxFailPos       = 0,\n        peg$maxFailExpected  = [],\n        peg$silentFails      = 0,\n\n        peg$result;\n\n    if (\"startRule\" in options) {\n      if (!(options.startRule in peg$startRuleFunctions)) {\n        throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + \"\\\".\");\n      }\n\n      peg$startRuleFunction = peg$startRuleFunctions[options.startRule];\n    }\n\n    function text() {\n      return input.substring(peg$reportedPos, peg$currPos);\n    }\n\n    function offset() {\n      return peg$reportedPos;\n    }\n\n    function line() {\n      return peg$computePosDetails(peg$reportedPos).line;\n    }\n\n    function column() {\n      return peg$computePosDetails(peg$reportedPos).column;\n    }\n\n    function expected(description) {\n      throw peg$buildException(\n        null,\n        [{ type: \"other\", description: description }],\n        peg$reportedPos\n      );\n    }\n\n    function error(message) {\n      throw peg$buildException(message, null, peg$reportedPos);\n    }\n\n    function peg$computePosDetails(pos) {\n      function advance(details, startPos, endPos) {\n        var p, ch;\n\n        for (p = startPos; p < endPos; p++) {\n          ch = input.charAt(p);\n          if (ch === \"\\n\") {\n            if (!details.seenCR) { details.line++; }\n            details.column = 1;\n            details.seenCR = false;\n          } else if (ch === \"\\r\" || ch === \"\\u2028\" || ch === \"\\u2029\") {\n            details.line++;\n            details.column = 1;\n            details.seenCR = true;\n          } else {\n            details.column++;\n            details.seenCR = false;\n          }\n        }\n      }\n\n      if (peg$cachedPos !== pos) {\n        if (peg$cachedPos > pos) {\n          peg$cachedPos = 0;\n          peg$cachedPosDetails = { line: 1, column: 1, seenCR: false };\n        }\n        advance(peg$cachedPosDetails, peg$cachedPos, pos);\n        peg$cachedPos = pos;\n      }\n\n      return peg$cachedPosDetails;\n    }\n\n    function peg$fail(expected) {\n      if (peg$currPos < peg$maxFailPos) { return; }\n\n      if (peg$currPos > peg$maxFailPos) {\n        peg$maxFailPos = peg$currPos;\n        peg$maxFailExpected = [];\n      }\n\n      peg$maxFailExpected.push(expected);\n    }\n\n    function peg$buildException(message, expected, pos) {\n      function cleanupExpected(expected) {\n        var i = 1;\n\n        expected.sort(function(a, b) {\n          if (a.description < b.description) {\n            return -1;\n          } else if (a.description > b.description) {\n            return 1;\n          } else {\n            return 0;\n          }\n        });\n\n        while (i < expected.length) {\n          if (expected[i - 1] === expected[i]) {\n            expected.splice(i, 1);\n          } else {\n            i++;\n          }\n        }\n      }\n\n      function buildMessage(expected, found) {\n        function stringEscape(s) {\n          function hex(ch) { return ch.charCodeAt(0).toString(16).toUpperCase(); }\n\n          return s\n            .replace(/\\\\/g,   '\\\\\\\\')\n            .replace(/\"/g,    '\\\\\"')\n            .replace(/\\x08/g, '\\\\b')\n            .replace(/\\t/g,   '\\\\t')\n            .replace(/\\n/g,   '\\\\n')\n            .replace(/\\f/g,   '\\\\f')\n            .replace(/\\r/g,   '\\\\r')\n            .replace(/[\\x00-\\x07\\x0B\\x0E\\x0F]/g, function(ch) { return '\\\\x0' + hex(ch); })\n            .replace(/[\\x10-\\x1F\\x80-\\xFF]/g,    function(ch) { return '\\\\x'  + hex(ch); })\n            .replace(/[\\u0180-\\u0FFF]/g,         function(ch) { return '\\\\u0' + hex(ch); })\n            .replace(/[\\u1080-\\uFFFF]/g,         function(ch) { return '\\\\u'  + hex(ch); });\n        }\n\n        var expectedDescs = new Array(expected.length),\n            expectedDesc, foundDesc, i;\n\n        for (i = 0; i < expected.length; i++) {\n          expectedDescs[i] = expected[i].description;\n        }\n\n        expectedDesc = expected.length > 1\n          ? expectedDescs.slice(0, -1).join(\", \")\n              + \" or \"\n              + expectedDescs[expected.length - 1]\n          : expectedDescs[0];\n\n        foundDesc = found ? \"\\\"\" + stringEscape(found) + \"\\\"\" : \"end of input\";\n\n        return \"Expected \" + expectedDesc + \" but \" + foundDesc + \" found.\";\n      }\n\n      var posDetails = peg$computePosDetails(pos),\n          found      = pos < input.length ? input.charAt(pos) : null;\n\n      if (expected !== null) {\n        cleanupExpected(expected);\n      }\n\n      return new SyntaxError(\n        message !== null ? message : buildMessage(expected, found),\n        expected,\n        found,\n        pos,\n        posDetails.line,\n        posDetails.column\n      );\n    }\n\n    function peg$parsestart() {\n      var s0, s1;\n\n      s0 = peg$parsesourceEntries();\n      if (s0 === peg$FAILED) {\n        s0 = peg$currPos;\n        s1 = [];\n        if (s1 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c1();\n        }\n        s0 = s1;\n      }\n\n      return s0;\n    }\n\n    function peg$parsesourceEntries() {\n      var s0, s1, s2, s3, s4, s5;\n\n      s0 = peg$currPos;\n      s1 = peg$parsesourceEntry();\n      if (s1 !== peg$FAILED) {\n        s2 = [];\n        s3 = peg$parsewhitespace();\n        while (s3 !== peg$FAILED) {\n          s2.push(s3);\n          s3 = peg$parsewhitespace();\n        }\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 44) {\n            s3 = peg$c3;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c4); }\n          }\n          if (s3 !== peg$FAILED) {\n            s4 = [];\n            s5 = peg$parsewhitespace();\n            while (s5 !== peg$FAILED) {\n              s4.push(s5);\n              s5 = peg$parsewhitespace();\n            }\n            if (s4 !== peg$FAILED) {\n              s5 = peg$parsesourceEntries();\n              if (s5 !== peg$FAILED) {\n                peg$reportedPos = s0;\n                s1 = peg$c5(s1, s5);\n                s0 = s1;\n              } else {\n                peg$currPos = s0;\n                s0 = peg$c2;\n              }\n            } else {\n              peg$currPos = s0;\n              s0 = peg$c2;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n      if (s0 === peg$FAILED) {\n        s0 = peg$currPos;\n        s1 = peg$parsesourceEntry();\n        if (s1 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c6(s1);\n        }\n        s0 = s1;\n      }\n\n      return s0;\n    }\n\n    function peg$parsesourceEntry() {\n      var s0;\n\n      s0 = peg$parseurlEntry();\n      if (s0 === peg$FAILED) {\n        s0 = peg$parselocalEntry();\n      }\n\n      return s0;\n    }\n\n    function peg$parseurlEntry() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      s1 = peg$parseurl();\n      if (s1 !== peg$FAILED) {\n        s2 = [];\n        s3 = peg$parsewhitespace();\n        if (s3 !== peg$FAILED) {\n          while (s3 !== peg$FAILED) {\n            s2.push(s3);\n            s3 = peg$parsewhitespace();\n          }\n        } else {\n          s2 = peg$c2;\n        }\n        if (s2 !== peg$FAILED) {\n          s3 = peg$parseformat();\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c7(s1, s3);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n      if (s0 === peg$FAILED) {\n        s0 = peg$currPos;\n        s1 = peg$parseurl();\n        if (s1 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c8(s1);\n        }\n        s0 = s1;\n      }\n\n      return s0;\n    }\n\n    function peg$parseurl() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 4) === peg$c9) {\n        s1 = peg$c9;\n        peg$currPos += 4;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c10); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parsevalue();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s3 = peg$c11;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c12); }\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c13(s2);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n\n      return s0;\n    }\n\n    function peg$parseformat() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 7) === peg$c14) {\n        s1 = peg$c14;\n        peg$currPos += 7;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c15); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parsevalue();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s3 = peg$c11;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c12); }\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c13(s2);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n\n      return s0;\n    }\n\n    function peg$parselocalEntry() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 6) === peg$c16) {\n        s1 = peg$c16;\n        peg$currPos += 6;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c17); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parsevalue();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s3 = peg$c11;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c12); }\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c18(s2);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n\n      return s0;\n    }\n\n    function peg$parsevalue() {\n      var s0, s1, s2;\n\n      s0 = peg$currPos;\n      s1 = [];\n      if (peg$c19.test(input.charAt(peg$currPos))) {\n        s2 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c20); }\n      }\n      if (s2 !== peg$FAILED) {\n        while (s2 !== peg$FAILED) {\n          s1.push(s2);\n          if (peg$c19.test(input.charAt(peg$currPos))) {\n            s2 = input.charAt(peg$currPos);\n            peg$currPos++;\n          } else {\n            s2 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c20); }\n          }\n        }\n      } else {\n        s1 = peg$c2;\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c21(s1);\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parsewhitespace() {\n      var s0;\n\n      if (peg$c22.test(input.charAt(peg$currPos))) {\n        s0 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s0 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c23); }\n      }\n\n      return s0;\n    }\n\n\n      var util = require('../util');\n\n\n    peg$result = peg$startRuleFunction();\n\n    if (peg$result !== peg$FAILED && peg$currPos === input.length) {\n      return peg$result;\n    } else {\n      if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n        peg$fail({ type: \"end\", description: \"end of input\" });\n      }\n\n      throw peg$buildException(null, peg$maxFailExpected, peg$maxFailPos);\n    }\n  }\n\n  return {\n    SyntaxError: SyntaxError,\n    parse:       parse\n  };\n})();\n","var grammar = require('./grammar');\n\n\nexports.SyntaxError = function (message, offset) {\n    this.message  = message;\n    this.offset   = offset;\n};\n\nexports.parse = function (fontFaceSourceValue) {\n    try {\n        return grammar.parse(fontFaceSourceValue);\n    } catch (e) {\n        throw new exports.SyntaxError(e.message, e.offset);\n    }\n};\n\nexports.serialize = function (parsedFontFaceSources) {\n    return parsedFontFaceSources.map(function (sourceItem) {\n        var itemValue;\n\n        if (sourceItem.url) {\n            itemValue = 'url(\"' + sourceItem.url + '\")';\n            if (sourceItem.format) {\n                itemValue += ' format(\"' + sourceItem.format + '\")';\n            }\n        } else {\n            itemValue = 'local(\"' + sourceItem.local + '\")';\n        }\n        return itemValue;\n    }).join(', ');\n};\n","var trimCSSWhitespace = function (value) {\n    var whitespaceRegex = /^[\\t\\r\\f\\n ]*(.+?)[\\t\\r\\f\\n ]*$/;\n\n    return value.replace(whitespaceRegex, \"$1\");\n};\n\nvar unquoteString = function (quotedUrl) {\n    var doubleQuoteRegex = /^\"(.*)\"$/,\n        singleQuoteRegex = /^'(.*)'$/;\n\n    if (doubleQuoteRegex.test(quotedUrl)) {\n        return quotedUrl.replace(doubleQuoteRegex, \"$1\");\n    } else {\n        if (singleQuoteRegex.test(quotedUrl)) {\n            return quotedUrl.replace(singleQuoteRegex, \"$1\");\n        } else {\n            return quotedUrl;\n        }\n    }\n};\n\nexports.extractValue = function (value) {\n    return unquoteString(trimCSSWhitespace(value));\n};\n","//.CommonJS\nvar CSSOM = {\n    CSSRule: require(\"./CSSRule\").CSSRule,\n    MatcherList: require(\"./MatcherList\").MatcherList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see https://developer.mozilla.org/en/CSS/@-moz-document\n */\nCSSOM.CSSDocumentRule = function CSSDocumentRule() {\n    CSSOM.CSSRule.call(this);\n    this.matcher = new CSSOM.MatcherList();\n    this.cssRules = [];\n};\n\nCSSOM.CSSDocumentRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSDocumentRule.prototype.constructor = CSSOM.CSSDocumentRule;\nCSSOM.CSSDocumentRule.prototype.type = 10;\n//FIXME\n//CSSOM.CSSDocumentRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSDocumentRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\nObject.defineProperty(CSSOM.CSSDocumentRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n        cssTexts.push(this.cssRules[i].cssText);\n    }\n    return \"@-moz-document \" + this.matcher.matcherText + \" {\" + cssTexts.join(\"\") + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSDocumentRule = CSSOM.CSSDocumentRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#css-font-face-rule\n */\nCSSOM.CSSFontFaceRule = function CSSFontFaceRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.style = new CSSOM.CSSStyleDeclaration();\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSFontFaceRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSFontFaceRule.prototype.constructor = CSSOM.CSSFontFaceRule;\nCSSOM.CSSFontFaceRule.prototype.type = 5;\n//FIXME\n//CSSOM.CSSFontFaceRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSFontFaceRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSFontFaceRule.cpp\nObject.defineProperty(CSSOM.CSSFontFaceRule.prototype, \"cssText\", {\n  get: function() {\n    return \"@font-face {\" + this.style.cssText + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSFontFaceRule = CSSOM.CSSFontFaceRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tCSSStyleSheet: require(\"./CSSStyleSheet\").CSSStyleSheet,\n\tMediaList: require(\"./MediaList\").MediaList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssimportrule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSImportRule\n */\nCSSOM.CSSImportRule = function CSSImportRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.href = \"\";\n\tthis.media = new CSSOM.MediaList();\n\tthis.styleSheet = new CSSOM.CSSStyleSheet();\n};\n\nCSSOM.CSSImportRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSImportRule.prototype.constructor = CSSOM.CSSImportRule;\nCSSOM.CSSImportRule.prototype.type = 3;\n\nObject.defineProperty(CSSOM.CSSImportRule.prototype, \"cssText\", {\n  get: function() {\n    var mediaText = this.media.mediaText;\n    return \"@import url(\" + this.href + \")\" + (mediaText ? \" \" + mediaText : \"\") + \";\";\n  },\n  set: function(cssText) {\n    var i = 0;\n\n    /**\n     * @import url(partial.css) screen, handheld;\n     *        ||               |\n     *        after-import     media\n     *         |\n     *         url\n     */\n    var state = '';\n\n    var buffer = '';\n    var index;\n    for (var character; (character = cssText.charAt(i)); i++) {\n\n      switch (character) {\n        case ' ':\n        case '\\t':\n        case '\\r':\n        case '\\n':\n        case '\\f':\n          if (state === 'after-import') {\n            state = 'url';\n          } else {\n            buffer += character;\n          }\n          break;\n\n        case '@':\n          if (!state && cssText.indexOf('@import', i) === i) {\n            state = 'after-import';\n            i += 'import'.length;\n            buffer = '';\n          }\n          break;\n\n        case 'u':\n          if (state === 'url' && cssText.indexOf('url(', i) === i) {\n            index = cssText.indexOf(')', i + 1);\n            if (index === -1) {\n              throw i + ': \")\" not found';\n            }\n            i += 'url('.length;\n            var url = cssText.slice(i, index);\n            if (url[0] === url[url.length - 1]) {\n              if (url[0] === '\"' || url[0] === \"'\") {\n                url = url.slice(1, -1);\n              }\n            }\n            this.href = url;\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case '\"':\n          if (state === 'url') {\n            index = cssText.indexOf('\"', i + 1);\n            if (!index) {\n              throw i + \": '\\\"' not found\";\n            }\n            this.href = cssText.slice(i + 1, index);\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case \"'\":\n          if (state === 'url') {\n            index = cssText.indexOf(\"'\", i + 1);\n            if (!index) {\n              throw i + ': \"\\'\" not found';\n            }\n            this.href = cssText.slice(i + 1, index);\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case ';':\n          if (state === 'media') {\n            if (buffer) {\n              this.media.mediaText = buffer.trim();\n            }\n          }\n          break;\n\n        default:\n          if (state === 'media') {\n            buffer += character;\n          }\n          break;\n      }\n    }\n  }\n});\n\n\n//.CommonJS\nexports.CSSImportRule = CSSOM.CSSImportRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tCSSStyleDeclaration: require('./CSSStyleDeclaration').CSSStyleDeclaration\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/css3-animations/#DOM-CSSKeyframeRule\n */\nCSSOM.CSSKeyframeRule = function CSSKeyframeRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.keyText = '';\n\tthis.style = new CSSOM.CSSStyleDeclaration();\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSKeyframeRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSKeyframeRule.prototype.constructor = CSSOM.CSSKeyframeRule;\nCSSOM.CSSKeyframeRule.prototype.type = 9;\n//FIXME\n//CSSOM.CSSKeyframeRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSKeyframeRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSKeyframeRule.cpp\nObject.defineProperty(CSSOM.CSSKeyframeRule.prototype, \"cssText\", {\n  get: function() {\n    return this.keyText + \" {\" + this.style.cssText + \"} \";\n  }\n});\n\n\n//.CommonJS\nexports.CSSKeyframeRule = CSSOM.CSSKeyframeRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/css3-animations/#DOM-CSSKeyframesRule\n */\nCSSOM.CSSKeyframesRule = function CSSKeyframesRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.name = '';\n\tthis.cssRules = [];\n};\n\nCSSOM.CSSKeyframesRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSKeyframesRule.prototype.constructor = CSSOM.CSSKeyframesRule;\nCSSOM.CSSKeyframesRule.prototype.type = 8;\n//FIXME\n//CSSOM.CSSKeyframesRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSKeyframesRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSKeyframesRule.cpp\nObject.defineProperty(CSSOM.CSSKeyframesRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n      cssTexts.push(\"  \" + this.cssRules[i].cssText);\n    }\n    return \"@\" + (this._vendorPrefix || '') + \"keyframes \" + this.name + \" { \\n\" + cssTexts.join(\"\\n\") + \"\\n}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSKeyframesRule = CSSOM.CSSKeyframesRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tMediaList: require(\"./MediaList\").MediaList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssmediarule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSMediaRule\n */\nCSSOM.CSSMediaRule = function CSSMediaRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.media = new CSSOM.MediaList();\n\tthis.cssRules = [];\n};\n\nCSSOM.CSSMediaRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSMediaRule.prototype.constructor = CSSOM.CSSMediaRule;\nCSSOM.CSSMediaRule.prototype.type = 4;\n//FIXME\n//CSSOM.CSSMediaRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSMediaRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://opensource.apple.com/source/WebCore/WebCore-658.28/css/CSSMediaRule.cpp\nObject.defineProperty(CSSOM.CSSMediaRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n      cssTexts.push(this.cssRules[i].cssText);\n    }\n    return \"@media \" + this.media.mediaText + \" {\" + cssTexts.join(\"\") + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSMediaRule = CSSOM.CSSMediaRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-cssrule-interface\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSRule\n */\nCSSOM.CSSRule = function CSSRule() {\n\tthis.parentRule = null;\n\tthis.parentStyleSheet = null;\n};\n\nCSSOM.CSSRule.UNKNOWN_RULE = 0;                 // obsolete\nCSSOM.CSSRule.STYLE_RULE = 1;\nCSSOM.CSSRule.CHARSET_RULE = 2;                 // obsolete\nCSSOM.CSSRule.IMPORT_RULE = 3;\nCSSOM.CSSRule.MEDIA_RULE = 4;\nCSSOM.CSSRule.FONT_FACE_RULE = 5;\nCSSOM.CSSRule.PAGE_RULE = 6;\nCSSOM.CSSRule.KEYFRAMES_RULE = 7;\nCSSOM.CSSRule.KEYFRAME_RULE = 8;\nCSSOM.CSSRule.MARGIN_RULE = 9;\nCSSOM.CSSRule.NAMESPACE_RULE = 10;\nCSSOM.CSSRule.COUNTER_STYLE_RULE = 11;\nCSSOM.CSSRule.SUPPORTS_RULE = 12;\nCSSOM.CSSRule.DOCUMENT_RULE = 13;\nCSSOM.CSSRule.FONT_FEATURE_VALUES_RULE = 14;\nCSSOM.CSSRule.VIEWPORT_RULE = 15;\nCSSOM.CSSRule.REGION_STYLE_RULE = 16;\n\n\nCSSOM.CSSRule.prototype = {\n\tconstructor: CSSOM.CSSRule\n\t//FIXME\n};\n\n\n//.CommonJS\nexports.CSSRule = CSSOM.CSSRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration\n */\nCSSOM.CSSStyleDeclaration = function CSSStyleDeclaration(){\n\tthis.length = 0;\n\tthis.parentRule = null;\n\n\t// NON-STANDARD\n\tthis._importants = {};\n};\n\n\nCSSOM.CSSStyleDeclaration.prototype = {\n\n\tconstructor: CSSOM.CSSStyleDeclaration,\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-getPropertyValue\n\t * @return {string} the value of the property if it has been explicitly set for this declaration block.\n\t * Returns the empty string if the property has not been set.\n\t */\n\tgetPropertyValue: function(name) {\n\t\treturn this[name] || \"\";\n\t},\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @param {string} value\n\t * @param {string} [priority=null] \"important\" or null\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-setProperty\n\t */\n\tsetProperty: function(name, value, priority) {\n\t\tif (this[name]) {\n\t\t\t// Property already exist. Overwrite it.\n\t\t\tvar index = Array.prototype.indexOf.call(this, name);\n\t\t\tif (index < 0) {\n\t\t\t\tthis[this.length] = name;\n\t\t\t\tthis.length++;\n\t\t\t}\n\t\t} else {\n\t\t\t// New property.\n\t\t\tthis[this.length] = name;\n\t\t\tthis.length++;\n\t\t}\n\t\tthis[name] = value;\n\t\tthis._importants[name] = priority;\n\t},\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-removeProperty\n\t * @return {string} the value of the property if it has been explicitly set for this declaration block.\n\t * Returns the empty string if the property has not been set or the property name does not correspond to a known CSS property.\n\t */\n\tremoveProperty: function(name) {\n\t\tif (!(name in this)) {\n\t\t\treturn \"\";\n\t\t}\n\t\tvar index = Array.prototype.indexOf.call(this, name);\n\t\tif (index < 0) {\n\t\t\treturn \"\";\n\t\t}\n\t\tvar prevValue = this[name];\n\t\tthis[name] = \"\";\n\n\t\t// That's what WebKit and Opera do\n\t\tArray.prototype.splice.call(this, index, 1);\n\n\t\t// That's what Firefox does\n\t\t//this[index] = \"\"\n\n\t\treturn prevValue;\n\t},\n\n\tgetPropertyCSSValue: function() {\n\t\t//FIXME\n\t},\n\n\t/**\n\t *\n\t * @param {String} name\n\t */\n\tgetPropertyPriority: function(name) {\n\t\treturn this._importants[name] || \"\";\n\t},\n\n\n\t/**\n\t *   element.style.overflow = \"auto\"\n\t *   element.style.getPropertyShorthand(\"overflow-x\")\n\t *   -> \"overflow\"\n\t */\n\tgetPropertyShorthand: function() {\n\t\t//FIXME\n\t},\n\n\tisPropertyImplicit: function() {\n\t\t//FIXME\n\t},\n\n\t// Doesn't work in IE < 9\n\tget cssText(){\n\t\tvar properties = [];\n\t\tfor (var i=0, length=this.length; i < length; ++i) {\n\t\t\tvar name = this[i];\n\t\t\tvar value = this.getPropertyValue(name);\n\t\t\tvar priority = this.getPropertyPriority(name);\n\t\t\tif (priority) {\n\t\t\t\tpriority = \" !\" + priority;\n\t\t\t}\n\t\t\tproperties[i] = name + \": \" + value + priority + \";\";\n\t\t}\n\t\treturn properties.join(\" \");\n\t},\n\n\tset cssText(text){\n\t\tvar i, name;\n\t\tfor (i = this.length; i--;) {\n\t\t\tname = this[i];\n\t\t\tthis[name] = \"\";\n\t\t}\n\t\tArray.prototype.splice.call(this, 0, this.length);\n\t\tthis._importants = {};\n\n\t\tvar dummyRule = CSSOM.parse('#bogus{' + text + '}').cssRules[0].style;\n\t\tvar length = dummyRule.length;\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\tname = dummyRule[i];\n\t\t\tthis.setProperty(dummyRule[i], dummyRule.getPropertyValue(name), dummyRule.getPropertyPriority(name));\n\t\t}\n\t}\n};\n\n\n//.CommonJS\nexports.CSSStyleDeclaration = CSSOM.CSSStyleDeclaration;\nCSSOM.parse = require('./parse').parse; // Cannot be included sooner due to the mutual dependency between parse.js and CSSStyleDeclaration.js\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssstylerule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleRule\n */\nCSSOM.CSSStyleRule = function CSSStyleRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.selectorText = \"\";\n\tthis.style = new CSSOM.CSSStyleDeclaration();\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSStyleRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSStyleRule.prototype.constructor = CSSOM.CSSStyleRule;\nCSSOM.CSSStyleRule.prototype.type = 1;\n\nObject.defineProperty(CSSOM.CSSStyleRule.prototype, \"cssText\", {\n\tget: function() {\n\t\tvar text;\n\t\tif (this.selectorText) {\n\t\t\ttext = this.selectorText + \" {\" + this.style.cssText + \"}\";\n\t\t} else {\n\t\t\ttext = \"\";\n\t\t}\n\t\treturn text;\n\t},\n\tset: function(cssText) {\n\t\tvar rule = CSSOM.CSSStyleRule.parse(cssText);\n\t\tthis.style = rule.style;\n\t\tthis.selectorText = rule.selectorText;\n\t}\n});\n\n\n/**\n * NON-STANDARD\n * lightweight version of parse.js.\n * @param {string} ruleText\n * @return CSSStyleRule\n */\nCSSOM.CSSStyleRule.parse = function(ruleText) {\n\tvar i = 0;\n\tvar state = \"selector\";\n\tvar index;\n\tvar j = i;\n\tvar buffer = \"\";\n\n\tvar SIGNIFICANT_WHITESPACE = {\n\t\t\"selector\": true,\n\t\t\"value\": true\n\t};\n\n\tvar styleRule = new CSSOM.CSSStyleRule();\n\tvar name, priority=\"\";\n\n\tfor (var character; (character = ruleText.charAt(i)); i++) {\n\n\t\tswitch (character) {\n\n\t\tcase \" \":\n\t\tcase \"\\t\":\n\t\tcase \"\\r\":\n\t\tcase \"\\n\":\n\t\tcase \"\\f\":\n\t\t\tif (SIGNIFICANT_WHITESPACE[state]) {\n\t\t\t\t// Squash 2 or more white-spaces in the row into 1\n\t\t\t\tswitch (ruleText.charAt(i - 1)) {\n\t\t\t\t\tcase \" \":\n\t\t\t\t\tcase \"\\t\":\n\t\t\t\t\tcase \"\\r\":\n\t\t\t\t\tcase \"\\n\":\n\t\t\t\t\tcase \"\\f\":\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbuffer += \" \";\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// String\n\t\tcase '\"':\n\t\t\tj = i + 1;\n\t\t\tindex = ruleText.indexOf('\"', j) + 1;\n\t\t\tif (!index) {\n\t\t\t\tthrow '\" is missing';\n\t\t\t}\n\t\t\tbuffer += ruleText.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tbreak;\n\n\t\tcase \"'\":\n\t\t\tj = i + 1;\n\t\t\tindex = ruleText.indexOf(\"'\", j) + 1;\n\t\t\tif (!index) {\n\t\t\t\tthrow \"' is missing\";\n\t\t\t}\n\t\t\tbuffer += ruleText.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tbreak;\n\n\t\t// Comment\n\t\tcase \"/\":\n\t\t\tif (ruleText.charAt(i + 1) === \"*\") {\n\t\t\t\ti += 2;\n\t\t\t\tindex = ruleText.indexOf(\"*/\", i);\n\t\t\t\tif (index === -1) {\n\t\t\t\t\tthrow new SyntaxError(\"Missing */\");\n\t\t\t\t} else {\n\t\t\t\t\ti = index + 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"{\":\n\t\t\tif (state === \"selector\") {\n\t\t\t\tstyleRule.selectorText = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"name\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \":\":\n\t\t\tif (state === \"name\") {\n\t\t\t\tname = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"value\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"!\":\n\t\t\tif (state === \"value\" && ruleText.indexOf(\"!important\", i) === i) {\n\t\t\t\tpriority = \"important\";\n\t\t\t\ti += \"important\".length;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \";\":\n\t\t\tif (state === \"value\") {\n\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\tpriority = \"\";\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"name\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"}\":\n\t\t\tif (state === \"value\") {\n\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\tpriority = \"\";\n\t\t\t\tbuffer = \"\";\n\t\t\t} else if (state === \"name\") {\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tstate = \"selector\";\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\n\t\t}\n\t}\n\n\treturn styleRule;\n\n};\n\n\n//.CommonJS\nexports.CSSStyleRule = CSSOM.CSSStyleRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tStyleSheet: require(\"./StyleSheet\").StyleSheet,\n\tCSSStyleRule: require(\"./CSSStyleRule\").CSSStyleRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet\n */\nCSSOM.CSSStyleSheet = function CSSStyleSheet() {\n\tCSSOM.StyleSheet.call(this);\n\tthis.cssRules = [];\n};\n\n\nCSSOM.CSSStyleSheet.prototype = new CSSOM.StyleSheet();\nCSSOM.CSSStyleSheet.prototype.constructor = CSSOM.CSSStyleSheet;\n\n\n/**\n * Used to insert a new rule into the style sheet. The new rule now becomes part of the cascade.\n *\n *   sheet = new Sheet(\"body {margin: 0}\")\n *   sheet.toString()\n *   -> \"body{margin:0;}\"\n *   sheet.insertRule(\"img {border: none}\", 0)\n *   -> 0\n *   sheet.toString()\n *   -> \"img{border:none;}body{margin:0;}\"\n *\n * @param {string} rule\n * @param {number} index\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet-insertRule\n * @return {number} The index within the style sheet's rule collection of the newly inserted rule.\n */\nCSSOM.CSSStyleSheet.prototype.insertRule = function(rule, index) {\n\tif (index < 0 || index > this.cssRules.length) {\n\t\tthrow new RangeError(\"INDEX_SIZE_ERR\");\n\t}\n\tvar cssRule = CSSOM.parse(rule).cssRules[0];\n\tcssRule.parentStyleSheet = this;\n\tthis.cssRules.splice(index, 0, cssRule);\n\treturn index;\n};\n\n\n/**\n * Used to delete a rule from the style sheet.\n *\n *   sheet = new Sheet(\"img{border:none} body{margin:0}\")\n *   sheet.toString()\n *   -> \"img{border:none;}body{margin:0;}\"\n *   sheet.deleteRule(0)\n *   sheet.toString()\n *   -> \"body{margin:0;}\"\n *\n * @param {number} index within the style sheet's rule list of the rule to remove.\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet-deleteRule\n */\nCSSOM.CSSStyleSheet.prototype.deleteRule = function(index) {\n\tif (index < 0 || index >= this.cssRules.length) {\n\t\tthrow new RangeError(\"INDEX_SIZE_ERR\");\n\t}\n\tthis.cssRules.splice(index, 1);\n};\n\n\n/**\n * NON-STANDARD\n * @return {string} serialize stylesheet\n */\nCSSOM.CSSStyleSheet.prototype.toString = function() {\n\tvar result = \"\";\n\tvar rules = this.cssRules;\n\tfor (var i=0; i<rules.length; i++) {\n\t\tresult += rules[i].cssText + \"\\n\";\n\t}\n\treturn result;\n};\n\n\n//.CommonJS\nexports.CSSStyleSheet = CSSOM.CSSStyleSheet;\nCSSOM.parse = require('./parse').parse; // Cannot be included sooner due to the mutual dependency between parse.js and CSSStyleSheet.js\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSValue\n *\n * TODO: add if needed\n */\nCSSOM.CSSValue = function CSSValue() {\n};\n\nCSSOM.CSSValue.prototype = {\n\tconstructor: CSSOM.CSSValue,\n\n\t// @see: http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSValue\n\tset cssText(text) {\n\t\tvar name = this._getConstructorName();\n\n\t\tthrow new Error('DOMException: property \"cssText\" of \"' + name + '\" is readonly and can not be replaced with \"' + text + '\"!');\n\t},\n\n\tget cssText() {\n\t\tvar name = this._getConstructorName();\n\n\t\tthrow new Error('getter \"cssText\" of \"' + name + '\" is not implemented!');\n\t},\n\n\t_getConstructorName: function() {\n\t\tvar s = this.constructor.toString(),\n\t\t\t\tc = s.match(/function\\s([^\\(]+)/),\n\t\t\t\tname = c[1];\n\n\t\treturn name;\n\t}\n};\n\n\n//.CommonJS\nexports.CSSValue = CSSOM.CSSValue;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSValue: require('./CSSValue').CSSValue\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://msdn.microsoft.com/en-us/library/ms537634(v=vs.85).aspx\n *\n */\nCSSOM.CSSValueExpression = function CSSValueExpression(token, idx) {\n\tthis._token = token;\n\tthis._idx = idx;\n};\n\nCSSOM.CSSValueExpression.prototype = new CSSOM.CSSValue();\nCSSOM.CSSValueExpression.prototype.constructor = CSSOM.CSSValueExpression;\n\n/**\n * parse css expression() value\n *\n * @return {Object}\n *         - error:\n *         or\n *         - idx:\n *         - expression:\n *\n * Example:\n *\n * .selector {\n *\t\tzoom: expression(documentElement.clientWidth > 1000 ? '1000px' : 'auto');\n * }\n */\nCSSOM.CSSValueExpression.prototype.parse = function() {\n\tvar token = this._token,\n\t\t\tidx = this._idx;\n\n\tvar character = '',\n\t\t\texpression = '',\n\t\t\terror = '',\n\t\t\tinfo,\n\t\t\tparen = [];\n\n\n\tfor (; ; ++idx) {\n\t\tcharacter = token.charAt(idx);\n\n\t\t// end of token\n\t\tif (character === '') {\n\t\t\terror = 'css expression error: unfinished expression!';\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch(character) {\n\t\t\tcase '(':\n\t\t\t\tparen.push(character);\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\n\t\t\tcase ')':\n\t\t\t\tparen.pop(character);\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\n\t\t\tcase '/':\n\t\t\t\tif ((info = this._parseJSComment(token, idx))) { // comment?\n\t\t\t\t\tif (info.error) {\n\t\t\t\t\t\terror = 'css expression error: unfinished comment in expression!';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tidx = info.idx;\n\t\t\t\t\t\t// ignore the comment\n\t\t\t\t\t}\n\t\t\t\t} else if ((info = this._parseJSRexExp(token, idx))) { // regexp\n\t\t\t\t\tidx = info.idx;\n\t\t\t\t\texpression += info.text;\n\t\t\t\t} else { // other\n\t\t\t\t\texpression += character;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase \"'\":\n\t\t\tcase '\"':\n\t\t\t\tinfo = this._parseJSString(token, idx, character);\n\t\t\t\tif (info) { // string\n\t\t\t\t\tidx = info.idx;\n\t\t\t\t\texpression += info.text;\n\t\t\t\t} else {\n\t\t\t\t\texpression += character;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (error) {\n\t\t\tbreak;\n\t\t}\n\n\t\t// end of expression\n\t\tif (paren.length === 0) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tvar ret;\n\tif (error) {\n\t\tret = {\n\t\t\terror: error\n\t\t};\n\t} else {\n\t\tret = {\n\t\t\tidx: idx,\n\t\t\texpression: expression\n\t\t};\n\t}\n\n\treturn ret;\n};\n\n\n/**\n *\n * @return {Object|false}\n *          - idx:\n *          - text:\n *          or\n *          - error:\n *          or\n *          false\n *\n */\nCSSOM.CSSValueExpression.prototype._parseJSComment = function(token, idx) {\n\tvar nextChar = token.charAt(idx + 1),\n\t\t\ttext;\n\n\tif (nextChar === '/' || nextChar === '*') {\n\t\tvar startIdx = idx,\n\t\t\t\tendIdx,\n\t\t\t\tcommentEndChar;\n\n\t\tif (nextChar === '/') { // line comment\n\t\t\tcommentEndChar = '\\n';\n\t\t} else if (nextChar === '*') { // block comment\n\t\t\tcommentEndChar = '*/';\n\t\t}\n\n\t\tendIdx = token.indexOf(commentEndChar, startIdx + 1 + 1);\n\t\tif (endIdx !== -1) {\n\t\t\tendIdx = endIdx + commentEndChar.length - 1;\n\t\t\ttext = token.substring(idx, endIdx + 1);\n\t\t\treturn {\n\t\t\t\tidx: endIdx,\n\t\t\t\ttext: text\n\t\t\t};\n\t\t} else {\n\t\t\tvar error = 'css expression error: unfinished comment in expression!';\n\t\t\treturn {\n\t\t\t\terror: error\n\t\t\t};\n\t\t}\n\t} else {\n\t\treturn false;\n\t}\n};\n\n\n/**\n *\n * @return {Object|false}\n *\t\t\t\t\t- idx:\n *\t\t\t\t\t- text:\n *\t\t\t\t\tor \n *\t\t\t\t\tfalse\n *\n */\nCSSOM.CSSValueExpression.prototype._parseJSString = function(token, idx, sep) {\n\tvar endIdx = this._findMatchedIdx(token, idx, sep),\n\t\t\ttext;\n\n\tif (endIdx === -1) {\n\t\treturn false;\n\t} else {\n\t\ttext = token.substring(idx, endIdx + sep.length);\n\n\t\treturn {\n\t\t\tidx: endIdx,\n\t\t\ttext: text\n\t\t};\n\t}\n};\n\n\n/**\n * parse regexp in css expression\n *\n * @return {Object|false}\n *\t\t\t\t- idx:\n *\t\t\t\t- regExp:\n *\t\t\t\tor \n *\t\t\t\tfalse\n */\n\n/*\n\nall legal RegExp\n \n/a/\n(/a/)\n[/a/]\n[12, /a/]\n\n!/a/\n\n+/a/\n-/a/\n* /a/\n/ /a/\n%/a/\n\n===/a/\n!==/a/\n==/a/\n!=/a/\n>/a/\n>=/a/\n</a/\n<=/a/\n\n&/a/\n|/a/\n^/a/\n~/a/\n<</a/\n>>/a/\n>>>/a/\n\n&&/a/\n||/a/\n?/a/\n=/a/\n,/a/\n\n\t\tdelete /a/\n\t\t\t\tin /a/\ninstanceof /a/\n\t\t\t\tnew /a/\n\t\ttypeof /a/\n\t\t\tvoid /a/\n\n*/\nCSSOM.CSSValueExpression.prototype._parseJSRexExp = function(token, idx) {\n\tvar before = token.substring(0, idx).replace(/\\s+$/, \"\"),\n\t\t\tlegalRegx = [\n\t\t\t\t/^$/,\n\t\t\t\t/\\($/,\n\t\t\t\t/\\[$/,\n\t\t\t\t/\\!$/,\n\t\t\t\t/\\+$/,\n\t\t\t\t/\\-$/,\n\t\t\t\t/\\*$/,\n\t\t\t\t/\\/\\s+/,\n\t\t\t\t/\\%$/,\n\t\t\t\t/\\=$/,\n\t\t\t\t/\\>$/,\n\t\t\t\t/<$/,\n\t\t\t\t/\\&$/,\n\t\t\t\t/\\|$/,\n\t\t\t\t/\\^$/,\n\t\t\t\t/\\~$/,\n\t\t\t\t/\\?$/,\n\t\t\t\t/\\,$/,\n\t\t\t\t/delete$/,\n\t\t\t\t/in$/,\n\t\t\t\t/instanceof$/,\n\t\t\t\t/new$/,\n\t\t\t\t/typeof$/,\n\t\t\t\t/void$/\n\t\t\t];\n\n\tvar isLegal = legalRegx.some(function(reg) {\n\t\treturn reg.test(before);\n\t});\n\n\tif (!isLegal) {\n\t\treturn false;\n\t} else {\n\t\tvar sep = '/';\n\n\t\t// same logic as string\n\t\treturn this._parseJSString(token, idx, sep);\n\t}\n};\n\n\n/**\n *\n * find next sep(same line) index in `token`\n *\n * @return {Number}\n *\n */\nCSSOM.CSSValueExpression.prototype._findMatchedIdx = function(token, idx, sep) {\n\tvar startIdx = idx,\n\t\t\tendIdx;\n\n\tvar NOT_FOUND = -1;\n\n\twhile(true) {\n\t\tendIdx = token.indexOf(sep, startIdx + 1);\n\n\t\tif (endIdx === -1) { // not found\n\t\t\tendIdx = NOT_FOUND;\n\t\t\tbreak;\n\t\t} else {\n\t\t\tvar text = token.substring(idx + 1, endIdx),\n\t\t\t\t\tmatched = text.match(/\\\\+$/);\n\t\t\tif (!matched || matched[0] % 2 === 0) { // not escaped\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tstartIdx = endIdx;\n\t\t\t}\n\t\t}\n\t}\n\n\t// boundary must be in the same line(js sting or regexp)\n\tvar nextNewLineIdx = token.indexOf('\\n', idx + 1);\n\tif (nextNewLineIdx < endIdx) {\n\t\tendIdx = NOT_FOUND;\n\t}\n\n\n\treturn endIdx;\n};\n\n\n\n\n//.CommonJS\nexports.CSSValueExpression = CSSOM.CSSValueExpression;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see https://developer.mozilla.org/en/CSS/@-moz-document\n */\nCSSOM.MatcherList = function MatcherList(){\n    this.length = 0;\n};\n\nCSSOM.MatcherList.prototype = {\n\n    constructor: CSSOM.MatcherList,\n\n    /**\n     * @return {string}\n     */\n    get matcherText() {\n        return Array.prototype.join.call(this, \", \");\n    },\n\n    /**\n     * @param {string} value\n     */\n    set matcherText(value) {\n        // just a temporary solution, actually it may be wrong by just split the value with ',', because a url can include ','.\n        var values = value.split(\",\");\n        var length = this.length = values.length;\n        for (var i=0; i<length; i++) {\n            this[i] = values[i].trim();\n        }\n    },\n\n    /**\n     * @param {string} matcher\n     */\n    appendMatcher: function(matcher) {\n        if (Array.prototype.indexOf.call(this, matcher) === -1) {\n            this[this.length] = matcher;\n            this.length++;\n        }\n    },\n\n    /**\n     * @param {string} matcher\n     */\n    deleteMatcher: function(matcher) {\n        var index = Array.prototype.indexOf.call(this, matcher);\n        if (index !== -1) {\n            Array.prototype.splice.call(this, index, 1);\n        }\n    }\n\n};\n\n\n//.CommonJS\nexports.MatcherList = CSSOM.MatcherList;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-medialist-interface\n */\nCSSOM.MediaList = function MediaList(){\n\tthis.length = 0;\n};\n\nCSSOM.MediaList.prototype = {\n\n\tconstructor: CSSOM.MediaList,\n\n\t/**\n\t * @return {string}\n\t */\n\tget mediaText() {\n\t\treturn Array.prototype.join.call(this, \", \");\n\t},\n\n\t/**\n\t * @param {string} value\n\t */\n\tset mediaText(value) {\n\t\tvar values = value.split(\",\");\n\t\tvar length = this.length = values.length;\n\t\tfor (var i=0; i<length; i++) {\n\t\t\tthis[i] = values[i].trim();\n\t\t}\n\t},\n\n\t/**\n\t * @param {string} medium\n\t */\n\tappendMedium: function(medium) {\n\t\tif (Array.prototype.indexOf.call(this, medium) === -1) {\n\t\t\tthis[this.length] = medium;\n\t\t\tthis.length++;\n\t\t}\n\t},\n\n\t/**\n\t * @param {string} medium\n\t */\n\tdeleteMedium: function(medium) {\n\t\tvar index = Array.prototype.indexOf.call(this, medium);\n\t\tif (index !== -1) {\n\t\t\tArray.prototype.splice.call(this, index, 1);\n\t\t}\n\t}\n\n};\n\n\n//.CommonJS\nexports.MediaList = CSSOM.MediaList;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-stylesheet-interface\n */\nCSSOM.StyleSheet = function StyleSheet() {\n\tthis.parentStyleSheet = null;\n};\n\n\n//.CommonJS\nexports.StyleSheet = CSSOM.StyleSheet;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSStyleSheet: require(\"./CSSStyleSheet\").CSSStyleSheet,\n\tCSSStyleRule: require(\"./CSSStyleRule\").CSSStyleRule,\n\tCSSMediaRule: require(\"./CSSMediaRule\").CSSMediaRule,\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSKeyframeRule: require('./CSSKeyframeRule').CSSKeyframeRule,\n\tCSSKeyframesRule: require('./CSSKeyframesRule').CSSKeyframesRule\n};\n///CommonJS\n\n\n/**\n * Produces a deep copy of stylesheet — the instance variables of stylesheet are copied recursively.\n * @param {CSSStyleSheet|CSSOM.CSSStyleSheet} stylesheet\n * @nosideeffects\n * @return {CSSOM.CSSStyleSheet}\n */\nCSSOM.clone = function clone(stylesheet) {\n\n\tvar cloned = new CSSOM.CSSStyleSheet();\n\n\tvar rules = stylesheet.cssRules;\n\tif (!rules) {\n\t\treturn cloned;\n\t}\n\n\tvar RULE_TYPES = {\n\t\t1: CSSOM.CSSStyleRule,\n\t\t4: CSSOM.CSSMediaRule,\n\t\t//3: CSSOM.CSSImportRule,\n\t\t//5: CSSOM.CSSFontFaceRule,\n\t\t//6: CSSOM.CSSPageRule,\n\t\t8: CSSOM.CSSKeyframesRule,\n\t\t9: CSSOM.CSSKeyframeRule\n\t};\n\n\tfor (var i=0, rulesLength=rules.length; i < rulesLength; i++) {\n\t\tvar rule = rules[i];\n\t\tvar ruleClone = cloned.cssRules[i] = new RULE_TYPES[rule.type]();\n\n\t\tvar style = rule.style;\n\t\tif (style) {\n\t\t\tvar styleClone = ruleClone.style = new CSSOM.CSSStyleDeclaration();\n\t\t\tfor (var j=0, styleLength=style.length; j < styleLength; j++) {\n\t\t\t\tvar name = styleClone[j] = style[j];\n\t\t\t\tstyleClone[name] = style[name];\n\t\t\t\tstyleClone._importants[name] = style.getPropertyPriority(name);\n\t\t\t}\n\t\t\tstyleClone.length = style.length;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('keyText')) {\n\t\t\truleClone.keyText = rule.keyText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('selectorText')) {\n\t\t\truleClone.selectorText = rule.selectorText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('mediaText')) {\n\t\t\truleClone.mediaText = rule.mediaText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('cssRules')) {\n\t\t\truleClone.cssRules = clone(rule).cssRules;\n\t\t}\n\t}\n\n\treturn cloned;\n\n};\n\n//.CommonJS\nexports.clone = CSSOM.clone;\n///CommonJS\n","'use strict';\n\nexports.CSSStyleDeclaration = require('./CSSStyleDeclaration').CSSStyleDeclaration;\nexports.CSSRule = require('./CSSRule').CSSRule;\nexports.CSSStyleRule = require('./CSSStyleRule').CSSStyleRule;\nexports.MediaList = require('./MediaList').MediaList;\nexports.CSSMediaRule = require('./CSSMediaRule').CSSMediaRule;\nexports.CSSImportRule = require('./CSSImportRule').CSSImportRule;\nexports.CSSFontFaceRule = require('./CSSFontFaceRule').CSSFontFaceRule;\nexports.StyleSheet = require('./StyleSheet').StyleSheet;\nexports.CSSStyleSheet = require('./CSSStyleSheet').CSSStyleSheet;\nexports.CSSKeyframesRule = require('./CSSKeyframesRule').CSSKeyframesRule;\nexports.CSSKeyframeRule = require('./CSSKeyframeRule').CSSKeyframeRule;\nexports.MatcherList = require('./MatcherList').MatcherList;\nexports.CSSDocumentRule = require('./CSSDocumentRule').CSSDocumentRule;\nexports.CSSValue = require('./CSSValue').CSSValue;\nexports.CSSValueExpression = require('./CSSValueExpression').CSSValueExpression;\nexports.parse = require('./parse').parse;\nexports.clone = require('./clone').clone;\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @param {string} token\n */\nCSSOM.parse = function parse(token) {\n\n\tvar i = 0;\n\n\t/**\n\t\t\"before-selector\" or\n\t\t\"selector\" or\n\t\t\"atRule\" or\n\t\t\"atBlock\" or\n\t\t\"before-name\" or\n\t\t\"name\" or\n\t\t\"before-value\" or\n\t\t\"value\"\n\t*/\n\tvar state = \"before-selector\";\n\n\tvar index;\n\tvar buffer = \"\";\n\n\tvar SIGNIFICANT_WHITESPACE = {\n\t\t\"selector\": true,\n\t\t\"value\": true,\n\t\t\"atRule\": true,\n\t\t\"importRule-begin\": true,\n\t\t\"importRule\": true,\n\t\t\"atBlock\": true,\n\t\t'documentRule-begin': true\n\t};\n\n\tvar styleSheet = new CSSOM.CSSStyleSheet();\n\n\t// @type CSSStyleSheet|CSSMediaRule|CSSFontFaceRule|CSSKeyframesRule|CSSDocumentRule\n\tvar currentScope = styleSheet;\n\n\t// @type CSSMediaRule|CSSKeyframesRule|CSSDocumentRule\n\tvar parentRule;\n\n\tvar name, priority=\"\", styleRule, mediaRule, importRule, fontFaceRule, keyframesRule, documentRule;\n\n\tvar atKeyframesRegExp = /@(-(?:\\w+-)+)?keyframes/g;\n\n\tvar parseError = function(message) {\n\t\tvar lines = token.substring(0, i).split('\\n');\n\t\tvar lineCount = lines.length;\n\t\tvar charCount = lines.pop().length + 1;\n\t\tvar error = new Error(message + ' (line ' + lineCount + ', char ' + charCount + ')');\n\t\terror.line = lineCount;\n\t\t/* jshint sub : true */\n\t\terror['char'] = charCount;\n\t\terror.styleSheet = styleSheet;\n\t\tthrow error;\n\t};\n\n\tfor (var character; (character = token.charAt(i)); i++) {\n\n\t\tswitch (character) {\n\n\t\tcase \" \":\n\t\tcase \"\\t\":\n\t\tcase \"\\r\":\n\t\tcase \"\\n\":\n\t\tcase \"\\f\":\n\t\t\tif (SIGNIFICANT_WHITESPACE[state]) {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// String\n\t\tcase '\"':\n\t\t\tindex = i + 1;\n\t\t\tdo {\n\t\t\t\tindex = token.indexOf('\"', index) + 1;\n\t\t\t\tif (!index) {\n\t\t\t\t\tparseError('Unmatched \"');\n\t\t\t\t}\n\t\t\t} while (token[index - 2] === '\\\\');\n\t\t\tbuffer += token.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tswitch (state) {\n\t\t\t\tcase 'before-value':\n\t\t\t\t\tstate = 'value';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'importRule-begin':\n\t\t\t\t\tstate = 'importRule';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"'\":\n\t\t\tindex = i + 1;\n\t\t\tdo {\n\t\t\t\tindex = token.indexOf(\"'\", index) + 1;\n\t\t\t\tif (!index) {\n\t\t\t\t\tparseError(\"Unmatched '\");\n\t\t\t\t}\n\t\t\t} while (token[index - 2] === '\\\\');\n\t\t\tbuffer += token.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tswitch (state) {\n\t\t\t\tcase 'before-value':\n\t\t\t\t\tstate = 'value';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'importRule-begin':\n\t\t\t\t\tstate = 'importRule';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// Comment\n\t\tcase \"/\":\n\t\t\tif (token.charAt(i + 1) === \"*\") {\n\t\t\t\ti += 2;\n\t\t\t\tindex = token.indexOf(\"*/\", i);\n\t\t\t\tif (index === -1) {\n\t\t\t\t\tparseError(\"Missing */\");\n\t\t\t\t} else {\n\t\t\t\t\ti = index + 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tif (state === \"importRule-begin\") {\n\t\t\t\tbuffer += \" \";\n\t\t\t\tstate = \"importRule\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// At-rule\n\t\tcase \"@\":\n\t\t\tif (token.indexOf(\"@-moz-document\", i) === i) {\n\t\t\t\tstate = \"documentRule-begin\";\n\t\t\t\tdocumentRule = new CSSOM.CSSDocumentRule();\n\t\t\t\tdocumentRule.__starts = i;\n\t\t\t\ti += \"-moz-document\".length;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@media\", i) === i) {\n\t\t\t\tstate = \"atBlock\";\n\t\t\t\tmediaRule = new CSSOM.CSSMediaRule();\n\t\t\t\tmediaRule.__starts = i;\n\t\t\t\ti += \"media\".length;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@import\", i) === i) {\n\t\t\t\tstate = \"importRule-begin\";\n\t\t\t\ti += \"import\".length;\n\t\t\t\tbuffer += \"@import\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@font-face\", i) === i) {\n\t\t\t\tstate = \"fontFaceRule-begin\";\n\t\t\t\ti += \"font-face\".length;\n\t\t\t\tfontFaceRule = new CSSOM.CSSFontFaceRule();\n\t\t\t\tfontFaceRule.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tatKeyframesRegExp.lastIndex = i;\n\t\t\t\tvar matchKeyframes = atKeyframesRegExp.exec(token);\n\t\t\t\tif (matchKeyframes && matchKeyframes.index === i) {\n\t\t\t\t\tstate = \"keyframesRule-begin\";\n\t\t\t\t\tkeyframesRule = new CSSOM.CSSKeyframesRule();\n\t\t\t\t\tkeyframesRule.__starts = i;\n\t\t\t\t\tkeyframesRule._vendorPrefix = matchKeyframes[1]; // Will come out as undefined if no prefix was found\n\t\t\t\t\ti += matchKeyframes[0].length - 1;\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (state === \"selector\") {\n\t\t\t\t\tstate = \"atRule\";\n\t\t\t\t}\n\t\t\t}\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\n\t\tcase \"{\":\n\t\t\tif (state === \"selector\" || state === \"atRule\") {\n\t\t\t\tstyleRule.selectorText = buffer.trim();\n\t\t\t\tstyleRule.style.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"atBlock\") {\n\t\t\t\tmediaRule.media.mediaText = buffer.trim();\n\t\t\t\tcurrentScope = parentRule = mediaRule;\n\t\t\t\tmediaRule.parentStyleSheet = styleSheet;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-selector\";\n\t\t\t} else if (state === \"fontFaceRule-begin\") {\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tfontFaceRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tfontFaceRule.parentStyleSheet = styleSheet;\n\t\t\t\tstyleRule = fontFaceRule;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"keyframesRule-begin\") {\n\t\t\t\tkeyframesRule.name = buffer.trim();\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tkeyframesRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tkeyframesRule.parentStyleSheet = styleSheet;\n\t\t\t\tcurrentScope = parentRule = keyframesRule;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"keyframeRule-begin\";\n\t\t\t} else if (state === \"keyframeRule-begin\") {\n\t\t\t\tstyleRule = new CSSOM.CSSKeyframeRule();\n\t\t\t\tstyleRule.keyText = buffer.trim();\n\t\t\t\tstyleRule.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"documentRule-begin\") {\n\t\t\t\t// FIXME: what if this '{' is in the url text of the match function?\n\t\t\t\tdocumentRule.matcher.matcherText = buffer.trim();\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tdocumentRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tcurrentScope = parentRule = documentRule;\n\t\t\t\tdocumentRule.parentStyleSheet = styleSheet;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-selector\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \":\":\n\t\t\tif (state === \"name\") {\n\t\t\t\tname = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-value\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"(\":\n\t\t\tif (state === 'value') {\n\t\t\t\t// ie css expression mode\n\t\t\t\tif (buffer.trim() === 'expression') {\n\t\t\t\t\tvar info = (new CSSOM.CSSValueExpression(token, i)).parse();\n\n\t\t\t\t\tif (info.error) {\n\t\t\t\t\t\tparseError(info.error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuffer += info.expression;\n\t\t\t\t\t\ti = info.idx;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tstate = 'value-parenthesis';\n\t\t\t\t\tbuffer += character;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \")\":\n\t\t\tif (state === 'value-parenthesis') {\n\t\t\t\tstate = 'value';\n\t\t\t}\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\n\t\tcase \"!\":\n\t\t\tif (state === \"value\" && token.indexOf(\"!important\", i) === i) {\n\t\t\t\tpriority = \"important\";\n\t\t\t\ti += \"important\".length;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \";\":\n\t\t\tswitch (state) {\n\t\t\t\tcase \"value\":\n\t\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\t\tpriority = \"\";\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-name\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"atRule\":\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"importRule\":\n\t\t\t\t\timportRule = new CSSOM.CSSImportRule();\n\t\t\t\t\timportRule.parentStyleSheet = importRule.styleSheet.parentStyleSheet = styleSheet;\n\t\t\t\t\timportRule.cssText = buffer + character;\n\t\t\t\t\tstyleSheet.cssRules.push(importRule);\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbuffer += character;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"}\":\n\t\t\tswitch (state) {\n\t\t\t\tcase \"value\":\n\t\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\t\tpriority = \"\";\n\t\t\t\t\t/* falls through */\n\t\t\t\tcase \"before-name\":\n\t\t\t\tcase \"name\":\n\t\t\t\t\tstyleRule.__ends = i + 1;\n\t\t\t\t\tif (parentRule) {\n\t\t\t\t\t\tstyleRule.parentRule = parentRule;\n\t\t\t\t\t}\n\t\t\t\t\tstyleRule.parentStyleSheet = styleSheet;\n\t\t\t\t\tcurrentScope.cssRules.push(styleRule);\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tif (currentScope.constructor === CSSOM.CSSKeyframesRule) {\n\t\t\t\t\t\tstate = \"keyframeRule-begin\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"keyframeRule-begin\":\n\t\t\t\tcase \"before-selector\":\n\t\t\t\tcase \"selector\":\n\t\t\t\t\t// End of media/document rule.\n\t\t\t\t\tif (!parentRule) {\n\t\t\t\t\t\tparseError(\"Unexpected }\");\n\t\t\t\t\t}\n\t\t\t\t\tcurrentScope.__ends = i + 1;\n\t\t\t\t\t// Nesting rules aren't supported yet\n\t\t\t\t\tstyleSheet.cssRules.push(currentScope);\n\t\t\t\t\tcurrentScope = styleSheet;\n\t\t\t\t\tparentRule = null;\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tswitch (state) {\n\t\t\t\tcase \"before-selector\":\n\t\t\t\t\tstate = \"selector\";\n\t\t\t\t\tstyleRule = new CSSOM.CSSStyleRule();\n\t\t\t\t\tstyleRule.__starts = i;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"before-name\":\n\t\t\t\t\tstate = \"name\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"before-value\":\n\t\t\t\t\tstate = \"value\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"importRule-begin\":\n\t\t\t\t\tstate = \"importRule\";\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn styleSheet;\n};\n\n\n//.CommonJS\nexports.parse = CSSOM.parse;\n// The following modules cannot be included sooner due to the mutual dependency with parse.js\nCSSOM.CSSStyleSheet = require(\"./CSSStyleSheet\").CSSStyleSheet;\nCSSOM.CSSStyleRule = require(\"./CSSStyleRule\").CSSStyleRule;\nCSSOM.CSSImportRule = require(\"./CSSImportRule\").CSSImportRule;\nCSSOM.CSSMediaRule = require(\"./CSSMediaRule\").CSSMediaRule;\nCSSOM.CSSFontFaceRule = require(\"./CSSFontFaceRule\").CSSFontFaceRule;\nCSSOM.CSSStyleDeclaration = require('./CSSStyleDeclaration').CSSStyleDeclaration;\nCSSOM.CSSKeyframeRule = require('./CSSKeyframeRule').CSSKeyframeRule;\nCSSOM.CSSKeyframesRule = require('./CSSKeyframesRule').CSSKeyframesRule;\nCSSOM.CSSValueExpression = require('./CSSValueExpression').CSSValueExpression;\nCSSOM.CSSDocumentRule = require('./CSSDocumentRule').CSSDocumentRule;\n///CommonJS\n","// Simple, stupid \"background\"/\"background-image\" value parser that just aims at exposing the image URLs\n\"use strict\";\n\nvar cssSupport = require('./cssSupport');\n\n\nvar trimCSSWhitespace = function (url) {\n    var whitespaceRegex = /^[\\t\\r\\f\\n ]*(.+?)[\\t\\r\\f\\n ]*$/;\n\n    return url.replace(whitespaceRegex, \"$1\");\n};\n\n// TODO exporting this for the sake of unit testing. Should rather test the background value parser explicitly.\nexports.extractCssUrl = function (cssUrl) {\n    var urlRegex = /^url\\(([^\\)]+)\\)/,\n        quotedUrl;\n\n    if (!urlRegex.test(cssUrl)) {\n        throw new Error(\"Invalid url\");\n    }\n\n    quotedUrl = urlRegex.exec(cssUrl)[1];\n    return cssSupport.unquoteString(trimCSSWhitespace(quotedUrl));\n};\n\nvar sliceBackgroundDeclaration = function (backgroundDeclarationText) {\n    var functionParamRegexS = \"\\\\s*(?:\\\"[^\\\"]*\\\"|'[^']*'|[^\\\\(]+)\\\\s*\",\n        valueRegexS = \"(\" + \"url\\\\(\" + functionParamRegexS + \"\\\\)\" + \"|\" + \"[^,\\\\s]+\" + \")\",\n        simpleSingularBackgroundRegexS = \"(?:\\\\s*\" + valueRegexS + \")+\",\n        simpleBackgroundRegexS = \"^\\\\s*(\" + simpleSingularBackgroundRegexS + \")\" +\n                                  \"(?:\\\\s*,\\\\s*(\" + simpleSingularBackgroundRegexS + \"))*\" +\n                                  \"\\\\s*$\",\n        simpleSingularBackgroundRegex = new RegExp(simpleSingularBackgroundRegexS, \"g\"),\n        outerRepeatedMatch,\n        backgroundLayers = [],\n        getValues = function (singularBackgroundDeclaration) {\n            var valueRegex = new RegExp(valueRegexS, \"g\"),\n                backgroundValues = [],\n                repeatedMatch;\n\n            repeatedMatch = valueRegex.exec(singularBackgroundDeclaration);\n            while (repeatedMatch) {\n                backgroundValues.push(repeatedMatch[1]);\n                repeatedMatch = valueRegex.exec(singularBackgroundDeclaration);\n            }\n            return backgroundValues;\n        };\n\n    if (backgroundDeclarationText.match(new RegExp(simpleBackgroundRegexS))) {\n        outerRepeatedMatch = simpleSingularBackgroundRegex.exec(backgroundDeclarationText);\n        while (outerRepeatedMatch) {\n            backgroundLayers.push(getValues(outerRepeatedMatch[0]));\n            outerRepeatedMatch = simpleSingularBackgroundRegex.exec(backgroundDeclarationText);\n        }\n\n        return backgroundLayers;\n    }\n    return [];\n};\n\nvar findBackgroundImageUrlInValues = function (values) {\n    var i, url;\n\n    for(i = 0; i < values.length; i++) {\n        try {\n            url = exports.extractCssUrl(values[i]);\n            return {\n                url: url,\n                idx: i\n            };\n        } catch (e) {}\n    }\n};\n\nexports.parse = function (backgroundValue) {\n    var backgroundLayers = sliceBackgroundDeclaration(backgroundValue);\n\n    return backgroundLayers.map(function (backgroundLayerValues) {\n        var urlMatch = findBackgroundImageUrlInValues(backgroundLayerValues);\n\n        if (urlMatch) {\n            return {\n                preUrl: backgroundLayerValues.slice(0, urlMatch.idx),\n                url: urlMatch.url,\n                postUrl: backgroundLayerValues.slice(urlMatch.idx+1),\n            };\n        } else {\n            return {\n                preUrl: backgroundLayerValues\n            };\n        }\n    });\n};\n\nexports.serialize = function (parsedBackground) {\n    var backgroundLayers = parsedBackground.map(function (backgroundLayer) {\n        var values = [].concat(backgroundLayer.preUrl);\n\n        if (backgroundLayer.url) {\n            values.push('url(\"' + backgroundLayer.url + '\")');\n        }\n        if (backgroundLayer.postUrl) {\n            values = values.concat(backgroundLayer.postUrl);\n        }\n\n        return values.join(' ');\n    });\n\n    return backgroundLayers.join(', ');\n};\n","\"use strict\";\n\nvar cssom;\n\ntry {\n  cssom = require('cssom');\n} catch (e) {\n}\n\n\nexports.unquoteString = function (quotedUrl) {\n    var doubleQuoteRegex = /^\"(.*)\"$/,\n        singleQuoteRegex = /^'(.*)'$/;\n\n    if (doubleQuoteRegex.test(quotedUrl)) {\n        return quotedUrl.replace(doubleQuoteRegex, \"$1\");\n    } else {\n        if (singleQuoteRegex.test(quotedUrl)) {\n            return quotedUrl.replace(singleQuoteRegex, \"$1\");\n        } else {\n            return quotedUrl;\n        }\n    }\n};\n\nvar rulesForCssTextFromBrowser = function (styleContent) {\n    var doc = document.implementation.createHTMLDocument(\"\"),\n        styleElement = document.createElement(\"style\"),\n        rules;\n\n    styleElement.textContent = styleContent;\n    // the style will only be parsed once it is added to a document\n    doc.body.appendChild(styleElement);\n    rules = styleElement.sheet.cssRules;\n\n    return Array.prototype.slice.call(rules);\n};\n\nvar browserHasBackgroundImageUrlIssue = (function () {\n    // Checks for http://code.google.com/p/chromium/issues/detail?id=161644\n    var rules = rulesForCssTextFromBrowser('a{background:url(i)}');\n    return !rules.length || rules[0].cssText.indexOf('url()') >= 0;\n}());\n\nvar browserHasFontFaceUrlIssue = (function () {\n    // Checks for https://bugs.chromium.org/p/chromium/issues/detail?id=588129\n    var rules = rulesForCssTextFromBrowser('@font-face { font-family: \"f\"; src: url(\"f\"); }');\n    return !rules.length || /url\\(['\"]*\\)/.test(rules[0].cssText);\n}());\n\nvar browserHasBackgroundImageUrlSetIssue = (function () {\n    // Checks for https://bugs.chromium.org/p/chromium/issues/detail?id=660663\n    var rules = rulesForCssTextFromBrowser('a{background:url(old)}');\n    rules[0].style.setProperty('background', 'url(new)', '');\n    return rules[0].style.getPropertyValue('background').indexOf('old') >= 0;\n}());\n\nexports.rulesForCssText = function (styleContent) {\n    if ((browserHasBackgroundImageUrlIssue || browserHasFontFaceUrlIssue || browserHasBackgroundImageUrlSetIssue) && cssom && cssom.parse) {\n        return cssom.parse(styleContent).cssRules;\n    } else {\n        return rulesForCssTextFromBrowser(styleContent);\n    }\n};\n\nexports.cssRulesToText = function (cssRules) {\n    return cssRules.reduce(function (cssText, rule) {\n        return cssText + rule.cssText;\n    }, '');\n};\n\nexports.exchangeRule = function (cssRules, rule, newRuleText) {\n    var ruleIdx = cssRules.indexOf(rule);\n\n    // We create a new document and stylesheet to parse the rule,\n    // instead of relying on rule.parentStyleSheet, because\n    // rule.parentStyleSheet may be null\n    // (https://github.com/cburgmer/inlineresources/issues/3)\n    cssRules[ruleIdx] = exports.rulesForCssText(newRuleText)[0];\n};\n\n// Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=443978\nexports.changeFontFaceRuleSrc = function (cssRules, rule, newSrc) {\n    var newRuleText = '@font-face { font-family: ' + rule.style.getPropertyValue(\"font-family\") + '; ';\n\n    if (rule.style.getPropertyValue(\"font-style\")) {\n        newRuleText += 'font-style: ' + rule.style.getPropertyValue(\"font-style\") + '; ';\n    }\n\n    if (rule.style.getPropertyValue(\"font-weight\")) {\n        newRuleText += 'font-weight: ' + rule.style.getPropertyValue(\"font-weight\") + '; ';\n    }\n\n    newRuleText += 'src: ' + newSrc + '}';\n    exports.exchangeRule(cssRules, rule, newRuleText);\n};\n","\"use strict\";\n\nvar util = require('./util'),\n    inlineImage = require('./inlineImage'),\n    inlineScript = require('./inlineScript'),\n    inlineCss = require('./inlineCss'),\n    cssSupport = require('./cssSupport');\n\n\nvar getUrlBasePath = function (url) {\n    return util.joinUrl(url, '.');\n};\n\nvar parameterHashFunction = function (params) {\n    // HACK JSON.stringify is poor man's hashing;\n    // same objects might not receive same result as key order is not guaranteed\n    var a = params.map(function (param, idx) {\n        // Only include options relevant for method\n        if (idx === (params.length - 1)) {\n            param = {\n                // Two different HTML pages on the same path level have the same base path, but a different URL\n                baseUrl: getUrlBasePath(param.baseUrl)\n            };\n        }\n        return JSON.stringify(param);\n    });\n    return a;\n};\n\nvar memoizeFunctionOnCaching = function (func, options) {\n    if ((options.cache !== false && options.cache !== 'none') && options.cacheBucket) {\n        return util.memoize(func, parameterHashFunction, options.cacheBucket);\n    } else {\n        return func;\n    }\n};\n\n/* Style inlining */\n\nvar requestExternalsForStylesheet = function (styleContent, alreadyLoadedCssUrls, options) {\n    var cssRules = cssSupport.rulesForCssText(styleContent);\n\n    return inlineCss.loadCSSImportsForRules(cssRules, alreadyLoadedCssUrls, options).then(function (cssImportResult) {\n        return inlineCss.loadAndInlineCSSResourcesForRules(cssRules, options).then(function (cssResourcesResult) {\n            var errors = cssImportResult.errors.concat(cssResourcesResult.errors),\n                hasChanges = cssImportResult.hasChanges || cssResourcesResult.hasChanges;\n\n            if (hasChanges) {\n                styleContent = cssSupport.cssRulesToText(cssRules);\n            }\n\n            return {\n                hasChanges: hasChanges,\n                content: styleContent,\n                errors: errors\n            };\n        });\n    });\n};\n\nvar loadAndInlineCssForStyle = function (style, options, alreadyLoadedCssUrls) {\n    var styleContent = style.textContent,\n        processExternals = memoizeFunctionOnCaching(requestExternalsForStylesheet, options);\n\n    return processExternals(styleContent, alreadyLoadedCssUrls, options).then(function (result) {\n        if (result.hasChanges) {\n            style.childNodes[0].nodeValue = result.content;\n        }\n\n        return util.cloneArray(result.errors);\n    });\n};\n\nvar getCssStyleElements = function (doc) {\n    var styles = doc.getElementsByTagName(\"style\");\n\n    return Array.prototype.filter.call(styles, function (style) {\n        return !style.attributes.type || style.attributes.type.value === \"text/css\";\n    });\n};\n\nexports.loadAndInlineStyles = function (doc, options) {\n    var styles = getCssStyleElements(doc),\n        allErrors = [],\n        alreadyLoadedCssUrls = [],\n        inlineOptions;\n\n    inlineOptions = util.clone(options);\n    inlineOptions.baseUrl = inlineOptions.baseUrl || util.getDocumentBaseUrl(doc);\n\n    return util.all(styles.map(function (style) {\n        return loadAndInlineCssForStyle(style, inlineOptions, alreadyLoadedCssUrls).then(function (errors) {\n            allErrors = allErrors.concat(errors);\n        });\n    })).then(function () {\n        return allErrors;\n    });\n};\n\n/* CSS link inlining */\n\nvar substituteLinkWithInlineStyle = function (oldLinkNode, styleContent) {\n    var parent = oldLinkNode.parentNode,\n        styleNode;\n\n    styleContent = styleContent.trim();\n    if (styleContent) {\n        styleNode = oldLinkNode.ownerDocument.createElement(\"style\");\n        styleNode.type = \"text/css\";\n        styleNode.appendChild(oldLinkNode.ownerDocument.createTextNode(styleContent));\n\n        parent.insertBefore(styleNode, oldLinkNode);\n    }\n\n    parent.removeChild(oldLinkNode);\n};\n\nvar requestStylesheetAndInlineResources = function (url, options) {\n    return util.ajax(url, options)\n        .then(function (content) {\n            var cssRules = cssSupport.rulesForCssText(content);\n\n            return {\n                content: content,\n                cssRules: cssRules\n            };\n        })\n        .then(function (result) {\n            var hasChangesFromPathAdjustment = inlineCss.adjustPathsOfCssResources(url, result.cssRules);\n\n            return {\n                content: result.content,\n                cssRules: result.cssRules,\n                hasChanges: hasChangesFromPathAdjustment\n            };\n        })\n        .then(function (result) {\n            return inlineCss.loadCSSImportsForRules(result.cssRules, [], options)\n                .then(function (cssImportResult) {\n                    return {\n                        content: result.content,\n                        cssRules: result.cssRules,\n                        hasChanges: result.hasChanges || cssImportResult.hasChanges,\n                        errors: cssImportResult.errors\n                    };\n                });\n        })\n        .then(function (result) {\n            return inlineCss.loadAndInlineCSSResourcesForRules(result.cssRules, options)\n                .then(function (cssResourcesResult) {\n                    return {\n                        content: result.content,\n                        cssRules: result.cssRules,\n                        hasChanges: result.hasChanges || cssResourcesResult.hasChanges,\n                        errors: result.errors.concat(cssResourcesResult.errors)\n                    };\n                });\n        })\n        .then(function (result) {\n            var content = result.content;\n            if (result.hasChanges) {\n                content = cssSupport.cssRulesToText(result.cssRules);\n            }\n            return {\n                content: content,\n                errors: result.errors\n            };\n        });\n};\n\nvar loadLinkedCSS = function (link, options) {\n    var cssHref = link.attributes.href.value,\n        documentBaseUrl = util.getDocumentBaseUrl(link.ownerDocument),\n        ajaxOptions = util.clone(options);\n\n    if (!ajaxOptions.baseUrl && documentBaseUrl) {\n        ajaxOptions.baseUrl = documentBaseUrl;\n    }\n\n    var processStylesheet = memoizeFunctionOnCaching(requestStylesheetAndInlineResources, options);\n\n    return processStylesheet(cssHref, ajaxOptions).then(function (result) {\n        return {\n            content: result.content,\n            errors: util.cloneArray(result.errors)\n        };\n    });\n};\n\nvar getCssStylesheetLinks = function (doc) {\n    var links = doc.getElementsByTagName(\"link\");\n\n    return Array.prototype.filter.call(links, function (link) {\n        return link.attributes.rel && link.attributes.rel.value === \"stylesheet\" &&\n            (!link.attributes.type || link.attributes.type.value === \"text/css\");\n    });\n};\n\nexports.loadAndInlineCssLinks = function (doc, options) {\n    var links = getCssStylesheetLinks(doc),\n        errors = [];\n\n    return util.all(links.map(function (link) {\n        return loadLinkedCSS(link, options).then(function(result) {\n            substituteLinkWithInlineStyle(link, result.content + \"\\n\");\n\n            errors = errors.concat(result.errors);\n        }, function (e) {\n            errors.push({\n                resourceType: \"stylesheet\",\n                url: e.url,\n                msg: \"Unable to load stylesheet \" + e.url\n            });\n        });\n    })).then(function () {\n        return errors;\n    });\n};\n\n/* Main */\n\nexports.loadAndInlineImages = inlineImage.inline;\nexports.loadAndInlineScript = inlineScript.inline;\n\nexports.inlineReferences = function (doc, options) {\n    var allErrors = [],\n        inlineFuncs = [\n            exports.loadAndInlineImages,\n            exports.loadAndInlineStyles,\n            exports.loadAndInlineCssLinks];\n\n    if (options.inlineScripts !== false) {\n        inlineFuncs.push(exports.loadAndInlineScript);\n    }\n\n    return util.all(inlineFuncs.map(function (func) {\n        return func(doc, options)\n            .then(function (errors) {\n                allErrors = allErrors.concat(errors);\n            });\n    })).then(function () {\n        return allErrors;\n    });\n};\n","\"use strict\";\n\nvar ayepromise = require('ayepromise'),\n    util = require('./util'),\n    cssSupport = require('./cssSupport'),\n    backgroundValueParser = require('./backgroundValueParser'),\n    fontFaceSrcValueParser = require('css-font-face-src');\n\n\nvar updateCssPropertyValue = function (rule, property, value) {\n    rule.style.setProperty(property, value, rule.style.getPropertyPriority(property));\n};\n\nvar findBackgroundImageRules = function (cssRules) {\n    return cssRules.filter(function (rule) {\n        return rule.type === window.CSSRule.STYLE_RULE && (rule.style.getPropertyValue('background-image') || rule.style.getPropertyValue('background'));\n    });\n};\n\nvar findBackgroundDeclarations = function (rules) {\n    var backgroundDeclarations = [];\n\n    rules.forEach(function (rule) {\n        if (rule.style.getPropertyValue('background-image')) {\n            backgroundDeclarations.push({\n                property: 'background-image',\n                value: rule.style.getPropertyValue('background-image'),\n                rule: rule\n            });\n        } else if (rule.style.getPropertyValue('background')) {\n            backgroundDeclarations.push({\n                property: 'background',\n                value: rule.style.getPropertyValue('background'),\n                rule: rule\n            });\n        }\n    });\n\n    return backgroundDeclarations;\n};\n\nvar findFontFaceRules = function (cssRules) {\n    return cssRules.filter(function (rule) {\n        return rule.type === window.CSSRule.FONT_FACE_RULE && rule.style.getPropertyValue(\"src\");\n    });\n};\n\nvar findCSSImportRules = function (cssRules) {\n    return cssRules.filter(function (rule) {\n        return rule.type === window.CSSRule.IMPORT_RULE && rule.href;\n    });\n};\n\nvar findExternalBackgroundUrls = function (parsedBackground) {\n    var matchIndices = [];\n\n    parsedBackground.forEach(function (backgroundLayer, i) {\n        if (backgroundLayer.url && !util.isDataUri(backgroundLayer.url)) {\n            matchIndices.push(i);\n        }\n    });\n\n    return matchIndices;\n};\n\nvar findExternalFontFaceUrls = function (parsedFontFaceSources) {\n    var sourceIndices = [];\n    parsedFontFaceSources.forEach(function (sourceItem, i) {\n        if (sourceItem.url && !util.isDataUri(sourceItem.url)) {\n            sourceIndices.push(i);\n        }\n    });\n    return sourceIndices;\n};\n\nexports.adjustPathsOfCssResources = function (baseUrl, cssRules) {\n    var backgroundRules = findBackgroundImageRules(cssRules),\n        backgroundDeclarations = findBackgroundDeclarations(backgroundRules),\n        change = false;\n\n    backgroundDeclarations.forEach(function (declaration) {\n        var parsedBackground = backgroundValueParser.parse(declaration.value),\n            externalBackgroundIndices = findExternalBackgroundUrls(parsedBackground),\n            backgroundValue;\n\n        if (externalBackgroundIndices.length > 0) {\n            externalBackgroundIndices.forEach(function (backgroundLayerIndex) {\n                var relativeUrl = parsedBackground[backgroundLayerIndex].url,\n                    url = util.joinUrl(baseUrl, relativeUrl);\n                parsedBackground[backgroundLayerIndex].url = url;\n            });\n\n            backgroundValue = backgroundValueParser.serialize(parsedBackground);\n\n            updateCssPropertyValue(declaration.rule, declaration.property, backgroundValue);\n\n            change = true;\n        }\n    });\n    findFontFaceRules(cssRules).forEach(function (rule) {\n        var fontFaceSrcDeclaration = rule.style.getPropertyValue(\"src\"),\n            parsedFontFaceSources, externalFontFaceUrlIndices;\n\n        try {\n            parsedFontFaceSources = fontFaceSrcValueParser.parse(fontFaceSrcDeclaration);\n        } catch (e) {\n            return;\n        }\n        externalFontFaceUrlIndices = findExternalFontFaceUrls(parsedFontFaceSources);\n\n        if (externalFontFaceUrlIndices.length > 0) {\n            externalFontFaceUrlIndices.forEach(function (fontFaceUrlIndex) {\n                var relativeUrl = parsedFontFaceSources[fontFaceUrlIndex].url,\n                    url = util.joinUrl(baseUrl, relativeUrl);\n\n                parsedFontFaceSources[fontFaceUrlIndex].url = url;\n            });\n\n            cssSupport.changeFontFaceRuleSrc(cssRules, rule, fontFaceSrcValueParser.serialize(parsedFontFaceSources));\n\n            change = true;\n        }\n    });\n    findCSSImportRules(cssRules).forEach(function (rule) {\n        var cssUrl = rule.href,\n            url = util.joinUrl(baseUrl, cssUrl);\n\n        cssSupport.exchangeRule(cssRules, rule, \"@import url(\" + url + \");\");\n\n        change = true;\n    });\n\n    return change;\n};\n\n/* CSS import inlining */\n\nvar substituteRule = function (cssRules, rule, newCssRules) {\n    var position = cssRules.indexOf(rule);\n\n    cssRules.splice(position, 1);\n\n    newCssRules.forEach(function (newRule, i) {\n        cssRules.splice(position + i, 0, newRule);\n    });\n};\n\nvar fulfilledPromise = function (value) {\n    var defer = ayepromise.defer();\n    defer.resolve(value);\n    return defer.promise;\n};\n\nvar loadAndInlineCSSImport = function (cssRules, rule, alreadyLoadedCssUrls, options) {\n    var url = rule.href,\n        cssHrefRelativeToDoc;\n\n    url = cssSupport.unquoteString(url);\n\n    cssHrefRelativeToDoc = util.joinUrl(options.baseUrl, url);\n\n    if (alreadyLoadedCssUrls.indexOf(cssHrefRelativeToDoc) >= 0) {\n        // Remove URL by adding empty string\n        substituteRule(cssRules, rule, []);\n        return fulfilledPromise([]);\n    } else {\n        alreadyLoadedCssUrls.push(cssHrefRelativeToDoc);\n    }\n\n    return util.ajax(url, options)\n        .then(function (cssText) {\n            var externalCssRules = cssSupport.rulesForCssText(cssText);\n\n            // Recursively follow @import statements\n            return exports.loadCSSImportsForRules(externalCssRules, alreadyLoadedCssUrls, options)\n                .then(function (result) {\n                    exports.adjustPathsOfCssResources(url, externalCssRules);\n\n                    substituteRule(cssRules, rule, externalCssRules);\n\n                    return result.errors;\n                });\n        }, function (e) {\n            throw {\n                resourceType: \"stylesheet\",\n                url: e.url,\n                msg: \"Unable to load stylesheet \" + e.url\n            };\n        });\n};\n\nexports.loadCSSImportsForRules = function (cssRules, alreadyLoadedCssUrls, options) {\n    var rulesToInline = findCSSImportRules(cssRules),\n        errors = [],\n        hasChanges = false;\n\n    return util.all(rulesToInline.map(function (rule) {\n        return loadAndInlineCSSImport(cssRules, rule, alreadyLoadedCssUrls, options).then(function (moreErrors) {\n            errors = errors.concat(moreErrors);\n\n            hasChanges = true;\n        }, function (e) {\n            errors.push(e);\n        });\n    })).then(function () {\n        return {\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\n/* CSS linked resource inlining */\n\nvar loadAndInlineBackgroundImages = function (backgroundValue, options) {\n    var parsedBackground = backgroundValueParser.parse(backgroundValue),\n        externalBackgroundLayerIndices = findExternalBackgroundUrls(parsedBackground),\n        hasChanges = false;\n\n    return util.collectAndReportErrors(externalBackgroundLayerIndices.map(function (backgroundLayerIndex) {\n        var url = parsedBackground[backgroundLayerIndex].url;\n\n        return util.getDataURIForImageURL(url, options)\n            .then(function (dataURI) {\n                parsedBackground[backgroundLayerIndex].url = dataURI;\n\n                hasChanges = true;\n            }, function (e) {\n                throw {\n                    resourceType: \"backgroundImage\",\n                    url: e.url,\n                    msg: \"Unable to load background-image \" + e.url\n                };\n            });\n    })).then(function (errors) {\n        return {\n            backgroundValue: backgroundValueParser.serialize(parsedBackground),\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\nvar iterateOverRulesAndInlineBackgroundImages = function (cssRules, options) {\n    var rulesToInline = findBackgroundImageRules(cssRules),\n        backgroundDeclarations = findBackgroundDeclarations(rulesToInline),\n        errors = [],\n        cssHasChanges = false;\n\n    return util.all(backgroundDeclarations.map(function (declaration) {\n        return loadAndInlineBackgroundImages(declaration.value, options)\n            .then(function (result) {\n                if (result.hasChanges) {\n                    updateCssPropertyValue(declaration.rule, declaration.property, result.backgroundValue);\n\n                    cssHasChanges = true;\n                }\n\n                errors = errors.concat(result.errors);\n            });\n    })).then(function () {\n        return {\n            hasChanges: cssHasChanges,\n            errors: errors\n        };\n    });\n};\n\nvar loadAndInlineFontFace = function (srcDeclarationValue, options) {\n    var hasChanges = false,\n        parsedFontFaceSources, externalFontFaceUrlIndices;\n\n    try {\n        parsedFontFaceSources = fontFaceSrcValueParser.parse(srcDeclarationValue);\n    } catch (e) {\n        parsedFontFaceSources = [];\n    }\n    externalFontFaceUrlIndices = findExternalFontFaceUrls(parsedFontFaceSources);\n\n    return util.collectAndReportErrors(externalFontFaceUrlIndices.map(function (urlIndex) {\n        var fontSrc = parsedFontFaceSources[urlIndex],\n            format = fontSrc.format || \"woff\";\n\n        return util.binaryAjax(fontSrc.url, options)\n            .then(function (content) {\n                var base64Content = btoa(content);\n                fontSrc.url = 'data:font/' + format + ';base64,' + base64Content;\n\n                hasChanges = true;\n            }, function (e) {\n                throw {\n                    resourceType: \"fontFace\",\n                    url: e.url,\n                    msg: \"Unable to load font-face \" + e.url\n                };\n            });\n    })).then(function (errors) {\n        return {\n            srcDeclarationValue: fontFaceSrcValueParser.serialize(parsedFontFaceSources),\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\nvar iterateOverRulesAndInlineFontFace = function (cssRules, options) {\n    var rulesToInline = findFontFaceRules(cssRules),\n        errors = [],\n        hasChanges = false;\n\n    return util.all(rulesToInline.map(function (rule) {\n        var srcDeclarationValue = rule.style.getPropertyValue(\"src\");\n\n        return loadAndInlineFontFace(srcDeclarationValue, options).then(function (result) {\n            if (result.hasChanges) {\n                cssSupport.changeFontFaceRuleSrc(cssRules, rule, result.srcDeclarationValue);\n\n                hasChanges = true;\n            }\n\n            errors = errors.concat(result.errors);\n        });\n    })).then(function () {\n        return {\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\nexports.loadAndInlineCSSResourcesForRules = function (cssRules, options) {\n    var hasChanges = false,\n        errors = [];\n\n    return util.all([iterateOverRulesAndInlineBackgroundImages, iterateOverRulesAndInlineFontFace].map(function (func) {\n        return func(cssRules, options)\n            .then(function (result) {\n                hasChanges = hasChanges || result.hasChanges;\n                errors = errors.concat(result.errors);\n            });\n    })).then(function () {\n        return {\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n","\"use strict\";\n\nvar util = require('./util');\n\n\nvar encodeImageAsDataURI = function (image, options) {\n    var url = null;\n    if(image.hasAttribute('src')){\n        url = image.getAttribute('src');\n    }\n    else if(image.hasAttributeNS('http://www.w3.org/1999/xlink','href')){\n        url = image.getAttributeNS('http://www.w3.org/1999/xlink','href');\n    }\n    else if(image.hasAttribute('href')){\n        url = image.getAttribute('href');\n    }\n    var documentBase = util.getDocumentBaseUrl(image.ownerDocument),\n        ajaxOptions = util.clone(options);\n\n    if (!ajaxOptions.baseUrl && documentBase) {\n        ajaxOptions.baseUrl = documentBase;\n    }\n\n    return util.getDataURIForImageURL(url, ajaxOptions)\n        .then(function (dataURI) {\n            return dataURI;\n        }, function (e) {\n            throw {\n                resourceType: \"image\",\n                url: e.url,\n                msg: \"Unable to load image \" + e.url\n            };\n        });\n};\n\nvar filterExternalImages = function (images) {\n    return images.filter(function (image) {\n        var url = null;\n        if(image.hasAttribute('src')){\n            url = image.getAttribute('src');\n        }\n        else if(image.hasAttributeNS('http://www.w3.org/1999/xlink','href')){\n            url = image.getAttributeNS('http://www.w3.org/1999/xlink','href');\n        }\n        else if(image.hasAttribute('href')){\n            url = image.getAttribute('href');\n        }\n\n        return url !== null && !util.isDataUri(url);\n    });\n};\n\nvar filterInputsForImageType = function (inputs) {\n    return Array.prototype.filter.call(inputs, function (input) {\n        return input.type === \"image\";\n    });\n};\n\nvar toArray = function (arrayLike) {\n    return Array.prototype.slice.call(arrayLike);\n};\n\nexports.inline = function (doc, options) {\n    var images = toArray(doc.getElementsByTagName(\"img\")),\n        svgImages = toArray(doc.getElementsByTagName(\"image\")),\n        imageInputs = filterInputsForImageType(doc.getElementsByTagName(\"input\"));\n\n    images = images.concat(svgImages);\n    images = images.concat(imageInputs);\n    var externalImages = filterExternalImages(images);\n\n    return util.collectAndReportErrors(externalImages.map(function (image) {\n        return encodeImageAsDataURI(image, options).then(function (dataURI) {\n            if(!!image.attributes.src){\n                image.attributes.src.value = dataURI;\n            }\n            else if(!!image.attributes['xlink:href']){\n                image.attributes['xlink:href'].value = dataURI;\n            }\n            else if(!!image.attributes.href){\n                image.attributes.href.value = dataURI;\n            }\n        });\n    }));\n};\n","\"use strict\";\n\nvar util = require('./util');\n\n\nvar loadLinkedScript = function (script, options) {\n    var src = script.attributes.src.value,\n        documentBase = util.getDocumentBaseUrl(script.ownerDocument),\n        ajaxOptions = util.clone(options);\n\n    if (!ajaxOptions.baseUrl && documentBase) {\n        ajaxOptions.baseUrl = documentBase;\n    }\n\n    return util.ajax(src, ajaxOptions)\n        .fail(function (e) {\n            throw {\n                resourceType: \"script\",\n                url: e.url,\n                msg: \"Unable to load script \" + e.url\n            };\n        });\n};\n\nvar escapeClosingTags = function (text) {\n    // http://stackoverflow.com/questions/9246382/escaping-script-tag-inside-javascript\n    return text.replace(/<\\//g, '<\\\\/');\n};\n\nvar substituteExternalScriptWithInline = function (scriptNode, jsCode) {\n    scriptNode.attributes.removeNamedItem('src');\n    scriptNode.textContent = escapeClosingTags(jsCode);\n};\n\nvar getScripts = function (doc) {\n    var scripts = doc.getElementsByTagName(\"script\");\n\n    return Array.prototype.filter.call(scripts, function (script) {\n        return !!script.attributes.src;\n    });\n};\n\nexports.inline = function (doc, options) {\n    var scripts = getScripts(doc);\n\n    return util.collectAndReportErrors(scripts.map(function (script) {\n        return loadLinkedScript(script, options).then(function (jsCode) {\n            substituteExternalScriptWithInline(script, jsCode);\n        });\n    }));\n};\n","\"use strict\";\n\nvar url = require('url'),\n    ayepromise = require('ayepromise');\n\n\nexports.getDocumentBaseUrl = function (doc) {\n    if (doc.baseURI !== 'about:blank') {\n        return doc.baseURI;\n    }\n\n    return null;\n};\n\nexports.clone = function (object) {\n    var theClone = {},\n        i;\n    for (i in object) {\n        if (object.hasOwnProperty(i)) {\n           theClone[i] = object[i];\n        }\n    }\n    return theClone;\n};\n\nexports.cloneArray = function (nodeList) {\n    return Array.prototype.slice.apply(nodeList, [0]);\n};\n\nexports.joinUrl = function (baseUrl, relUrl) {\n    if (!baseUrl) {\n        return relUrl;\n    }\n    return url.resolve(baseUrl, relUrl);\n};\n\nexports.isDataUri = function (url) {\n    return (/^data:/).test(url);\n};\n\nexports.all = function (promises) {\n    var defer = ayepromise.defer(),\n        pendingPromiseCount = promises.length,\n        resolvedValues = [];\n\n    if (promises.length === 0) {\n        defer.resolve([]);\n        return defer.promise;\n    }\n\n    promises.forEach(function (promise, idx) {\n        promise.then(function (value) {\n            pendingPromiseCount -= 1;\n            resolvedValues[idx] = value;\n\n            if (pendingPromiseCount === 0) {\n                defer.resolve(resolvedValues);\n            }\n        }, function (e) {\n            defer.reject(e);\n        });\n    });\n    return defer.promise;\n};\n\nexports.collectAndReportErrors = function (promises) {\n    var errors = [];\n\n    return exports.all(promises.map(function (promise) {\n        return promise.fail(function (e) {\n            errors.push(e);\n        });\n    })).then(function () {\n        return errors;\n    });\n};\n\nvar lastCacheDate = null;\n\nvar getUncachableURL = function (url, cache) {\n    if (cache === false || cache === 'none' || cache === 'repeated') {\n        if (lastCacheDate === null || cache !== 'repeated') {\n            lastCacheDate = Date.now();\n        }\n        return url + \"?_=\" + lastCacheDate;\n    } else {\n        return url;\n    }\n};\n\nexports.ajax = function (url, options) {\n    var ajaxRequest = new window.XMLHttpRequest(),\n        defer = ayepromise.defer(),\n        joinedUrl = exports.joinUrl(options.baseUrl, url),\n        augmentedUrl;\n\n    var doReject = function () {\n        defer.reject({\n            msg: 'Unable to load url',\n            url: joinedUrl\n        });\n    };\n\n    augmentedUrl = getUncachableURL(joinedUrl, options.cache);\n\n    ajaxRequest.addEventListener(\"load\", function () {\n        if (ajaxRequest.status === 200 || ajaxRequest.status === 0) {\n            defer.resolve(ajaxRequest.response);\n        } else {\n            doReject();\n        }\n    }, false);\n\n    ajaxRequest.addEventListener(\"error\", doReject, false);\n\n    try {\n        ajaxRequest.open('GET', augmentedUrl, true);\n        ajaxRequest.overrideMimeType(options.mimeType);\n        ajaxRequest.send(null);\n    } catch (e) {\n        doReject();\n    }\n\n    return defer.promise;\n};\n\nexports.binaryAjax = function (url, options) {\n    var ajaxOptions = exports.clone(options);\n\n    ajaxOptions.mimeType = 'text/plain; charset=x-user-defined';\n\n    return exports.ajax(url, ajaxOptions)\n        .then(function (content) {\n            var binaryContent = \"\";\n\n            for (var i = 0; i < content.length; i++) {\n                binaryContent += String.fromCharCode(content.charCodeAt(i) & 0xFF);\n            }\n\n            return binaryContent;\n        });\n};\n\nvar detectMimeType = function (content) {\n    var startsWith = function (string, substring) {\n        return string.substring(0, substring.length) === substring;\n    };\n\n    if (startsWith(content, '<?xml') || startsWith(content, '<svg')) {\n        return 'image/svg+xml';\n    }\n    return 'image/png';\n};\n\nexports.getDataURIForImageURL = function (url, options) {\n    return exports.binaryAjax(url, options)\n        .then(function (content) {\n            var base64Content = btoa(content),\n                mimeType = detectMimeType(content);\n\n            return 'data:' + mimeType + ';base64,' + base64Content;\n        });\n};\n\nvar uniqueIdList = [];\n\nvar constantUniqueIdFor = function (element) {\n    // HACK, using a list results in O(n), but how do we hash a function?\n    if (uniqueIdList.indexOf(element) < 0) {\n        uniqueIdList.push(element);\n    }\n    return uniqueIdList.indexOf(element);\n};\n\nexports.memoize = function (func, hasher, memo) {\n    if (typeof memo !== \"object\") {\n        throw new Error(\"cacheBucket is not an object\");\n    }\n\n    return function () {\n        var args = Array.prototype.slice.call(arguments);\n\n        var argumentHash = hasher(args),\n            funcHash = constantUniqueIdFor(func),\n            retValue;\n\n        if (memo[funcHash] && memo[funcHash][argumentHash]) {\n            return memo[funcHash][argumentHash];\n        } else {\n            retValue = func.apply(null, args);\n\n            memo[funcHash] = memo[funcHash] || {};\n            memo[funcHash][argumentHash] = retValue;\n\n            return retValue;\n        }\n    };\n};\n","'use strict';\n\nvar innerXML = function (node) {\n    var s = new XMLSerializer();\n    return Array.prototype.map.call(node.childNodes, function (node) {\n        return s.serializeToString(node);\n    }).join('');\n};\n\nvar getParseError = function (doc) {\n    // Firefox\n    if (doc.documentElement.tagName === 'parsererror' &&\n        doc.documentElement.namespaceURI === 'http://www.mozilla.org/newlayout/xml/parsererror.xml') {\n        return doc.documentElement;\n    }\n\n    // Chrome, Safari\n    if ((doc.documentElement.tagName === 'xml' || doc.documentElement.tagName === 'html') &&\n        doc.documentElement.childNodes &&\n        doc.documentElement.childNodes.length > 0 &&\n        doc.documentElement.childNodes[0].nodeName === 'parsererror') {\n        return doc.documentElement.childNodes[0];\n    }\n\n    // PhantomJS\n    if (doc.documentElement.tagName === 'html' &&\n        doc.documentElement.childNodes &&\n        doc.documentElement.childNodes.length > 0 &&\n        doc.documentElement.childNodes[0].nodeName === 'body' &&\n        doc.documentElement.childNodes[0].childNodes &&\n        doc.documentElement.childNodes[0].childNodes.length &&\n        doc.documentElement.childNodes[0].childNodes[0].nodeName === 'parsererror') {\n        return doc.documentElement.childNodes[0].childNodes[0];\n    }\n\n    return undefined;\n};\n\nvar errorMessagePatterns = [\n    // Chrome, Safari, PhantomJS\n    new RegExp('^<h3[^>]*>This page contains the following errors:<\\/h3><div[^>]*>(.+?)\\n?<\\/div>'),\n    // Firefox\n    new RegExp('^(.+)\\n')\n];\n\nvar extractParseError = function (errorNode) {\n    var content = innerXML(errorNode);\n    var i, match;\n\n    for(i = 0; i < errorMessagePatterns.length; i++) {\n        match = errorMessagePatterns[i].exec(content);\n\n        if (match) {\n            return match[1];\n        }\n    }\n    return undefined;\n};\n\nvar failOnParseError = function (doc) {\n    var errorMessage;\n\n    if (doc === null) {\n        throw new Error('Parse error');\n    }\n\n    var parseError = getParseError(doc);\n    if (parseError !== undefined) {\n        errorMessage = extractParseError(parseError) || 'Parse error';\n        throw new Error(errorMessage);\n    }\n};\n\nexports.failOnParseError = function (doc) {\n    failOnParseError(doc);\n\n    return doc;\n};\n","var removeInvalidCharacters = function (content) {\n    // See http://www.w3.org/TR/xml/#NT-Char for valid XML 1.0 characters\n    return content.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F]/g, '');\n};\n\nvar serializeAttributeValue = function (value) {\n    return value\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&apos;');\n};\n\nvar serializeTextContent = function (content) {\n    return content\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n};\n\nvar serializeAttribute = function (attr) {\n    var value = attr.value;\n\n    return ' ' + attr.name + '=\"' + serializeAttributeValue(value) + '\"';\n};\n\nvar getTagName = function (node) {\n    var tagName = node.tagName;\n\n    // Aid in serializing of original HTML documents\n    if (node.namespaceURI === 'http://www.w3.org/1999/xhtml') {\n        tagName = tagName.toLowerCase();\n    }\n    return tagName;\n};\n\nvar serializeNamespace = function (node, isRootNode) {\n    var nodeHasXmlnsAttr = Array.prototype.map.call(node.attributes || node.attrs, function (attr) {\n            return attr.name;\n        })\n        .indexOf('xmlns') >= 0;\n    // Serialize the namespace as an xmlns attribute whenever the element\n    // doesn't already have one and the inherited namespace does not match\n    // the element's namespace.\n    if (!nodeHasXmlnsAttr &&\n        (isRootNode ||\n         node.namespaceURI !== node.parentNode.namespaceURI)) {\n         return ' xmlns=\"' + node.namespaceURI + '\"';\n    } else {\n        return '';\n    }\n};\n\nvar serializeChildren = function (node) {\n    return Array.prototype.map.call(node.childNodes, function (childNode) {\n        return nodeTreeToXHTML(childNode);\n    }).join('');\n};\n\nvar serializeTag = function (node, isRootNode) {\n    var output = '<' + getTagName(node);\n    output += serializeNamespace(node, isRootNode);\n\n    Array.prototype.forEach.call(node.attributes || node.attrs, function (attr) {\n        output += serializeAttribute(attr);\n    });\n\n    if (node.childNodes.length > 0) {\n        output += '>';\n        output += serializeChildren(node);\n        output += '</' + getTagName(node) + '>';\n    } else {\n        output += '/>';\n    }\n    return output;\n};\n\nvar serializeText = function (node) {\n    var text = node.nodeValue || node.value || '';\n    return serializeTextContent(text);\n};\n\nvar serializeComment = function (node) {\n    return '<!--' +\n        node.data\n            .replace(/-/g, '&#45;') +\n        '-->';\n};\n\nvar serializeCDATA = function (node) {\n    return '<![CDATA[' + node.nodeValue + ']]>';\n};\n\nvar nodeTreeToXHTML = function (node, options) {\n    var isRootNode = options && options.rootNode;\n\n    if (node.nodeName === '#document' ||\n        node.nodeName === '#document-fragment') {\n        return serializeChildren(node);\n    } else {\n        if (node.tagName) {\n            return serializeTag(node, isRootNode);\n        } else if (node.nodeName === '#text') {\n            return serializeText(node);\n        } else if (node.nodeName === '#comment') {\n            return serializeComment(node);\n        } else if (node.nodeName === '#cdata-section') {\n            return serializeCDATA(node);\n        }\n    }\n};\n\nexports.serializeToString = function (node) {\n    return removeInvalidCharacters(nodeTreeToXHTML(node, {rootNode: true}));\n};\n"]}