(function(a,b){if(typeof define==="function"&&define.amd){define([],function(){return b()})}else{a.Burry=b()}}(this,function(){var a={Store:function(c,d){var b=a.stores();if(c){this._CACHE_SUFFIX=this._CACHE_SUFFIX+c;this._EXPIRY_KEY=this._EXPIRY_KEY+c;if(b.indexOf(c)===-1){b.push(c)}}localStorage.setItem("_burry_stores_",JSON.stringify(b));this.default_ttl=d},_EXPIRY_UNITS:60*1000,_mEpoch:function(){return Math.floor((new Date().getTime())/a._EXPIRY_UNITS)},stores:function(){var b=localStorage.getItem("_burry_stores_");if(b){b=JSON.parse(b)}else{b=[""]}return b},isSupported:function(){if(a._isSupported){return a._isSupported}try{localStorage.setItem("_burry_","_burry_");localStorage.removeItem("_burry_")}catch(b){return a._isSupported=false}if(!JSON){return a._isSupported=false}return a._isSupported=true},flushExpired:function(){var f,d,e,j,g,b=[],c=a._mEpoch(),h=new RegExp("(.+)"+a.Store.prototype._EXPIRY_KEY+"(.*)");for(f=0;f<localStorage.length;f++){e=localStorage.key(f);d=e.match(h);if(d){j=localStorage.getItem(e);if(j<c){e=d[1];g=d[2];b.push(e+a.Store.prototype._CACHE_SUFFIX+g);b.push(e+a.Store.prototype._EXPIRY_KEY+g)}}}for(f=0;f<b.length;f++){localStorage.removeItem(b[f])}}};a.Store.prototype={_CACHE_SUFFIX:"-_burry_",_EXPIRY_KEY:"-_burry_exp_",_internalKey:function(b){return b+this._CACHE_SUFFIX},_expirationKey:function(b){return b+this._EXPIRY_KEY},_isInternalKey:function(b){if(b.slice(-this._CACHE_SUFFIX.length)===this._CACHE_SUFFIX){return b.slice(0,-this._CACHE_SUFFIX.length)}return false},_isExpirationKey:function(b){if(b.slice(-this._EXPIRY_KEY.length)===this._EXPIRY_KEY){return b.slice(0,-this._EXPIRY_KEY.length)}return false},_expiresOn:function(c){var b=localStorage.getItem(this._expirationKey(c));if(b){return parseInt(b,10)}},_getCounter:function(c){var b=localStorage.getItem(c);if(b===null){return 0}return parseInt(b,10)},get:function(b){var c=localStorage.getItem(this._internalKey(b));if(c===null){return undefined}if(this.hasExpired(b)){this.remove(b);return undefined}try{c=JSON.parse(c)}catch(d){return undefined}return c},set:function(k,j,d){var g,f,c={},l=this,b=function(){localStorage.setItem(l._internalKey(k),j);if(d){localStorage.setItem(l._expirationKey(k),a._mEpoch()+d)}else{localStorage.removeItem(l._expirationKey(k))}};d=d||l.default_ttl;if(d){d=parseInt(d,10)}if(typeof k===undefined||typeof j===undefined){return false}j=JSON.stringify(j);try{b()}catch(h){if(h.code===22||h.name==="QUOTA_EXCEEDED_ERR"||h.name==="QuoteExceededError"||h.name==="NS_ERROR_DOM_QUOTA_REACHED"){a.flushExpired();try{b()}catch(h){return false}}}return true},add:function(c,d,b){if(localStorage.getItem(this._internalKey(c))===null||this.hasExpired(c)){return this.set(c,d,b)}return false},replace:function(c,d,b){if(localStorage.getItem(this._internalKey(c))!==null&&!this.hasExpired(c)){return this.set(c,d,b)}return false},remove:function(b){localStorage.removeItem(this._internalKey(b));localStorage.removeItem(this._expirationKey(b))},incr:function(b){var d=this._internalKey(b),c=this._getCounter(d);c++;localStorage.setItem(d,c)},decr:function(b){var d=this._internalKey(b),c=this._getCounter(d);c--;localStorage.setItem(d,c)},hasExpired:function(c){var b=this._expiresOn(c);if(b&&(b<a._mEpoch())){return true}return false},keys:function(){var d,e,c,b=[];for(d=0;d<localStorage.length;d++){e=localStorage.key(d);c=this._isInternalKey(e);if(c){b.push(c)}}return b},expirableKeys:function(){var d,e,c,b={};for(d=0;d<localStorage.length;d++){e=localStorage.key(d);c=this._isExpirationKey(e);if(c){b[c]=parseInt(localStorage.getItem(e),10)}}return b},flush:function(){var d,c,b=[];for(d=0;d<localStorage.length;d++){c=localStorage.key(d);if(this._isInternalKey(c)||this._isExpirationKey(c)){b.push(c)}}for(d=0;d<b.length;d++){localStorage.removeItem(b[d])}},flushExpired:function(){var d=this.expirableKeys(),b=a._mEpoch(),c,e;for(c in d){e=d[c];if(e<b){this.remove(c)}}}};return a}));
