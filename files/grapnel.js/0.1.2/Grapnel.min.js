
/****
 * Grapnel.js
 * https://github.com/gregsabia/Grapnel.js 
 * 
 * @author Greg Sabia
 * @link http://gregsabia.com
 * @version 0.1.2
 * 
 * Released under MIT License. See LICENSE.txt or http://opensource.org/licenses/MIT
*/

var Grapnel=function(e){"use strict";var t=this;this.action=null;this.hook=e||":";this.value=null;this.actionsMatching=[];this.listeners=[];this.version="0.1.2";this.mapArray=function(e,t){if(typeof Array.prototype.map==="function")return Array.prototype.map.call(e,t);return function(e,t){var n=new Array(this.length);for(var r=0,i=this.length;r<i;r++){if(r in this)n[r]=e.call(t,this[r],r,this)}return n}.call(e,t)};this.on=function(e,n){var r=typeof e==="string"?e.split():e;this.mapArray(r,function(e){t.listeners.push({event:e,handler:n})});return this};this.add=function(e,n){var r=function(){var r=t.action&&e instanceof RegExp&&t.action.match(e);if(r||e===t.action){t._trigger("match",t.value,t.action);t.actionsMatching.push({name:e,handler:n});n.call(t,t.value,t.action)}return t};return r().on(["ready","hashchange"],r)};this._trigger=function(e){var n=Array.prototype.slice.call(arguments,1);this.mapArray(this.listeners,function(r){if(r.event==e)r.handler.apply(t,n)});return this};this.getAnchor=function(){return window.location.hash?window.location.hash.split("#")[1]:""};this.setAnchor=function(e){window.location.hash=!e?"":e;return this};this.clearAnchor=function(){return this.setAnchor(false)};this.parse=function(){var e,t;if(this.getAnchor().match(this.hook)){t=this.getAnchor().split(this.hook)[1];e=this.getAnchor().split(this.hook)[0]}return{value:t,action:e}};this.matches=function(){var e=[];this.mapArray(this.actionsMatching,function(n){var r=n.name instanceof RegExp&&t.action.match(n.name);if(r||n.name===t.action){e.push(n)}});return e};this.on(["ready","hashchange"],function(){this.action=this.parse().action;this.value=this.parse().value;this.actionsMatching=[]});if(typeof window.onhashchange==="function")this.on("hashchange",window.onhashchange);window.onhashchange=function(){t._trigger("hashchange")};return this._trigger("ready")}