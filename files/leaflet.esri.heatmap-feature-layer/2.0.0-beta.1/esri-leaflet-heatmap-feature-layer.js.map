{"version":3,"file":"esri-leaflet-heatmap-feature-layer.js","sources":["src/HeatmapFeatureLayer.js"],"names":["exports","VERSION","HeatmapFeatureLayer","esri_leaflet","FeatureManager","extend","initialize","options","prototype","call","this","L","setOptions","_cache","_active","heat","window","heatLayer","onAdd","map","_map","addLayer","onRemove","removeLayer","createLayers","features","i","length","geojson","id","latlng","LatLng","geometry","coordinates","timeField","_featureWithinTimeRange","_latlngs","push","redraw","addLayers","ids","removeLayers","permanent","newLatLngs","setLatLngs","heatmapFeatureLayer","_HeatmapFeatureLayer"],"mappings":"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","sourcesContent":["export var VERSION = '2.0.0-beta.1';\n\nimport L from 'leaflet';\nimport { FeatureManager } from 'esri-leaflet';\n\nexport var HeatmapFeatureLayer = FeatureManager.extend({\n  /**\n   * Constructor\n   */\n\n  initialize: function (options) {\n    FeatureManager.prototype.initialize.call(this, options);\n\n    options = L.setOptions(this, options);\n\n    this._cache = {};\n    this._active = {};\n\n    this.heat = window.L.heatLayer([], options);\n  },\n\n  /**\n   * Layer Interface\n   */\n\n  onAdd: function (map) {\n    FeatureManager.prototype.onAdd.call(this, map);\n    this._map.addLayer(this.heat);\n  },\n\n  onRemove: function (map) {\n    FeatureManager.prototype.onRemove.call(this, map);\n    this._map.removeLayer(this.heat);\n  },\n\n  /**\n   * Feature Managment Methods\n   */\n\n  createLayers: function (features) {\n    for (var i = features.length - 1; i >= 0; i--) {\n      var geojson = features[i];\n      var id = geojson.id;\n      var latlng = new L.LatLng(geojson.geometry.coordinates[1], geojson.geometry.coordinates[0]);\n      this._cache[id] = latlng;\n\n      // add the layer if it is within the time bounds or our layer is not time enabled\n      if (!this._active[id] && (!this.options.timeField || (this.options.timeField && this._featureWithinTimeRange(geojson)))) {\n        this._active[id] = latlng;\n        this.heat._latlngs.push(latlng);\n      }\n    }\n\n    this.heat.redraw();\n  },\n\n  addLayers: function (ids) {\n    for (var i = ids.length - 1; i >= 0; i--) {\n      var id = ids[i];\n      if (!this._active[id]) {\n        var latlng = this._cache[id];\n        this.heat._latlngs.push(latlng);\n        this._active[id] = latlng;\n      }\n    }\n    this.heat.redraw();\n  },\n\n  removeLayers: function (ids, permanent) {\n    var newLatLngs = [];\n    for (var i = ids.length - 1; i >= 0; i--) {\n      var id = ids[i];\n      if (this._active[id]) {\n        delete this._active[id];\n      }\n      if (this._cache[id] && permanent) {\n        delete this._cache[id];\n      }\n    }\n\n    for (var latlng in this._active) {\n      newLatLngs.push(this._active[latlng]);\n    }\n\n    this.heat.setLatLngs(newLatLngs);\n  }\n\n});\n\nexport function heatmapFeatureLayer (options) {\n  return new HeatmapFeatureLayer(options);\n}\n\nexport default heatmapFeatureLayer;\n"]}