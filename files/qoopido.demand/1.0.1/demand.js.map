{"version":3,"sources":["demand.js"],"names":["global","demand","dependency","self","this","module","isInstanceOf","Module","dependencies","arrayPrototypeSlice","call","arguments","forEach","index","resolved","resolve","path","handler","pointer","modules","Loader","pledge","Pledge","all","provide","definition","loader","isTypeOf","STRING_STRING","queue","current","Error","setTimeout","defered","log","cached","store","then","apply","reject","length","next","when","configure","aConfig","key","aCache","cache","aDebug","debug","aVersion","version","aTimeout","timeout","aLifetime","lifetime","aBase","base","aPattern","pattern","aProbes","probes","STRING_BOOLEAN","isPositiveInteger","timeoutXhr","Math","min","max","timeoutQueue","Pattern","url","isObject","addHandler","aType","aSuffix","aHandler","suffix","modify","assign","id","factory","aMessage","type","console","STRING_UNDEFINED","toString","regex","expression","modifier","RegExp","escape","aValue","replace","regexMatchSpecial","removeProtocol","regexMatchProtocol","isAbsolute","aPath","regexIsAbsolute","test","object","value","isFinite","floor","executor","handle","PLEDGE_RESOLVED","PLEDGE_REJECTED","aState","aParameter","state","PLEDGE_PENDING","listener","rejected","aResolved","aRejected","push","aModule","aStack","message","stack","aUrl","specificity","regexPattern","regexUrl","Queue","aParent","xhr","defer","retrieve","add","regexMatchUrl","XHR","XDR","onprogress","ontimeout","onerror","onabort","onload","source","responseText","open","send","readyState","abort","aDefinition","aDependencies","regexMatchLsState","storage","JavascriptHandler","CssHandler","document","Array","prototype","slice","arrayPrototypeConcat","concat","target","getElementsByTagName","resolver","createElement","localStorage","DEMAND_PREFIX","DEMAND_SUFFIX_STATE","DEMAND_SUFFIX_VALUE","XMLHttpRequest","XDomainRequest","regexMatchHandler","regexMatchSourcemap","regexMatchCssUrl","hasRemainingSpace","defaults","main","settings","href","match","isLoader","matches","process","get","JSON","parse","getItem","expires","Date","getTime","clear","set","spaceBefore","remainingSpace","setItem","stringify","error","removeItem","indexOf","script","async","text","setAttribute","appendChild","replacement","exec","style","sheet","styleSheet","media","cssText","innerHTML","constructor","aResolve","aReject","aPledges","countTotal","countResolved","aPledge","aIndex","race","result","traverse","depth","indention","join","item","remove","aItem","shift","probe","isPending"],"mappings":"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","file":"demand.js","sourcesContent":["/**\n * Qoopido demand\n *\n * Promise like module loader (XHR) with localStorage caching\n *\n * Copyright (c) 2015 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n *\n * @requires XMLHttpRequest, XDomainRequest, JSON.parse, JSON.stringify, Array.forEach\n */\n\n;(function(global) {\n\t'use strict';\n\n\tvar // shortcuts\n\t\t\tdocument              = global.document,\n\t\t\tsetTimeout            = global.setTimeout,\n\t\t\tarrayPrototypeSlice   = Array.prototype.slice,\n\t\t\tarrayPrototypeConcat  = Array.prototype.concat,\n\t\t\ttarget                = document.getElementsByTagName('head')[0],\n\t\t\tresolver              = document.createElement('a'),\n\t\t\tlocalStorage          = global.localStorage,\n\t\t// constants\n\t\t\tDEMAND_PREFIX         = '[demand]',\n\t\t\tDEMAND_SUFFIX_STATE   = '[state]',\n\t\t\tDEMAND_SUFFIX_VALUE   = '[value]',\n\t\t\tSTRING_UNDEFINED      = 'undefined',\n\t\t\tSTRING_STRING         = 'string',\n\t\t\tSTRING_BOOLEAN        = 'boolean',\n\t\t\tPLEDGE_PENDING        = 'pending',\n\t\t\tPLEDGE_RESOLVED       = 'resolved',\n\t\t\tPLEDGE_REJECTED       = 'rejected',\n\t\t\tXHR                   = global.XMLHttpRequest,\n\t\t\tXDR                   = 'XDomainRequest' in global && global.XDomainRequest || XHR,\n\t\t// regular expressions\n\t\t\tregexIsAbsolute       = /^\\//i,\n\t\t\tregexMatchHandler     = /^([-\\w]+\\/[-\\w]+)!/,\n\t\t\tregexMatchSpecial     = /[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g,\n\t\t\tregexMatchSourcemap   = /\\/\\/#\\s+sourceMappingURL\\s*=\\s*(.+?)\\.map/g,\n\t\t\tregexMatchCssUrl      = /url\\(\\s*(?:\"|'|)(?!data:|http:|https:|\\/)(.+?)(?:\"|'|)\\)/g,\n\t\t\tregexMatchProtocol    = /^http(s?):/,\n\t\t\tregexMatchUrl, regexMatchLsState,\n\t\t// flags\n\t\t\thasRemainingSpace     = localStorage && 'remainingSpace' in localStorage,\n\t\t// general storage & objects\n\t\t\tdefaults              = { cache: true, debug: false, version: '1.0.0', lifetime: 0, timeout: 5, base: '/' },\n\t\t\tmain                  = global.demand.main,\n\t\t\tsettings              = global.demand.settings,\n\t\t\tmodules               = {},\n\t\t\tpattern               = {},\n\t\t\tprobes                = {},\n\t\t\thandler               = {},\n\t\t\tqueue, resolve, storage,\n\t\t// handler\n\t\t\tJavascriptHandler, CssHandler,\n\t\t// configuration\n\t\t\tbase, cache, debug, timeoutXhr, timeoutQueue, version, lifetime;\n\n\t/**\n\t * demand required modules\n\t *\n\t * Will take any number of string arguments and return a Pledge.all\n\t * that resolves when all dependencies are resolved and rejects when\n\t * at least one dependency is rejected. Both, the resolved and\n\t * rejected callbacks will get all dependencies resolved or rejected\n\t * as arguments.\n\t *\n\t * If the scope of the call is of type \"Module\" relative paths are\n\t * resolved in relation to the parent module.\n\t *\n\t * @param {...String} dependency\n\t *\n\t * @exports /demand\n\t */\n\tfunction demand(dependency) {\n\t\tvar self         = this || {},\n\t\t\tmodule       = isInstanceOf(self, Module) ? self : null,\n\t\t\tdependencies = arrayPrototypeSlice.call(arguments);\n\n\t\tdependencies.forEach(\n\t\t\tfunction(dependency, index) {\n\t\t\t\tvar resolved = resolve.path(dependency, module),\n\t\t\t\t\thandler  = resolved.handler,\n\t\t\t\t\tpath     = resolved.path,\n\t\t\t\t\tpointer  = modules[handler] || (modules[handler] = {});\n\n\t\t\t\tthis[index] = pointer[path] || (pointer[path] = (new Loader(dependency, module)).pledge);\n\t\t\t},\n\t\t\tdependencies);\n\n\t\treturn Pledge.all(dependencies);\n\t}\n\n\t/**\n\t * provide modules\n\t *\n\t * Will either take two arguments, a \"path\" as a string first\n\t * and a \"definition\" function second or only a \"definition\"\n\t * function in case of an anonymous provide from a loaded module.\n\t *\n\t * In case of an anonymous provide it will be matched against\n\t * the queue to find the loader being resolved by this provide.\n\t * In case there is no loader in queue an error is thrown.\n\t *\n\t * When provide detects a duplicate a warning will be logged to\n\t * console in case the \"debug\" configuration option is set to true.\n\t *\n\t * @param {String} [path]\n\t * @param {Function} definition\n\t *\n\t * @exports /provide\n\t */\n\tfunction provide(path, definition) {\n\t\tvar loader, dependencies;\n\n\t\tpath         = (isTypeOf(arguments[0], STRING_STRING) && arguments[0]) || null;\n\t\tdefinition   = !path ? arguments[0] : arguments[1];\n\n\t\tif(!path && queue.current) {\n\t\t\tloader = queue.current;\n\t\t\tpath   = loader.handler + '!' + loader.path;\n\t\t}\n\n\t\tif(path) {\n\t\t\t// delay execution to be able to wait for \"when\" call\n\t\t\tsetTimeout(function() {\n\t\t\t\tvar resolved = resolve.path(path),\n\t\t\t\t\tpointer  = modules[resolved.handler],\n\t\t\t\t\tmodule, pledge, defered;\n\n\t\t\t\tif(!loader && pointer[resolved.path]) {\n\t\t\t\t\tlog('duplicate found for module ' + resolved.path);\n\t\t\t\t} else {\n\t\t\t\t\tmodule = new Module(path, definition, dependencies || []);\n\t\t\t\t\tpledge = modules[module.handler][module.path] = module.pledge;\n\n\t\t\t\t\tif(loader) {\n\t\t\t\t\t\t!loader.cached && loader.store();\n\n\t\t\t\t\t\tdefered = loader.defered;\n\n\t\t\t\t\t\tpledge.then(\n\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\tdefered.resolve.apply(null, arguments);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\tdefered.reject(new Error('unable to resolve module', path, arguments));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tqueue.length > 0 && queue.next();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthrow new Error('unspecified anonymous provide');\n\t\t}\n\n\t\t// provide an Object with a \"when\" method to attach dependencies\n\t\treturn { when: function() { dependencies = arrayPrototypeSlice.call(arguments); } };\n\t}\n\n\t/**\n\t * alter demand configuration\n\t *\n\t * @param {Object} aConfig\n\t */\n\tfunction configure(aConfig) {\n\t\tvar aCache    = aConfig.cache,\n\t\t\taDebug    = aConfig.debug,\n\t\t\taVersion  = aConfig.version,\n\t\t\taTimeout  = aConfig.timeout,\n\t\t\taLifetime = aConfig.lifetime,\n\t\t\taBase     = aConfig.base,\n\t\t\taPattern  = aConfig.pattern,\n\t\t\taProbes   = aConfig.probes,\n\t\t\tkey;\n\t\t\t\t\n\t\tcache   = isTypeOf(aCache, STRING_BOOLEAN)  ? aCache   : cache;\n\t\tdebug   = isTypeOf(aDebug, STRING_BOOLEAN)  ? aDebug   : debug;\n\t\tversion = isTypeOf(aVersion, STRING_STRING) ? aVersion : version;\n\n\t\tif(isPositiveInteger(aTimeout)) {\n\t\t\ttimeoutXhr   = Math.min(Math.max(aTimeout, 2), 10) * 1000;\n\t\t\ttimeoutQueue = Math.min(Math.max(timeoutXhr / 5, 1000), 5000);\n\t\t}\n\t\t\t\t\n\t\tif(isPositiveInteger(aLifetime)) {\n\t\t\tlifetime = aLifetime * 1000;\n\t\t}\n\t\t\t\t\n\t\tif(isTypeOf(aBase, STRING_STRING)) {\n\t\t\tbase = pattern.base = new Pattern('', resolve.url(aBase));\n\t\t}\n\t\t\t\t\n\t\tif(isObject(aPattern)) {\n\t\t\tfor(key in aPattern) {\n\t\t\t\tkey !== 'base' && (pattern[key] = new Pattern(key, aPattern[key]));\n\t\t\t}\n\t\t}\n\t\t\t\t\n\t\tif(isObject(aProbes)) {\n\t\t\tfor(key in aProbes) {\n\t\t\t\tprobes[key] = aProbes[key];\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * add handler for mimetype\n\t *\n\t * @param {String} aType\n\t * @param {String} aSuffix\n\t * @param {Object} aHandler\n\t */\n\tfunction addHandler(aType, aSuffix, aHandler) {\n\t\tif(!handler[aType]) {\n\t\t\thandler[aType] = { suffix: aSuffix, resolve: aHandler.resolve, modify: aHandler.modify };\n\n\t\t\tmodules[aType] = {};\n\t\t}\n\t}\n\n\t/**\n\t * Shortcut to globally provide internal functions\n\t *\n\t * @param {String} id\n\t * @param {Function} factory\n\t */\n\tfunction assign(id, factory) {\n\t\tprovide(id, function() { return factory; });\n\t}\n\n\t/**\n\t * log a message to the console\n\t *\n\t * @param {String|Error} aMessage\n\t */\n\tfunction log(aMessage) {\n\t\tvar type = (isInstanceOf(aMessage, Error)) ? 'error' : 'warn';\n\n\t\tif(!isTypeOf(console, STRING_UNDEFINED) && (debug || type !== 'warn')) {\n\t\t\tconsole[type](aMessage.toString());\n\t\t}\n\t}\n\n\t/**\n\t * generate a new RegExp\n\t *\n\t * @param {String} expression\n\t * @param {{String}} [modifier]\n\t *\n\t * @returns {RegExp}\n\t */\n\tfunction regex(expression, modifier) {\n\t\treturn new RegExp(expression, modifier);\n\t}\n\n\t/**\n\t * escape a string to be used in a RegExp\n\t *\n\t * @param {String} aValue\n\t *\n\t * @returns {String}\n\t */\n\tfunction escape(aValue) {\n\t\treturn aValue.replace(regexMatchSpecial, '\\\\$&');\n\t}\n\n\t/**\n\t * remove the protocol portion from any URL\n\t *\n\t * @param {String} url\n\t *\n\t * @returns {String}\n\t */\n\tfunction removeProtocol(url) {\n\t\treturn url.replace(regexMatchProtocol, '');\n\t}\n\n\t/**\n\t * check whether a given path is absolute\n\t *\n\t * @param {String} aPath\n\t *\n\t * @returns {Boolean}\n\t */\n\tfunction isAbsolute(aPath) {\n\t\treturn regexIsAbsolute.test(aPath);\n\t}\n\n\t/**\n\t * check whether a passed object is an instance of a certain type\n\t *\n\t * @param {*} object\n\t * @param {*} module\n\t *\n\t * @returns {Boolean}\n\t *\n\t * @exports /validator/isInstanceOf\n\t */\n\tfunction isInstanceOf(object, module) {\n\t\treturn object instanceof module;\n\t}\n\t\t\t\n\t/**\n\t * check wheter a given object is of a certain type\n\t *\n\t * @param {*} object\n\t * @param {String} type\n\t *\n\t * @returns {Boolean}\n\t *\n\t * @exports /validator/isTypeOf\n\t */\n\tfunction isTypeOf(object, type) {\n\t\treturn typeof object === type;\n\t}\n\n\t/**\n\t * check whether a given object is an object\n\t *\n\t * @param {*} object\n\t *\n\t * @returns {Boolean}\n\t *\n\t * @exports /validator/isObject\n\t */\n\tfunction isObject(object) {\n\t\treturn object && isTypeOf(object, 'object');\n\t}\n\n\t/**\n\t * check whether a given value is a positive integer\n\t *\n\t * @param {*} value\n\t *\n\t * @returns {Boolean}\n\t *\n\t * @exports /validator/isPositiveInteger\n\t */\n\tfunction isPositiveInteger(value) {\n\t\treturn isTypeOf(value, 'number') && isFinite(value) && Math.floor(value) === value && value >= 0;\n\t}\n\n\tresolve = {\n\t\t/**\n\t\t * resolve any given url\n\t\t *\n\t\t * @param {String} aUrl\n\t\t *\n\t\t * @returns {String}\n\t\t */\n\t\turl: function(aUrl) {\n\t\t\tresolver.href = aUrl;\n\n\t\t\treturn resolver.href;\n\t\t},\n\t\t/**\n\t\t * resolve any given path\n\t\t *\n\t\t * if context is either \"Loader\" or \"Module\" nothing will\n\t\t * be returned but instead \"handler\" and \"path\" will be\n\t\t * set directly on context. In case of \"Loader\" an\n\t\t * additional property \"url\" will be set as well.\n\t\t *\n\t\t * @param {String} aPath\n\t\t * @param {Module} [aParent]\n\t\t *\n\t\t * @returns {void|{handler: string, path: string}}\n\t\t */\n\t\tpath: function(aPath, aParent) {\n\t\t\tvar self     = this,\n\t\t\t\tpointer  = aPath.match(regexMatchHandler) || 'application/javascript',\n\t\t\t\tisLoader = isInstanceOf(self, Loader),\n\t\t\t\tkey, match;\n\t\t\t\t\t\t\n\t\t\tif(!isTypeOf(pointer, STRING_STRING)) {\n\t\t\t\taPath   = aPath.replace(regex('^' + escape(pointer[0])), '');\n\t\t\t\t\t\t\n\t\t\t\tpointer = pointer[1];\n\t\t\t}\n\n\t\t\tif(!isAbsolute(aPath)) {\n\t\t\t\taPath = '/' + resolve.url(((aParent && aParent.path && resolve.url(aParent.path + '/../')) || '/') + aPath).replace(regexMatchUrl, '');\n\t\t\t}\n\t\t\t\t\t\n\t\t\tfor(key in pattern) {\n\t\t\t\tpattern[key].matches(aPath) && (!match || match.specificity < pattern[key].specificity) && (match = pattern[key]);\n\t\t\t}\n\t\t\t\t\t\n\t\t\tif(isLoader || isInstanceOf(self, Module)) {\n\t\t\t\tself.handler = pointer;\n\t\t\t\tself.path    = aPath;\n\t\t\t\t\t\t\n\t\t\t\tisLoader && (self.url = removeProtocol(resolve.url(match.process(aPath))));\n\t\t\t} else {\n\t\t\t\treturn { handler: pointer, path: aPath };\n\t\t\t}\n\t\t}\n\t};\n\n\tstorage = {\n\t\t/**\n\t\t * retrieve cache for a given path and URL\n\t\t *\n\t\t * @param {String} aPath\n\t\t * @param {String} aUrl\n\t\t *\n\t\t * @returns {void|String}\n\t\t */\n\t\tget: function(aPath, aUrl) {\n\t\t\tvar id, state;\n\n\t\t\tif(localStorage && cache) {\n\t\t\t\tid    = DEMAND_PREFIX + '[' + aPath + ']';\n\t\t\t\tstate = JSON.parse(localStorage.getItem(id + DEMAND_SUFFIX_STATE));\n\n\t\t\t\tif(state && state.version === version && state.url === aUrl && (state.expires === 0 || state.expires > new Date().getTime())) {\n\t\t\t\t\treturn localStorage.getItem(id + DEMAND_SUFFIX_VALUE);\n\t\t\t\t} else {\n\t\t\t\t\tstorage.clear(aPath);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * store cache for a given path, value and url\n\t\t *\n\t\t * @param {String} aPath\n\t\t * @param {String} aValue\n\t\t * @param {String} aUrl\n\t\t */\n\t\tset: function(aPath, aValue, aUrl) {\n\t\t\tvar id, spaceBefore;\n\n\t\t\tif(localStorage && cache) {\n\t\t\t\tid = DEMAND_PREFIX + '[' + aPath + ']';\n\n\t\t\t\ttry {\n\t\t\t\t\tspaceBefore = hasRemainingSpace ? localStorage.remainingSpace : null;\n\n\t\t\t\t\tlocalStorage.setItem(id + DEMAND_SUFFIX_VALUE, aValue);\n\t\t\t\t\tlocalStorage.setItem(id + DEMAND_SUFFIX_STATE, JSON.stringify({ version: version, expires: lifetime > 0 ? new Date().getTime() + lifetime : 0, url: aUrl }));\n\n\t\t\t\t\t// strict equality check with \"===\" is required due to spaceBefore might be \"0\"\n\t\t\t\t\tif(spaceBefore !== null && localStorage.remainingSpace === spaceBefore) {\n\t\t\t\t\t\tthrow 'QuotaExceedError';\n\t\t\t\t\t}\n\t\t\t\t} catch(error) {\n\t\t\t\t\tlog('unable to cache module ' + aPath);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * clear either a given path, all cached resources or only expired resources\n\t\t *\n\t\t * @param {String|Boolean} [aPath]\n\t\t */\n\t\tclear: function(aPath) {\n\t\t\tvar id, key, match, state;\n\n\t\t\tif(localStorage) {\n\t\t\t\tswitch(typeof aPath) {\n\t\t\t\t\t// handle if aPath is of type \"string\" => clear specific\n\t\t\t\t\tcase STRING_STRING:\n\t\t\t\t\t\tid = DEMAND_PREFIX + '[' + aPath + ']';\n\n\t\t\t\t\t\tlocalStorage.removeItem(id + DEMAND_SUFFIX_STATE);\n\t\t\t\t\t\tlocalStorage.removeItem(id + DEMAND_SUFFIX_VALUE);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t// handle if aPath is of type \"boolean\" and is truthy => clear expired\n\t\t\t\t\tcase STRING_BOOLEAN:\n\t\t\t\t\t\tif(aPath) {\n\t\t\t\t\t\t\tfor(key in localStorage) {\n\t\t\t\t\t\t\t\tmatch = key.match(regexMatchLsState);\n\n\t\t\t\t\t\t\t\tif(match) {\n\t\t\t\t\t\t\t\t\tstate = JSON.parse(localStorage.getItem(DEMAND_PREFIX + '[' + match[1] + ']' + DEMAND_SUFFIX_STATE));\n\n\t\t\t\t\t\t\t\t\tif(state && state.expires > 0 && state.expires <= new Date().getTime()) {\n\t\t\t\t\t\t\t\t\t\tstorage.clear(match[1]);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t// handle if aPath is of type \"undefined\" => clear all\n\t\t\t\t\tcase STRING_UNDEFINED:\n\t\t\t\t\t\tfor(key in localStorage) {\n\t\t\t\t\t\t\tkey.indexOf(DEMAND_PREFIX) === 0 && (localStorage.removeItem(key));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tJavascriptHandler = {\n\t\t/**\n\t\t * handles resolving of JavaScript modules\n\t\t *\n\t\t * @param {String} aPath\n\t\t * @param {String} aValue\n\t\t */\n\t\tresolve: function(aPath, aValue) {\n\t\t\tvar script = document.createElement('script');\n\n\t\t\tscript.type  = 'application/javascript';\n\t\t\tscript.defer = script.async = true;\n\t\t\tscript.text  = aValue;\n\n\t\t\tscript.setAttribute('demand-path', aPath);\n\n\t\t\ttarget.appendChild(script);\n\t\t},\n\t\t/**\n\t\t * handles modifying of JavaScript module's source prior to caching\n\t\t *\n\t\t * Rewrites sourcemap URL to an absolute URL in relation to the URL the module was loaded from\n\t\t *\n\t\t * @param {String} aUrl\n\t\t * @param {String} aValue\n\t\t *\n\t\t * @returns {String}\n\t\t */\n\t\tmodify: function(aUrl, aValue) {\n\t\t\tvar match, replacement;\n\n\t\t\twhile(match = regexMatchSourcemap.exec(aValue)) {\n\t\t\t\treplacement = removeProtocol(resolve.url(aUrl + '/../' + match[1]));\n\t\t\t\taValue      = aValue.replace(match[0], '//# sourcemap=' + replacement + '.map');\n\t\t\t}\n\n\t\t\treturn aValue;\n\t\t}\n\t};\n\n\tCssHandler = {\n\t\t/**\n\t\t * handles resolving of CSS modules\n\t\t *\n\t\t * @param {String} aPath\n\t\t * @param {String} aValue\n\t\t */\n\t\tresolve: function(aPath, aValue) {\n\t\t\tvar style = document.createElement('style'),\n\t\t\t\tsheet = style.styleSheet;\n\n\t\t\tstyle.type  = 'text/css';\n\t\t\tstyle.media = 'only x';\n\t\t\t(sheet && (sheet.cssText = aValue)) || (style.innerHTML = aValue);\n\n\t\t\tstyle.setAttribute('demand-path', aPath);\n\n\t\t\ttarget.appendChild(style);\n\n\t\t\tsetTimeout(function() {\n\t\t\t\tprovide(function() { return style; });\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * handles modifying of CSS module's source prior to caching\n\t\t *\n\t\t * Rewrites relative CSS URLs to an absolute URL in relation to the URL the module was loaded from\n\t\t *\n\t\t * @param {String} aUrl\n\t\t * @param {String} aValue\n\t\t *\n\t\t * @returns {String}\n\t\t */\n\t\tmodify: function(aUrl, aValue) {\n\t\t\tvar base = resolve.url(aUrl + '/..'),\n\t\t\t\tmatch;\n\n\t\t\twhile((match = regexMatchCssUrl.exec(aValue))) {\n\t\t\t\taValue = aValue.replace(match[0], 'url(' + resolve.url(base + match[1]) + ')');\n\t\t\t}\n\n\t\t\treturn aValue;\n\t\t}\n\t};\n\n\t/**\n\t * provides promise like behaviour\n\t *\n\t * unlike native Promises and polyfills a Pledge\n\t * can be resolved and rejected with multiple values\n\t * which will all get applied\n\t *\n\t * @param {Function} executor\n\t *\n\t * @constructor\n\t * @exports /pledge\n\t */\n\tfunction Pledge(executor) {\n\t\tvar self     = this,\n\t\t\tlistener = { resolved: [], rejected: [] };\n\n\t\tfunction resolve() {\n\t\t\thandle(PLEDGE_RESOLVED, arguments);\n\t\t}\n\n\t\tfunction reject() {\n\t\t\thandle(PLEDGE_REJECTED, arguments);\n\t\t}\n\n\t\tfunction handle(aState, aParameter) {\n\t\t\tif(self.state === PLEDGE_PENDING) {\n\t\t\t\tself.state = aState;\n\t\t\t\tself.value = aParameter;\n\n\t\t\t\tlistener[aState].forEach(function(aHandler) {\n\t\t\t\t\taHandler.apply(null, self.value);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tself.then = function(aResolved, aRejected) {\n\t\t\tif(self.state === PLEDGE_PENDING) {\n\t\t\t\taResolved && listener[PLEDGE_RESOLVED].push(aResolved);\n\t\t\t\taRejected && listener[PLEDGE_REJECTED].push(aRejected);\n\t\t\t} else {\n\t\t\t\tswitch(self.state) {\n\t\t\t\t\tcase PLEDGE_RESOLVED:\n\t\t\t\t\t\taResolved.apply(null, self.value);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PLEDGE_REJECTED:\n\t\t\t\t\t\taRejected.apply(null, self.value);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\texecutor(resolve, reject);\n\t}\n\n\tPledge.prototype = {\n\t\tconstructor: Pledge,\n\t\tstate:       PLEDGE_PENDING,\n\t\tvalue:       null,\n\t\tlistener:    null,\n\t\tthen:        null\n\t};\n\n\t/**\n\t * provides Promise.defer like behaviour\n\t *\n\t * @returns {Object}\n\t */\n\tPledge.defer = function() {\n\t\tvar self = {};\n\n\t\tself.pledge = new Pledge(function(aResolve, aReject) {\n\t\t\tself.resolve = aResolve;\n\t\t\tself.reject  = aReject;\n\t\t});\n\n\t\treturn self;\n\t};\n\n\t/**\n\t * provides Promise.all like behaviour\n\t *\n\t * unlike native Promise.all Pledge.all will not reject on the\n\t * first rejected Pledge but when all Pledges ere either\n\t * resolved or rejected. Rejection callbacks will get passed\n\t * all rejected reasons, not only the first one.\n\t *\n\t * @param {Object[]} aPledges\n\t *\n\t * @returns {Pledge}\n\t */\n\tPledge.all = function(aPledges) {\n\t\tvar defered       = Pledge.defer(),\n\t\t\tpledge        = defered.pledge,\n\t\t\tresolved      = [],\n\t\t\trejected      = [],\n\t\t\tcountTotal    = aPledges.length,\n\t\t\tcountResolved = 0;\n\n\t\taPledges.forEach(function(aPledge, aIndex) {\n\t\t\taPledge.then(\n\t\t\t\tfunction() {\n\t\t\t\t\tresolved[aIndex] = arrayPrototypeSlice.call(arguments);\n\n\t\t\t\t\tcountResolved++;\n\n\t\t\t\t\tcountResolved === countTotal && defered.resolve.apply(null, arrayPrototypeConcat.apply([], resolved));\n\t\t\t\t},\n\t\t\t\tfunction() {\n\t\t\t\t\trejected.push(arrayPrototypeSlice.call(arguments));\n\n\t\t\t\t\trejected.length + countResolved === countTotal && defered.reject.apply(null, arrayPrototypeConcat.apply([], rejected));\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\n\t\treturn pledge;\n\t};\n\n\t/**\n\t * provides Promise.race like behaviour\n\t *\n\t * @param {Object[]} aPledges\n\t *\n\t * @returns {Pledge}\n\t */\n\tPledge.race = function(aPledges) {\n\t\tvar defered = Pledge.defer();\n\n\t\taPledges.forEach(function(aPledge) {\n\t\t\taPledge.then(\n\t\t\t\tdefered.resolve,\n\t\t\t\tdefered.reject\n\t\t\t);\n\t\t});\n\n\t\treturn defered.pledge;\n\t};\n\n\t/**\n\t * internal error class\n\t *\n\t * @param {String} aMessage\n\t * @param {String} [aModule]\n\t * @param {Object[]} [aStack]\n\t *\n\t * @constructor\n\t */\n\tfunction Error(aMessage, aModule, aStack) {\n\t\tvar self = this;\n\n\t\tself.message = aMessage;\n\t\tself.module  = aModule;\n\n\t\taStack && (self.stack = arrayPrototypeSlice.call(aStack));\n\t}\n\n\tError.prototype = {\n\t\tmessage: null,\n\t\tmodule:  null,\n\t\tstack:   null,\n\t\t/**\n\t\t * handles output to console\n\t\t *\n\t\t * @returns {String}\n\t\t */\n\t\ttoString: function() {\n\t\t\tvar self   = this,\n\t\t\t\tresult = DEMAND_PREFIX + ' ' + self.message + ' ' + self.module;\n\n\t\t\tif(self.stack) {\n\t\t\t\tresult = Error.traverse(self.stack, result, 1);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\t};\n\n\t/**\n\t * handles recursion of stack on output to console\n\t *\n\t * @param {Object[]} stack\n\t * @param {String} value\n\t * @param {Number} depth\n\t *\n\t * @returns {String}\n\t */\n\tError.traverse = function(stack, value, depth) {\n\t\tvar indention = new Array(depth + 1).join(' ');\n\n\t\tstack.forEach(function(item) {\n\t\t\tvalue += '\\n' + indention + '> ' + item.message + ' ' + item.module;\n\n\t\t\tif(item.stack) {\n\t\t\t\tvalue = Error.traverse(item.stack, value, depth + 1);\n\t\t\t}\n\t\t});\n\n\t\treturn value;\n\t};\n\n\t/**\n\t * abstraction for pattern matching of paths\n\t *\n\t * @param {String} aPattern\n\t * @param {String} aUrl\n\t *\n\t * @constructor\n\t */\n\tfunction Pattern(aPattern, aUrl) {\n\t\tvar self = this;\n\n\t\tself.specificity  = aPattern.length;\n\t\tself.url          = resolve.url(aUrl);\n\t\tself.regexPattern = regex('^' + escape(aPattern));\n\t\tself.regexUrl     = regex('^' + escape(aUrl));\n\t}\n\n\tPattern.prototype = {\n\t\tspecificity:  0,\n\t\turl:          null,\n\t\tregexPattern: null,\n\t\tregexUrl:     null,\n\t\t/**\n\t\t * check whether a given path matches the pattern\n\t\t *\n\t\t * @param {String} aPath\n\t\t *\n\t\t * @returns {Boolean}\n\t\t */\n\t\tmatches: function(aPath) {\n\t\t\treturn this.regexPattern.test(aPath);\n\t\t},\n\t\t/**\n\t\t * remove this pattern's URL from a given URL\n\t\t *\n\t\t * @param {String} aUrl\n\t\t *\n\t\t * @returns {String}\n\t\t */\n\t\tremove: function(aUrl) {\n\t\t\treturn aUrl.replace(this.regexUrl, '');\n\t\t},\n\t\t/**\n\t\t * process this pattern for a given path\n\t\t *\n\t\t * @param {String} aPath\n\t\t *\n\t\t * @returns {String}\n\t\t */\n\t\tprocess: function(aPath) {\n\t\t\tvar self = this;\n\n\t\t\treturn aPath.replace(self.regexPattern, self.url);\n\t\t}\n\t};\n\n\t/**\n\t * Queue handling for anonymous (loaded) modules\n\t *\n\t * @constructor\n\t */\n\tfunction Queue() {\n\t\tvar self = this;\n\n\t\tself.current = null;\n\t\tself.queue   = [];\n\t}\n\n\tQueue.prototype = {\n\t\tcurrent: null,\n\t\tqueue:   null,\n\t\tlength:  0,\n\t\t/**\n\t\t * add an item to the queue\n\t\t *\n\t\t * @param {Loader} aItem\n\t\t */\n\t\tadd: function(aItem) {\n\t\t\tvar self  = this,\n\t\t\t\tqueue = self.queue;\n\n\t\t\tqueue.push(aItem);\n\n\t\t\tself.length++;\n\n\t\t\tqueue.length === 1 && self.next();\n\t\t},\n\t\t/**\n\t\t * process the queue\n\t\t */\n\t\tnext: function() {\n\t\t\tvar self    = this,\n\t\t\t\tcurrent = self.current,\n\t\t\t\tqueue   = self.queue,\n\t\t\t\tdefered, path, pointer;\n\n\t\t\tif(current) {\n\t\t\t\tself.current = null;\n\n\t\t\t\tqueue.shift();\n\t\t\t\tself.length--;\n\t\t\t}\n\n\t\t\tif(queue.length) {\n\t\t\t\tcurrent = self.current = self.queue[0];\n\t\t\t\tdefered = current.defered;\n\t\t\t\tpath    = current.path;\n\t\t\t\tpointer = handler[current.handler];\n\n\t\t\t\t!current.cached && pointer.modify && (current.source = pointer.modify(current.url, current.source));\n\n\t\t\t\tpointer.resolve(path, current.source);\n\n\t\t\t\tif(probes[path]) {\n\t\t\t\t\tcurrent.probe();\n\t\t\t\t}\n\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tdefered.reject(new Error('timeout resolving module', path));\n\t\t\t\t}, timeoutQueue);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * module loader\n\t *\n\t * @param {String} aPath\n\t * @param {Module} [aParent]\n\t *\n\t * @constructor\n\t */\n\tfunction Loader(aPath, aParent) {\n\t\tvar self    = this,\n\t\t\tdefered = Pledge.defer(),\n\t\t\txhr, pointer;\n\n\t\tresolve.path.call(self, aPath, aParent);\n\n\t\tself.defered = defered;\n\t\tself.pledge  = defered.pledge;\n\t\tpointer      = handler[self.handler];\n\n\t\tif(!aParent) {\n\t\t\tself.pledge.then(null, log);\n\t\t}\n\n\t\tif(pointer) {\n\t\t\tself.retrieve();\n\n\t\t\tif(self.cached) {\n\t\t\t\tqueue.add(self);\n\t\t\t} else {\n\t\t\t\txhr            = regexMatchUrl.test(self.url) ? new XHR() : new XDR();\n\t\t\t\txhr.onprogress = function() {};\n\t\t\t\txhr.ontimeout  = xhr.onerror = xhr.onabort = function() { defered.reject(new Error('unable to load module', self.path)); };\n\t\t\t\txhr.onload     = function() { self.source = xhr.responseText; queue.add(self);};\n\n\t\t\t\txhr.open('GET', self.url + pointer.suffix, true);\n\t\t\t\txhr.send();\n\n\t\t\t\tsetTimeout(function() { if(xhr.readyState < 4) { xhr.abort(); } }, timeoutXhr);\n\t\t\t}\n\t\t} else {\n\t\t\tdefered.reject(new Error('no handler \"' + self.handler + '\" for', self.path));\n\t\t}\n\t}\n\n\tLoader.prototype = {\n\t\thandler: null,\n\t\tpath:    null,\n\t\turl:     null,\n\t\tdefered: null,\n\t\tpledge:  null,\n\t\tcached:  false,\n\t\tsource:  null,\n\t\t/**\n\t\t * probe for the loading state of an external module\n\t\t */\n\t\tprobe: function() {\n\t\t\tvar self      = this,\n\t\t\t\tpath      = self.path,\n\t\t\t\tisPending = self.pledge.state === PLEDGE_PENDING,\n\t\t\t\tresult;\n\n\t\t\tif(isPending) {\n\t\t\t\tif(result = probes[path]()) {\n\t\t\t\t\tprovide(function() { return result; });\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout(self.probe, 100);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * store loaders result in localStorage\n\t\t */\n\t\tstore: function() {\n\t\t\tvar self = this;\n\n\t\t\tstorage.set(self.path, self.source, self.url);\n\t\t},\n\t\t/**\n\t\t * retrieve cache for loader\n\t\t */\n\t\tretrieve: function() {\n\t\t\tvar self   = this,\n\t\t\t\tcache  = storage.get(self.path, self.url),\n\t\t\t\tcached = self.cached = !!(cache);\n\n\t\t\tcached && (self.source = cache);\n\t\t}\n\t};\n\n\t/**\n\t * module\n\t *\n\t * @param {String} aPath\n\t * @param {Function} aDefinition\n\t * @param {Object[]} aDependencies\n\t *\n\t * @constructor\n\t */\n\tfunction Module(aPath, aDefinition, aDependencies) {\n\t\tvar self    = this,\n\t\t\tdefered = Pledge.defer();\n\n\t\tresolve.path.call(self, aPath);\n\n\t\t(self.pledge = defered.pledge).then(null, function() {\n\t\t\tlog(new Error('unable to resolve module', self.path, arguments));\n\t\t});\n\n\t\tif(aDependencies.length > 0) {\n\t\t\tdemand.apply(self, aDependencies)\n\t\t\t\t.then(\n\t\t\t\t\tfunction() { defered.resolve(aDefinition.apply(null, arguments)); },\n\t\t\t\t\tfunction() { defered.reject(new Error('unable to resolve dependencies for', self.path, arguments)); }\n\t\t\t\t);\n\t\t} else {\n\t\t\tdefered.resolve(aDefinition());\n\t\t}\n\t}\n\n\tModule.prototype = {\n\t\thandler: null,\n\t\tpath:    null,\n\t\tpledge:  null\n\t};\n\n\t// initialization\n\t\t// regex\n\t\t\tregexMatchUrl     = regex('^' + escape(resolve.url('/')));\n\t\t\tregexMatchLsState = regex('^' + escape(DEMAND_PREFIX + '\\[(.+?)\\]' + DEMAND_SUFFIX_STATE + '$'));\n\n\t\t// create queue\n\t\t\tqueue = new Queue();\n\n\t\t// execute localStorage garbage collection\n\t\t\tstorage.clear(true);\n\n\t\t// add default handler\n\t\t\taddHandler('application/javascript', '.js', JavascriptHandler);\n\t\t\taddHandler('text/css', '.css', CssHandler);\n\n\t\t// configure\n\t\t\tconfigure(defaults) && settings && configure(settings);\n\n\t\t// register in global scope\n\t\t\tdemand.configure  = configure;\n\t\t\tdemand.addHandler = addHandler;\n\t\t\tdemand.clear      = storage.clear;\n\t\t\tglobal.demand     = demand;\n\t\t\tglobal.provide    = provide;\n\n\t\t// register modules\n\t\t\tassign('/demand', demand);\n\t\t\tassign('/provide', provide);\n\t\t\tassign('/pledge', Pledge);\n\t\t\tassign('/validator/isTypeOf', isTypeOf);\n\t\t\tassign('/validator/isInstanceOf', isInstanceOf);\n\t\t\tassign('/validator/isObject', isObject);\n\t\t\tassign('/validator/isPositiveInteger', isPositiveInteger);\n\n\t// load main script\n\t\tif(main) {\n\t\t\tdemand(main);\n\t\t}\n}(this));"],"sourceRoot":"/source/"}