{"version":3,"file":"esri-leaflet-related.js","sources":["esri-leaflet-related-src.js"],"names":["Esri","window","L","esri","Tasks","QueryRelated","Task","extend","setters","offset","limit","outFields","objectIds","relationshipId","definitionExpression","precision","featureIds","returnGeometry","returnZ","returnM","token","path","params","outSr","initialize","endpoint","_service","prototype","call","this","simplify","map","factor","mapWidth","Math","abs","getBounds","getWest","getEast","maxAllowableOffset","getSize","y","run","callback","context","request","error","response","result","features","i","relatedRecordGroups","length","k","relatedRecords","push","Util","responseToFeatureCollection","queryRelated"],"mappings":";;;;;;;;AAKA,IAAKA,KACH,GAAIA,MAAOC,OAAOC,EAAEC,IAGtBD,GAAEC,KAAKC,MAAMC,aAAeL,KAAKI,MAAME,KAAKC,QAC1CC,SACEC,OAAU,SACVC,MAAS,QACTC,UAAa,SACbC,UAAa,YACbC,eAAkB,iBAClBC,qBAAwB,uBACxBC,UAAa,oBACbC,WAAc,YACdC,eAAkB,iBAClBC,QAAW,UACXC,QAAW,UACXC,MAAS,SAGXC,KAAM,sBAENC,QACEL,gBAAgB,EAChBM,MAAO,KACPZ,UAAW,IACXO,SAAS,EACTC,SAAS,GAKXK,WAAY,SAASC,GAEfA,EAASC,SACXxB,EAAEC,KAAKC,MAAME,KAAKqB,UAAUH,WAAWI,KAAKC,KAAMJ,EAASC,UAG3DxB,EAAEC,KAAKC,MAAME,KAAKqB,UAAUH,WAAWI,KAAKC,KAAMJ,IAKtDK,SAAU,SAASC,EAAKC,GAEtB,GAAIC,GAAWC,KAAKC,IAAIJ,EAAIK,YAAYC,UAAYN,EAAIK,YAAYE,UAEpE,OADAT,MAAKP,OAAOiB,mBAAsBN,EAAWF,EAAIS,UAAUC,EAAKT,EACzDH,MAGTa,IAAK,SAASC,EAAUC,GACtB,MAAOf,MAAKgB,QAAQ,SAASC,EAAOC,GAKlC,IAAK,GAHDC,IACFC,aAEOC,EAAI,EAAGA,EAAIH,EAASI,oBAAoBC,OAAQF,IACvD,IAAK,GAAIG,GAAI,EAAGA,EAAIN,EAASI,oBAAoBD,GAAGI,eAAeF,OAAQC,IACzEL,EAAOC,SAASM,KAAKR,EAASI,oBAAoBD,GAAGI,eAAeD,GAGxEV,GAASf,KAAKgB,EAASE,EAAQC,GAAY7C,EAAEC,KAAKqD,KAAKC,4BAA4BT,GAAUD,IAC5FH,MAWe,mBAAX3C,SAA0BA,OAAOC,GAAKD,OAAOC,EAAEC,OACxDF,OAAOC,EAAEC,KAAKC,MAAMsD,aAAe,SAASjC,GAC1C,MAAO,IAAIvB,GAAEC,KAAKC,MAAMC,aAAaoB","sourcesContent":["/*! esri-leaflet-related - v1.0.2 - 2015-07-16\n*   Copyright (c) 2015 Environmental Systems Research Institute, Inc.\n*   Apache 2.0 License */\n\n// We do not have an 'Esri' variable e.g loading this file directly from source define 'Esri'\nif (!Esri) {\n  var Esri = window.L.esri;\n}\n\nL.esri.Tasks.QueryRelated = Esri.Tasks.Task.extend({\n  setters: {\n    'offset': 'offset',\n    'limit': 'limit',\n    'outFields': 'fields',\n    'objectIds': 'objectIds',\n    'relationshipId': 'relationshipId',\n    'definitionExpression': 'definitionExpression',\n    'precision': 'geometryPrecision',\n    'featureIds': 'objectIds',\n    'returnGeometry': 'returnGeometry',\n    'returnZ': 'returnZ',\n    'returnM': 'returnM',\n    'token': 'token'\n  },\n\n  path: 'queryRelatedRecords',\n\n  params: {\n    returnGeometry: true,\n    outSr: 4326,\n    outFields: '*',\n    returnZ: true,\n    returnM: false\n  },\n\n  //http://resources.arcgis.com/en/help/arcgis-rest-api/#/Query_Related_Records/02r300000115000000/\n\n  initialize: function(endpoint) {\n    //don't replace parent initialize, either pass FeatureLayer._service or the raw options object\n    if (endpoint._service) {\n      L.esri.Tasks.Task.prototype.initialize.call(this, endpoint._service);\n    }\n    else {\n      L.esri.Tasks.Task.prototype.initialize.call(this, endpoint);\n    }\n\n  },\n\n  simplify: function(map, factor) {\n    //not sure if there's a better way to port L.esri.Tasks.Query.simplify() than just copy/pasting the function\n    var mapWidth = Math.abs(map.getBounds().getWest() - map.getBounds().getEast());\n    this.params.maxAllowableOffset = (mapWidth / map.getSize().y) * factor;\n    return this;\n  },\n\n  run: function(callback, context) {\n    return this.request(function(error, response) {\n      //if more than one objectId is specified, we loop through the features and pass a single collection to the utility method which converts to geoJson\n      var result = {\n        'features': []\n      };\n      for (var i = 0; i < response.relatedRecordGroups.length; i++) {\n        for (var k = 0; k < response.relatedRecordGroups[i].relatedRecords.length; k++) {\n          result.features.push(response.relatedRecordGroups[i].relatedRecords[k]);\n        }\n      }\n      callback.call(context, error, (response && L.esri.Util.responseToFeatureCollection(result)), response);\n    }, context);\n  }\n\n  // no clue why i ever included this originally.  object's hardcoded 'path' property is appended to featureLayer url in Task.Request automatically.\n  // layer: function(layer) {\n  //   this.path = layer + '/queryRelatedRecords';\n  //   return this;\n  // }\n});\n\n// attach to the L.esri global if available\nif (typeof window !== 'undefined' && window.L && window.L.esri) {\n  window.L.esri.Tasks.queryRelated = function(endpoint) {\n    return new L.esri.Tasks.QueryRelated(endpoint);\n  };\n}"]}