/*
    Author : mridul ahuja
    Github : https://github.com/mridah/autocomplete-lite-img
*/

!function(a){function b(){}function c(b,c,d,e,f,g){b.addClass("autocomplete-lite-img-input-node");var i,h=0;i=parseInt(b.css("font-size"))-2+"px",a("#mridautocomplete_css").length||a("body").prepend('<style id="mridautocomplete_css">.mridautocomplete-list::-webkit-scrollbar{width: 12px;}.mridautocomplete-list::-webkit-scrollbar-track{-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);border-radius: 2px;}.mridautocomplete-list::-webkit-scrollbar-thumb{border-radius: 2px;-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5);} </style>');var j=[];if(!Array.isArray(d))return void console.error("Error : autocomplete-lite-img failed to initialize on ["+c+"]. Expected array, "+typeof d+" given");j=j.concat(d);var l=function(a,b){return a=a.toLowerCase(),b=b.toLowerCase(),!!b.includes(a)},m=function(a,b){var c=b.map(function(b,c){return l(a,b)?[b,c]:0});return c.filter(isNaN)},n=function(b,c){var d=b.val().toLowerCase(),h=b.next();h.empty().hide();var j=m(d,c);""!=d&&0!=j.length&&(j.forEach(function(c){var j=a("<div />"),k=!1;if(j.css({margin:"0px","padding-left":parseInt(b.css("padding-left"),10)+parseInt(b.css("border-left-width"),10),"text-align":"left","font-size":b.css("font-size"),cursor:"default"}),j.addClass("mrid-autocomplete-item"),c[0]=c[0].toLowerCase(),c[0].includes(d)){var l=c[0].split(d)[0],m=c[0].split(d).splice(1).join(d);j.attr("_ix",c[1]),j.html('<img src="'+e[c[0]+"#"+c[1]]+'" class="mridautocomplete-item-image" style="height: '+i+"; width: "+i+";\" onerror=\"this.src='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'; this.removeAttribute('onerror'); this.removeAttribute('onload');\" onload=\"this.removeAttribute('onerror'); this.removeAttribute('onload');\">"+l+'<span style="color: #4682B4; font-weight: bold;">'+d+"</span>"+m),k=!0}j.click(function(){b.val(j.text()),args=g.concat([h.prev(),j.attr("_ix")]),h.empty().removeAttr("style").hide(1,function(){f.apply(this,args)})}),j.mouseenter(function(){a(".mrid-autocomplete-item").css("background-color","white"),a(".mrid-autocomplete-item").removeClass("autocomplete-lite-item-selected"),a(this).addClass("autocomplete-lite-item-selected"),a(this).css("background-color","#DCDCDC")}).mouseleave(function(){a(this).removeClass("autocomplete-lite-item-selected"),a(this).css("background-color","white")}),k&&h.append(j)}),h.css({left:b.position().left,width:b.css("width"),position:"absolute","background-color":"white",border:"1px solid #dddddd","max-height":"150px",overflow:"scroll","overflow-x":"hidden","font-family":b.css("font-family"),"font-size":b.css("font-size"),"z-index":"8888"}).insertAfter(b).show())},o=a("<div class='mridautocomplete-list' style='display: none;'/>");o.insertAfter(b),b.click(function(){o.is(":visible")||(clearTimeout(h),h=setTimeout(function(){n(b,j)},0))}),b.keyup(function(a){37!=a.keyCode&&38!=a.keyCode&&39!=a.keyCode&&40!=a.keyCode&&13!=a.keyCode&&9!=a.keyCode&&(clearTimeout(h),h=setTimeout(function(){n(b,j)},100))}),b.keydown(function(c){var d=b.next();if(40==c.keyCode){c.preventDefault();var e;a("mrid-autocomplete-item").css("background-color","white"),b.next().find(".autocomplete-lite-item-selected").length>0?(e=b.next().find(".autocomplete-lite-item-selected"),e.next().hasClass("mrid-autocomplete-item")&&(e.css("background-color","white"),e.removeClass("autocomplete-lite-item-selected"),e.next().css("background-color","#DCDCDC"),e.next().addClass("autocomplete-lite-item-selected"),d.animate({scrollTop:e.offset().top-d.offset().top+d.scrollTop()},50))):(first=b.next().find(".mrid-autocomplete-item").first(),first.css("background-color","#DCDCDC"),first.addClass("autocomplete-lite-item-selected"),e=first)}else if(38==c.keyCode){c.preventDefault();var e,i=2*b.next().find(".mrid-autocomplete-item").css("height").replace("px","");a("mrid-autocomplete-item").css("background-color","white"),b.next().find(".autocomplete-lite-item-selected").length>0&&(e=b.next().find(".autocomplete-lite-item-selected"),e.css("background-color","white"),e.removeClass("autocomplete-lite-item-selected"),e.prev().css("background-color","#DCDCDC"),e.prev().addClass("autocomplete-lite-item-selected"),d.animate({scrollTop:e.offset().top-d.offset().top+d.scrollTop()-i},50))}else 13==c.keyCode?(e=b.next().find(".autocomplete-lite-item-selected"),b.val(e.text()),args=g.concat([o.prev(),e.attr("_ix")]),o.empty().removeAttr("style").hide(1,function(){f.apply(this,args)})):9==c.keyCode?(o.removeAttr("style"),o.empty().hide()):clearTimeout(h)}),b.focusout(function(a){b.next().find(".autocomplete-lite-item-selected").length||(o.removeAttr("style"),o.empty().hide())})}jQuery.fn.extend({autocomplete_img_init:function(d){if(self=this,!self.length)return void console.error("Error : autocomplete-lite-img failed to initialize on ["+self.selector+"].  Element does not exist");var e={items:"",images:"",args:[]};d=a.extend(e,d);var f=d.items,g=d.callback,h=d.images;if(!Array.isArray(d.args))return void console.error("Error : autocomplete-lite-img failed to initialize on ["+self.selector+"].  args is not an array");if(void 0===g)g=b;else if("function"!=typeof g)return void console.error("Error : autocomplete-lite-img failed to initialize on ["+self.selector+"]. "+g+" is not a function");var i=f.length;if(i===h.length){var j={};for(let a=0;a<i;a++)j[f[a].toLowerCase()+"#"+a]=h[a];c(self,self.selector,f,j,g,d.args)}else console.error("Error : autocomplete-lite-img failed to initialize on ["+self.selector+"]. Item count does not match the image count")},autocomplete_img_destroy:function(){self=this,self.hasClass("autocomplete-lite-img-input-node")&&self.next().hasClass("mridautocomplete-list")&&(self.removeClass("autocomplete-lite-img-input-node"),self.next().remove(),self.off("click"),self.off("keyup"),self.off("keydown"))}})}(jQuery);