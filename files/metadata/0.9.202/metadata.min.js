/*!
 &copy; http://www.oknosoft.ru 2014-2015
 @license content of this file is covered by Oknosoft Commercial license. Usage without proper license is prohibited. To obtain it contact info@oknosoft.ru
 @author Evgeniy Malyarov
 */
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.$p=t()}(this,function(){function MetaEngine(){this.version="0.9.201",this.toString=function(){return"Oknosoft data engine. v:"+this.version},this.injected_data={}}function Messages(){this.toString=function(){return"Интернационализация сообщений"},"undefined"!=typeof window&&"dhtmlx"in window&&(this.show_msg=function(e,t){if(e){if("string"==typeof e){if($p.iface.synctxt)return void $p.iface.synctxt.show_message(e);e={type:"info",text:e}}t&&"function"==typeof t.setText&&t.setText(e.text),dhtmlx.message(e)}},this.check_soap_result=function(e){return e?"limit_query"==e.error?($p.iface.docs.progressOff(),$p.msg.show_msg({type:"alert-warning",text:$p.msg.limit_query.replace("%1",e.queries).replace("%2",e.queries_avalable),title:$p.msg.srv_overload}),!0):"network"==e.error||"empty"==e.error?($p.iface.docs.progressOff(),$p.msg.show_msg({type:"alert-warning",text:$p.msg.error_network,title:$p.msg.error_critical}),!0):e.error&&e.error_description?($p.iface.docs.progressOff(),-1!=e.error_description.indexOf("Недостаточно прав")&&(e.error_type="alert-warning",e.error_title=$p.msg.error_rights),$p.msg.show_msg({type:e.error_type||"alert-error",text:e.error_description,title:e.error_title||$p.msg.error_critical}),!0):e.error&&!e.messages?($p.iface.docs.progressOff(),$p.msg.show_msg({type:"alert-error",title:$p.msg.error_critical,text:$p.msg.unknown_error.replace("%1","unknown_error")}),!0):void 0:($p.msg.show_msg({type:"alert-error",text:$p.msg.empty_response,title:$p.msg.error_critical}),!0)},this.show_not_implemented=function(){$p.msg.show_msg({type:"alert-warning",text:$p.msg.not_implemented,title:$p.msg.main_title})})}function InterfaceObjs(){this.toString=function(){return"Объекты интерфейса пользователя"},this.clear_svgs=function(e){for("string"==typeof e&&(e=document.getElementById(e));e.firstChild;)e.removeChild(e.firstChild)},this.get_offset=function(e){var t={left:0,top:0};if(e.offsetParent)do t.left+=e.offsetLeft,t.top+=e.offsetTop;while(e=e.offsetParent);return t},this.normalize_xml=function(e){if(!e)return"";var t={"&":"&amp;",'"':"&quot;","'":"&apos;","<":"&lt;",">":"&gt;"};return e.replace(/[&"'<>]/g,function(e){return t[e]})},this.scale_svg=function(e,t,n){var a,r,o,i,s,l,c,d,p,_={};s=e.indexOf(">"),c=e.substring(5,s),o=c.split(" "),i=e.substr(s+1),i=i.substr(0,i.length-6);for(a in o)e=o[a].split("="),("width"==e[0]||"height"==e[0])&&(e[1]=Number(e[1].replace(/"/g,"")),_[e[0]]=e[1]);return-1!=(l=c.indexOf("viewBox="))?(d=c.substring(l+9),p='viewBox="'+d.substring(0,d.indexOf('"'))+'"'):p='viewBox="0 0 '+(_.width-n)+" "+(_.height-n)+'"',r=t/(_.height-n),_.height=t,_.width=Math.round(_.width*r),'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="'+_.width+'" height="'+_.height+'" xml:space="preserve" '+p+">"+i+"</svg>"},this.bind_help=function(e,t){function n(e){return e.help_path?void 0:void $p.msg.show_msg({title:"Справка",type:"alert-info",text:$p.msg.not_implemented})}e instanceof dhtmlXCellObject||(!e.help_path&&t&&(e.help_path=t),e.button("help").show(),e.button("help").enable(),e.attachEvent("onHelp",n))},this.set_hash=function(e,t,n,a){var r={},o=$p.job_prm.parse_url();1==arguments.length&&"object"==typeof e&&(r=e,r.hasOwnProperty("obj")&&(e=r.obj,delete r.obj),r.hasOwnProperty("ref")&&(t=r.ref,delete r.ref),r.hasOwnProperty("frm")&&(n=r.frm,delete r.frm),r.hasOwnProperty("view")&&(a=r.view,delete r.view)),void 0===e&&(e=o.obj||""),void 0===t&&(t=o.ref||""),void 0===n&&(n=o.frm||""),void 0===a&&(a=o.view||"");var i="obj="+e+"&ref="+t+"&frm="+n+"&view="+a;for(var s in r)i+="&"+s+"="+r[s];location.hash.substr(1)==i?this.hash_route():location.hash=i},this.hash_route=function(e){var t,n=$p.job_prm.parse_url(),a=$p.eve.hash_route.execute(n);return a===!1||$p.iface.before_route&&$p.iface.before_route(e)===!1||$p.ajax.authorized&&(n.ref&&"undefined"!=typeof _md?(t=_md.mgr_by_class_name(n.obj),t&&t[n.frm||"form_obj"]($p.iface.docs,n.ref)):n.view&&$p.iface.swith_view&&$p.iface.swith_view(n.view)),e?$p.cancel_bubble(e):void 0},this.oninit=null,this.ontimer=null,setTimeout(function(){$p.iface.ontimer&&"function"==typeof $p.iface.ontimer&&setInterval($p.iface.ontimer,9e4)},2e4)}function Modifiers(){var e=[];this.push=function(t){e.push(t)},this.detache=function(t){var n=e.indexOf(t);-1!=n&&e.splice(n,1)},this.execute=function(t){var n,a;return e.forEach(function(e){a="function"==typeof e?e(t):$p.injected_data[e](t),n!==!1&&(n=a)}),a}}function AppEvents(){this.toString=function(){return"События при начале работы программы"},this.__define("onload",{value:new Modifiers,enumerable:!1,configurable:!1}),this.__define("hash_route",{value:new Modifiers,enumerable:!1,configurable:!1})}function JobPrm(){function e(){return $p.wsql.get_user_param("rest_path")||$p.job_prm.rest_path||"/a/zd/%1/odata/standard.odata/"}this.parse_url=function(){function e(e){var t,n={},a=[];if(("#"===e.substr(0,1)||"?"===e.substr(0,1))&&(e=e.substr(1)),e.length>2){t=decodeURI(e).split("&");for(var r in t)if(a=t[r].split("="),"m"==a[0])try{n[a[0]]=JSON.parse(a[1])}catch(o){n[a[0]]={}}else n[a[0]]=a[1]||""}return n}return e(location.search)._mixin(e(location.hash))},this.check_dhtmlx=!0,this.use_builder=!1,this.offline=!1,this.local_storage_prefix="",this.create_tables=!0,"undefined"!=typeof window?this.url_prm=this.parse_url():this.url_prm={},"function"==typeof $p.settings&&$p.settings(this,$p.modifiers);for(var t in this)"url_prm"!==t&&"function"!=typeof this[t]&&this.url_prm.hasOwnProperty[t]&&(this[t]=this.url_prm[t]);this.hs_url=function(){var e=this.hs_path||"/a/zd/%1/hs/upzp",t=$p.wsql.get_user_param("zone","number");return t?e.replace("%1",t):e.replace("%1/","")},this.rest_url=function(){var t=e(),n=$p.wsql.get_user_param("zone","number");return n?t.replace("%1",n):t.replace("%1/","")},this.irest_url=function(){var t=e(),n=$p.wsql.get_user_param("zone","number");return t=t.replace("odata/standard.odata","hs/rest"),n?t.replace("%1",n):t.replace("%1/","")}}function WSQL(){function e(e,t){if("object"==t){try{e=JSON.parse(e)}catch(n){e={}}return e}return"number"==t?$p.fix_number(e,!0):"date"==t?$p.fix_date(e,!0):"boolean"==t?$p.fix_boolean(e):e}var t,n=this,a={};"undefined"==typeof localStorage?"undefined"==typeof WorkerGlobalScope&&"undefined"==typeof localStorage&&(t=new require("node-localstorage").LocalStorage("./localstorage")):t=localStorage,n.promise=function(e,t){return new Promise(function(a,r){n.alasql(e,t||[],function(e,t){t?r(t):a(e)})})},n.set_user_param=function(e,n){return new Promise(function(r,o){var i=n;"object"==typeof n?i=JSON.stringify(n):n===!1&&(i=""),t&&t.setItem($p.job_prm.local_storage_prefix+e,i),a[e]=n,r()})},n.get_user_param=function(n,r){return!a.hasOwnProperty(n)&&t&&(a[n]=e(t.getItem($p.job_prm.local_storage_prefix+n),r)),a[n]},n.save_options=function(e,t){return n.set_user_param(e+"_"+t.name,t)},n.restore_options=function(e,t){var a=n.get_user_param(e+"_"+t.name,"object");for(var r in a)if("object"!=typeof a[r])t[r]=a[r];else{t[r]||(t[r]={});for(var o in a[r])t[r][o]=a[r][o]}return t},n.init_params=function(e,a){n.alasql=e||alasql,n.aladb=new n.alasql.Database("md");var r,o=[{p:"user_name",v:"",t:"string"},{p:"user_pwd",v:"",t:"string"},{p:"browser_uid",v:$p.generate_guid(),t:"string"},{p:"zone",v:$p.job_prm.hasOwnProperty("zone")?$p.job_prm.zone:1,t:"number"},{p:"enable_save_pwd",v:"",t:"boolean"},{p:"reset_local_data",v:"",t:"boolean"},{p:"autologin",v:"",t:"boolean"},{p:"cache_cat_date",v:0,t:"number"},{p:"margin",v:60,t:"number"},{p:"discount",v:15,t:"number"},{p:"offline",v:$p.job_prm.offline||"",t:"boolean"},{p:"skin",v:"dhx_web",t:"string"},{p:"rest_path",v:"",t:"string"}];return $p.job_prm.additional_params&&(o=o.concat($p.job_prm.additional_params)),t.getItem($p.job_prm.local_storage_prefix+"zone")||(r=$p.job_prm.hasOwnProperty("zone")?$p.job_prm.zone:1),$p.job_prm.url_prm.hasOwnProperty("zone")&&(r=$p.fix_number($p.job_prm.url_prm.zone,!0)),void 0!==r&&n.set_user_param("zone",r),o.forEach(function(e){(void 0==n.get_user_param(e.p,e.t)||!n.get_user_param(e.p,e.t)&&-1!=e.p.indexOf("url"))&&n.set_user_param(e.p,$p.job_prm.hasOwnProperty(e.p)?$p.job_prm[e.p]:e.v)}),n.set_user_param("cache_cat_date",0),n.set_user_param("reset_local_data",""),new Promise(function(e,t){a?n.alasql(a,[],e):$p.job_prm.create_tables?$p.job_prm.create_tables_sql?n.alasql($p.job_prm.create_tables_sql,[],function(){delete $p.job_prm.create_tables_sql,e()}):$p.injected_data["create_tables.sql"]?n.alasql($p.injected_data["create_tables.sql"],[],function(){delete $p.injected_data["create_tables.sql"],e()}):"string"==typeof $p.job_prm.create_tables?$p.ajax.get($p.job_prm.create_tables).then(function(t){n.alasql(t.response,[],e)}):e():e()})},n.drop_tables=function(e){function t(){o--,0>=o?setTimeout(e,10):a()}function a(){var e=i[o-1].tableid;"_"==e.substr(0,1)?t():n.alasql("drop table IF EXISTS "+e,[],t)}function r(e){i=e,(o=e.length)?a():t()}var o=0,i=[];n.alasql("SHOW TABLES",[],r)},n.backup_database=function(e){},n.restore_database=function(){},n.idx_connect=function(e,t){return new Promise(function(a,r){var o=indexedDB.open(e,1);o.onerror=function(e){r(e)},o.onsuccess=function(){a(o.result)},o.onupgradeneeded=function(a){return a.currentTarget.result.createObjectStore(t,{keyPath:"ref"}),n.idx_connect(e,t)}})},n.idx_save=function(e,t,a){return new Promise(function(r,o){function i(t){var n=t.transaction([a],"readwrite").objectStore(a).put(e instanceof DataObj?e._obj:e);n.onerror=function(e){o(e)},n.onsuccess=function(){r(n.result)}}!a&&e._manager&&(a=e._manager.table_name),t?i(t):n.idx_connect(n.idx_name||$p.job_prm.local_storage_prefix||"md",a).then(i)})},n.idx_get=function(e,t,a){return new Promise(function(r,o){function i(t){var n=t.transaction([a],"readonly").objectStore(a).get(e);n.onerror=function(e){o(e)},n.onsuccess=function(){r(n.result)}}t?i(t):n.idx_connect(n.idx_name||$p.job_prm.local_storage_prefix||"md",a).then(i)})},n.idx_delete=function(e,t,a){return new Promise(function(r,o){function i(t){var n=t.transaction([a],"readwrite").objectStore(a)["delete"](e instanceof DataObj?e.ref:e);n.onerror=function(e){o(e)},n.onsuccess=function(){r(n.result)}}!a&&e._manager&&(a=e._manager.table_name),t?i(t):n.idx_connect(n.idx_name||$p.job_prm.local_storage_prefix||"md",a).then(i)})}}function eXcell_ocombo(e){if(e){var t=this;t.cell=e,t.grid=e.parentNode.grid,t.setValue=function(e){t.setCValue(e instanceof DataObj?e.presentation:e||"")},t.getValue=function(){return t.grid.get_cell_value()},t.shiftNext=function(){t.grid.editStop()},t.edit=function(){t.combo||(t.val=t.getValue(),t.cell.innerHTML="",t.combo=new OCombo({parent:t.cell}._mixin(t.grid.get_cell_field())),t.combo.getInput().focus())},t.detach=function(){if(t.combo&&t.combo.getComboText){t.setValue(t.combo.getComboText()),t.combo.getSelectedValue()||t.combo.callEvent("onChange");var e=!$p.is_equal(t.val,t.getValue());return t.combo.unload(),e}return!0}}}function eXcell_pwd(e){var t;e&&(this.cell=e,this.grid=e.parentNode.grid,eXcell_ed.call(this),t=this.edit,this.edit=function(){t.call(this),this.obj.type="password"},this.setValue=function(){this.setCValue("*********")},this.getValue=function(){return this.grid.get_cell_value()},this.detach=function(){if(this.grid.get_cell_field){var e=this.grid.get_cell_field();e.obj[e.field]=this.obj.value}return this.setValue(),t=null,this.val!=this.getValue()})}function ODropdownList(e){function t(t){o.innerHTML=e.values[o.getAttribute("current")],e.event_name&&!t&&dhx4.callEvent(e.event_name,[o.getAttribute("current")])}function n(){r.classList.remove("open")}var a,r,o,i=document.createElement("ul");e.container.innerHTML='<div class="dropdown_list">'+e.title+'<a href="#" class="dropdown_list"></a></div>',r=e.container.firstChild,o=r.querySelector("a"),o.setAttribute("current",Array.isArray(e.values)?"0":Object.keys(e.values)[0]),r.onclick=function(e){if(r.classList.contains("open")){if("LI"==e.target.tagName)for(var a in i.childNodes)if(i.childNodes[a]==e.target){o.setAttribute("current",e.target.getAttribute("current")),t();break}n()}else r.classList.add("open");return $p.cancel_bubble(e)},r.appendChild(i),i.className="dropdown_menu",e.class_name&&(r.classList.add(e.class_name),i.classList.add(e.class_name));for(var s in e.values){a=document.createElement("li");var l=e.values[s].indexOf("<i");a.innerHTML=e.values[s].substr(l)+" "+e.values[s].substr(0,l),a.setAttribute("current",s),i.appendChild(a)}document.body.addEventListener("keydown",function(e){27==e.keyCode&&r.classList.remove("open")}),document.body.addEventListener("click",n),this.unload=function(){for(var t;t=r.lastChild;)r.removeChild(t);e.container.removeChild(r),a=i=r=o=e=null},t(!0)}function OCombo(e){function t(e){var t,n={_top:30};d&&d.metadata().hierarchical&&d.metadata().group_hierarchy&&("elm"==c.choice_groups_elm?n.is_folder=!1:("grp"==c.choice_groups_elm||"parent"==l)&&(n.is_folder=!0));for(var a in c.choice_links)t=c.choice_links[a],t.name&&"selection"==t.name[0]&&(s instanceof TabularSectionRow?t.path.length<2?n[t.name[1]]="function"==typeof t.path[0]?t.path[0]:s._owner._owner[t.path[0]]:n[t.name[1]]=s[t.path[1]]:n[t.name[1]]="function"==typeof t.path[0]?t.path[0]:s[t.path[0]]);return e&&(n.presentation={like:e}),n}function n(e){if("select"==this.name)d?d.form_selection(f,{initial_value:s[l].ref,selection:[t()]}):n.call({name:"type"});else if("add"==this.name)d&&d.create({},!0).then(function(e){e._set_loaded(e.ref),e.form_obj()});else if("open"==this.name)s&&s[l]&&!s[l].empty()&&s[l].form_obj();else if("type"==this.name){var a,r,o=[],i=s,p=l;c.type.types.forEach(function(e){a=_md.mgr_by_class_name(e),r=a.metadata(),o.push({presentation:r.synonym||r.name,mgr:a,selected:d===a})}),$p.iface.select_from_list(o).then(function(e){(!i[p]||i[p]&&i[p]._manager!=e.mgr)&&(d=e.mgr,s=i,l=p,c=s._metadata.fields[l],d.form_selection({on_select:function(e){s[l]=e,s=null,l=null,c=null}},{selection:[t()]})),d=null,a=null,r=null,i=null,p=null})}return e?$p.cancel_bubble(e):void 0}function a(){_=!1,setTimeout(function(){_||$p.iface.popup.hide()},300)}function r(){if(!(d instanceof EnumManager)){_=!0;var e=document.createElement("div"),t="<a href='#' name='select' title='Форма выбора {F4}'>Показать все</a><a href='#' name='open' style='margin-left: 9px;' title='Открыть форму элемента {Ctrl+Shift+F4}'><i class='fa fa-external-link fa-fw'></i></a>";$p.ajax.root&&(t+="&nbsp;<a href='#' name='add' title='Создать новый элемент {F8}'><i class='fa fa-plus fa-fwfa-fw'></i></a>"),c.type.types.length>1&&(t+="&nbsp;<a href='#' name='type' title='Выбрать тип значения {Alt+T}'><i class='fa fa-level-up fa-fw'></i></a>"),e.innerHTML=t;for(var r=0;r<e.children.length;r++)e.children[r].onclick=n;$p.iface.popup.clear(),$p.iface.popup.attachObject(e),$p.iface.popup.show(dhx4.absLeft(u.getButton())-77,dhx4.absTop(u.getButton()),u.getButton().offsetWidth,u.getButton().offsetHeight),$p.iface.popup.p.onmouseover=function(){_=!0},$p.iface.popup.p.onmouseout=a}}function o(e){u&&u.getBase&&(u.getBase().parentElement?s instanceof TabularSectionRow||e.forEach(function(e){e.name==l&&i(s[l])}):setTimeout(u.unload))}function i(e){if(e&&e instanceof DataObj&&!e.empty()){if(u.getOption(e.ref)||u.addOption(e.ref,e.presentation),u.getSelectedValue()==e.ref)return;u.setComboValue(e.ref)}else u.getSelectedValue()||(u.setComboValue(""),u.setComboText(""))}var s,l,c,d,p,_,u=this,f={on_select:e.on_select||function(e){s[l]=e}};OCombo.superclass.constructor.call(u,e),e.on_select?(u.getBase().style.border="none",u.getInput().style.left="-3px",e.is_tabular||(u.getButton().style.right="9px")):u.getBase().style.marginBottom="4px",e.left&&(u.getBase().style.left=left+"px"),this.attachEvent("onChange",function(){s[l]=this.getSelectedValue()}),this.attachEvent("onBlur",function(){!this.getSelectedValue()&&this.getComboText()&&this.setComboText("")}),this.attachEvent("onDynXLS",function(e){d||(d=_md.value_mgr(s,l,c.type)),d&&(u.clearAll(),d.get_option_list(null,t(e)).then(function(e){u.addOption&&(u.addOption(e),u.openSelect())}))}),dhtmlxEvent(u.getButton(),"mouseover",r),dhtmlxEvent(u.getButton(),"mouseout",a),dhtmlxEvent(u.getBase(),"click",function(e){return $p.cancel_bubble(e)}),dhtmlxEvent(u.getBase(),"contextmenu",function(e){return setTimeout(r,10),e.preventDefault(),!1}),dhtmlxEvent(u.getInput(),"keyup",function(e){return d instanceof EnumManager?void 0:115==e.keyCode?(e.ctrlKey&&e.shiftKey?s[l].empty()||s[l].form_obj():e.ctrlKey||e.shiftKey||d&&d.form_selection(f,{initial_value:s[l].ref,selection:[t()]}),$p.cancel_bubble(e)):void 0}),dhtmlxEvent(u.getInput(),"focus",function(e){setTimeout(function(){u&&u.getInput&&u.getInput().select()},50)}),this.attach=function(e){s&&Object.unobserve(s,o),s=e.obj,l=e.field,p=e.property,e.meta?c=e.meta:p?(c=s._metadata.fields[l]._clone(),c.type=p.type):c=s._metadata.fields[l],u.clearAll(),d=_md.value_mgr(s,l,c.type),d&&d.get_option_list(s[l],t()).then(function(e){u.addOption&&(u.addOption(e),i(s[l]))}),s instanceof TabularSectionRow?Object.observe(s._owner._owner,o,["row"]):Object.observe(s,o,["update"])};var m=this.unload;this.unload=function(){a(),s&&Object.unobserve(s,o),u.conf&&u.conf.tm_confirm_blur&&clearTimeout(u.conf.tm_confirm_blur),s=null,l=null,c=null,d=null,f=null;try{m.call(u)}catch(e){}},e.obj&&e.field&&this.attach(e),this.enableFilteringMode("between","dummy",!1,!1)}function eXcell_rsvg(e){e&&(this.cell=e,this.grid=this.cell.parentNode.grid),this.edit=function(){},this.isDisabled=function(){return!0},this.setValue=function(e){this.setCValue(e?$p.iface.scale_svg(e,120,10):"нет эскиза")}}function _clear_all(){$p.iface.docs.__define({clear_all:{value:function(){this.detachToolbar(),this.detachStatusBar(),this.detachObject(!0)},enumerable:!1},"Очистить":{get:function(){return this.clear_all},enumerable:!1},"Контейнер":{get:function(){return this.cell.querySelector(".dhx_cell_cont_layout")},enumerable:!1}})}function OTooolBar(e){function t(e){for(var t=0;t<c.children.length;t++){var n=c.children[t];n.classList.contains("selected")&&n.classList.remove("selected")}e&&!this.classList.contains("selected")&&this.classList.add("selected")}function n(){o=!1,setTimeout(function(){o||$p.iface.popup.hide()},300)}function a(){var t=this.name.replace(e.name+"_","");e.onclick&&e.onclick.call(l,t)}var r,o,i,s,l=this,c=document.createElement("div");e.image_path||(e.image_path=dhtmlx.image_path),e.hasOwnProperty("class_name")?c.className=e.class_name:c.className="md_otooolbar",l.cell=c,l.buttons={},this.add=function(t){function d(e){if(e||(e=p),e.subdiv&&!i&&!s){for(;e.subdiv.firstChild;)e.subdiv.removeChild(e.subdiv.firstChild);e.subdiv.parentNode.removeChild(e.subdiv),e.subdiv=null}}var p=$p.iface.add_button(c,e,t);p.onclick=a,p.onmouseover=function(){t.title&&!t.sub&&(o=!0,$p.iface.popup.clear(),$p.iface.popup.attachHTML(t.title),$p.iface.popup.show(dhx4.absLeft(p),dhx4.absTop(p),p.offsetWidth,p.offsetHeight),$p.iface.popup.p.onmouseover=function(){o=!0},$p.iface.popup.p.onmouseout=n)},p.onmouseout=n,l.buttons[t.name]=p,t.sub&&(p.onmouseover=function(){for(var n=0;n<p.parentNode.children.length;n++)if(p.parentNode.children[n]!=p&&p.parentNode.children[n].subdiv){d(p.parentNode.children[n]);break}if(s=!0,!this.subdiv){this.subdiv=document.createElement("div"),this.subdiv.className="md_otooolbar",r=$p.iface.get_offset(p),"right"==t.sub.align?this.subdiv.style.left=r.left+p.offsetWidth-(parseInt(t.sub.width.replace(/\D+/g,""))||56)+"px":this.subdiv.style.left=r.left+"px",this.subdiv.style.top=r.top+c.offsetHeight+"px",this.subdiv.style.height=t.sub.height||"198px",this.subdiv.style.width=t.sub.width||"56px";for(var n in t.sub.buttons){var o=$p.iface.add_button(this.subdiv,e,t.sub.buttons[n]);o.onclick=a}e.wrapper.appendChild(this.subdiv),this.subdiv.onmouseover=function(){i=!0},this.subdiv.onmouseout=function(){i=!1,setTimeout(d,500)},t.title&&$p.iface.popup.show(dhx4.absLeft(this.subdiv),dhx4.absTop(this.subdiv),this.subdiv.offsetWidth,this.subdiv.offsetHeight)}},p.onmouseout=function(){s=!1,setTimeout(d,500)})},this.select=function(n){for(var a=0;a<c.children.length;a++){var r=c.children[a];if(r.name==e.name+"_"+n)return void t.call(r,!0)}},this.get_selected=function(){for(var e=0;e<c.children.length;e++){var t=c.children[e];if(t.classList.contains("selected"))return t.name}},this.unload=function(){for(;c.firstChild;)c.removeChild(c.firstChild);e.wrapper.removeChild(c)},e.wrapper.appendChild(c),c.style.width=e.width||"28px",c.style.height=e.height||"150px",c.style.position="absolute",e.top&&(c.style.top=e.top),e.left&&(c.style.left=e.left),e.bottom&&(c.style.bottom=e.bottom),e.right&&(c.style.right=e.right),e.buttons&&e.buttons.forEach(function(e){l.add(e)})}function eXcell_addr(e){if(e){var t,n=this,a=function(e){return eXcell_proto.input_keydown(e,n)},r=function(e){var t={grid:n.grid}._mixin(n.grid.get_cell_field());return wnd_address(t),$p.cancel_bubble(e)};n.cell=e,n.grid=n.cell.parentNode.grid,n.open_selection=r,n.setValue=function(e){n.setCValue(e)},n.getValue=function(){return n.grid.get_cell_value()},n.edit=function(){var e;n.val=n.getValue(),n.cell.innerHTML='<div class="ref_div21"><input type="text" class="dhx_combo_edit" style="height: 20px;"><div class="ref_field21">&nbsp;</div></div>',t=n.cell.firstChild,e=t.childNodes[0],e.value=n.val,e.onclick=$p.cancel_bubble,e.readOnly=!0,e.focus(),e.onkeydown=a,t.childNodes[1].onclick=r},n.detach=function(){return n.setValue(n.getValue()),!$p.is_equal(n.val,n.getValue())}}}function wnd_address(e){function t(){var e={name:"wnd_addr",wnd:{id:"wnd_addr",top:130,left:200,width:800,height:560,modal:!0,center:!0,pwnd:g,allow_close:!0,allow_minmax:!0,on_close:f,caption:h.shipping_address}};g&&g.getHeight&&e.wnd.height>g.getHeight()&&(e.wnd.height=g.getHeight()),m=$p.iface.dat_blank(null,e.wnd),m.elmnts.layout=m.attachLayout("2E"),m.elmnts.cell_frm=m.elmnts.layout.cells("a"),m.elmnts.cell_frm.setHeight("110"),m.elmnts.cell_frm.hideHeader(),m.elmnts.cell_frm.fixSize(0,1),m.elmnts.pgrid=m.elmnts.cell_frm.attachPropertyGrid(),m.elmnts.pgrid.setDateFormat("%d.%m.%Y %H:%i"),m.elmnts.pgrid.init(),m.elmnts.pgrid.parse(h._manager.get_property_grid_xml({" ":[{id:"delivery_area",path:"o.delivery_area",synonym:"Район доставки",type:"ref",txt:y.delivery_area.presentation},{id:"region",path:"o.region",synonym:"Регион",type:"ro",txt:y.region},{id:"city",path:"o.city",synonym:"Населенный пункт",type:"ed",txt:y.city},{id:"street",path:"o.street",synonym:"Улица, дом, корпус, литера, квартира",type:"ed",txt:y.street}]},y),function(){m.elmnts.pgrid.enableAutoHeight(!0),m.elmnts.pgrid.setInitWidthsP("40,60"),m.elmnts.pgrid.setSizes(),m.elmnts.pgrid.attachEvent("onPropertyChanged",u)},"xml"),m.elmnts.pgrid.get_cell_field=function(){return{obj:y,field:"delivery_area",on_select:a,pwnd:m,meta:{synonym:"Район",tooltip:"Район (зона, направление) доставки для группировки при планировании и оптимизации маршрута геокодером",choice_groups_elm:"elm",type:{types:["cat.delivery_areas"],is_ref:!0}}}},m.elmnts.toolbar=m.attachToolbar({icons_path:dhtmlx.image_path+"dhxtoolbar"+dhtmlx.skin_suffix()}),m.elmnts.toolbar.loadStruct('<toolbar><item id="btn_select" type="button" title="Установить адрес" text="&lt;b&gt;Выбрать&lt;/b&gt;" /></toolbar>',function(){this.attachEvent("onclick",n)}),m.elmnts.cell_map=m.elmnts.layout.cells("b"),m.elmnts.cell_map.hideHeader();var t={center:new google.maps.LatLng(y.latitude,y.longitude),zoom:y.street?15:12,mapTypeId:google.maps.MapTypeId.ROADMAP};m.elmnts.map=m.elmnts.cell_map.attachMap(t),y.marker=new google.maps.Marker({map:m.elmnts.map,draggable:!0,animation:google.maps.Animation.DROP,position:t.center}),google.maps.event.addListener(y.marker,"click",p),google.maps.event.addListener(y.marker,"dragend",_),o()}function n(e){"btn_select"==e&&(h.delivery_area=y.delivery_area,l(),h.coordinates=JSON.stringify([y.latitude,y.longitude])),m.close()}function a(e){if(void 0!==e){var t,n=b;b=$p.is_data_obj(e)?e:$p.cat.delivery_areas.get(e,!1),t=n!=b,$p.is_data_obj(b)||(b=$p.cat.delivery_areas.get()),m.elmnts.pgrid.cells().setValue(e.presentation),r(t)}}function r(e){if(!y.delivery_area.empty()&&e&&(y.street=""),y.delivery_area.region?(y.region=y.delivery_area.region,m.elmnts.pgrid.cells("region",1).setValue(y.region)):e&&(y.region=""),y.delivery_area.city?(y.city=y.delivery_area.city,m.elmnts.pgrid.cells("city",1).setValue(y.city)):e&&(y.city=""),y.delivery_area.latitude&&y.delivery_area.longitude){var t=new google.maps.LatLng(y.delivery_area.latitude,y.delivery_area.longitude);m.elmnts.map.setCenter(t),y.marker.setPosition(t)}o()}function o(){m.elmnts.pgrid.cells("region",1).setValue(y.region),m.elmnts.pgrid.cells("city",1).setValue(y.city),m.elmnts.pgrid.cells("street",1).setValue(y.street)}function i(){var e=y.street?15:12;m.elmnts.map.getZoom()!=e&&m.elmnts.map.setZoom(e),d(function(e,t){if(t==google.maps.GeocoderStatus.OK){var n=e[0].geometry.location;m.elmnts.map.setCenter(n),y.marker.setPosition(n),y.latitude=n.lat(),y.longitude=n.lng(),y.postal_code=$p.ipinfo.components({},e[0].address_components).postal_code||""}})}function s(){return(y.street?y.street.replace(/,/g," ")+", ":"")+(y.city?y.city+", ":"")+(y.region?y.region+", ":"")+y.country+(y.postal_code?", "+y.postal_code:"")}function l(){h.shipping_address=s();var e='<КонтактнаяИнформация  				xmlns="http://www.v8.1c.ru/ssl/contactinfo" 				xmlns:xs="http://www.w3.org/2001/XMLSchema" 				xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"   				Представление="%1">   					<Комментарий/>  					<Состав xsi:type="Адрес" Страна="РОССИЯ">   						<Состав xsi:type="АдресРФ">'.replace("%1",h.shipping_address);if(y.region&&(e+="\n<СубъектРФ>"+y.region+"</СубъектРФ>"),y.city&&(e+=-1!=y.city.indexOf("г.")||-1!=y.city.indexOf("г ")||-1!=y.city.indexOf(" г")?"\n<Город>"+y.city+"</Город>":"\n<НаселПункт>"+y.city+"</НаселПункт>"),y.street){var t,n,a,r,o,i=y.street.replace(/,/g," ");for(var l in $p.fias){if(1==$p.fias[l].type)for(var c in $p.fias[l].syn)if(-1!=(n=i.indexOf($p.fias[l].syn[c]))){r=l,t=i.substr(n+$p.fias[l].syn[c].length).trim(),i=i.substr(0,n).trim();break}if(r)break}if(r||(r="1010",-1!=(n=i.indexOf(" "))&&(t=i.substr(n),i=i.substr(0,n))),e+="\n<Улица>"+i.trim()+"</Улица>",t){a=t.toLowerCase(),t="";for(var l in $p.fias){if(3==$p.fias[l].type)for(var c in $p.fias[l].syn)if(-1!=(n=a.indexOf($p.fias[l].syn[c]))){o=l,t=a.substr(n+$p.fias[l].syn[c].length),a=a.substr(0,n);break}if(o)break}o||(o="2010",-1!=(n=a.indexOf(" "))&&(t=a.substr(n),a=a.substr(0,n))),e+='\n<ДопАдрЭл><Номер Тип="'+r+'" Значение="'+a.trim()+'"/></ДопАдрЭл>'}t&&(e+='\n<ДопАдрЭл><Номер Тип="'+o+'" Значение="'+t.trim()+'"/></ДопАдрЭл>')}y.postal_code&&(e+='<ДопАдрЭл ТипАдрЭл="10100000" Значение="'+y.postal_code+'"/>'),e+="</Состав> 					</Состав></КонтактнаяИнформация>",h.address_fields=e}function c(e){function t(e){if(e.attributes&&2==e.attributes.length){var t={};return t[e.attributes[0].value]=e.attributes[1].value,t}}if(h.address_fields){y.xml=(new DOMParser).parseFromString(h.address_fields,"text/xml");var n,a={},r={building_room:""},o=[],i="СубъектРФ,Округ,СвРайМО,СвРайМО,ВнутригРайон,НаселПункт,Улица,Город,ДопАдрЭл,Адрес_по_документу,Местоположение".split(",");for(var s in i)a[i[s]]=y.xml.getElementsByTagName(i[s]);for(var s in a)for(var l in a[s])if("length"!=l&&a[s].hasOwnProperty(l))if(n=t(a[s][l]))r[s]||(r[s]=[]),r[s].push(n);else if(a[s][l].childNodes.length)for(var c in a[s][l].childNodes)"length"!=c&&a[s][l].childNodes.hasOwnProperty(c)&&((n=t(a[s][l].childNodes[c]))?(r[s]||(r[s]=[]),r[s].push(n)):a[s][l].childNodes[c].nodeValue&&(r[s]?r[s]+=" "+a[s][l].childNodes[c].nodeValue:r[s]=a[s][l].childNodes[c].nodeValue));for(var s in r["ДопАдрЭл"]){for(var l in $p.fias)4==l.length&&r["ДопАдрЭл"][s][l]&&(o[$p.fias[l].type]=$p.fias[l].name+" "+r["ДопАдрЭл"][s][l]);r["ДопАдрЭл"][s][101e5]&&(y.postal_code=r["ДопАдрЭл"][s][101e5])}y.address_fields=r,y.region=r["СубъектРФ"]||r["Округ"]||"",y.city=r["Город"]||r["НаселПункт"]||"",y.street=r["Улица"]||"";for(var s in o)y.street+=" "+o[s]}y.coordinates.length?(y.latitude=y.coordinates[0],y.longitude=y.coordinates[1],e()):h.shipping_address?d(function(t,n){n==google.maps.GeocoderStatus.OK&&(y.latitude=t[0].geometry.location.lat(),y.longitude=t[0].geometry.location.lng()),e()}):$p.ipinfo.latitude&&$p.ipinfo.longitude?(y.latitude=$p.ipinfo.latitude,y.longitude=$p.ipinfo.longitude,e()):(y.latitude=55.635924,y.longitude=37.6066379,e(),$p.msg.show_msg($p.msg.empty_geocoding))}function d(e){var t=s();$p.ipinfo.ggeocoder.geocode({address:t},e)}function p(){null!=y.marker.getAnimation()?y.marker.setAnimation(null):(y.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){y.marker.setAnimation(null)},1500))}function _(e){$p.ipinfo.ggeocoder.geocode({latLng:e.latLng},function(t,n){if(n==google.maps.GeocoderStatus.OK&&t[0]){var a=t[0];m.setText(a.formatted_address),$p.ipinfo.components(y,a.address_components),o();var r=y.street?15:12;m.elmnts.map.getZoom()!=r&&(m.elmnts.map.setZoom(r),m.elmnts.map.setCenter(e.latLng)),y.latitude=e.latLng.lat(),y.longitude=e.latLng.lng()}})}function u(e,t,n){e&&(y.delivery_area.empty()?(t=n,$p.msg.show_msg({type:"alert",text:$p.msg.delivery_area_empty,title:$p.msg.addr_title}),setTimeout(function(){m.elmnts.pgrid.selectRowById("delivery_area")},50)):"delivery_area"==e?a(t):(y[m.elmnts.pgrid.getSelectedRowId()]=t,i()))}function f(t){return e.grid.editStop(),!t.error}var m,h=e.obj,g=e.pwnd,b=h.delivery_area,y={coordinates:h.coordinates?JSON.parse(h.coordinates):[],country:"Россия",region:"",city:"",street:"",postal_code:"",marker:{}};return y.__define("delivery_area",{get:function(){return b},set:function(e){a(e)}}),c(t),m}function _load(e){function t(){return o.cachable?$p.wsql.promise(o.get_sql_struct(e),[]).then($p.iface.data_to_tree):void 0}function n(){}function a(){return o.cachable?$p.wsql.promise(o.get_sql_struct(e),[]).then(function(t){return $p.iface.data_to_grid.call(o,t,e)}):void 0}var r,o=_md.mgr_by_class_name(e.class_name);return"get_tree"==e.action&&(r=t())?r:"get_orders"==e.action&&(r=n())?r:"get_selection"==e.action&&(r=a())?r:$p.job_prm.offline?Promise.reject(Error($p.msg.offline_request)):(e.browser_uid=$p.wsql.get_user_param("browser_uid"),$p.ajax.post_ex($p.job_prm.hs_url(),JSON.stringify(e),!0).then(function(e){return e.response}))}function Meta(e,t){var n,a=e&&e.response?JSON.parse(e.response):e;_md=$p.md=this,t&&Meta._patch(a,t.response?JSON.parse(t.response):t),e=null,"undefined"!=typeof window&&(t=$p.injected_data["log.json"],Meta._patch(a,t),t=null),_md.get=function(e,t){var n=e.split("."),r={multiline_mode:!1,note:"",synonym:"",tooltip:"",type:{is_ref:!1,types:["string"]}};return t?("doc"==n[0]&&"number_doc"==t?(r.synonym="Номер",r.tooltip="Номер документа",r.type.str_len=11):"doc"==n[0]&&"date"==t?(r.synonym="Дата",r.tooltip="Дата документа",r.type.date_part="date_time",r.type.types[0]="date"):"doc"==n[0]&&"posted"==t?(r.synonym="Проведен",r.type.types[0]="boolean"):"cat"==n[0]&&"id"==t?r.synonym="Код":"cat"==n[0]&&"name"==t?r.synonym="Наименование":"deleted"==t?(r.synonym="Пометка удаления",r.type.types[0]="boolean"):"is_folder"==t?(r.synonym="Это группа",r.type.types[0]="boolean"):"lc_changed"==t?(r.synonym="Изменено в 1С",r.tooltip="Время записи в 1С",r.type.types[0]="number",r.type.digits=15,r.type.fraction_figits=0):"ref"==t?(r.synonym="Ссылка",r.type.is_ref=!0,r.type.types[0]=e):r=t?a[n[0]][n[1]].fields[t]:a[n[0]][n[1]],r):a[n[0]][n[1]]},_md.get_classes=function(){var e={};for(var t in a){e[t]=[];for(var n in a[t])e[t].push(n)}return e},_md.create_tables=function(e,t){function n(t){"number"==typeof t?(o--,0==o?e?setTimeout(function(){e(l)},10):alasql.utils.saveFile("create_tables.sql",l):a()):t&&t.hasOwnProperty("message")&&$p.iface&&$p.iface.docs&&($p.iface.docs.progressOff(),$p.msg.show_msg({title:$p.msg.error_critical,type:"alert-error",
text:t.message}))}function a(){var e=i[o-1];l+=e["class"][e.name].get_sql_struct(t)+";\n",n(1)}var r,o=0,i=[],s=_md.get_classes(),l=t&&t.postgres?"":"USE md;\n";for(r in s.cat)i.push({"class":_cat,name:s.cat[r]});o=i.length;for(r in s.ireg)i.push({"class":_ireg,name:s.ireg[r]}),o++;for(r in s.doc)i.push({"class":_doc,name:s.doc[r]}),o++;for(r in s.enm)i.push({"class":_enm,name:s.enm[r]}),o++;for(r in s.cch)i.push({"class":_cch,name:s.cch[r]}),o++;for(r in s.cacc)i.push({"class":_cacc,name:s.cacc[r]}),o++;a()},_md.sql_type=function(e,t,n,a){var r;return r="type"==t&&"cch_properties"==e.table_name||"svg"==t&&"cat_production_params"==e.table_name?" JSON":n.is_ref||-1!=n.types.indexOf("guid")?a?n.types.every(function(e){return 0==e.indexOf("enm.")})?" character varying(100)":n.hasOwnProperty("str_len")?" character varying("+Math.max(36,n.str_len)+")":" uuid":" CHAR":n.hasOwnProperty("str_len")?a?n.str_len?" character varying("+n.str_len+")":" text":" CHAR":n.date_part?a&&"date"!=n.date_part?"date_time"==n.date_part?" timestamp with time zone":" time without time zone":" Date":n.hasOwnProperty("digits")?0==n.fraction_figits?a?n.digits<7?" integer":" bigint":" INT":a?" numeric("+n.digits+","+n.fraction_figits+")":" FLOAT":-1!=n.types.indexOf("boolean")?" BOOLEAN":-1!=n.types.indexOf("json")?" JSON":a?" character varying(255)":" CHAR"},_md.sql_composite=function(e,t,n,a){var r="";return e[t].type.types.length>1&&"type"!=t&&(n=n?n.substr(0,29)+"_T":t.substr(0,29)+"_T",r=a?', "'+n+'" character varying(255)':_md.sql_mask(n)+" CHAR"),r},_md.sql_mask=function(e,t){return", "+(t?"_t_.":"")+("`"+e+"`")},_md.mgr_by_class_name=function(e){if(e){var t=e.split(".");if(t[1]&&$p[t[0]])return $p[t[0]][t[1]]}},_md.value_mgr=function(e,t,n,a,r){function o(e){return e&&1==n.types.length&&(n._mgr=e),e}var i,s,l,c,d;if(n._mgr)return n._mgr;if(1==n.types.length){if(l=n.types[0].split("."),l.length>1&&$p[l[0]])return o($p[l[0]][l[1]])}else if(r&&r.type&&(l=r.type.split("."),l.length>1&&$p[l[0]]))return o($p[l[0]][l[1]]);if(i=e.property||e.param,"value"==t&&i){if(s=_cch.properties.get(i,!1),$p.is_data_obj(s)){if(s.is_new())return _cat.property_values;for(c in s.type.types)if(s.type.types[c].indexOf(".")>-1){l=s.type.types[c].split(".");break}return l&&l.length>1&&$p[l[0]]?o($p[l[0]][l[1]]):s.type}}else{if(c=[],n.types.forEach(function(e){l=e.split("."),l.length>1&&$p[l[0]][l[1]]&&c.push($p[l[0]][l[1]])}),1==c.length)return o(c[0]);if(a)return c;if((i=e[t])instanceof DataObj)return i._manager;if($p.is_guid(i)&&i!=$p.blank.guid)for(var p in c)if(d=c[p],d.get(i,!1,!0))return d}},_md.control_by_type=function(e){var t;return t=e.is_ref?-1==e.types.join().indexOf("enm.")?"ocombo":"refc":e.date_part?"dhxCalendar":e.digits?e.fraction_figits<5?"calck":"edn":"boolean"==e.types[0]?"ch":e.hasOwnProperty("str_len")&&(e.str_len>=100||0==e.str_len)?"txt":"ed"},_md.ts_captions=function(e,t,n){n||(n={});var a,r=_md.get(e).tabular_sections[t],o=_md.get(e).form,i=r.fields;if(o&&o.obj){if(!o.obj.tabular_sections[t])return;n._mixin(o.obj.tabular_sections[t])}else{"contact_information"===t&&(i={type:"",kind:"",presentation:""}),n.fields=["row"],n.headers="№",n.widths="40",n.min_widths="",n.aligns="",n.sortings="na",n.types="cntr";for(var s in i)a=r.fields[s],a.hide||(n.fields.push(s),n.headers+=","+(a.synonym?a.synonym.replace(/,/g," "):s),n.types+=","+_md.control_by_type(a.type),n.sortings+=",na")}return!0},_md.syns_js=function(e){var t={DeletionMark:"deleted",Description:"name",DataVersion:"data_version",IsFolder:"is_folder",Number:"number_doc",Date:"date","Дата":"date",Posted:"posted",Code:"id",Parent_Key:"parent",Owner_Key:"owner",Owner:"owner",Ref_Key:"ref","Ссылка":"ref",LineNumber:"row"};return t[e]?t[e]:a.syns_js[a.syns_1с.indexOf(e)]||e},_md.syns_1с=function(e){var t={deleted:"DeletionMark",name:"Description",data_version:"DataVersion",is_folder:"IsFolder",number_doc:"Number",date:"Date",posted:"Posted",id:"Code",ref:"Ref_Key",parent:"Parent_Key",owner:"Owner_Key",row:"LineNumber"};return t[e]?t[e]:a.syns_1с[a.syns_js.indexOf(e)]||e},_md.printing_plates=function(e){if(e)for(var t in e.doc)a.doc[t].printing_plates=e.doc[t]},_md.class_name_from_1c=function(e){var t=e.split(".");return 1==t.length?"enm."+e:("Перечисление"==t[0]?e="enm.":"Справочник"==t[0]?e="cat.":"Документ"==t[0]?e="doc.":"РегистрСведений"==t[0]?e="ireg.":"РегистрНакопления"==t[0]?e="areg.":"РегистрБухгалтерии"==t[0]?e="aссreg.":"ПланВидовХарактеристик"==t[0]?e="cch.":"ПланСчетов"==t[0]?e="cacc.":"Обработка"==t[0]?e="dp.":"Отчет"==t[0]&&(e="rep."),e+t[1])},_md.class_name_to_1c=function(e){var t=e.split(".");return 1==t.length?"Перечисление."+e:("enm"==t[0]?e="Перечисление.":"cat"==t[0]?e="Справочник.":"doc"==t[0]?e="Документ.":"ireg"==t[0]?e="РегистрСведений.":"areg"==t[0]?e="РегистрНакопления.":"aссreg"==t[0]?e="РегистрБухгалтерии.":"cch"==t[0]?e="ПланВидовХарактеристик.":"cacc"==t[0]?e="ПланСчетов.":"dp"==t[0]?e="Обработка.":"rep"==t[0]&&(e="Отчет."),e+t[1])};for(n in a.enm)_enm[n]=new EnumManager(a.enm[n],"enm."+n);for(n in a.cat)_cat[n]=new CatManager("cat."+n);for(n in a.doc)_doc[n]=new DocManager("doc."+n);for(n in a.ireg)"$log"==n?_ireg[n]=new LogManager("ireg."+n):_ireg[n]=new InfoRegManager("ireg."+n);for(n in a.dp)_dp[n]=new DataProcessorsManager("dp."+n);for(n in a.cch)_cch[n]=new ChartOfCharacteristicManager("cch."+n);for(n in a.cacc)_cacc[n]=new ChartOfAccountManager("cacc."+n);return $p.modifiers.execute($p),{md_date:a.md_date,cat_date:a.cat_date}}function DataManager(class_name){var _metadata=_md.get(class_name),_cachable,_async_write=_metadata.async_write,_events={after_create:[],after_load:[],before_save:[],after_save:[],value_change:[]};_cachable=-1!=class_name.indexOf("enm.")?!0:$p.job_prm.offline?!0:-1!=class_name.indexOf("doc.")||-1!=class_name.indexOf("dp.")||-1!=class_name.indexOf("rep.")?!1:!0,$p.job_prm.offline||void 0==_metadata.cachable||(_cachable="НеКешировать"!=_metadata.cachable),this.__define({cachable:{value:_cachable,writable:!0,enumerable:!1},async_write:{value:_async_write,writable:!1,enumerable:!1},class_name:{value:class_name,writable:!1,enumerable:!1},alatable:{get:function(){return $p.wsql.aladb.tables[this.table_name]?$p.wsql.aladb.tables[this.table_name].data:[]},enumerable:!1},metadata:{value:function(e){return e?_metadata.fields[e]||_metadata.tabular_sections[e]:_metadata},enumerable:!1},attache_event:{value:function(e,t,n){n?_events[e].push(t):_events[e].push(t)},enumerable:!1},handle_event:{value:function(e,t,n){var a,r=[];return _events[t].forEach(function(t){r!==!1&&(a=t.call(e,n),a===!1?r=a:a&&r.push(a))}),r.length?1==r.length?r[0]:r.some(function(e){return"object"==typeof e&&e.then})?Promise.all(r):r:void 0},enumerable:!1}});var _obj_сonstructor=this._obj_сonstructor||DataObj;if(!(this instanceof EnumManager)){var obj_сonstructor_name=class_name.split(".")[1];if(this._obj_сonstructor=eval("(function "+obj_сonstructor_name.charAt(0).toUpperCase()+obj_сonstructor_name.substr(1)+"(attr, manager){manager._obj_сonstructor.superclass.constructor.call(this, attr, manager)})"),this._obj_сonstructor._extend(_obj_сonstructor),this instanceof InfoRegManager){delete this._obj_сonstructor.prototype.deleted,delete this._obj_сonstructor.prototype.ref,delete this._obj_сonstructor.prototype.lc_changed;for(var f in this.metadata().dimensions)this._obj_сonstructor.prototype.__define(f,{get:new Function("return this._getter('"+f+"')"),set:new Function("v","this._setter('"+f+"',v)"),enumerable:!0});for(var f in this.metadata().resources)this._obj_сonstructor.prototype.__define(f,{get:new Function("return this._getter('"+f+"')"),set:new Function("v","this._setter('"+f+"',v)"),enumerable:!0})}else{this._ts_сonstructors={};for(var f in this.metadata().fields)this._obj_сonstructor.prototype.__define(f,{get:new Function("return this._getter('"+f+"')"),set:new Function("v","this._setter('"+f+"',v)"),enumerable:!0});for(var f in this.metadata().tabular_sections){var row_сonstructor_name=obj_сonstructor_name.charAt(0).toUpperCase()+obj_сonstructor_name.substr(1)+f.charAt(0).toUpperCase()+f.substr(1)+"Row";this._ts_сonstructors[f]=eval("(function "+row_сonstructor_name+"(owner) 			{owner._owner._manager._ts_сonstructors[owner._name].superclass.constructor.call(this, owner)})"),this._ts_сonstructors[f]._extend(TabularSectionRow);for(var rf in this.metadata().tabular_sections[f].fields)this._ts_сonstructors[f].prototype.__define(rf,{get:new Function("return this._getter('"+rf+"')"),set:new Function("v","this._setter('"+rf+"',v)"),enumerable:!0});this._obj_сonstructor.prototype.__define(f,{get:new Function("return this._getter_ts('"+f+"')"),set:new Function("v","this._setter_ts('"+f+"',v)"),enumerable:!0})}}}_obj_сonstructor=null}function RefDataManager(e){var t=this,n={};RefDataManager.superclass.constructor.call(t,e),t.push=function(e,t){t&&t!=e.ref?(delete n[e.ref],n[t]=e):n[e.ref]=e},t.all=function(){return n},t.each=function(e){for(var t in n)if(t&&t!=$p.blank.guid&&1==e.call(this,n[t]))break},t.get=function(e,a,r){var o=n[e]||n[e=$p.fix_guid(e)];if(!o){if(r)return;o=new t._obj_сonstructor(e,t,!0)}return a===!1?o:void 0===a&&e===$p.blank.guid?o:!t.cachable||o.is_new()?o.load():a?Promise.resolve(o):o},t.create=function(e,a){e&&"object"==typeof e||(e={}),e.ref&&$p.is_guid(e.ref)&&!$p.is_empty_guid(e.ref)||(e.ref=$p.generate_guid());var r=n[e.ref];if(!r){if(r=new t._obj_сonstructor(e,t),!t.cachable&&a){var o={};return $p.ajax.default_attr(o,$p.job_prm.irest_url()),o.url+=t.rest_name+"/Create()",$p.ajax.get_ex(o.url,o).then(function(e){return r._mixin(JSON.parse(e.response),void 0,["ref"])})}if(a){var i=r._obj;for(var s in t.metadata().fields)void 0==i[s]&&(i[s]="")}}return Promise.resolve(r)},t.delete_loc=function(e){var a;delete n[e];for(var r in t.alatable)if(t.alatable[r].ref==e){a=r;break}void 0!=a&&t.alatable.splice(a,1)},t.find=function(e){return $p._find(n,e)},t.find_rows=function(e,a){return $p._find_rows.call(t,n,e,a)},t.save=function(e){return e&&(e.specify||$p.is_guid(e.ref)&&!t.cachable)?_load({class_name:t.class_name,action:e.action||"save",attr:e}).then(JSON.parse):Promise.reject()},t.load_array=function(e,a){var r,o;for(var i in e)r=$p.fix_guid(e[i]),(o=n[r])?(o.is_new()||a)&&(o._mixin(e[i]),o._set_loaded()):(o=new t._obj_сonstructor(e[i],t),a&&o._set_loaded())},t.predefined=function(e){var n=t.metadata().predefined[e];if(n)return t.get(n.ref)},t.first_folder=function(e){for(var a in n){var r=n[a];if(r.is_folder&&(!e||$p.is_equal(e,r.owner)))return r}return t.get()}}function DataProcessorsManager(e){DataProcessorsManager.superclass.constructor.call(this,e),this.create=function(){return new this._obj_сonstructor({},this)}}function EnumManager(e,t){EnumManager.superclass.constructor.call(this,t),this._obj_сonstructor=EnumObj,this.push=function(e,t){this.__define(t,{value:e,enumerable:!1})},this.get=function(e){if(e instanceof EnumObj)return e;e&&e!=$p.blank.guid||(e="_");var t=this[e];return t||(t=new EnumObj({name:e},this)),t},this.each=function(e){this.alatable.forEach(function(t){t.ref&&t.ref!=$p.blank.guid&&e.call(this[t.ref])})};for(var n in e)new EnumObj(e[n],this)}function RegisterManager(e){var t={};this._obj_сonstructor=RegisterRow,RegisterManager.superclass.constructor.call(this,e),this.push=function(e,n){n&&n!=e.ref?(delete t[e.ref],t[n]=e):t[e.ref]=e},this.get=function(e,n,a){e||(e={}),e.action="select";var r,o=$p.wsql.alasql(this.get_sql_struct(e),e._values);if(delete e.action,delete e._values,o.length)if(a)r=t[this.get_ref(o[0])];else{r=[];for(var i in o)r.push(t[this.get_ref(o[i])])}return n?Promise.resolve(r):r},this.load_array=function(e){var n,a,r=[];for(var o in e)n=this.get_ref(e[o]),(a=t[n])?a._mixin(e[o]):new this._obj_сonstructor(e[o],this),r.push(t[n]);return r},this.find_rows=function(e,t){return $p._find_rows.call(this,this.alatable,e,t)}}function InfoRegManager(e){InfoRegManager.superclass.constructor.call(this,e)}function LogManager(){LogManager.superclass.constructor.call(this,"ireg.$log");var e;this.record=function(t){if(t instanceof Error){console&&console.log(t);var n=t;t={"class":"error",note:n.toString()}}"object"!=typeof t&&(t={note:t}),t.date=Date.now()+$p.eve.time_diff(),e||(e=alasql.compile("select MAX(`sequence`) as `sequence` from `ireg_$log` where `date` = ?"));var a=e([t.date]);a.length&&void 0!==a[0].sequence?t.sequence=a[0].sequence+1:t.sequence=0,t["class"]||(t["class"]="note"),$p.wsql.alasql("insert into `ireg_$log` (`date`, `sequence`, `class`, `note`, `obj`) values (?, ?, ?, ?, ?)",[t.date,t.sequence,t["class"],t.note,t.obj?JSON.stringify(t.obj):""])},this.backup=function(e,t){},this.restore=function(e,t){},this.clear=function(e,t){},this.show=function(e){},this.get_sql_struct=function(e){if(e&&"get_selection"==e.action){var t="select * from `ireg_$log`";return e.date_from?t+=e.date_till?" where `date` >= ? and `date` <= ?":" where `date` >= ?":e.date_till&&(t+=" where `date` <= ?"),t}return LogManager.superclass.get_sql_struct.call(this,e)},this.caption_flds=function(e){function t(e,t,n,a,r,o){this.id=e,this.width=t,this.type=n,this.align=a,this.sort=r,this.caption=o}var n='<column id="%1" width="%2" type="%3" align="%4" sort="%5">%6</column>',a=[],r=(this.metadata(),"");if(a.push(new t("date","140","ro","left","server","Дата")),a.push(new t("class","100","ro","left","server","Класс")),a.push(new t("note","*","ro","left","server","Событие")),e.get_header){r="<head>";for(var o in a)r+=n.replace("%1",a[o].id).replace("%2",a[o].width).replace("%3",a[o].type).replace("%4",a[o].align).replace("%5",a[o].sort).replace("%6",a[o].caption);r+="</head>"}return{head:r,acols:a}},this.data_to_grid=function(e,t){var n="<?xml version='1.0' encoding='UTF-8'?><rows total_count='%1' pos='%2' set_parent='%3'>".replace("%1",e.length).replace("%2",t.start).replace("%3",t.set_parent||""),a=this.caption_flds(t),r=$p.eve.time_diff();return n+=a.head,e.forEach(function(e){n+='<row id="'+e.date+"_"+e.sequence+'"><cell>'+$p.dateFormat(e.date-r,$p.dateFormat.masks.date_time)+(e.sequence?"."+e.sequence:"")+"</cell><cell>"+e["class"]+"</cell><cell>"+e.note+"</cell></row>"}),n+"</rows>"}}function AccumRegManager(e){AccumRegManager.superclass.constructor.call(this,e)}function CatManager(e){this._obj_сonstructor=CatObj,CatManager.superclass.constructor.call(this,e),this.metadata().hierarchical&&this.metadata().group_hierarchy&&this._obj_сonstructor.prototype.__define("is_folder",{get:function(){return this._obj.is_folder||!1},set:function(e){this._obj.is_folder=$p.fix_boolean(e)},enumerable:!0})}function ChartOfCharacteristicManager(e){this._obj_сonstructor=CatObj,ChartOfCharacteristicManager.superclass.constructor.call(this,e)}function ChartOfAccountManager(e){this._obj_сonstructor=CatObj,ChartOfAccountManager.superclass.constructor.call(this,e)}function DocManager(e){this._obj_сonstructor=DocObj,DocManager.superclass.constructor.call(this,e)}function DataObj(e,t){var n,a,r={},o={data_version:""},i=!(this instanceof EnumObj);return t instanceof DataProcessorsManager||t instanceof EnumManager||(a=t.get(e,!1,!0)),a?a:(t instanceof EnumManager?o.ref=n=e.name:t instanceof RegisterManager?n=t.get_ref(e):(o.ref=n=$p.fix_guid(e),o.deleted=!1,o.lc_changed=0),this.__define("_manager",{value:t,enumerable:!1}),this.__define("is_new",{value:function(){return i},enumerable:!1}),this.__define("_set_loaded",{value:function(e){i=!1,t.push(this,e)},enumerable:!1}),this.__define("_obj",{value:o,writable:!1,enumerable:!1}),this.__define("_ts_",{value:function(e){return r[e]||(r[e]=new TabularSection(e,this)),r[e]},enumerable:!1}),void(t.alatable&&t.push&&(t.alatable.push(o),t.push(this,n))))}function CatObj(e,t){var n="";CatObj.superclass.constructor.call(this,e,t),this.__define("presentation",{get:function(){return this.name||this.id?this.name||this.id||this._metadata.obj_presentation:n},set:function(e){e&&(n=String(e))},enumerable:!1}),e&&"object"==typeof e&&(e._not_set_loaded?(delete e._not_set_loaded,this._mixin(e)):(this._mixin(e),$p.is_empty_guid(this.ref)||!e.id&&!e.name||this._set_loaded(this.ref)))}function DocObj(e,t){var n="";DocObj.superclass.constructor.call(this,e,t),this.__define("presentation",{get:function(){return this.number_str||this.number_doc?this._metadata.obj_presentation+" №"+(this.number_str||this.number_doc)+" от "+$p.dateFormat(this.date,$p.dateFormat.masks.ru):n},set:function(e){e&&(n=String(e))},enumerable:!1}),e&&"object"==typeof e&&this._mixin(e),!$p.is_empty_guid(this.ref)&&e.number_doc&&this._set_loaded(this.ref)}function DataProcessorObj(e,t){DataProcessorObj.superclass.constructor.call(this,e,t);var n,a=t.metadata();for(n in a.fields)e[n]=$p.fetch_type("",a.fields[n].type);for(n in a.tabular_sections)e[n]=[];this._mixin(e),this.unload=function(){for(n in this)this[n]instanceof TabularSection?(this[n].clear(),delete this[n]):"function"!=typeof this[n]&&delete this[n]}}function EnumObj(e,t){EnumObj.superclass.constructor.call(this,e,t),e&&"object"==typeof e&&this._mixin(e)}function RegisterRow(e,t){RegisterRow.superclass.constructor.call(this,e,t),e&&"object"==typeof e&&this._mixin(e)}function TabularSection(e,t){t._obj[e]||(t._obj[e]=[]),this.__define("_name",{value:e,enumerable:!1}),this.__define("_owner",{value:t,enumerable:!1}),this.__define("_obj",{value:t._obj[e],writable:!1,enumerable:!1})}function TabularSectionRow(e){var t={};this.__define("_owner",{value:e,enumerable:!1}),this.__define("_obj",{value:t,writable:!1,enumerable:!1})}function Rest(){this.filter_date=function(e,t,n){t||(t=new Date("2015-01-01"));var a=e+" gt datetime'"+$p.dateFormat(t,$p.dateFormat.masks.isoDateTime)+"'";return n&&(a+=" and "+e+" lt datetime'"+$p.dateFormat(n,$p.dateFormat.masks.isoDateTime)+"'"),a},this.to_data=function(e,t){var n,a,r,o,i,s,l={},c=t.metadata().fields,d=t.metadata().tabular_sections;t instanceof RefDataManager?(e.hasOwnProperty("DeletionMark")&&(l.deleted=e.DeletionMark),e.hasOwnProperty("DataVersion")&&(l.data_version=e.DataVersion),e.hasOwnProperty("Ref_Key")&&(l.ref=e.Ref_Key)):c=[]._mixin(t.metadata().dimensions)._mixin(t.metadata().resources),t instanceof DocManager?(e.hasOwnProperty("Number")?l.number_doc=e.Number||e.number_doc:e.hasOwnProperty("number_doc")&&(l.number_doc=e.number_doc),e.hasOwnProperty("Date")?l.date=e.Date:e.hasOwnProperty("date")&&(l.date=e.date),e.hasOwnProperty("Posted")?l.posted=e.Posted:e.hasOwnProperty("posted")&&(l.posted=e.posted)):(t.metadata().main_presentation_name&&(e.hasOwnProperty("Description")?l.name=e.Description:e.hasOwnProperty("name")&&(l.name=e.name)),t.metadata().code_length&&(e.hasOwnProperty("Code")?l.id=e.Code:e.hasOwnProperty("id")&&(l.id=e.id)));for(a in c)i=_md.syns_1с(a),-1==i.indexOf("_Key")&&c[a].type.is_ref&&e[i+"_Key"]&&(i+="_Key"),e.hasOwnProperty(i)&&(l[a]=e[i]);for(n in d)s="extra_fields"==n?n:_md.syns_1с(n),e.hasOwnProperty(s)&&(l[n]=[],e[s]&&(e[s].sort(function(e,t){return e.LineNumber>t.LineNumber}),e[s].forEach(function(e){o={};for(r in d[n].fields)i="extra_fields"!=n||"property"!=r&&"value"!=r?_md.syns_1с(r):r,-1==i.indexOf("_Key")&&d[n].fields[r].type.is_ref&&e[i+"_Key"]&&(i+="_Key"),o[r]=e[i];l[n].push(o)})));return l},this.ajax_to_data=function(e,t){return $p.ajax.get_ex(e.url,e).then(function(e){return JSON.parse(e.response)}).then(function(e){var n=[];return e.value.forEach(function(e){n.push(_rest.to_data(e,t))}),n})},this.build_select=function(e,t){function n(e,a){"function"==typeof a?o+=a(t,e):(i=_md.syns_1с(e),s=_md.get(t.class_name,e),s&&(s=s.type,s.is_ref&&-1==i.indexOf("_Key")&&s.types.length&&-1==s.types[0].indexOf("enm.")&&(i+="_Key"),s.types.length&&(-1!=["boolean","number"].indexOf(typeof a)?o+=i+" eq "+a:s.is_ref&&"object"!=typeof a||a instanceof DataObj?o+=i+" eq guid'"+a+"'":"string"==typeof a?o+=i+" eq '"+a+"'":"object"==typeof a&&(a.hasOwnProperty("like")?o+=i+" like '%"+a.like+"%'":a.hasOwnProperty("not")?o+=" not ("+n(e,a.not)+") ":a.hasOwnProperty("in")&&(o+=i+" in ("+(s.is_ref?a["in"].map(function(e){return"guid'"+e+"'"}).join(","):a["in"].join(","))+") ")))))}function a(e){for(var t in e)if(o?o+=" and ":o="&$filter=","or"==t&&Array.isArray(e[t])){var a=!0;e[t].forEach(function(e){a?(o+=" ( ",a=!1):o+=" or ";var t=Object.keys(e)[0];n(t,e[t])}),o+=" ) "}else n(t,e[t])}var r,o,i,s,l="";e||(e={}),e.fields&&(e.fields.forEach(function(e){"ref"==e?i="Ref_Key":(i=_md.syns_1с(e),s=_md.get(t.class_name,e).type,s.is_ref&&-1==i.indexOf("_Key")&&s.types.length&&-1==s.types[0].indexOf("enm.")&&(i+="_Key")),r?r+=",":r="&$select=",r+=i}),l+=r),e.selection&&("function"==typeof e.selection||(Array.isArray(e.selection)?e.selection.forEach(a):a(e.selection)),o&&(l+=o)),$p.job_prm.rest&&-1==t.rest_name.indexOf("Module_")&&-1==t.rest_name.indexOf("DataProcessor_")&&-1==t.rest_name.indexOf("Report_")&&-1==l.indexOf(" like ")&&-1==l.indexOf(" in ")&&!t.metadata().irest?$p.ajax.default_attr(e,$p.job_prm.rest_url()):$p.ajax.default_attr(e,$p.job_prm.irest_url()),e.url+=t.rest_name+"?allowedOnly=true&$format=json&$top="+(e.top||300)+l},this.load_array=function(e,t){return _rest.build_select(e,t),_rest.ajax_to_data(e,t)},this.load_obj=function(e){var t={};return $p.ajax.default_attr(t,!e._metadata.irest&&$p.job_prm.rest?$p.job_prm.rest_url():$p.job_prm.irest_url()),t.url+=e._manager.rest_name+"(guid'"+e.ref+"')?$format=json",$p.ajax.get_ex(t.url,t).then(function(e){return JSON.parse(e.response)}).then(function(t){return e._mixin(_rest.to_data(t,e._manager))._set_loaded(),e})["catch"](function(t){return 404==t.status?e:void $p.record_log(t)})},this.save_irest=function(e,t){var n=JSON.stringify(e),a=(void 0!=t.post?",post="+t.post:"")+(void 0!=t.operational?",operational="+t.operational:"");return $p.ajax.default_attr(t,$p.job_prm.irest_url()),t.url+=e._manager.rest_name+"(guid'"+e.ref+"'"+a+")",$p.ajax.post_ex(t.url,n,t).then(function(e){return JSON.parse(e.response)}).then(function(t){return e._mixin(t)})},this.save_rest=function(e,t){var n,a=e.to_atom();return $p.ajax.default_attr(t,$p.job_prm.rest_url()),n=t.url+e._manager.rest_name,t.url=n+"(guid'"+e.ref+"')?$format=json&$select=Ref_Key,DeletionMark",$p.ajax.get_ex(t.url,t)["catch"](function(e){return 404==e.status?{response:JSON.stringify({is_new:!0})}:Promise.reject(e)}).then(function(e){return JSON.parse(e.response)}).then(function(r){return r.is_new?$p.ajax.post_ex(n,a,t):$p.ajax.patch_ex(n+"(guid'"+e.ref+"')",a,t)}).then(function(t){var n=xmlToJSON.parseString(t.response,{mergeCDATA:!1,grokAttr:!0,grokText:!1,normalize:!0,xmlns:!1,namespaceKey:"_ns",textKey:"_text",valueKey:"_value",attrKey:"_attr",cdataKey:"_cdata",attrsAsObject:!1,stripAttrPrefix:!0,stripElemPrefix:!0,childrenAsArray:!1});if(n.entry&&n.entry.content&&n.entry.updated){var a,r=n.entry.content.properties,o={};o.lc_changed=new Date(n.entry.updated._text);for(var i in r)if(0!=i.indexOf("_"))if(a=r[i].element)if(o[i]=[],Array.isArray(a))for(var s in a){o[i][s]={};for(var l in a[s])0!=l.indexOf("_")&&(o[i][s][l]="false"===a[s][l]._text?!1:a[s][l]._text)}else{o[i][0]={};for(var l in a)0!=l.indexOf("_")&&(o[i][0][l]="false"===a[l]._text?!1:a[l]._text)}else o[i]="false"===r[i]._text?!1:r[i]._text;return _rest.to_data(o,e._manager)}}).then(function(t){return e._mixin(t)})}}function wnd_appcache(e){function t(){n.wnd_appcache=e.iface.w.createWindow("wnd_appcache",0,0,490,250);var t=[{type:"block",name:"form_block_1",list:[{type:"label",name:"form_label_1",label:e.msg.sync_script},{type:"block",name:"form_block_2",list:[{type:"template",name:"img_long",className:"img_long"},{type:"newcolumn"},{type:"template",name:"text_processed"},{type:"template",name:"text_current"},{type:"template",name:"text_bottom"}]}]},{type:"button",name:"form_button_1",value:e.msg.sync_break}];n.frm_appcache=n.wnd_appcache.attachForm(t),n.frm_appcache.attachEvent("onButtonClick",function(e){n&&(n.do_break=!0)}),n.wnd_appcache.setText(e.msg.long_operation),n.wnd_appcache.denyResize(),n.wnd_appcache.centerOnScreen(),n.wnd_appcache.button("park").hide(),n.wnd_appcache.button("minmax").hide(),n.wnd_appcache.button("close").hide()}var n,a=e.iface.appcache={};a.create=function(e){n=e,t()},a.update=function(){n.frm_appcache.setItemValue("text_processed","Обработано элементов: "+n.loaded+" из "+n.total)},a.close=function(){n&&n.wnd_appcache&&(n.wnd_appcache.close(),delete n.wnd_appcache)}}function only_in_browser(w){var eve=$p.eve,iface=$p.iface,msg=$p.msg,stepper={},timer_setted=!1,cache;eve.set_offline=function(e){var t=$p.job_prm.offline;$p.job_prm.offline=!(!e&&!$p.wsql.get_user_param("offline","boolean")),t!=$p.job_prm.offline&&(t=$p.job_prm.offline)},eve.on_rotate=function(e){$p.device_orient=0==w.orientation||180==w.orientation?"portrait":"landscape","undefined"!=typeof e&&w.dhx4.callEvent("onOrientationChange",[$p.device_orient])},"undefined"==typeof w.orientation?$p.device_orient=w.innerWidth>w.innerHeight?"landscape":"portrait":eve.on_rotate(),w.addEventListener("orientationchange",eve.on_rotate,!1),$p.__define("device_type",{get:function(){var e=$p.wsql.get_user_param("device_type");return e||(e=function(e){return 1024>e?"phone":1280>e?"tablet":"desktop"}(Math.max(screen.width,screen.height)),$p.wsql.set_user_param("device_type",e)),e},set:function(e){$p.wsql.set_user_param("device_type",e)},enumerable:!1,configurable:!1}),w.addEventListener("online",eve.set_offline),w.addEventListener("offline",function(){eve.set_offline(!0)}),w.addEventListener("load",function(){function do_reload(){$p.ajax.authorized||(eve.redirect=!0,location.reload(!0))}function do_cache_update_msg(e){!stepper.wnd_appcache&&$p.iface.appcache?$p.iface.appcache.create(stepper):timer_setted||(timer_setted=!0,setTimeout(do_reload,25e3)),$p.iface.appcache&&(stepper.loaded=e.loaded||0,stepper.total=e.total||140,$p.iface.appcache.update()),stepper.do_break&&($p.iface.appcache.close(),setTimeout(do_reload,1e3))}setTimeout(function(){function IPInfo(){function e(){this.geocode=function(e){return Promise.resolve(!1)}}var t,n,a,r="";this.__define({ipgeo:{value:function(){return $p.ajax.get("//api.sypexgeo.net/").then(function(e){return JSON.parse(e.response)})["catch"]($p.record_log)}},yageocoder:{get:function(){return t||(t=new e),t},enumerable:!1,configurable:!1},ggeocoder:{get:function(){return n},enumerable:!1,configurable:!1},addr:{get:function(){return r}},parts:{get:function(){return a}},components:{value:function(e,t){var n,a,r,o="",i="",s="";for(n in t){a=t[n];for(r in a.types)switch(a.types[r]){case"route":-1==a.short_name.indexOf("Unnamed")&&(o=a.short_name+(o?" "+o:""),i=a.long_name.replace("улица","").trim());break;case"administrative_area_level_1":e.region=a.long_name;break;case"administrative_area_level_2":e.city=a.short_name,e.city_long=a.long_name;break;case"locality":s=(s?s+" ":"")+a.short_name;break;case"street_number":o=(o?o+" ":"")+a.short_name;break;case"postal_code":e.postal_code=a.short_name}}return e.region&&e.region==e.city_long?-1==e.city.indexOf(s)?e.city=s:e.city="":s&&-1==e.city.indexOf(s)&&-1==e.region.indexOf(s)&&(o=s+", "+o),e.street&&-1!=e.street.indexOf(i)||(e.street=o),e}}}),this.location_callback=function(){n=new google.maps.Geocoder,navigator.geolocation.getCurrentPosition(function(e){$p.ipinfo.latitude=e.coords.latitude,$p.ipinfo.longitude=e.coords.longitude;var t=new google.maps.LatLng($p.ipinfo.latitude,$p.ipinfo.longitude);n.geocode({latLng:t},function(e,t){t==google.maps.GeocoderStatus.OK&&(a=!e[1]||e[0].address_components.length>=e[1].address_components.length?e[0]:e[1],r=a.formatted_address,dhx4.callEvent("geo_current_position",[$p.ipinfo.components({},a.address_components)]))})},$p.record_log,{timeout:3e4})}}function navigate(e){e&&-1==(location.origin+location.pathname).indexOf(e)&&location.replace(e)}function init_params(){$p.wsql.init_params().then(function(){function e(){var e,t,n,a=!0,r=!0,o=new RegExp("metadata.js$"),i=new RegExp("metadata.min.js$");for(e in document.scripts){if(document.scripts[e].src.match(o)){n=o,t=document.scripts[e].src;break}if(document.scripts[e].src.match(i)){n=i,t=document.scripts[e].src;break}}for(e=0;e<document.styleSheets.length;e++)document.styleSheets[e].href&&(-1!=document.styleSheets[e].href.indexOf("dhx_web")||-1!=document.styleSheets[e].href.indexOf("dhx_terrace")?a=!1:-1!=document.styleSheets[e].href.indexOf("metadata.css")&&(r=!1));dhtmlx.skin=$p.wsql.get_user_param("skin")||$p.job_prm.skin||"dhx_web",a&&$p.load_script(t.replace(n,"dhx_web"==dhtmlx.skin?"dhx_web.css":"dhx_terrace.css"),"link"),r&&$p.load_script(t.replace(n,"metadata.css"),"link"),$p.job_prm.additional_css&&$p.job_prm.additional_css.forEach(function(e){(dhx4.isIE||-1==e.indexOf("ie_only"))&&$p.load_script(e,"link")}),dhtmlx.image_path=t.replace(n,"imgs/"),dhtmlx.skin_suffix=function(){return dhtmlx.skin.replace("dhx","")+"/"},dhx4.ajax.cache=!0,$p.iface.__define("w",{value:new dhtmlXWindows,enumerable:!1}),$p.iface.w.setSkin(dhtmlx.skin),$p.iface.__define("popup",{value:new dhtmlXPopup,enumerable:!1})}if("dhtmlx"in w&&e(),eve.stepper={step:0,count_all:0,cat_date:0,step_size:57,files:0,cat_ini_date:$p.wsql.get_user_param("cache_cat_date","number")||0},eve.set_offline(!navigator.onLine),eve.update_files_version(),document.documentElement.webkitRequestFullScreen&&navigator.userAgent.match(/Android|iPhone|iPad|iPod/i)&&($p.job_prm.request_full_screen||$p.wsql.get_user_param("request_full_screen"))){var t=function(){document.documentElement.webkitRequestFullScreen(),w.removeEventListener("touchstart",t)};w.addEventListener("touchstart",t,!1)}($p.job_prm.use_builder||$p.job_prm.use_wrapper)&&($p.wrapper=document.getElementById("owb_wrapper"),$p.risdiv=document.getElementById("risdiv"),$p.ft=document.getElementById("msgfooter"),$p.ft&&($p.ft.style.display="none")),eve.onload.execute($p),document&&document.querySelector("#splash")&&document.querySelector("#splash").parentNode.removeChild(document.querySelector("#splash")),$p.job_prm.use_builder&&$p.ft?dhtmlxEvent($p.ft,"click",function(e){$p.cancel_bubble(e),"ready"==e.qualifier?iface.oninit():$p.eve.builder_click&&$p.eve.builder_click(e)}):setTimeout(iface.oninit,100),$p.msg.russian_names(),$p.wsql.get_user_param("use_service_worker","boolean")&&"undefined"!=typeof navigator&&"serviceWorker"in navigator&&-1!=location.protocol.indexOf("https")?navigator.serviceWorker.register("metadata_service_worker.js",{scope:"/"}).then(function(e){$p.record_log("serviceWorker register succeeded")})["catch"]($p.record_log):(cache=w.applicationCache)&&(cache.addEventListener("noupdate",function(e){},!1),cache.addEventListener("cached",function(e){timer_setted=!0,$p.iface.appcache&&$p.iface.appcache.close()},!1),cache.addEventListener("downloading",do_cache_update_msg,!1),cache.addEventListener("progress",do_cache_update_msg,!1),cache.addEventListener("updateready",function(e){try{cache.swapCache(),$p.iface.appcache&&$p.iface.appcache.close()}catch(e){}do_reload()},!1),cache.addEventListener("error",$p.record_log,!1))})}if($p.job_prm=new JobPrm,($p.job_prm.use_ip_geo||$p.job_prm.use_google_geo)&&($p.ipinfo=new IPInfo),navigator.geolocation&&$p.job_prm.use_google_geo&&(window.google&&window.google.maps?location_callback():$p.eve.onload.push(function(){setTimeout(function(){$p.load_script(location.protocol+"//maps.google.com/maps/api/js?callback=$p.ipinfo.location_callback","script",function(){})},100)})),$p.job_prm.allow_post_message&&w.addEventListener("message",function(event){if(("*"==$p.job_prm.allow_post_message||$p.job_prm.allow_post_message==event.origin)&&"string"==typeof event.data)try{var res=eval(event.data);if(res&&event.source){if("object"==typeof res)res=JSON.stringify(res);else if("function"==typeof res)return;event.source.postMessage(res,"*")}}catch(e){$p.record_log(e)}}),eve.socket.connect(),!w.JSON||!w.indexedDB)throw eve.redirect=!0,msg.show_msg({type:"alert-error",text:msg.unsupported_browser,title:msg.unsupported_browser_title}),msg.unsupported_browser;setTimeout(function(){"function"!=typeof Promise?$p.load_script("//cdn.jsdelivr.net/es6-promise/latest/es6-promise.min.js","script",function(){
ES6Promise.polyfill(),init_params()}):init_params()},20)},20)},!1),w.onbeforeunload=function(){return eve.redirect?void 0:msg.onbeforeunload},w.addEventListener("popstat",$p.iface.hash_route),w.addEventListener("hashchange",$p.iface.hash_route)}function SocketMsg(){function e(e){if(e&&"react"==e.type)try{var t=_md?_md.mgr_by_class_name(e.class_name):null;t&&t.load_array([e.obj],!0)}catch(n){$p.record_log(n)}}var t,n,a,r=0,o=this;o.connect=function(e){if(t||(t=$p.job_prm.parse_url().socket_uid||""),e&&(r=0),r++,$p.job_prm.ws_url&&(!n||!a))try{n=new WebSocket($p.job_prm.ws_url),n.onopen=function(){a=!0,n.send(JSON.stringify({socket_uid:t,zone:$p.wsql.get_user_param("zone"),browser_uid:$p.wsql.get_user_param("browser_uid"),_side:"js",_mirror:!0}))},n.onclose=function(){a=!1,setTimeout(o.connect,3>r?3e4:6e5)},n.onmessage=function(e){var t;try{t=JSON.parse(e.data)}catch(n){t=e.data}dhx4.callEvent("socket_msg",[t])},n.onerror=$p.record_log}catch(i){setTimeout(o.connect,3>r?3e4:6e5),$p.record_log(i)}},o.send=function(e){n&&a&&(e?"object"!=typeof e&&(e={data:e}):e={},e.socket_uid=t,e._side="js",n.send(JSON.stringify(e)))},"undefined"!=typeof window&&window.dhx4&&dhx4.attachEvent("socket_msg",e)}var $p=new MetaEngine;"undefined"!=typeof window&&($p.load_script=function(e,t,n){var a=document.createElement(t);"script"==t?(a.type="text/javascript",a.src=e,n?(a.async=!0,a.addEventListener("load",n,!1)):a.async=!1):(a.type="text/css",a.rel="stylesheet",a.href=e),document.head.appendChild(a)}),Object.defineProperty(Object.prototype,"__define",{value:function(e,t){return t?Object.defineProperty(this,e,t):Object.defineProperties(this,e),this},enumerable:!1}),Object.prototype.__define({_extend:{value:function(e){var t=function(){};t.prototype=e.prototype,this.prototype=new t,this.prototype.constructor=this,this.__define("superclass",{value:e.prototype,enumerable:!1})},enumerable:!1},_mixin:{value:function(e,t,n){var a,r,o={};if(t&&t.length)for(a=0;a<t.length;a++)r=t[a],n&&-1!=n.indexOf(r)||("undefined"==typeof o[r]||o[r]!=e[r])&&(this[r]=e[r]);else for(r in e)n&&-1!=n.indexOf(r)||("undefined"==typeof o[r]||o[r]!=e[r])&&(this[r]=e[r]);return this},enumerable:!1},_clone:{value:function(){if(!this||"object"!=typeof this)return this;var e,t,n="function"==typeof this.pop?[]:{};for(e in this)this.hasOwnProperty(e)&&(t=this[e],t?"function"==typeof t||t instanceof DataObj||t instanceof DataManager?n[e]=t:"object"==typeof t?n[e]=t._clone():n[e]=t:n[e]=t);return n},enumerable:!1}}),Object.observe||Object.unobserve||Object.getNotifier||Object.prototype.__define({observe:{value:function(e,t){e._observers||e.__define({_observers:{value:[],enumerable:!1},_notis:{value:[],enumerable:!1}}),e._observers.push(t)},enumerable:!1},unobserve:{value:function(e,t){if(e._observers)for(var n in e._observers)if(e._observers[n]===t){e._observers.splice(n,1);break}},enumerable:!1},getNotifier:{value:function(e){var t;return{notify:function(n){e._observers&&(e._notis.push(n),t||(t=!0,setTimeout(function(){e._observers.forEach(function(t){t(e._notis)}),e._notis.length=0,t=!1},10)))}}},enumerable:!1}}),/**
 * Date Format 1.2.3
 * (c) 2007-2009 Steven Levithan <stevenlevithan.com>
 * MIT license
 *
 * Includes enhancements by Scott Trenda <scott.trenda.net>
 * and Kris Kowal <cixar.com/~kris.kowal/>
 *
 * Accepts a date, a mask, or a date and a mask.
 * Returns a formatted version of the given date.
 * The date defaults to the current date/time.
 * The mask defaults to dateFormat.masks.default.
 * @method dateFormat
 * @for MetaEngine
 * @param date {Date} - источник
 * @param mask {dateFormat.masks} - маска формата
 * @param utc {Boolean} Converts the date from local time to UTC/GMT
 * @return {String}
 */
$p.dateFormat=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,a=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e};return function(r,o,i){var s=$p.dateFormat;o||(o=$p.dateFormat.masks.ru),1!=arguments.length||"[object String]"!=Object.prototype.toString.call(r)||/\d/.test(r)||(o=r,r=void 0),r=r?new Date(r):new Date,isNaN(r)&&(r=new Date(0)),o=String(s.masks[o]||o||s.masks["default"]),"UTC:"==o.slice(0,4)&&(o=o.slice(4),i=!0);var l=i?"getUTC":"get",c=r[l+"Date"](),d=r[l+"Day"](),p=r[l+"Month"](),_=r[l+"FullYear"](),u=r[l+"Hours"](),f=r[l+"Minutes"](),m=r[l+"Seconds"](),h=r[l+"Milliseconds"](),g=i?0:r.getTimezoneOffset(),b={d:c,dd:a(c),ddd:s.i18n.dayNames[d],dddd:s.i18n.dayNames[d+7],m:p+1,mm:a(p+1),mmm:s.i18n.monthNames[p],mmmm:s.i18n.monthNames[p+12],yy:String(_).slice(2),yyyy:_,h:u%12||12,hh:a(u%12||12),H:u,HH:a(u),M:f,MM:a(f),s:m,ss:a(m),l:a(h,3),L:a(h>99?Math.round(h/10):h),t:12>u?"a":"p",tt:12>u?"am":"pm",T:12>u?"A":"P",TT:12>u?"AM":"PM",Z:i?"UTC":(String(r).match(t)||[""]).pop().replace(n,""),o:(g>0?"-":"+")+a(100*Math.floor(Math.abs(g)/60)+Math.abs(g)%60,4),S:["th","st","nd","rd"][c%10>3?0:(c%100-c%10!=10)*c%10]};return o.replace(e,function(e){return e in b?b[e]:e.slice(1,e.length-1)})}}(),$p.dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",atom:"yyyy-mm-dd'T'HH:MM:ss'Z'",ru:"dd.mm.yyyy HH:MM",short_ru:"dd.mm.yyyy",date:"dd.mm.yy",date_time:"dd.mm.yy HH:MM"},$p.ajax=new function(){function e(e,t,n,a,r){return new Promise(function(o,i){if("undefined"==typeof window&&a&&a.request)a.request({url:encodeURI(t),headers:{Authorization:a.auth}},function(e,t,n){e?i(e):200!=t.statusCode?i({message:t.statusMessage,description:n,status:t.statusCode}):o({response:n})});else{var s=new XMLHttpRequest;if(window.dhx4&&window.dhx4.isIE&&(t=encodeURI(t)),a){var l,c;"object"==typeof a&&a.username&&a.hasOwnProperty("password")?(l=a.username,c=a.password):$p.ajax.username&&$p.ajax.authorized?(l=$p.ajax.username,c=$p.ajax.password):(l=$p.wsql.get_user_param("user_name"),c=$p.wsql.get_user_param("user_pwd"),!l&&$p.job_prm&&$p.job_prm.guest_name&&(l=$p.job_prm.guest_name,c=$p.job_prm.guest_pwd)),s.open(e,t,!0,l,c),s.withCredentials=!0,s.setRequestHeader("Authorization","Basic "+btoa(unescape(encodeURIComponent(l+":"+c))))}else s.open(e,t,!0);r&&r.call(this,s),"GET"!=e?this.hide_headers||a.hide_headers||(s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.setRequestHeader("X-Requested-With","XMLHttpRequest")):n=null,s.onload=function(){200==s.status&&(s.response instanceof Blob||"<!DOCTYPE"!==s.response.substr(0,9))?(void 0==s.responseURL&&(s.responseURL=t),o(s)):i(s.response?{message:s.statusText,description:s.response,status:s.status}:Error(s.statusText))},s.onerror=function(){i(Error("Network Error"))},s.send(n)}})}this.username="",this.password="",this.authorized=!1,this.get=function(t){return e.call(this,"GET",t)},this.post=function(t,n){return 1==arguments.length?n="":2==arguments.length&&"function"==typeof n?(onLoad=n,n=""):n=String(n),e.call(this,"POST",t,n)},this.get_ex=function(t,n,a){return e.call(this,"GET",t,null,n,a)},this.post_ex=function(t,n,a,r){return e.call(this,"POST",t,n,a,r)},this.put_ex=function(t,n,a,r){return e.call(this,"PUT",t,n,a,r)},this.patch_ex=function(t,n,a,r){return e.call(this,"PATCH",t,n,a,r)},this.delete_ex=function(t,n,a){return e.call(this,"DELETE",t,null,n,a)},this.get_and_show_blob=function(e,t,n){function a(t){return e=window.URL.createObjectURL(t.response),r=window.open(e,"wnd_print",o),r.onload=function(t){window.URL.revokeObjectURL(e)},r}var r,o="menubar=no,toolbar=no,location=no,status=no,directories=no,resizable=yes,scrollbars=yes";return!n||"string"==typeof n&&-1!=n.toLowerCase().indexOf("post")?this.post_ex(e,"object"==typeof t?JSON.stringify(t):t,!0,function(e){e.responseType="blob"}).then(a):this.get_ex(e,!0,function(e){e.responseType="blob"}).then(a)},this.get_and_save_blob=function(e,t,n){return this.post_ex(e,"object"==typeof t?JSON.stringify(t):t,!0,function(e){e.responseType="blob"}).then(function(e){saveAs(e.response,n)})},this.default_attr=function(e,t){e.url||(e.url=t),e.username||(e.username=this.username),e.password||(e.password=this.password),e.hide_headers=!0,$p.job_prm["1c"]&&(e.auth=$p.job_prm["1c"].auth,e.request=$p.job_prm["1c"].request)}},$p.m={point_pos:function(e,t,n,a,r,o){return Math.abs(n-r)<.2?(e-n)*(a-o):Math.abs(a-o)<.2?(t-a)*(r-n):(t-a)*(r-n)-(o-a)*(e-n)},arc_cntr:function(e,t,n,a,r,o){var i,s,l,c,d,p,_,u,f;if(o){var m=e,h=t;e=n,t=a,n=m,a=h}return e!=n?(i=(e*e-n*n-a*a+t*t)/(2*(e-n)),s=(a-t)/(e-n),l=s*s+1,c=-2*((e-i)*s+t),d=(e-i)*(e-i)-r*r+t*t,p=(-c+Math.sqrt(c*c-4*l*d))/(2*l),_=i+s*p,u=(-c-Math.sqrt(c*c-4*l*d))/(2*l),f=i+s*u):(i=(t*t-a*a-n*n+e*e)/(2*(t-a)),s=(n-e)/(t-a),l=s*s+1,c=-2*((t-i)*s+e),d=(t-i)*(t-i)-r*r+e*e,_=(-c-Math.sqrt(c*c-4*l*d))/(2*l),p=i+s*_,f=(-c+Math.sqrt(c*c-4*l*d))/(2*l),u=i+s*f),$p.m.point_pos(_,p,e,t,n,a)>0?{x:_,y:p}:{x:f,y:u}},arc_point:function(e,t,n,a,r,o,i){var s={x:(e+n)/2,y:(t+a)/2};if(r>0){var l,c,d,p=e-n,_=t-a,u=r*r-(p*p+_*_)/4;u>=0&&(d=$p.m.arc_cntr(e,t,n,a,r,o),p=d.x-s.x,_=s.y-d.y,l=Math.sqrt(p*p+_*_),c=i?r+Math.sqrt(u):r-Math.sqrt(u),s.x+=p*c/l,s.y+=_*c/l)}return s}},$p.blank=new function(){this.date=new Date("0001-01-01"),this.guid="00000000-0000-0000-0000-000000000000",this.by_type=function(e){var t;return t=e.is_ref?$p.blank.guid:e.date_part?$p.blank.date:e.digits?0:e.types&&"boolean"==e.types[0]?!1:""}},$p.is_guid=function(e){return"string"!=typeof e||e.length<36?!1:(e.length>36&&(e=e.substr(0,36)),/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(e))},$p.is_empty_guid=function(e){return!e||e===$p.blank.guid},$p.generate_guid=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:7&n|8).toString(16)})},$p.fix_guid=function(e,t){if(e&&"string"==typeof e);else{if(e instanceof DataObj)return e.ref;if(e&&"object"==typeof e)if(e.presentation){if(e.ref)return e.ref;if(e.name)return e.name}else e="object"==typeof e.ref&&e.ref.hasOwnProperty("ref")?e.ref.ref:e.ref}return $p.is_guid(e)||t===!1?e:t?$p.generate_guid():$p.blank.guid},$p.fix_number=function(e,t){var n=parseFloat(e);return isNaN(n)?t?0:e:n},$p.fix_boolean=function(e){return"string"==typeof e?!(!e||"false"==e.toLowerCase()):!!e},$p.fix_date=function(e,t){var n=/(^\d{1,4}[\.|\\/|-]\d{1,2}[\.|\\/|-]\d{1,4})(\s*(?:0?[1-9]:[0-5]|1(?=[012])\d:[0-5])\d\s*[ap]m)?$/;if(e instanceof Date)return e;if(e&&"string"==typeof e&&n.test(e.substr(0,10))){var a,r,o=e.split(" "),i=o[0].split(".");if(1==i.length&&(i=o[0].split("/"),1==i.length&&(i=o[0].split("-"))),3==i.length&&4==i[2].length){r=i[2]+"-"+i[1]+"-"+i[0];for(var s=1;s<o.length;s++)r+=" "+o[s];a=new Date(r)}else a=new Date(e);if(a&&a.getFullYear()>0)return a}return t?$p.blank.date:e},$p.date_add_day=function(e,t){var n=new Date;return n.setDate(e.getDate()+t),n},$p.cancel_bubble=function(e){var t=e||event;return t&&t.stopPropagation&&t.stopPropagation(),t&&!t.cancelBubble&&(t.cancelBubble=!0),!1},$p.msg=new Messages,$p.iface=new InterfaceObjs,$p.Modifiers=Modifiers,$p.eve=new AppEvents,$p.__define("modifiers",{value:new Modifiers,enumerable:!1,configurable:!1}),$p.JobPrm=JobPrm,$p.wsql=new WSQL;var msg=$p.msg;$p.dateFormat.i18n={dayNames:["Вс","Пн","Вт","Ср","Чт","Пт","Сб","Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],monthNames:["Янв","Фев","Maр","Aпр","Maй","Июн","Июл","Aвг","Сен","Окт","Ноя","Дек","Январь","Февраль","Март","Апрель","Maй","Июнь","Июль","Август","Сентябрь","Oктябрь","Ноябрь","Декабрь"]},"undefined"!=typeof window&&"dhx4"in window&&(dhx4.dateFormat.ru="%d.%m.%Y",dhx4.dateLang="ru",dhx4.dateStrings={ru:{monthFullName:["Январь","Февраль","Март","Апрель","Maй","Июнь","Июль","Август","Сентябрь","Oктябрь","Ноябрь","Декабрь"],monthShortName:["Янв","Фев","Maр","Aпр","Maй","Июн","Июл","Aвг","Сен","Окт","Ноя","Дек"],dayFullName:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],dayShortName:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"]}}),$p.msg.russian_names=function(){$p.job_prm.russian_names&&(window.__define({"Метаданные":{get:function(){return _md},enumerable:!1},"Справочники":{get:function(){return _cat},enumerable:!1},"Документы":{get:function(){return _doc},enumerable:!1},"РегистрыСведений":{get:function(){return _ireg},enumerable:!1},"РегистрыНакопления":{get:function(){return _areg},enumerable:!1},"РегистрыБухгалтерии":{get:function(){return _aссreg},enumerable:!1},"Обработки":{get:function(){return _dp},enumerable:!1},"Отчеты":{get:function(){return _rep},enumerable:!1},"ОбластьКонтента":{get:function(){return $p.iface.docs},enumerable:!1},"Сообщить":{get:function(){return $p.msg.show_msg},enumerable:!1},"Истина":{value:!0,enumerable:!1},"Ложь":{value:!1,enumerable:!1}}),DataManager.prototype.__define({"ФормаВыбора":{get:function(){return this.form_selection},enumerable:!1},"ФормаОбъекта":{get:function(){return this.form_obj},enumerable:!1},"Найти":{get:function(){return this.find},enumerable:!1},"НайтиСтроки":{get:function(){return this.find_rows},enumerable:!1},"НайтиПоНаименованию":{get:function(){return this.by_name},enumerable:!1}}),DataObj.prototype.__define({"ФормаОбъекта":{get:function(){return this.form_obj},enumerable:!1}}))},$p.fias=function(){},function(e){e.toString=function(){return"Коды адресного классификатора"},e.types=["владение","здание","помещение"],e[1010]={name:"дом",type:1,order:1,fid:2,syn:[" д."," д "," дом"]},e[1020]={name:"владение",type:1,order:2,fid:1,syn:[" вл."," вл "," влад."," влад "," владен."," владен "," владение"]},e[1030]={name:"домовладение",type:1,order:3,fid:3},e[1050]={name:"корпус",type:2,order:1,syn:[" к."," к "," корп."," корп ","корпус"]},e[1060]={name:"строение",type:2,order:2,fid:1,syn:[" стр."," стр "," строен."," строен ","строение"]},e[1080]={name:"литера",type:2,order:3,fid:3,syn:[" л."," л "," лит."," лит ","литера"]},e[1070]={name:"сооружение",type:2,order:4,fid:2,syn:[" соор."," соор "," сооруж."," сооруж ","сооружение"]},e[1040]={name:"участок",type:2,order:5,syn:[" уч."," уч ","участок"]},e[2010]={name:"квартира",type:3,order:1,syn:["кв.","кв ","кварт.","кварт ","квартира","-"]},e[2030]={name:"офис",type:3,order:2,syn:["оф.","оф ","офис","-"]},e[2040]={name:"бокс",type:3,order:3},e[2020]={name:"помещение",type:3,order:4},e[2050]={name:"комната",type:3,order:5,syn:["комн.","комн ","комната"]},e[101e5]={name:"Почтовый индекс"},e[102e5]={name:"Адресная точка"},e[103e5]={name:"Садовое товарищество"},e[104e5]={name:"Элемент улично-дорожной сети, планировочной структуры дополнительного адресного элемента"},e[105e5]={name:"Промышленная зона"},e[106e5]={name:"Гаражно-строительный кооператив"},e[107e5]={name:"Территория"}}($p.fias),msg.store_url_od="https://chrome.google.com/webstore/detail/hcncallbdlondnoadgjomnhifopfaage",msg.align_node_right="Уравнять вертикально вправо",msg.align_node_bottom="Уравнять горизонтально вниз",msg.align_node_top="Уравнять горизонтально вверх",msg.align_node_left="Уравнять вертикально влево",msg.align_set_right="Установить размер сдвигом вправо",msg.align_set_bottom="Установить размер сдвигом вниз",msg.align_set_top="Установить размер сдвигом вверх",msg.align_set_left="Установить размер сдвигом влево",msg.align_invalid_direction="Неприменимо для элемента с данной ориентацией",msg.argument_is_not_ref="Аргумент не является ссылкой",msg.addr_title="Ввод адреса",msg.cache_update_title="Обновление кеша браузера",msg.cache_update="Выполняется загрузка измененных файлов<br/>и их кеширование в хранилище браузера",msg.delivery_area_empty="Укажите район доставки",msg.empty_login_password="Не указаны имя пользователя или пароль",msg.empty_response="Пустой ответ сервера",msg.empty_geocoding="Пустой ответ геокодера. Вероятно, отслеживание адреса запрещено в настройках браузера",msg.error_auth="Авторизация пользователя не выполнена",msg.error_critical="Критическая ошибка",msg.error_metadata="Ошибка загрузки метаданных конфигурации",msg.error_network="Ошибка сети или сервера - запрос отклонен",msg.error_rights="Ограничение доступа",msg.file_size="Запрещена загрузка файлов<br/>размером более ",msg.file_confirm_delete="Подтвердите удаление файла ",msg.file_new_date="Файлы на сервере обновлены<br /> Рекомендуется закрыть браузер и войти<br />повторно для применения обновления",msg.file_new_date_title="Версия файлов",msg.init_catalogues="Загрузка справочников с сервера",msg.init_catalogues_meta=": Метаданные объектов",msg.init_catalogues_tables=": Реструктуризация таблиц",msg.init_catalogues_nom=": Базовые типы + номенклатура",msg.init_catalogues_sys=": Технологические справочники",msg.init_login="Укажите имя пользователя и пароль",msg.requery="Повторите попытку через 1-2 минуты",msg.limit_query="Превышено число обращений к серверу<br/>Запросов за минуту:%1<br/>Лимит запросов:%2<br/>"+msg.requery,msg.long_operation="Длительная операция",msg.main_title="Окнософт: заказ дилера ",msg.meta_cat="Справочники",msg.meta_doc="Документы",msg.meta_cch="Планы видов характеристик",msg.meta_cacc="Планы счетов",msg.meta_ireg="Регистры сведений",msg.meta_areg="Регистры накопления",msg.meta_mgr="Менеджер",msg.meta_cat_mgr="Менеджер справочников",msg.meta_doc_mgr="Менеджер документов",msg.meta_enn_mgr="Менеджер перечислений",msg.meta_ireg_mgr="Менеджер регистров сведений",msg.meta_areg_mgr="Менеджер регистров накопления",msg.meta_accreg_mgr="Менеджер регистров бухгалтерии",msg.meta_dp_mgr="Менеджер обработок",msg.meta_reports_mgr="Менеджер отчетов",msg.meta_charts_of_accounts_mgr="Менеджер планов счетов",msg.meta_charts_of_characteristic_mgr="Менеджер планов видов характеристик",msg.meta_extender="Модификаторы объектов и менеджеров",msg.no_metadata="Не найдены метаданные объекта '%1'",msg.no_selected_row="Не выбрана строка табличной части '%1'",msg.no_dhtmlx="Библиотека dhtmlx не загружена",msg.not_implemented="Не реализовано в текущей версии",msg.offline_request="Запрос к серверу в автономном режиме",msg.onbeforeunload="Окнософт: легкий клиент. Закрыть программу?",msg.order_sent_title="Подтвердите отправку заказа",msg.order_sent_message="Отправленный заказ нельзя изменить.<br/>После проверки менеджером<br/>он будет запущен в работу",msg.request_title="Окнософт: Запрос регистрации",msg.request_message="Заявка зарегистрирована. После обработки менеджером будет сформировано ответное письмо",msg.select_from_list="Выбор из списка",msg.select_grp="Укажите группу, а не элемент",msg.select_elm="Укажите элемент, а не группу",msg.select_file_import="Укажите файл для импорта",msg.srv_overload="Сервер перегружен",msg.sub_row_change_disabled="Текущая строка подчинена продукции.<br/>Строку нельзя изменить-удалить в документе<br/>только через построитель",msg.sync_script="Обновление скриптов приложения:",msg.sync_data="Синхронизация с сервером выполняется:<br />* при первом старте программы<br /> * при обновлении метаданных<br /> * при изменении цен или технологических справочников",msg.sync_break="Прервать синхронизацию",msg.sync_no_data="Файл не содержит подходящих элементов для загрузки",msg.unsupported_browser_title="Браузер не поддерживается",msg.unsupported_browser="Несовместимая версия браузера<br/>Рекомендуется Google Chrome",msg.supported_browsers="Рекомендуется Chrome, Safari или Opera",msg.unsupported_mode_title="Режим не поддерживается",msg.unsupported_mode="Программа не установлена<br/> в <a href='"+msg.store_url_od+"'>приложениях Google Chrome</a>",msg.unknown_error="Неизвестная ошибка в функции '%1'",msg.value="Значение",msg.bld_constructor="Конструктор объектов графического построителя",msg.bld_title="Графический построитель",msg.bld_empty_param="Не заполнен обязательный параметр <br />",msg.bld_not_product="В текущей строке нет изделия построителя",msg.bld_not_draw="Отсутствует эскиз или не указана система профилей",msg.bld_wnd_title="Построитель изделия № ",msg.bld_from_blocks_title="Выбор типового блока",msg.bld_from_blocks="Текущее изделие будет заменено конфигурацией типового блока. Продолжить?",msg.bld_split_imp="В параметрах продукции<br />'%1'<br />запрещены незамкнутые контуры<br />Для включения деления импостом,<br />установите это свойство в 'Истина'";var eXcell_proto=new eXcell;eXcell_proto.input_keydown=function(e,t){function n(e){t.source.on_select&&t.source.on_select.call(t.source,e)}if(8===e.keyCode||46===e.keyCode)t.setValue(""),t.grid.editStop(),t.source.on_select&&t.source.on_select.call(t.source,"");else if(9===e.keyCode||13===e.keyCode)t.grid.editStop();else if(115===e.keyCode)t.cell.firstChild.childNodes[1].onclick(e);else if(113===e.keyCode)if(t.source.tabular_section){if(t.mgr=_md.value_mgr(t.source.row,t.source.col,t.source.row._metadata.fields[t.source.col].type),t.mgr){var a=t.source.row[t.source.col];t.mgr.form_obj(t.source.wnd,{o:a,on_select:n})}}else if(1==t.fpath.length&&(t.mgr=_md.value_mgr(t.source.o._obj,t.fpath[0],t.source.o._metadata.fields[t.fpath[0]].type),t.mgr)){var a=t.source.o[t.fpath[0]];t.mgr.form_obj(t.source.wnd,{o:a,on_select:n})}return $p.cancel_bubble(e)},eXcell_ocombo.prototype=eXcell_proto,window.eXcell_ocombo=eXcell_ocombo,window.eXcell_ref=eXcell_ocombo,window.eXcell_refc=eXcell_ocombo,eXcell_pwd.prototype=eXcell_proto,window.eXcell_pwd=eXcell_pwd,dhtmlXCalendarObject.prototype._dateToStr=function(e,t){return e instanceof Date&&e.getFullYear()<1e3?"":window.dhx4.date2str(e,t||this._dateFormat,this._dateStrings())},eXcell_dhxCalendar.prototype.edit=function(){var e=this.grid.getPosition(this.cell);this.grid._grid_calendarA._show(!1,!1),this.grid._grid_calendarA.setPosition(e[0],e[1]+this.cell.offsetHeight),this.grid._grid_calendarA._last_operation_calendar=!1,this.grid.callEvent("onCalendarShow",[this.grid._grid_calendarA,this.cell.parentNode.idd,this.cell._cellIndex]),this.cell._cediton=!0,this.val=this.cell.val,this.val instanceof Date&&this.val.getFullYear()<1e3&&(this.val=new Date),this._val=this.cell.innerHTML;var t=this.grid._grid_calendarA.draw;this.grid._grid_calendarA.draw=function(){},this.grid._grid_calendarA.setDateFormat(this.grid._dtmask||"%d.%m.%Y"),this.grid._grid_calendarA.setDate(this.val||new Date),this.grid._grid_calendarA.draw=t},function(){function e(e,t,n,a){if(-1!=n.indexOf("odata/standard.odata")||-1!=n.indexOf("/hs/rest")){var r,o;$p.ajax.authorized?(r=$p.ajax.username,o=$p.ajax.password):$p.job_prm.guest_name?(r=$p.job_prm.guest_name,o=$p.job_prm.guest_pwd):(r=$p.wsql.get_user_param("user_name"),o=$p.wsql.get_user_param("user_pwd")),e.open(t,n,a,r,o),e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa(unescape(encodeURIComponent(r+":"+o))))}else e.open(t,n,a)}dhx4.ajax._call=function(t,n,a,r,o,i,s){var l=window.XMLHttpRequest&&!dhx4.isIE?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),c=null!=navigator.userAgent.match(/AppleWebKit/)&&null!=navigator.userAgent.match(/Qt/)&&null!=navigator.userAgent.match(/Safari/);if(1==r&&(l.onreadystatechange=function(){if(4==l.readyState||1==c&&3==l.readyState){if((200!=l.status||""==l.responseText)&&!dhx4.callEvent("onAjaxError",[{xmlDoc:l,filePath:n,async:r}]))return;window.setTimeout(function(){"function"==typeof o&&o.apply(window,[{xmlDoc:l,filePath:n,async:r}]),null!=i&&("undefined"!=typeof i.postData?dhx4.ajax.postLong(i.url,i.postData,o):dhx4.ajax.getLong(i.url,o)),o=null,l=null},1)}}),"GET"==t&&1!=this.cache&&(n+=(n.indexOf("?")>=0?"&":"?")+"dhxr"+(new Date).getTime()+"=1"),e(l,t,n,r),null!=s)for(var d in s)l.setRequestHeader(d,s[d]);else"POST"==t||"PUT"==t||"DELETE"==t?l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"):"GET"==t&&(a=null);return l.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.send(a),{xmlDoc:l,filePath:n,async:r}},dhtmlx.ajax.prototype.send=function(t,n,a){var r=this.getXHR();if("function"==typeof a&&(a=[a]),"object"==typeof n){var o=[];for(var i in n){var s=n[i];(null===s||s===dhtmlx.undefined)&&(s=""),o.push(i+"="+encodeURIComponent(s))}n=o.join("&")}n&&!this.post&&(t=t+(-1!=t.indexOf("?")?"&":"?")+n,n=null),e(r,this.post?"POST":"GET",t,!this._sync),this.post&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded");var l=this;return r.onreadystatechange=function(){if(!r.readyState||4==r.readyState){if(a&&l)for(var e=0;e<a.length;e++)a[e]&&a[e].call(l.master||l,r.responseText,r.responseXML,r);l.master=null,a=l=null}},r.send(n||null),r}}(),$p.iface.data_to_grid=function(e,t){function n(e){var t;return t=e.is_folder?"cell_ref_folder":"cell_ref_elm",e.deleted&&(t+="_deleted"),t}function a(e,t){return"svg"==t?$p.iface.normalize_xml(e[t]):e[t]instanceof Date?e[t].getHours()||e.date.getMinutes()?$p.dateFormat(e[t],$p.dateFormat.masks.date_time):$p.dateFormat(e[t],$p.dateFormat.masks.date):e[t]||""}if(this.data_to_grid)return this.data_to_grid(e,t);var r="<?xml version='1.0' encoding='UTF-8'?><rows total_count='%1' pos='%2' set_parent='%3'>".replace("%1",e.length).replace("%2",t.start).replace("%3",t.set_parent||""),o=this.caption_flds(t);return r+=o.head,e.forEach(function(e){r+='<row id="'+e.ref+'"><cell class="'+n(e)+'">'+a(e,[o.acols[0].id])+"</cell>";for(var t=1;t<o.acols.length;t++)r+="<cell>"+a(e,[o.acols[t].id])+"</cell>";r+="</row>"}),r+"</rows>"},$p.iface.data_to_tree=function(e){function t(e,a){n=n+'<item text="'+e.presentation.replace(/"/g,"'")+'" id="'+e.ref+'" im0="'+dhtmlx.image_cache("tree","folderClosed")+'">',$p._find_rows(a,{parent:e.ref},function(e){t(e,a)}),n+="</item>"}var n="<?xml version='1.0' encoding='UTF-8'?><tree id=\"0\">";return t({presentation:"...",ref:$p.blank.guid},[]),$p._find_rows(e,{parent:$p.blank.guid},function(n){t(n,e)}),n+"</tree>"},$p.iface.ODropdownList=ODropdownList,OCombo._extend(dhtmlXCombo),$p.iface.OCombo=OCombo,$p.iface.select_from_list=function(e,t){return new Promise(function(n,a){function r(e){"cancel"!=e&&(o=c.getSelectedRowId()),l.close()}Array.isArray(e)&&e.length?1==e.length&&n(e[0]):n(void 0);var o,i,s={name:"wnd_select_from_list",wnd:{id:"wnd_select_from_list",width:300,height:300,modal:!0,center:!0,caption:$p.msg.select_from_list,allow_close:!0,on_close:function(){return o&&n(e[parseInt(o)-1]),!0}}},l=$p.iface.dat_blank(null,s.wnd),c=l.attachGrid(),d=l.attachToolbar({items:[{id:"select",type:"button",text:$p.msg.select_from_list},{id:"cancel",type:"button",text:"Отмена"}],onClick:r});c.setIconsPath(dhtmlx.image_path),c.setImagePath(dhtmlx.image_path),c.setHeader($p.msg.value),c.setColTypes("ro"),c.enableAutoWidth(!0,1200,600),c.attachEvent("onRowDblClicked",r),c.enableMultiselect(!!t),c.setNoHeader(!0),c.init(),d.addSpacer("select"),l.hideHeader(),l.cell.offsetParent.querySelector(".dhxwin_brd").style.border="none",e.forEach(function(e,t){var n;n="object"==typeof e?e.presentation||e.text||e.toString():e.toString(),c.addRow(1+t,n),e.selected&&(i=1+t)}),i&&c.selectRowById(i)})},dhtmlXCellObject.prototype.attachHeadFields=function(e){function t(e){if(a)_.entBox&&!_.entBox.parentElement?setTimeout(_.destructor):e.forEach(function(e){"unload"==e.type?p&&p.close?p.close():_.destructor():_.forEachRow(function(t){t==e.name&&_.cells(t,1).setValue(a[e.name])})});else{var r=[];e.forEach(function(e){-1==r.indexOf[e.object]&&(r.push(e.object),Object.unobserve(e.object,t),c&&c instanceof TabularSection&&Object.unobserve(e.object,n))}),r=null}}function n(t){var n;t.forEach(function(t){n||l!=t.tabular||(n=!0,_.clearAll(),_.parse(i.get_property_grid_xml(r,a,{title:e.ts_title,ts:l,selection:s,meta:o}),function(){},"xml"))})}var a,r,o,i,s,l,c,d,p=this,_=this.attachGrid(),u=_.destructor;return new dhtmlXPropertyGrid(_),_.setInitWidthsP("40,60"),_.setDateFormat("%d.%m.%Y %H:%i"),_.init(),_.setSizes(),_.attachEvent("onPropertyChanged",function(e,t,n){return e?d.on_select(t):void 0}),_.attachEvent("onCheckbox",function(e,t,n){return void 0!=a[e]?d.on_select(n,{obj:a,field:e}):void 0}),e.read_only&&_.setEditable(!1),_.get_cell_field=function(){if(a){var e={row_id:_.getSelectedRowId()},t=e.row_id.split("|");if(t.length<2)return{obj:a,field:t[0]}._mixin(d);var n=a[t[0]].find(t[1]);return n?(e.obj=n,n["Значение"]?(e.field="Значение",e.property=n.Свойство||n.Параметр):(e.field="value",e.property=n.property||n.param),e._mixin(d)):void 0}},_.destructor=function(){a&&Object.unobserve(a,t),c&&c instanceof TabularSection&&Object.unobserve(c,n),a=null,c=null,o=null,i=null,d=null,u.call(_)},_.__define("selection",{get:function(){return s},set:function(e){s=e,n([{tabular:l}])},enumerable:!1}),_.attach=function(e){a&&Object.unobserve(a,t),c&&c instanceof TabularSection&&Object.unobserve(a,n),e.oxml&&(r=e.oxml),e.selection&&(s=e.selection),a=e.obj,o=e.meta||a._metadata.fields,i=a._manager,l=e.ts||"",c=l?a[l]:a.extra_fields||a["ДополнительныеРеквизиты"],c&&!l&&(l=a.extra_fields?"extra_fields":"ДополнительныеРеквизиты"),d={on_select:function(e,t){if(t||(t=_.get_cell_field()),t){var n=i.handle_event(a,"value_change",{field:t.field,value:e,tabular_section:t.row_id?l:"",grid:_,cell:_.cells(t.row_id||t.field,1),wnd:d.pwnd});return"boolean"!=typeof n&&(t.obj[t.field]=e,n=!0),n}},pwnd:e.pwnd||p},Object.observe(a,t,["update","unload"]),c&&c instanceof TabularSection&&Object.observe(a,n,["row"]),l&&!e.ts_title&&(e.ts_title=a._metadata.tabular_sections[l].synonym),n([{tabular:l}])},e&&_.attach(e),_},dhtmlXGridObject.prototype.get_cell_value=function(){var e=this.get_cell_field();return e&&e.obj?e.obj[e.field]:void 0},dhtmlXCellObject.prototype.attachTabular=function(e){function t(e){var t=m.getSelectedRowId();return t&&!isNaN(Number(t))?Number(t)-1:void(e||$p.msg.show_msg({type:"alert-warning",text:$p.msg.no_selected_row.replace("%1",s._metadata.tabular_sections[l].synonym||l),title:(s._metadata.obj_presentation||s._metadata.synonym)+": "+s.presentation}))}function n(){var e=c.add();setTimeout(function(){m.selectRowById(e.row)},100)}function a(){var e=t();void 0!=e&&c.del(e)}function r(e,t,n,a,r){if(2!=e||a==r)return!0;var o=m.get_cell_field(),i=d.handle_event(s,"value_change",{field:o.field,value:a,tabular_section:l,grid:m,row:o.obj,cell:t&&n?m.cells(t,n):m.cells(),wnd:b.pwnd});return"boolean"!=typeof i&&(o.obj[o.field]=a,i=!0),i}function o(e){var t;e.forEach(function(e){t||l!=e.tabular||(t=!0,c.sync_grid(m,f))})}function i(e){if(e.length>4)try{c.sync_grid(m,f)}catch(t){}else e.forEach(function(e){if(l==e.tabular)if(m.getSelectedRowId()!=e.row.row)c.sync_grid(m,f);else{var t=m.cells(e.row.row,m.getColIndexById(e.name));t.setCValue($p.is_data_obj(e.row[e.name])?e.row[e.name].presentation:e.row[e.name])}})}var s=e.obj,l=e.ts,c=s[l],d=s._manager,p=e.meta||d.metadata().tabular_sections[l].fields,_=this,u={},f=e.selection;if(_md.ts_captions(d.class_name,l,u)){var m=this.attachGrid(),h=this.attachToolbar(),g=m.destructor,b={on_select:function(e){r(2,null,null,e)},pwnd:e.pwnd||_,is_tabular:!0};return m.setDateFormat("%d.%m.%Y %H:%i"),h.setIconsPath(dhtmlx.image_path+"dhxtoolbar"+dhtmlx.skin_suffix()),h.loadStruct($p.injected_data["toolbar_add_del.xml"],function(){this.attachEvent("onclick",function(e){"btn_add"==e?n():"btn_delete"==e&&a()})}),m.setIconsPath(dhtmlx.image_path),m.setImagePath(dhtmlx.image_path),m.setHeader(u.headers),u.min_widths&&m.setInitWidths(u.widths),u.min_widths&&m.setColumnMinWidth(u.min_widths),u.aligns&&m.setColAlign(u.aligns),m.setColSorting(u.sortings),m.setColTypes(u.types),m.setColumnIds(u.fields.join(",")),m.enableAutoWidth(!0,1200,600),m.enableEditTabOnly(!0),m.init(),e.read_only&&(m.setEditable(!1),h.disableItem("btn_add"),h.disableItem("btn_delete")),m.attachEvent("onEditCell",r),m.get_cell_field=function(){var e,n,a=t(!0),r=m.getSelectedCellIndex();return c&&void 0!=a&&r>=0?(e=c.get(a),n=m.getColumnId(r),{obj:e,field:n}._mixin(b)):void 0},m.destructor=function(){s&&(Object.unobserve(s,i),Object.unobserve(s,o)),s=null,c=null,p=null,d=null,b=null,_.detachToolbar(),g.call(m)},m.__define("selection",{get:function(){return f},set:function(e){f=e,o([{tabular:l}])},enumerable:!1}),o([{tabular:l}]),Object.observe(s,i,["row"]),Object.observe(s,o,["rows"]),m}},"undefined"!=typeof window&&"dhtmlx"in window&&(eXcell_rsvg.prototype=eXcell_proto,window.eXcell_rsvg=eXcell_rsvg,$p.iface.OSvgs=function(e,t,n){function a(){if(s.style.display=c?"none":"",t.setSizes)t.setSizes();else{var e=t.getDimension();t.setDimension(e[0],e[1]),t.maximize()}c?(i.style.backgroundPositionX="-32px",i.style.top=t.setSizes?"16px":"-18px"):(i.style.backgroundPositionX="0px",i.style.top="0px")}function r(e){var t,n;if($p.iface.clear_svgs(s),e.svgs.length)for(t in e.svgs)e.svgs[t]&&"<"==e.svgs[t].substr(0,1)&&(n=document.createElement("div"),s.appendChild(n),n.style["float"]="left",n.innerHTML=$p.iface.scale_svg(e.svgs[t],88,22));else;}var o=this,i=document.createElement("div"),s=document.createElement("div"),l=[],c=$p.wsql.get_user_param("svgs_area_hidden","boolean"),d=n.querySelector(".dhx_cell_statusbar_text");d&&(d.style.display="none"),s.className="svgs-area",n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),i.className="svgs-minmax",i.title="Скрыть/показать панель эскизов",i.onclick=function(){c=!c,$p.wsql.set_user_param("svgs_area_hidden",c),a(),!c&&l.length&&o.reload()},n.appendChild(i),a(),this.reload=function(t){t&&l.push(t),c||setTimeout(function(){l.length&&(e.save({ref:l.pop(),specify:"order_pics",action:"calc",async:!0}).then(r)["catch"]($p.record_log),l.length=0)},300)}}),$p.iface.Toolbar_filter=function(e){function t(){i&&(clearTimeout(i),i=0),e.onchange.call(r,r.get_filter())}function n(){i&&clearTimeout(i),i=setTimeout(function(){i&&t()},600)}function a(e,t){"min"==t?r.сalendar.setSensitiveRange(e.value,null):r.сalendar.setSensitiveRange(null,e.value)}var r=this,o=350,i=0;e.pos||(e.pos=6),(e.manager instanceof DocManager||e.period)&&(o=180,e.toolbar.addText("lbl_date_from",e.pos,"Период с:"),e.pos++,e.toolbar.addInput("input_date_from",e.pos,"",72),e.pos++,e.toolbar.addText("lbl_date_till",e.pos,"по:"),e.pos++,e.toolbar.addInput("input_date_till",e.pos,"",72),e.pos++,r.input_date_from=e.toolbar.getInput("input_date_from"),r.input_date_from.setAttribute("readOnly","true"),r.input_date_from.onclick=function(){a(r.input_date_till,"max")},r.input_date_till=e.toolbar.getInput("input_date_till"),r.input_date_till.setAttribute("readOnly","true"),r.input_date_till.onclick=function(){a(r.input_date_from,"min")},r.сalendar=new dhtmlXCalendarObject([r.input_date_from,r.input_date_till]),r.сalendar.attachEvent("onclick",t),e.date_from||(e.date_from=new Date((new Date).getFullYear().toFixed()+"-01-01")),e.date_till||(e.date_till=$p.date_add_day(new Date,1)),r.input_date_from.value=$p.dateFormat(e.date_from,$p.dateFormat.masks.short_ru),r.input_date_till.value=$p.dateFormat(e.date_till,$p.dateFormat.masks.short_ru)),e.hide_filter?r.input_date_till?e.toolbar.addSpacer("input_date_till"):e.toolbar.getItemText("btn_delete")&&e.toolbar.addSpacer("btn_delete"):(e.toolbar.addText("lbl_filter",e.pos,"Фильтр"),e.pos++,e.toolbar.addInput("input_filter",e.pos,"",o),r.input_filter=e.toolbar.getInput("input_filter"),r.input_filter.onchange=t,r.input_filter.onkeydown=n,r.input_filter.type="search",e.toolbar.addSpacer("input_filter")),r.get_filter=function(){return{date_from:r.input_date_from?dhx4.str2date(r.input_date_from.value):"",date_till:r.input_date_till?dhx4.str2date(r.input_date_till.value):"",filter:r.input_filter?r.input_filter.value:""}}},dhtmlXCellObject.prototype.attachDynTree=function(e,t,n){this.setCollapsedText&&this.setCollapsedText("Дерево"),t||(t={is_folder:!0});var a=this.attachTree();return a.setImagePath(dhtmlx.image_path+"dhxtree"+dhtmlx.skin_suffix()),
a.setIconsPath(dhtmlx.image_path+"dhxtree"+dhtmlx.skin_suffix()),"desktop"==$p.device_type&&a.enableKeyboardNavigation(!0),a.__define({filter:{get:function(){},set:function(e){t=e},enumerable:!1,configurable:!1}}),setTimeout(function(){$p.cat.load_soap_to_grid({action:"get_tree",class_name:e.class_name,filter:t},a,n)}),a},$p.iface.dat_blank=function(e,t){t||(t={});var n,a=!1,r=t.id||"wnd_dat_"+dhx4.newId();return n=(e||$p.iface.w).createWindow({id:r,left:t.left||900,top:t.top||20,width:t.width||220,height:t.height||300,move:!0,park:!t.allow_close,center:!!t.center,resize:!0,caption:t.caption||"Tools"}),e=null,t.allow_minmax||n.button("minmax").hide(),t.allow_close?n.button("park").hide():n.button("close").hide(),"function"==typeof t.on_close&&n.attachEvent("onClose",t.on_close),n.setIconCss("without_icon"),n.cell.parentNode.children[1].classList.add("dat_gui"),$p.iface.bind_help(n,t.help_path),n.elmnts={},n.__define("modified",{get:function(){return a},set:function(e){a=e;var t=n.getText();a&&t.lastIndexOf("*")!=t.length-1?n.setText(t+" *"):a||t.lastIndexOf("*")!=t.length-1||n.setText(t.replace(" *",""))},enumerable:!1,configurable:!1}),n.wnd_options=function(e){var t=n.getPosition(),a=n.getDimension(),r=n.isParked();e.left=t[0],e.top=t[1],e.width=a[0],e.parked=r,r||(e.height=a[1])},n.bottom_toolbar=function(e){var t={wrapper:n.cell,width:"100%",height:"28px",bottom:"0px",left:"0px",name:"tb_bottom",buttons:[{name:"btn_cancel",text:"Отмена",title:"Закрыть без сохранения",width:"60px","float":"right"},{name:"btn_ok",b:"Ок",title:"Применить изменения",width:"30px","float":"right"}],onclick:function(e){return!1}}._mixin(e),a=new OTooolBar(t),r=n.attachStatusBar({height:12});return r.style.zIndex=-1e3,r.firstChild.style.backgroundColor="transparent",r.firstChild.style.border="none",a},t.modal&&(t.pwnd&&t.pwnd.setModal&&t.pwnd.setModal(0),n.setModal(1)),n},$p.iface.dat_tree=function(e,t){var n=$p.iface.dat_blank(e,t),a=document.createElement("div"),r=document.createElement("div"),o=document.createElement("div");return e=null,n.setMinDimension(250,300),n.attachObject(a),a.appendChild(r),a.appendChild(o),n.cell_a=r,n.tree=new dhtmlXTreeObject(o,"100%","100%",0),n.tree.setImagePath(dhtmlx.image_path+"dhxtree"+dhtmlx.skin_suffix()),n.tree.setIconsPath(dhtmlx.image_path+"dhxtree"+dhtmlx.skin_suffix()),n.tree.enableCheckBoxes(!0,!0),n.tree.enableTreeImages(!1),n},$p.iface.dat_pgrid=function(e,t){var n=$p.iface.dat_blank(e,t);e=null,n.setMinDimension(320,300);var a=n.elmnts.pgrid=n.attachPropertyGrid();return a.setDateFormat("%d.%m.%Y %H:%i"),a.init(),t.grid_struct&&a.parse(t.o._manager.get_property_grid_xml(t.grid_struct,t.v),function(){a.enableAutoHeight(!1),a.setSizes(),a.setUserData("","source",{o:t.v,grid:a,on_select:$p.iface.pgrid_on_select,slist:t.grid_slist,grid_on_change:t.grid_on_change,wnd:n}),a.attachEvent("onPropertyChanged",$p.iface.pgrid_on_change),a.attachEvent("onCheckbox",$p.iface.pgrid_on_checkbox)},"xml"),n},$p.iface.pgrid_on_select=function(e){if(void 0!==e){var t=this.grid instanceof dhtmlXGridObject?this.grid:this,n=t.getUserData("","source"),a=t.getSelectedRowId();if(void 0!=n.o[a])"number"==typeof n.o[a]?n.o[a]=$p.fix_number(e,!0):n.o[a]=e;else if(a.indexOf("fprms")>-1){var r=$p._find(n.o.fprms,a.split("|")[1]);r.value=e}t.cells().setValue($p.is_data_obj(e)?e.presentation:e||""),n.wnd&&(n.wnd.modified=!0),n.grid_on_change&&n.grid_on_change.call(t,a,e)}},$p.iface.pgrid_on_change=function(e,t,n){e&&$p.iface.pgrid_on_select.call(this,t)},$p.iface.pgrid_on_checkbox=function(e,t,n){var a=this.grid instanceof dhtmlXGridObject?this.grid:this,r=a.getUserData("","source");void 0!=r.o[e]&&(r.o[e]=n),r.wnd&&(r.wnd.modified=!0),r.grid_on_change&&r.grid_on_change(e,n)},$p.iface.layout_2u=function(e){var t=$p.iface;return t.main=new dhtmlXLayoutObject({parent:document.body,pattern:"2U"}),t.main.attachEvent("onCollapse",function(e){return"b"==e?(t.docs.expand(),!1):void 0}),t.docs=t.main.cells("b"),_clear_all(),t.cell_tree=t.main.cells("a"),t.cell_tree.setText("Режим"),t.cell_tree.setWidth("190"),t.cell_tree.fixSize(!1,!1),t.cell_tree.collapse(),t.tree=t.cell_tree.attachTree(),t.tree.setImagePath(dhtmlx.image_path+"dhxtree"+dhtmlx.skin_suffix()),t.tree.setIconsPath(dhtmlx.image_path+"dhxtree"+dhtmlx.skin_suffix()),e?(t.tree.attachEvent("onSelect",e.onselect),new Promise(function(n,a){t.tree.loadXML(e.path+"?v="+$p.job_prm.files_date,function(){this.tree_filteres=e.path,n(this)})})):(t.tree.attachEvent("onSelect",function(e){var n=e.split(".");if(n.length>1&&"oper"==t.swith_view(n[0])){var a=$p.md.mgr_by_class_name(e.substr(5));"function"==typeof t.docs.close&&t.docs.close(),a&&a.form_list(t.docs,{})}}),Promise.resolve(t.tree))},$p.iface.layout_1c=function(){var e=$p.iface;return new Promise(function(t,n){try{e.main=new dhtmlXLayoutObject({parent:document.body,pattern:"1C",offsets:{top:4,right:4,bottom:4,left:4}}),e.docs=e.main.cells("a"),_clear_all(),t(!0)}catch(a){n(a)}})},$p.iface.frm_auth=function(e,t,n,a){function r(a,r,o){$p.ajax.username=a,$p.ajax.password=r,a?(o||$p.wsql.set_user_param("user_name",a),$p.is_guid($p.wsql.get_user_param("browser_uid"))||$p.wsql.set_user_param("browser_uid",$p.generate_guid()),$p.eve.log_in(e).then(l.on_auth||t)["catch"](function(e){s=!0,(l.on_error||n)&&(l.on_error||n)(e)}).then(function(e){$p.iface.sync&&$p.iface.sync.close(),$p.iface.docs&&($p.iface.docs.progressOff(),s||$p.iface.docs.hideHeader()),$p.iface.cell_tree&&!s&&$p.iface.cell_tree.expand()})):this.validate()}function o(e){this.resetValidateCss(),"guest"==this.getCheckedValue("type")?(r.call(this,this.getItemValue("guest"),"",!0),$p.wsql.set_user_param("user_name","")):"auth"==this.getCheckedValue("type")&&r.call(this,this.getItemValue("login"),this.getItemValue("password"))}var i,s,l=$p.iface.auth=$p.iface.docs.attachForm();e||(e=function(e){var t=$p.eve.stepper;switch(e){case $p.eve.steps.authorization:t.frm_sync.setItemValue("text_processed","Авторизация");break;case $p.eve.steps.load_meta:$p.iface.docs.progressOn(),$p.msg.show_msg($p.msg.init_catalogues+$p.msg.init_catalogues_meta,$p.iface.docs),$p.iface.sync||$p.iface.wnd_sync(),$p.iface.sync.create(t);break;case $p.eve.steps.create_managers:t.frm_sync.setItemValue("text_processed","Обработка метаданных"),t.frm_sync.setItemValue("text_bottom","Создаём объекты менеджеров данных...");break;case $p.eve.steps.process_access:break;case $p.eve.steps.load_data_files:t.frm_sync.setItemValue("text_processed","Загрузка начального образа"),t.frm_sync.setItemValue("text_bottom","Читаем файлы данных зоны...");break;case $p.eve.steps.load_data_db:t.frm_sync.setItemValue("text_processed","Загрузка изменений из 1С"),t.frm_sync.setItemValue("text_bottom","Читаем изменённые справочники");break;case $p.eve.steps.load_data_wsql:break;case $p.eve.steps.save_data_wsql:t.frm_sync.setItemValue("text_processed","Кеширование данных"),t.frm_sync.setItemValue("text_bottom","Сохраняем таблицы в локальном SQL...")}}),l.loadStruct($p.injected_data["form_auth.xml"],function(){$p.wsql.get_user_param("user_name")&&(l.setItemValue("login",$p.wsql.get_user_param("user_name")),l.setItemValue("type","auth"),$p.wsql.get_user_param("enable_save_pwd")&&$p.wsql.get_user_param("user_pwd")&&(l.setItemValue("password",$p.wsql.get_user_param("user_pwd")),$p.wsql.get_user_param("autologin")&&o())),(i=($p.iface.docs.getWidth()-500)/2)>=10?l.cont.style.paddingLeft=i.toFixed()+"px":l.cont.style.paddingLeft="20px",setTimeout(a)}),l.attachEvent("onButtonClick",o),l.attachEvent("onKeyDown",function(e,t,n,a){13==t.keyCode&&("password"==n||"guest"==this.getCheckedValue("type"))&&o.call(this)}),$p.msg.show_msg($p.msg.init_login,$p.iface.docs),l.onerror=function(e){$p.ajax.authorized=!1;var t=e.message.toLowerCase();-1!=t.indexOf("auth")?($p.msg.show_msg({title:$p.msg.main_title+$p.version,type:"alert-error",text:$p.msg.error_auth}),l.setItemValue("password",""),l.validate()):(-1!=t.indexOf("gateway")||-1!=t.indexOf("net"))&&$p.msg.show_msg({title:$p.msg.main_title+$p.version,type:"alert-error",text:$p.msg.error_network})}},$p.iface.open_settings=function(e){var t=e||("undefined"!=typeof event?event:void 0);return t&&t.preventDefault(),window.open(($p.job_prm.settings_url||"order_dealer/options.html")+"?v="+$p.job_prm.files_date),$p.cancel_bubble(t)},$p.iface.swith_view=function(e){var t,n=$p.iface,a=function(e){function t(e,t){return e.text>t.text?1:e.text<t.text?-1:void 0}if(n.tree){if(n.tree._view!=e&&-1==["rep","cal"].indexOf(e)){if(n.tree.deleteChildItems(0),"oper"==e){var a,r,o={id:0,item:[{id:"oper_cat",text:$p.msg.meta_cat,open:!0,item:[]},{id:"oper_doc",text:$p.msg.meta_doc,item:[]},{id:"oper_cch",text:$p.msg.meta_cch,item:[]},{id:"oper_cacc",text:$p.msg.meta_cacc,item:[]}]},i=o.item[0].item;for(a in _cat)"function"!=typeof _cat[a]&&(r=_cat[a].metadata(),r.hide||i.push({id:"oper.cat."+a,text:r.synonym||r.name,tooltip:r.illustration||r.list_presentation}));i.sort(t),i=o.item[1].item;for(a in _doc)"function"!=typeof _doc[a]&&(r=_doc[a].metadata(),r.hide||i.push({id:"oper.doc."+a,text:r.synonym||r.name,tooltip:r.illustration||r.list_presentation}));i.sort(t),i=o.item[2].item;for(a in _cch)"function"!=typeof _cch[a]&&(r=_cch[a].metadata(),r.hide||i.push({id:"oper.cch."+a,text:r.synonym||r.name,tooltip:r.illustration||r.list_presentation}));i.sort(t),i=o.item[3].item;for(a in _cacc)"function"!=typeof _cacc[a]&&(r=_cacc[a].metadata(),r.hide||i.push({id:"oper.cacc."+a,text:r.synonym||r.name,tooltip:r.illustration||r.list_presentation}));i.sort(t),n.tree.parse(o,function(){var e=$p.job_prm.parse_url();e.obj&&n.tree.selectItem(e.view+"."+e.obj,!0)},"json")}else n.tree.loadXML(n.tree.tree_filteres+"?v="+$p.job_prm.files_date,function(){});n.tree._view=e}}else{var s=$p.job_prm.parse_url();if(s.obj){var l=s.obj.split(".");if(l.length>1){var c=$p.md.mgr_by_class_name(s.obj);"function"==typeof n.docs.close&&n.docs.close(),c&&c.form_list(n.docs,{})}}}};return 0==e.indexOf(n.docs.getViewName())?n.docs.getViewName():(t=n.docs.showView(e),1==t&&("cal"!=e||window.dhtmlXScheduler||($p.load_script("dist/dhtmlxscheduler.min.js","script",function(){scheduler.config.first_hour=8,scheduler.config.last_hour=22,n.docs.scheduler=n.docs.attachScheduler(new Date("2015-11-20"),"week","scheduler_here"),n.docs.scheduler.attachEvent("onBeforeViewChange",function(e,t,n,a){return"timeline"==n?($p.msg.show_not_implemented(),!1):!0})}),$p.load_script("dist/dhtmlxscheduler.css","link"))),a(e),void("def"==e?n.main.showStatusBar():n.main.hideStatusBar()))},$p.iface.OTooolBar=OTooolBar,$p.iface.add_button=function(e,t,n){var a=document.createElement("div"),r="";return a.name=(t?t.name+"_":"")+n.name,e.appendChild(a),a.className="md_otooolbar_button",n.img&&(r='<img src="'+(t?t.image_path:"")+n.img+'">'),n.b?r+='<b style="vertical-align: super;"> '+n.b+"</b>":n.text?r+='<span style="vertical-align: super;"> '+n.text+"</span>":n.css&&a.classList.add(n.css),a.innerHTML=r,n["float"]&&(a.style["float"]=n["float"]),n.clear&&(a.style.clear=n.clear),n.width&&(a.style.width=n.width),a},"undefined"!=typeof window&&"dhtmlx"in window&&(eXcell_addr.prototype=eXcell_proto,window.eXcell_addr=eXcell_addr),$p.is_data_obj=function(e){return e&&e instanceof DataObj},$p.fetch_type=function(e,t){var n=e;return t.is_ref?n=$p.fix_guid(e):t.date_part?n=$p.fix_date(e,!0):t.digits?n=$p.fix_number(e,!0):"boolean"==t.types[0]&&(n=$p.fix_boolean(e)),n},$p.is_equal=function(e,t){return e==t?!0:typeof e==typeof t?!1:$p.fix_guid(e,!1)==$p.fix_guid(t,!1)},$p._find=function(e,t){var n,a,r;if("object"!=typeof t)for(a in e){n=e[a];for(var o in n)if("function"!=typeof n[o]&&$p.is_equal(n[o],t))return n}else for(a in e){n=e[a],r=!0;for(var o in t)if("function"!=typeof n[o]&&!$p.is_equal(n[o],t[o])){r=!1;break}if(r)return n}},$p._find_rows=function(e,t,n){var a,r,o,i,s,l=[],c=0;t&&(t._top?(s=t._top,delete t._top):s=300);for(o in e){if(r=e[o],a=!0,t)if("function"==typeof t)a=t(r);else for(i in t)if("_"!=i.substr(0,1))if("function"==typeof t[i]){if(a=t[i](r,i),!a)break}else if("or"==i&&Array.isArray(t[i])){if(a=t[i].some(function(e){var t=Object.keys(e)[0];return e[t].hasOwnProperty("like")?-1!=r[t].toLowerCase().indexOf(e[t].like.toLowerCase()):$p.is_equal(r[t],e[t])}),!a)break}else if(t[i].hasOwnProperty("like")){if(-1==r[i].toLowerCase().indexOf(t[i].like.toLowerCase())){a=!1;break}}else if(t[i].hasOwnProperty("not")){if($p.is_equal(r[i],t[i].not)){a=!1;break}}else if(t[i].hasOwnProperty("in")){if(a=t[i]["in"].some(function(e){return $p.is_equal(e,r[i])}),!a)break}else if(!$p.is_equal(r[i],t[i])){a=!1;break}if(a){if(n){if(n.call(this,r)===!1)break}else l.push(r);if(s&&(c++,c>=s))break}}return l};var _cat=$p.cat=new function(){this.toString=function(){return $p.msg.meta_cat_mgr}},_enm=$p.enm=new function(){this.toString=function(){return $p.msg.meta_enn_mgr}},_doc=$p.doc=new function(){this.toString=function(){return $p.msg.meta_doc_mgr}},_ireg=$p.ireg=new function(){this.toString=function(){return $p.msg.meta_ireg_mgr}},_areg=$p.areg=new function(){this.toString=function(){return $p.msg.meta_areg_mgr}},_aссreg=$p.aссreg=new function(){this.toString=function(){return $p.msg.meta_accreg_mgr}},_dp=$p.dp=new function(){this.toString=function(){return $p.msg.meta_dp_mgr}},_rep=$p.rep=new function(){this.toString=function(){return $p.msg.meta_reports_mgr}},_cacc=$p.cacc=new function(){this.toString=function(){return $p.msg.meta_charts_of_accounts_mgr}},_cch=$p.cch=new function(){this.toString=function(){return $p.msg.meta_charts_of_characteristic_mgr}},_md;$p.Meta=Meta,Meta._patch=function(e,t){for(var n in t)for(var a in t[n]){e[n][a]||(e[n][a]={});for(var r in t[n][a])e[n][a][r]?"object"==typeof e[n][a][r]&&e[n][a][r]._mixin(t[n][a][r]):e[n][a][r]=t[n][a][r]}},$p.record_log=function(e){$p.ireg&&$p.ireg.$log?$p.ireg.$log.record(e):console.log(e)},_cat.load_soap_to_grid=function(e,t,n){function a(e){"{"==e.substr(0,1)&&(e=JSON.parse(e)),"string"==typeof e?t.parse(e,function(){n&&n(e)},"xml"):n&&n(e)}t.xmlFileUrl="exec";var r=_md.mgr_by_class_name(e.class_name);!r.cachable&&($p.job_prm.rest||$p.job_prm.irest_enabled||e.rest)?r.rest_selection(e).then(a)["catch"]($p.record_log):_load(e).then(a)["catch"]($p.record_log)},DataManager.prototype.__define("family_name",{get:function(){return $p.msg["meta_"+this.class_name.split(".")[0]+"_mgr"].replace($p.msg.meta_mgr+" ","")},enumerable:!1}),DataManager.prototype.register_ex=function(){},DataManager.prototype.sync_grid=function(e,t){var n;this.cachable||($p.job_prm.rest||$p.job_prm.irest_enabled||t.rest)&&("get_tree"==t.action?n=this.rest_tree():"get_selection"==t.action&&(n=this.rest_selection()))},DataManager.prototype.get_option_list=function(e,t){function n(t){return $p.is_equal(t.value,e)&&(t.selected=!0),t}var a,r,o,i=this,s=[];if(t.presentation&&(a=i.metadata().input_by_string)&&(r=t.presentation.like,delete t.presentation,t.or=[],a.forEach(function(e){o={},o[e]={like:r},t.or.push(o)})),i.cachable||t&&t._local)return i.find_rows(t,function(e){s.push(n({text:e.presentation,value:e.ref}))}),Promise.resolve(s);var l={selection:t,top:t._top};return delete t._top,i instanceof DocManager?l.fields=["ref","date","number_doc"]:i.metadata().main_presentation_name?l.fields=["ref","name"]:l.fields=["ref","id"],_rest.load_array(l,i).then(function(e){return e.forEach(function(e){s.push(n({text:i instanceof DocManager?e.number_doc+" от "+$p.dateFormat(e.date,$p.dateFormat.masks.ru):e.name||e.id,value:e.ref}))}),s})},DataManager.prototype.tabular_captions=function(e,t){},DataManager.prototype.get_property_grid_xml=function(e,t,n){var a,r,o,i,s,l,c,d=this,p="<rows>",_=function(){if(!e)if(o=d.metadata(),o.form&&o.form.obj&&o.form.obj.head)e=o.form.obj.head;else{if(e={" ":[]},t instanceof CatObj?(o.code_length&&e[" "].push("id"),o.main_presentation_name&&e[" "].push("name")):t instanceof DocObj&&(e[" "].push("number_doc"),e[" "].push("date")),!t.is_folder)for(a in o.fields)o.fields[a].hide||e[" "].push(a);o.tabular_sections.extra_fields&&(e["Дополнительные реквизиты"]=[])}},u=function(e,t){l=$p.is_data_obj(e)?e.presentation:e,t.type.is_ref||(t.type.date_part?l=$p.dateFormat(l,""):"boolean"==t.type.types[0]&&(l=l?"1":"0"))},f=function(e){s=_md.control_by_type(o.type),u(e,o)},m=function(e,a){if(a){var r=e.property||e.param||e["Параметр"],_=void 0!=e.value?e.value:e["Значение"];r.empty()?(c=a+"|empty",s="ro",l="",o={synonym:"?"}):(o={synonym:r.presentation,type:r.type},c=a+"|"+r.ref,f(_),"edn"==s&&(s="calck"),r.mandatory&&(s+='" class="cell_mandatory'))}else if("object"==typeof e)o={synonym:e.synonym},c=e.id,s=e.type,l="",e.hasOwnProperty("txt")?l=e.txt:void 0!==(i=t[c])&&u(i,_md.get(d.class_name,c));else if(n&&n.meta&&void 0!==(o=n.meta[e]))c=e,f(i=t[e]);else{if(void 0===(i=t[e]))return;o=_md.get(d.class_name,c=e),f(i)}p+='<row id="'+c+'"><cell>'+(o.synonym||o.name)+'</cell><cell type="'+s+'">'+l+"</cell></row>"};_();for(a in e){" "!=a&&(p+='<row open="1"><cell>'+a+"</cell>");for(r in e[a])m(e[a][r]);if(n&&a==n.title&&t[n.ts]){t[n.ts].find_rows(n.selection,function(e){m(e,n.ts)})}" "!=a&&(p+="</row>")}return p+="</rows>"},DataManager.prototype.__define("table_name",{get:function(){return this.class_name.replace(".","_")},enumerable:!1}),DataManager.prototype.print=function(e,t,n){function a(e){n&&n.progressOff&&n.progressOff(),e&&e.focus()}n&&n.progressOn&&n.progressOn();var r={};$p.ajax.default_attr(r,$p.job_prm.irest_url()),r.url+=this.rest_name+"(guid'"+$p.fix_guid(e)+"')/Print(model="+t+", browser_uid="+$p.wsql.get_user_param("browser_uid")+")",$p.ajax.get_and_show_blob(r.url,r,"get").then(a)["catch"]($p.record_log),setTimeout(a,3e3)},DataManager.prototype.printing_plates=function(){var e={},t=this;return $p.job_prm.offline?Promise.resolve({}):(t.metadata().printing_plates&&(t._printing_plates=t.metadata().printing_plates),t._printing_plates?Promise.resolve(t._printing_plates):($p.ajax.default_attr(e,$p.job_prm.irest_url()),e.url+=t.rest_name+"/Print()",$p.ajax.get_ex(e.url,e).then(function(e){return t.__define("_printing_plates",{value:JSON.parse(e.response),enumerable:!1}),t._printing_plates})["catch"](function(e){return{}})))},RefDataManager._extend(DataManager),RefDataManager.prototype.get_sql_struct=function(e){function t(){function t(){var e=[],t="_t_.ref, _t_.`deleted`";return s.form&&s.form.selection?s.form.selection.fields.forEach(function(t){e.push(t)}):i instanceof DocManager?(e.push("posted"),e.push("date"),e.push("number_doc")):(s.hierarchical&&s.group_hierarchy?e.push("is_folder"):e.push("0 as is_folder"),i instanceof ChartOfAccountManager?(e.push("id"),e.push("name as presentation")):s.main_presentation_name?e.push("name as presentation"):s.code_length?e.push("id as presentation"):e.push("'...' as presentation"),s.has_owners&&e.push("owner"),s.code_length&&e.push("id")),e.forEach(function(e){t+=-1!=e.indexOf(" as ")?", "+e:_md.sql_mask(e,!0)}),t}function n(){var e,t="";if(s.form&&s.form.selection)for(var n in s.form.selection.fields)-1!=s.form.selection.fields[n].indexOf(" as ")&&-1==s.form.selection.fields[n].indexOf("_t_.")&&(e=s.form.selection.fields[n].split(" as "),e[0]=e[0].split("."),e[0].length>1&&(t&&(t+="\n"),t+="left outer join "+e[0][0]+" on "+e[0][0]+".ref = _t_."+e[1]));return t}function a(){var t;return t=i instanceof ChartOfAccountManager?" WHERE ("+(_?0:1):s.hierarchical?s.has_owners?" WHERE ("+(c||_?1:0)+" OR _t_.parent = '"+d+"') AND ("+(l==$p.blank.guid?1:0)+" OR _t_.owner = '"+l+"') AND ("+(_?0:1):" WHERE ("+(c||_?1:0)+" OR _t_.parent = '"+d+"') AND ("+(_?0:1):s.has_owners?" WHERE ("+(l==$p.blank.guid?1:0)+" OR _t_.owner = '"+l+"') AND ("+(_?0:1):" WHERE ("+(_?0:1),i.sql_selection_where_flds?t+=i.sql_selection_where_flds(_):i instanceof DocManager?t+=" OR _t_.number_doc LIKE '"+_+"'":((s.main_presentation_name||i instanceof ChartOfAccountManager)&&(t+=" OR _t_.name LIKE '"+_+"'"),s.code_length&&(t+=" OR _t_.id LIKE '"+_+"'")),t+=") AND (_t_.ref != '"+$p.blank.guid+"')",e.selection&&("function"==typeof e.selection||e.selection.forEach(function(e){for(var n in e)"function"==typeof e[n]?t+="\n AND "+e[n](i,n)+" ":s.fields.hasOwnProperty(n)?t+=e[n]===!0?"\n AND _t_."+n+" ":e[n]===!1?"\n AND (not _t_."+n+") ":"string"==typeof e[n]||"object"==typeof e[n]?"\n AND (_t_."+n+" = '"+e[n]+"') ":"\n AND (_t_."+n+" = "+e[n]+") ":"is_folder"==n&&s.hierarchical&&s.group_hierarchy})),t}function r(){return i instanceof ChartOfAccountManager?"ORDER BY id":s.hierarchical?s.group_hierarchy?"ORDER BY _t_.is_folder desc, is_initial_value, presentation":"ORDER BY _t_.parent desc, is_initial_value, presentation":"ORDER BY is_initial_value, presentation"}function o(){function t(t){t?(u=e.set_parent=t.parent.ref,d=u,c=!1):(_||c)&&"cat.base_blocks"==i.class_name&&(l==$p.blank.guid&&(l=_cat.bases.predefined("main")),d=i.first_folder(l).ref),_&&-1==_.indexOf("%")&&(_="%"+_+"%")}s.has_owners&&(l=e.owner,e.selection&&"function"!=typeof e.selection&&e.selection.forEach(function(e){e.owner&&(l="object"==typeof e.owner?e.owner.valueOf():e.owner,delete e.owner)}),l||(l=$p.blank.guid)),p!=$p.blank.guid&&c&&s.hierarchical?t(i.get(p,!1)):t()}var l,c=!e.parent,d=e.parent||$p.blank.guid,p=e.initial_value||$p.blank.guid,_=e.filter||"",u=$p.blank.guid;o();var f;return f=i.sql_selection_list_flds?i.sql_selection_list_flds(p):("SELECT %2, case when _t_.ref = '"+p+"' then 0 else 1 end as is_initial_value FROM `"+i.table_name+"` AS _t_ %j %3 %4 LIMIT 300").replace("%2",t()).replace("%j",n()),f.replace("%3",a()).replace("%4",r())}function n(){var t="CREATE TABLE IF NOT EXISTS ";if(e&&e.postgres){t+=i.table_name+" (ref uuid PRIMARY KEY NOT NULL, deleted boolean, lc_changed bigint",i instanceof DocManager?t+=", posted boolean, date timestamp with time zone, number_doc character(11)":(s.code_length&&(t+=", id character("+s.code_length+")"),t+=", name character varying(50), is_folder boolean");for(r in s.fields)r.length>30?s.fields[r].short_name?o=s.fields[r].short_name:(c++,o=r[0]+c+r.substr(r.length-27)):o=r,t+=", "+o+_md.sql_type(i,r,s.fields[r].type,!0)+_md.sql_composite(s.fields,r,o,!0);for(r in s.tabular_sections)t+=", ts_"+r+" JSON"}else{t+="`"+i.table_name+"` (ref CHAR PRIMARY KEY NOT NULL, `deleted` BOOLEAN, lc_changed INT",t+=i instanceof DocManager?", posted boolean, date Date, number_doc CHAR":", id CHAR, name CHAR, is_folder BOOLEAN";for(r in s.fields)t+=_md.sql_mask(r)+_md.sql_type(i,r,s.fields[r].type)+_md.sql_composite(s.fields,r);for(r in s.tabular_sections)t+=", `ts_"+r+"` JSON"}return t+=")"}function a(){var e=["ref","deleted","lc_changed"],t="INSERT INTO `"+i.table_name+"` (ref, `deleted`, lc_changed",n="(?";"cat"==i.class_name.substr(0,3)?(t+=", id, name, is_folder",e.push("id"),e.push("name"),e.push("is_folder")):"doc"==i.class_name.substr(0,3)&&(t+=", posted, date, number_doc",e.push("posted"),e.push("date"),e.push("number_doc"));for(r in s.fields)t+=_md.sql_mask(r),e.push(r);for(r in s.tabular_sections)t+=", `ts_"+r+"`",e.push("ts_"+r);for(t+=") VALUES ",r=1;r<e.length;r++)n+=", ?";return n+=")",t+=n,{sql:t,fields:e,values:n}}var r,o,i=this,s=i.metadata(),l={},c=0,d=e&&e.action?e.action:"create_table";return"create_table"==d?l=n():-1!=["insert","update","replace"].indexOf(d)?l[i.table_name]=a():"select"==d?l="SELECT * FROM `"+i.table_name+"` WHERE ref = ?":"select_all"==d?l="SELECT * FROM `"+i.table_name+"`":"delete"==d?l="DELETE FROM `"+i.table_name+"` WHERE ref = ?":"drop"==d?l="DROP TABLE IF EXISTS `"+i.table_name+"`":"get_tree"==d?l=!e.filter||e.filter.is_folder?"SELECT ref, parent, name as presentation FROM `"+i.table_name+"` WHERE is_folder order by parent, name":"SELECT ref, parent, name as presentation FROM `"+i.table_name+"` order by parent, name":"get_selection"==d&&(l=t()),l},RefDataManager.prototype.caption_flds=function(e){function t(e,t,n,a,r,o){this.id=e,this.width=t,this.type=n,this.align=a,this.sort=r,this.caption=o}var n='<column id="%1" width="%2" type="%3" align="%4" sort="%5">%6</column>',a=[],r=this.metadata(),o="";if(r.form&&r.form.selection?a=r.form.selection.cols:this instanceof DocManager?(a.push(new t("date","120","ro","left","server","Дата")),a.push(new t("number_doc","120","ro","left","server","Номер"))):this instanceof ChartOfAccountManager?(a.push(new t("id","120","ro","left","server","Код")),a.push(new t("presentation","*","ro","left","server","Наименование"))):a.push(new t("presentation","*","ro","left","server","Наименование")),e.get_header&&a.length){o="<head>";for(var i in a)o+=n.replace("%1",a[i].id).replace("%2",a[i].width).replace("%3",a[i].type).replace("%4",a[i].align).replace("%5",a[i].sort).replace("%6",a[i].caption);o+="</head>"}return{head:o,acols:a}},RefDataManager.prototype.load_cached_server_array=function(e,t){var n,a=[],r=this,o=t?{class_name:r.class_name,rest_name:t}:r,i=!t;if(e.forEach(function(e){n=r.get(e.ref||e,!1,!0),(!n||i&&n.is_new())&&a.push(e.ref||e)}),a.length){var s={url:"",selection:{ref:{"in":a}}};return i&&(s.fields=["ref"]),$p.rest.build_select(s,o),$p.ajax.get_ex(s.url,s).then(function(t){var n=JSON.parse(t.response);if(i)n=n.value;else{n=n.data;for(var a in n)!n[a].ref&&n[a].id&&(n[a].ref=n[a].id),n[a].Код&&(n[a].id=n[a].Код,delete n[a].Код),n[a]._not_set_loaded=!0}return r.load_array(n),e})}return Promise.resolve(e)},DataProcessorsManager._extend(DataManager),EnumManager._extend(RefDataManager),EnumManager.prototype.get_sql_struct=function(e){var t="CREATE TABLE IF NOT EXISTS ",n=e&&e.action?e.action:"create_table";return e&&e.postgres?"create_table"==n?t+=this.table_name+" (ref character varying(255) PRIMARY KEY NOT NULL, sequence INT, synonym character varying(255))":-1!=["insert","update","replace"].indexOf(n)?(t={},t[this.table_name]={sql:"INSERT INTO "+this.table_name+" (ref, sequence, synonym) VALUES ($1, $2, $3)",fields:["ref","sequence","synonym"],values:"($1, $2, $3)"}):"delete"==n&&(t="DELETE FROM "+this.table_name+" WHERE ref = $1"):"create_table"==n?t+="`"+this.table_name+"` (ref CHAR PRIMARY KEY NOT NULL, sequence INT, synonym CHAR)":-1!=["insert","update","replace"].indexOf(n)?(t={},t[this.table_name]={sql:"INSERT INTO `"+this.table_name+"` (ref, sequence, synonym) VALUES (?, ?, ?)",fields:["ref","sequence","synonym"],values:"(?, ?, ?)"}):"delete"==n&&(t="DELETE FROM `"+this.table_name+"` WHERE ref = ?"),t},EnumManager.prototype.get_option_list=function(e,t){function n(t){return $p.is_equal(t.value,e)&&(t.selected=!0),t}var a=[],r="";if(t)for(var o in t)"_"!=o.substr(0,1)&&(r=t[o]);return"object"==typeof r&&(r=r.like?r.like:""),r=r.toLowerCase(),this.alatable.forEach(function(e){(!r||e.synonym&&-1!=e.synonym.toLowerCase().indexOf(r))&&a.push(n({text:e.synonym||"",value:e.ref}))}),Promise.resolve(a)},RegisterManager._extend(DataManager),RegisterManager.prototype.get_sql_struct=function(e){function t(){var t="CREATE TABLE IF NOT EXISTS ",n=!0;if(e&&e.postgres){t+=o.table_name+" (",i.splitted&&(t+="zone integer",n=!1);for(r in i.dimensions)n?(t+=r,n=!1):t+=", "+r,t+=_md.sql_type(o,r,i.dimensions[r].type,!0)+_md.sql_composite(i.dimensions,r,"",!0);for(r in i.resources)t+=", "+r+_md.sql_type(o,r,i.resources[r].type,!0)+_md.sql_composite(i.resources,r,"",!0);t+=", PRIMARY KEY (",n=!0,i.splitted&&(t+="zone",n=!1);for(r in i.dimensions)n?(t+=r,n=!1):t+=", "+r}else{t+="`"+o.table_name+"` (";for(r in i.dimensions)n?(t+="`"+r+"`",n=!1):t+=_md.sql_mask(r),t+=_md.sql_type(o,r,i.dimensions[r].type)+_md.sql_composite(i.dimensions,r);for(r in i.resources)t+=_md.sql_mask(r)+_md.sql_type(o,r,i.resources[r].type)+_md.sql_composite(i.resources,r);t+=", PRIMARY KEY (",n=!0;for(r in i.dimensions)n?(t+="`"+r+"`",n=!1):t+=_md.sql_mask(r)}return t+="))"}function n(){var e="INSERT OR REPLACE INTO `"+o.table_name+"` (",t=[],n=!0;for(r in i.dimensions)n?(e+=r,n=!1):e+=", "+r,t.push(r);for(r in i.resources)e+=", "+r,t.push(r);for(e+=") VALUES (?",r=1;r<t.length;r++)e+=", ?";return e+=")",{sql:e,fields:t}}function a(){var t="SELECT * FROM `"+o.table_name+"` WHERE ",n=!0;e._values=[];for(var a in i.dimensions)n?n=!1:t+=" and ",t+="`"+a+"`=?",e._values.push(e[a]);return n&&(t+="1"),t}var r,o=this,i=o.metadata(),s={},l=e&&e.action?e.action:"create_table";return"create_table"==l?s=t():l in{insert:"",update:"",replace:""}?s[o.table_name]=n():"select"==l?s=a():"select_all"==l?s=a():"delete"==l?s="DELETE FROM `"+o.table_name+"` WHERE ref = ?":"drop"==l&&(s="DROP TABLE IF EXISTS `"+o.table_name+"`"),s},RegisterManager.prototype.get_ref=function(e){var t="",n=this.metadata().dimensions;e instanceof RegisterRow&&(e=e._obj);for(var a in n)t+=t?"_":"",t+=n[a].type.is_ref?$p.fix_guid(e[a]):!e[a]&&n[a].type.digits?"0":n[a].date_part?$p.dateFormat(e[a]||$p.blank.date,$p.dateFormat.masks.atom):void 0!=e[a]?String(e[a]):"$";return t},InfoRegManager._extend(RegisterManager),InfoRegManager.prototype.slice_first=function(e){},InfoRegManager.prototype.slice_last=function(e){},LogManager._extend(InfoRegManager),AccumRegManager._extend(RegisterManager),CatManager._extend(RefDataManager),CatManager.prototype.by_name=function(e){var t;return this.find_rows({name:e},function(e){return t=e,!1}),t||(t=this.get()),t},CatManager.prototype.by_id=function(e){var t;return this.find_rows({id:e},function(e){return t=e,!1}),t||(t=this.get()),t},CatManager.prototype.path=function(e){var t,n=[];if(t=e instanceof DataObj?e:this.get(e,!1,!0),t&&n.push({ref:t.ref,presentation:t.presentation}),t&&this.metadata().hierarchical)for(;;){if(t=t.parent,t.empty())break;n.push({ref:t.ref,presentation:t.presentation})}return n},ChartOfCharacteristicManager._extend(CatManager),ChartOfAccountManager._extend(CatManager),DocManager._extend(RefDataManager),DataObj.prototype.valueOf=function(){return this.ref},DataObj.prototype.toJSON=function(){return this._obj},DataObj.prototype._getter=function(e){var t,n=this._metadata.fields[e].type;return"type"==e&&"object"==typeof this._obj[e]?this._obj[e]:"ref"==e?this._obj[e]:n.is_ref?(t=_md.value_mgr(this._obj,e,n))?t instanceof DataManager?t.get(this._obj[e],!1):$p.fetch_type(this._obj[e],t):this._obj[e]?(console.log([e,n,this._obj]),null):void 0:n.date_part?$p.fix_date(this._obj[e],!0):n.digits?$p.fix_number(this._obj[e],!0):"boolean"==n.types[0]?$p.fix_boolean(this._obj[e]):this._obj[e]||""},DataObj.prototype.__setter=function(e,t){var n,a=this._metadata.fields[e].type;"type"==e&&t.types?this._obj[e]=t:"ref"==e?this._obj[e]=$p.fix_guid(t):a.is_ref?(this._obj[e]=$p.fix_guid(t),n=_md.value_mgr(this._obj,e,a,!1,t),n?n instanceof EnumManager?"string"==typeof t?this._obj[e]=t:t?"object"==typeof t&&(this._obj[e]=t.ref||t.name||""):this._obj[e]="":t&&t.presentation?(!t.type||t instanceof DataObj||delete t.type,n.create(t)):n instanceof DataManager||(this._obj[e]=$p.fetch_type(t,n)):"object"!=typeof t&&(this._obj[e]=t)):a.date_part?this._obj[e]=$p.fix_date(t,!0):a.digits?this._obj[e]=$p.fix_number(t,!0):"boolean"==a.types[0]?this._obj[e]=$p.fix_boolean(t):this._obj[e]=t},DataObj.prototype.__notify=function(e){Object.getNotifier(this).notify({type:"update",name:e,oldValue:this._obj[e]})},DataObj.prototype._setter=function(e,t){this._obj[e]!=t&&(this.__notify(e),this.__setter(e,t))},DataObj.prototype._getter_ts=function(e){return this._ts_(e)},DataObj.prototype._setter_ts=function(e,t){var n=this._ts_(e);n instanceof TabularSection&&Array.isArray(t)&&n.load(t)},DataObj.prototype.load=function(){function e(e){if("string"==typeof e&&(e=JSON.parse(e)),!$p.msg.check_soap_result(e)){var n=$p.fix_guid(e);return t.is_new()&&!$p.is_empty_guid(n)&&t._set_loaded(n),t._mixin(e)}}var t=this;return t._manager.cachable&&!t.is_new()?Promise.resolve(t):t.ref==$p.blank.guid?(t instanceof CatObj?t.id="000000000":t.number_doc="000000000",Promise.resolve(t)):$p.job_prm.rest||$p.job_prm.irest_enabled?_rest.load_obj(t):_load({class_name:t._manager.class_name,action:"load",ref:t.ref}).then(e)},DataObj.prototype.save=function(e,t){var n,a=this._manager.handle_event(this,"before_save");return a===!1?Promise.resolve(this):"object"==typeof a&&a.then?a:(this instanceof DocObj&&$p.blank.date==this.date&&(this.date=new Date),
n=$p.job_prm.offline?function(e){return Promise.resolve(e)}:$p.job_prm.irest_enabled?_rest.save_irest:_rest.save_rest,n(this,{post:e,operational:t}).then(function(e){return e._manager.handle_event(e,"after_save")}))},DataObj.prototype.empty=function(){return $p.is_empty_guid(this._obj.ref)},DataObj.prototype.__define("_metadata",{get:function(){return this._manager.metadata()},enumerable:!1}),DataObj.prototype.__define("ref",{get:function(){return this._obj.ref},set:function(e){this._obj.ref=$p.fix_guid(e)},enumerable:!0,configurable:!0}),DataObj.prototype.__define("deleted",{get:function(){return this._obj.deleted},set:function(e){this.__notify("deleted"),this._obj.deleted=!!e},enumerable:!0,configurable:!0}),DataObj.prototype.__define("data_version",{get:function(){return this._obj.data_version||""},set:function(e){this.__notify("data_version"),this._obj.data_version=String(e)},enumerable:!0}),DataObj.prototype.__define("lc_changed",{get:function(){return this._obj.lc_changed||0},set:function(e){this.__notify("lc_changed"),this._obj.lc_changed=$p.fix_number(e,!0)},enumerable:!0,configurable:!0}),CatObj._extend(DataObj),CatObj.prototype.__define("id",{get:function(){return this._obj.id||""},set:function(e){this.__notify("id"),this._obj.id=e},enumerable:!0}),CatObj.prototype.__define("name",{get:function(){return this._obj.name||""},set:function(e){this.__notify("name"),this._obj.name=String(e)},enumerable:!0}),DocObj._extend(DataObj),DocObj.prototype.__define("number_doc",{get:function(){return this._obj.number_doc||""},set:function(e){this.__notify("number_doc"),this._obj.number_doc=e},enumerable:!0}),DocObj.prototype.__define("date",{get:function(){return this._obj.date||$p.blank.date},set:function(e){this.__notify("date"),this._obj.date=$p.fix_date(e,!0)},enumerable:!0}),DocObj.prototype.__define("posted",{get:function(){return this._obj.posted||!1},set:function(e){this.__notify("posted"),this._obj.posted=$p.fix_boolean(e)},enumerable:!0}),DataProcessorObj._extend(DataObj),EnumObj._extend(DataObj),EnumObj.prototype.__define("order",{get:function(){return this._obj.sequence},set:function(e){this._obj.sequence=parseInt(e)},enumerable:!0}),EnumObj.prototype.__define("name",{get:function(){return this._obj.ref},set:function(e){this._obj.ref=String(e)},enumerable:!0}),EnumObj.prototype.__define("synonym",{get:function(){return this._obj.synonym||""},set:function(e){this._obj.synonym=String(e)},enumerable:!0}),EnumObj.prototype.__define("presentation",{get:function(){return this.synonym||this.name},enumerable:!1}),EnumObj.prototype.empty=function(){return"_"==this.ref},RegisterRow._extend(DataObj),RegisterRow.prototype.__define("_metadata",{get:function(){var e=this._manager.metadata();return e.fields||(e.fields={}._mixin(e.dimensions)._mixin(e.resources)),e},enumerable:!1}),RegisterRow.prototype.__define("ref",{get:function(){return this._manager.get_ref(this)},enumerable:!0}),TabularSection.prototype.toString=function(){return"Табличная часть "+this._owner._manager.class_name+"."+this._name},TabularSection.prototype.get=function(e){return this._obj[e]._row},TabularSection.prototype.count=function(){return this._obj.length},TabularSection.prototype.clear=function(e){for(var t in this._obj)delete this._obj[t];this._obj.length=0,e||Object.getNotifier(this._owner).notify({type:"rows",tabular:this._name})},TabularSection.prototype.del=function(e){var t,n=this._obj,a=0;if("undefined"!=typeof e){if("number"==typeof e)t=e;else if(n[e.row-1]._row===e)t=e.row-1;else for(var r in n)if(n[r]._row===e){t=Number(r),delete n[r]._row;break}if(void 0!=t){n.splice(t,1);for(var r in n)a++,n[r].row=a;Object.getNotifier(this._owner).notify({type:"rows",tabular:this._name})}}},TabularSection.prototype.find=function(e){var t=$p._find(this._obj,e);return t?t._row:void 0},TabularSection.prototype.find_rows=function(e,t){var n=this,a=t?function(e){return t.call(n,e._row)}:null;return $p._find_rows.call(n,n._obj,e,a)},TabularSection.prototype.swap=function(e,t){var n=this._obj[e];this._obj[e]=this._obj[t],this._obj[t]=n,Object.getNotifier(this._owner).notify({type:"rows",tabular:this._name})},TabularSection.prototype.add=function(e,t){var n=new this._owner._manager._ts_сonstructors[this._name](this);e||(e={});for(var a in n._metadata.fields)n[a]=e[a]||"";return n._obj.row=this._obj.push(n._obj),n._obj.__define("_row",{value:n,enumerable:!1}),t||Object.getNotifier(this._owner).notify({type:"rows",tabular:this._name}),e=null,n},TabularSection.prototype.each=function(e){var t=this;t._obj.forEach(function(n){return e.call(t,n._row)})},TabularSection.prototype.load=function(e){var t,n=this;n.clear(!0),e instanceof TabularSection?t=e._obj:Array.isArray(e)&&(t=e),t&&t.forEach(function(e){n.add(e,!0)}),Object.getNotifier(this._owner).notify({type:"rows",tabular:this._name})},TabularSection.prototype.sync_grid=function(e,t){for(var n={rows:[]},a=[],r=0;r<e.getColumnCount();r++)a.push(e.getColumnId(r));e.clearAll(),this.find_rows(t,function(e){var t=[];a.forEach(function(n){$p.is_data_obj(e[n])?t.push(e[n].presentation):t.push(e[n])}),n.rows.push({id:e.row,data:t})});try{e.parse(n,"json")}catch(o){}e.callEvent("onGridReconstructed",[])},TabularSection.prototype.toJSON=function(){return this._obj},TabularSectionRow.prototype.__define("_metadata",{get:function(){return this._owner._owner._metadata.tabular_sections[this._owner._name]},enumerable:!1}),TabularSectionRow.prototype.__define("row",{get:function(){return this._obj.row||0},enumerable:!0}),TabularSectionRow.prototype.__define("_clone",{value:function(){return new this._owner._owner._manager._ts_сonstructors[this._owner._name](this._owner)._mixin(this._obj)},enumerable:!1}),TabularSectionRow.prototype._getter=DataObj.prototype._getter,TabularSectionRow.prototype._setter=function(e,t){this._obj[e]!=t&&(Object.getNotifier(this._owner._owner).notify({type:"row",row:this,tabular:this._owner._name,name:e,oldValue:this._obj[e]}),DataObj.prototype.__setter.call(this,e,t))};var _rest=$p.rest=new Rest;DataManager.prototype.__define("rest_name",{get:function(e){var t=this.class_name.split("."),n={cat:"Catalog",doc:"Document",ireg:"InformationRegister",areg:"AccumulationRegister",cch:"ChartOfCharacteristicTypes",cacc:"ChartOfAccounts"};return n[t[0]]+"_"+_md.syns_1с(t[1])+(e||"")},enumerable:!1}),DataManager.prototype.rest_tree=function(e){var t,n,a=this,r=a.metadata(),o=[];return $p.ajax.default_attr(e,!r.irest&&$p.job_prm.rest?$p.job_prm.rest_url():$p.job_prm.irest_url()),e.url+=this.rest_name+"?allowedOnly=true&$format=json&$top=1000&$select=Ref_Key,DeletionMark,Parent_Key,Description&$filter=IsFolder eq true",$p.ajax.get_ex(e.url,e).then(function(e){return JSON.parse(e.response)}).then(function(e){for(var a=0;a<e.value.length;a++)n=e.value[a],t={ref:n.Ref_Key,deleted:n.DeletionMark,parent:n.Parent_Key,presentation:n.Description},o.push(t);return $p.iface.data_to_tree(o)})},DataManager.prototype.rest_selection=function(e){if("get_tree"==e.action)return this.rest_tree(e);var t,n,a,r,o,i,s=this,l=s.metadata(),c=[],d=[];return o=function(){var e="$select=Ref_Key,DeletionMark";return l.form&&l.form.selection?l.form.selection.fields.forEach(function(e){c.push(e)}):s instanceof DocManager?(c.push("posted"),c.push("date"),c.push("number_doc")):(l.hierarchical&&l.group_hierarchy?c.push("is_folder"):c.push("0 as is_folder"),l.main_presentation_name?c.push("name as presentation"):l.code_length?c.push("id as presentation"):c.push("'...' as presentation"),l.has_owners&&c.push("owner"),l.code_length&&c.push("id")),c.forEach(function(t){var n;if(-1!=t.indexOf(" as "))if(n=t.split(" as ")[0].split("."),1==n.length)t=n[0];else{if("_t_"!=n[0])return;t=n[1]}"0"!=t&&(a=_md.syns_1с(t),_md.get(s.class_name,t).type.is_ref&&-1==a.indexOf("_Key")&&_md.get(s.class_name,t).type.types.length&&-1==_md.get(s.class_name,t).type.types[0].indexOf("enm.")&&(a+="_Key"),e+=","+a)}),c.push("ref"),c.push("deleted"),e}(),$p.ajax.default_attr(e,!l.irest&&$p.job_prm.rest?$p.job_prm.rest_url():$p.job_prm.irest_url()),e.url+=(l.irest&&l.irest.selection?l.irest.selection:this.rest_name)+"?allowedOnly=true&$format=json&$top=1000&"+o,_md.get(s.class_name,"date")&&(e.url+="&$filter="+_rest.filter_date("Date",e.date_from,e.date_till),i=!0),e.parent&&(e.url+=i?" and ":"&$filter=",e.url+="Parent_Key eq guid'"+e.parent+"'",i=!0),$p.ajax.get_ex(e.url,e).then(function(e){return JSON.parse(e.response)}).then(function(o){for(var i=0;i<o.value.length;i++)n=o.value[i],t={},c.forEach(function(e){var o;if("ref"==e)return void(t[e]=n.Ref_Key);if(-1!=e.indexOf(" as ")?(o=e.split(" as ")[1],e=e.split(" as ")[0].split("."),e=e[e.length-1]):o=e,a=_md.syns_1с(e),r=_md.get(s.class_name,e),-1==a.indexOf("_Key")&&r.type.is_ref&&r.type.types.length&&-1==r.type.types[0].indexOf("enm.")&&(a+="_Key"),r.type.date_part)t[o]=$p.dateFormat(n[a],$p.dateFormat.masks[r.type.date_part]);else if(r.type.is_ref)if(n[a]&&n[a]!=$p.blank.guid){var i=_md.value_mgr(t,e,r.type,!1,n[a]);i?t[o]=i.get(n[a]).presentation:t[o]=""}else t[o]="";else t[o]=n[a]}),d.push(t);return $p.iface.data_to_grid.call(s,d,e)})},InfoRegManager.prototype.rest_slice_last=function(e){e.period||(e.period=$p.date_add_day(new Date,1));var t=this,n=t.metadata(),a="Period=datetime'"+$p.dateFormat(e.period,$p.dateFormat.masks.isoDateTime)+"'",r="";for(var o in n.dimensions)if(void 0!==e[o]){var i=_md.syns_1с(o),s=n.dimensions[o];-1==i.indexOf("_Key")&&s.type.is_ref&&s.type.types.length&&-1==s.type.types[0].indexOf("enm.")?(i+="_Key",r&&(r+=" and "),r+=i+" eq guid'"+e[o].ref+"'"):(r&&(r+=" and "),r+=s.type.digits?i+" eq "+$p.fix_number(e[o]):s.type.date_part?i+" eq datetime'"+$p.dateFormat(e[o],$p.dateFormat.masks.isoDateTime)+"'":i+" eq '"+e[o]+"'")}return r&&(a+=",Condition='"+r+"'"),$p.ajax.default_attr(e,$p.job_prm.rest_url()),e.url+=this.rest_name+"/SliceLast(%sl)?allowedOnly=true&$format=json&$top=1000".replace("%sl",a),_rest.ajax_to_data(e,t).then(function(e){return t.load_array(e)})},DataObj.prototype.to_atom=function(e){function t(e){var t=e._metadata.fields,r=e instanceof TabularSectionRow?"\n	<d:":"\n<d:";for(n in t){if(a=t[n],s=_md.syns_1с(n),l=e[n],l instanceof EnumObj)l=l.empty()?"":l.name;else if(l instanceof DataObj)-1==s.indexOf("_Key")&&(s+="_Key"),l=l.ref;else if(a.type.date_part)l=l.getFullYear()<1e3?"0001-01-01T00:00:00Z":$p.dateFormat(l,$p.dateFormat.masks.atom);else if(void 0==l)continue;d+=r+s+">"+l+"</d:"+s+">"}}var n,a,r,o,i,s,l,c='<entry><category term="StandardODATA.%n" scheme="http://schemas.microsoft.com/ado/2007/08/dataservices/scheme"/>				\n<title type="text"/><updated>%d</updated><author/><summary/><content type="application/xml">				\n<m:properties xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices" xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata">			%p			\n</m:properties></content></entry>'.replace("%n",this._manager.rest_name).replace("%d",$p.dateFormat(new Date,$p.dateFormat.masks.atom)),d="\n<d:Ref_Key>"+this.ref+"</d:Ref_Key>\n<d:DeletionMark>"+this.deleted+"</d:DeletionMark>\n<d:DataVersion>"+this.data_version+"</d:DataVersion>";this instanceof DocObj?(d+="\n<d:Date>"+$p.dateFormat(this.date,$p.dateFormat.masks.atom)+"</d:Date>",d+="\n<d:Number>"+this.number_doc+"</d:Number>"):(this._metadata.main_presentation_name&&(d+="\n<d:Description>"+this.name+"</d:Description>"),this._metadata.code_length&&(d+="\n<d:Code>"+this.id+"</d:Code>"),this._metadata.hierarchical&&this._metadata.group_hierarchy&&(d+="\n<d:IsFolder>"+this.is_folder+"</d:IsFolder>")),t(this);for(r in this._metadata.tabular_sections)i=this._metadata.tabular_sections[r],s="StandardODATA."+this._manager.rest_name+"_"+_md.syns_1с(r)+"_RowType",o=this[r],o.count()?(d+="\n<d:"+_md.syns_1с(r)+' m:type="Collection('+s+')">',o.each(function(e){d+='\n	<d:element m:type="'+s+'">',d+="\n	<d:LineNumber>"+e.row+"</d:LineNumber>",t(e),d+="\n	</d:element>"}),d+="\n</d:"+_md.syns_1с(r)+">"):d+="\n<d:"+_md.syns_1с(r)+' m:type="Collection('+s+')" />';return c.replace("%p",d)},DataManager.prototype["export"]=function(e){function t(){$p.wsql.restore_options("data_manager",l),l.wnd.caption="Экспорт "+s.family_name+" '"+(s.metadata().synonym||s.metadata().name)+"'",i=$p.iface.dat_blank(null,l.wnd),i.bottom_toolbar({buttons:[{name:"btn_cancel",text:'<i class="fa fa-times fa-lg"></i> Отмена',title:"Отмена",width:"80px","float":"right"},{name:"btn_ok",b:'<i class="fa fa-floppy-o"></i> Ок',title:"Выполнить экспорт",width:"50px","float":"right"}],onclick:function(e){return"btn_ok"==e?r():i.close(),!1}}),i.button("close").show(),i.button("park").hide(),i.attachEvent("onClose",o);var t=[{type:"fieldset",name:"form_range",label:"Выгрузить",list:[{type:"settings",labelWidth:320,labelAlign:"left",position:"label-right"},{type:"radio",name:"range",label:"Выделенные строки",value:"selected"},{type:"radio",name:"range",label:"Весь справочник",value:"all"}]},{type:"fieldset",name:"form_fieldset_2",label:"Дополнительно выгрузить",list:[{type:"settings",labelWidth:160,position:"label-right"},{type:"checkbox",name:"meta",label:"Описание метаданных",labelAlign:"left",position:"label-right",checked:l.meta},{type:"newcolumn"},{type:"checkbox",name:"relation",label:"Связанные объекты",position:"label-right",checked:l.relation,tooltip:"Связанные объекты по ссылкам (пока не реализовано)"}]},{type:"fieldset",name:"fieldset_format",label:"Формат файла",list:[{type:"settings",labelWidth:60,labelAlign:"left",position:"label-right"},{type:"radio",name:"format",label:"json",value:"json",tooltip:"Выгрузить в формате JSON"},{type:"newcolumn"},{type:"radio",name:"format",label:"xlsx",value:"xlsx",tooltip:"Выгрузить в офисном формате XLSX"},{type:"newcolumn"},{type:"radio",name:"format",label:"atom",value:"atom",tooltip:"Выгрузить в формате XML Atom"}]}];i.elmnts.frm=i.attachForm(t),i.elmnts.frm.setItemValue("range",l.range||"all"),e.items&&1==e.items.length?(e.obj?i.elmnts.frm.setItemLabel("range","selected","Тек. объект: "+e.items[0].presentation):s.get(e.items[0],!0).then(function(e){i.elmnts.frm.setItemLabel("range","selected","Тек. объект: "+e.presentation)}),i.elmnts.frm.setItemValue("range","selected")):e.items&&e.items.length&&i.elmnts.frm.setItemLabel("range","selected","Выделенные строки ("+e.items.length+" элем.)"),s instanceof DocManager&&i.elmnts.frm.setItemLabel("range","all","Все документы из кеша (0 элем.)"),i.elmnts.frm.setItemValue("format",l.format||"json"),i.elmnts.frm.attachEvent("onChange",n),n(),e.pwnd&&e.pwnd.isModal&&e.pwnd.isModal()&&(e.set_pwnd_modal=!0,e.pwnd.setModal(!1)),i.setModal(!0)}function n(){i.elmnts.frm.setItemValue("relation",!1),i.elmnts.frm.disableItem("relation"),"all"==i.elmnts.frm.getItemValue("range")?(i.elmnts.frm.disableItem("format","atom"),"atom"==i.elmnts.frm.getItemValue("format")&&i.elmnts.frm.setItemValue("format","json")):i.elmnts.frm.enableItem("format","atom"),"json"==i.elmnts.frm.getItemValue("format")?i.elmnts.frm.enableItem("meta"):"sql"==i.elmnts.frm.getItemValue("format")?(i.elmnts.frm.setItemValue("meta",!1),i.elmnts.frm.disableItem("meta")):(i.elmnts.frm.setItemValue("meta",!1),i.elmnts.frm.disableItem("meta"))}function a(){return l.format=i.elmnts.frm.getItemValue("format"),l.range=i.elmnts.frm.getItemValue("range"),l.meta=i.elmnts.frm.getItemValue("meta"),l.relation=i.elmnts.frm.getItemValue("relation"),l}function r(){function t(){e.obj?$p.wsql.alasql("SELECT * INTO XLSX('"+s.table_name+".xlsx',{headers:true}) FROM ?",[e.items[0]._obj]):$p.wsql.alasql("SELECT * INTO XLSX('"+s.table_name+".xlsx',{headers:true}) FROM "+s.table_name)}a();var n={meta:{},items:{}},r=n.items[s.class_name]=[];if(l.meta&&(n.meta[s.class_name]=s.metadata()),"json"==l.format)e.obj?r.push(e.items[0]._obj):s.each(function(t){("all"==l.range||-1!=e.items.indexOf(t.ref))&&r.push(t._obj)}),e.items.length&&!r.length?s.get(e.items[0],!0).then(function(e){r.push(e._obj),alasql.utils.saveFile(s.table_name+".json",JSON.stringify(n,null,4))}):alasql.utils.saveFile(s.table_name+".json",JSON.stringify(n,null,4));else if("xlsx"==l.format)window.xlsx?t():$p.load_script("//cdn.jsdelivr.net/js-xlsx/latest/xlsx.core.min.js","script",t);else if("atom"==l.format&&e.items.length){var o=e.obj?Promise.resolve(e.items[0]):s.get(e.items[0],!0);o.then(function(e){alasql.utils.saveFile(s.table_name+".xml",e.to_atom())})}else $p.msg.show_not_implemented()}function o(t){return $p.iface.popup.hide(),i.wnd_options(l.wnd),$p.wsql.save_options("data_manager",a()),i.setModal(!1),e.set_pwnd_modal&&e.pwnd.setModal&&e.pwnd.setModal(!0),!0}e&&"string"==typeof e?e={items:e.split(",")}:e||(e={items:[]});var i,s=this,l={name:"export",wnd:{top:130,left:200,width:480,height:350}};t()},DataManager.prototype["import"]=function(e,t){function n(e){function n(e,n){var a=_md.mgr_by_class_name(e);if(n.length)if(t){if(t._manager==a)for(var o in n)$p.fix_guid(n[o])==t.ref&&(r=!0,a.load_array([n[o]],!0))}else r=!0,a.load_array(n,!0)}if(i.close(),a.files.length){var o=new FileReader;o.onload=function(e){try{var t=JSON.parse(o.result);if(t.items)for(var a in t.items)n(a,t.items[a]);else["cat","doc","ireg","areg","cch","cacc"].forEach(function(e){if(t[e])for(var a in t[e])n(e+"."+a,t.cat[a])});r||$p.msg.show_msg($p.msg.sync_no_data)}catch(i){$p.msg.show_msg(i.message)}},o.readAsText(a.files[0])}}var a,r;if(!e&&void 0!=typeof window){var o={name:"import",wnd:{width:300,height:100,caption:$p.msg.select_file_import}},i=$p.iface.dat_blank(null,o.wnd);a=document.createElement("input"),a.setAttribute("id","json_file"),a.setAttribute("type","file"),a.setAttribute("accept",".json"),a.setAttribute("value","*.json"),a.onchange=n,i.button("close").show(),i.button("park").hide(),i.attachObject(a),i.centerOnScreen(),i.setModal(!0),setTimeout(function(){a.click()},100)}},$p.iface.wnd_sync=function(){function e(){var e={name:"wnd_sync",wnd:{id:"wnd_sync",top:130,left:200,width:496,height:290,modal:!0,center:!0,caption:"Подготовка данных"}};t.wnd_sync=$p.iface.dat_blank(null,e.wnd);var n=[{type:"block",name:"form_block_1",list:[{type:"label",name:"form_label_1",label:$p.msg.sync_data},{type:"block",name:"form_block_2",list:[{type:"template",name:"img_long",className:"img_long"},{type:"newcolumn"},{type:"template",name:"text_processed"},{type:"template",name:"text_current"},{type:"template",name:"text_bottom"}]}]},{type:"button",name:"form_button_1",value:$p.msg.sync_break}];t.frm_sync=t.wnd_sync.attachForm(n),t.frm_sync.attachEvent("onButtonClick",function(e){t&&(t.do_break=!0)}),t.frm_sync.setItemValue("text_processed","Инициализация"),t.frm_sync.setItemValue("text_bottom","Загружается структура таблиц...")}var t,n=$p.iface.sync={};n.create=function(n){t=n,e()},n.update=function(e){t.frm_sync.setItemValue("text_processed","Обработано элементов: "+t.step*t.step_size+" из "+t.count_all);var n,a="",r=0;for(var o in e){if(r++,r>4)break;a&&(a+="<br />"),n=$p.cat[o].metadata(),a+=(n.list_presentation||n.synonym)+" ("+e[o].length+")"}t.frm_sync.setItemValue("text_current","Текущий запрос: "+t.step+" ("+Math.round(t.step*t.step_size*100/t.count_all)+"%)"),t.frm_sync.setItemValue("text_bottom",a)},n.close=function(){t&&t.wnd_sync&&(t.wnd_sync.close(),delete t.wnd_sync)}},DataManager.prototype.form_obj=function(e,t){function n(){if(e instanceof dhtmlXLayoutCell&&(t.bind_pwnd||t.Приклеить)?("function"==typeof e.close&&e.close(),p=e,p.close=function(){(p||e)&&((p||e).detachToolbar(),(p||e).detachStatusBar(),(p||e).detachObject(!0)),l()},p.elmnts={},setTimeout(function(){p.showHeader(),p.setText((m.obj_presentation||m.synonym)+": "+f.presentation)})):(_={name:"wnd_obj_"+u.class_name,wnd:{id:"wnd_obj_"+u.class_name,top:80+40*Math.random(),left:120+80*Math.random(),width:900,height:600,modal:!0,center:!1,pwnd:e,allow_close:!0,allow_minmax:!0,on_close:c,caption:(m.obj_presentation||m.synonym)+": "+f.presentation}},p=$p.iface.dat_blank(null,_.wnd)),p.ref||p.__define("ref",{get:function(){return f?f.ref:$p.blank.guid},enumerable:!1,configurable:!0}),p.elmnts.frm_tabs=p.attachTabbar({arrows_mode:"auto",offsets:{top:0,right:0,bottom:0,left:0}}),p.elmnts.frm_tabs.addTab("tab_header","&nbsp;Реквизиты&nbsp;",null,null,!0),p.elmnts.tabs={tab_header:p.elmnts.frm_tabs.cells("tab_header")},!f.is_folder)for(var n in m.tabular_sections)"extra_fields"!==n&&f[n]instanceof TabularSection&&i(n);p.attachEvent("onResizeFinish",function(e){p.elmnts.pg_header.enableAutoHeight(!1,p.elmnts.tabs.tab_header._getHeight()-20,!0)}),p.elmnts.pg_header=p.elmnts.tabs.tab_header.attachHeadFields({obj:f,pwnd:p,read_only:!$p.ajax.root}),p.elmnts.frm_toolbar=p.attachToolbar(),p.elmnts.frm_toolbar.setIconsPath(dhtmlx.image_path+"dhxtoolbar"+dhtmlx.skin_suffix()),p.elmnts.frm_toolbar.loadStruct($p.injected_data["toolbar_obj.xml"],function(){this.addSpacer("btn_unpost"),this.attachEvent("onclick",a),f.hasOwnProperty("posted")&&$p.ajax.root?(this.enableItem("btn_post"),this.enableItem("btn_unpost")):(this.hideItem("btn_post"),this.hideItem("btn_unpost")),$p.ajax.root||(this.hideItem("btn_save_close"),this.disableItem("btn_save")),t.on_select&&this.setItemText("btn_save_close","Записать и выбрать"),u instanceof CatManager||u instanceof DocManager?u.printing_plates().then(function(e){for(var t in e)p.elmnts.frm_toolbar.addListOption("bs_print",t,"~","button",e[t])}):this.disableItem("bs_print"),p.elmnts.vault_pop=new dhtmlXPopup({toolbar:this,id:"btn_files"}),p.elmnts.vault_pop.attachEvent("onShow",o)}),$p.job_prm.russian_names&&(p.Элементы||p.__define({"Элементы":{get:function(){return this.elmnts},enumerable:!1}}),p.elmnts.Шапка||p.elmnts.__define({"Шапка":{get:function(){return this.pg_header},enumerable:!1}}))}function a(e){"btn_save_close"==e?s("close"):"btn_save"==e?s("save"):"btn_go_connection"==e?r():"prn_"==e.substr(0,4)?u.print(f.ref,e,p):"btn_import"==e?u["import"](null,f):"btn_export"==e&&u["export"]({items:[f],pwnd:p,obj:!0})}function r(){$p.msg.show_not_implemented()}function o(){if(!p.elmnts.vault){var e={};$p.ajax.default_attr(e,$p.job_prm.irest_url()),e.url+=u.rest_name+"(guid'"+f.ref+"')/Files?$format=json",p.elmnts.vault=p.elmnts.vault_pop.attachVault(400,250,{uploadUrl:e.url,buttonClear:!1,autoStart:!0,filesLimit:10}),p.elmnts.vault.conf.wnd=p,p.elmnts.vault.attachEvent("onUploadFile",function(e,t){}),p.elmnts.vault.attachEvent("onBeforeFileAdd",function(e){return e.size<=this.getMaxFileSize()?!0:($p.msg.show_msg({type:"alert-warning",text:$p.msg.file_size+this._readableSize(this.getMaxFileSize()),title:$p.msg.main_title}),!1)}),p.elmnts.vault.attachEvent("onBeforeFileRemove",function(e){return p.elmnts.vault.file_data[e.id].delete_confirmed?!0:(dhtmlx.confirm({title:$p.msg.main_title,text:$p.msg.file_confirm_delete+e.name,cancel:"Отмена",callback:function(t){t&&$p.ajax.post_ex(p.elmnts.vault.actionUrl(e.id,"drop"),"",!0).then(function(t){p.elmnts.vault.file_data[e.id].delete_confirmed=!0,p.elmnts.vault._removeFileFromQueue(e.id)})}}),!1)})}}function i(e){_md.ts_captions(u.class_name,e)&&(p.elmnts.frm_tabs.addTab("tab_"+e,"&nbsp;"+m.tabular_sections[e].synonym+"&nbsp;"),p.elmnts.tabs["tab_"+e]=p.elmnts.frm_tabs.cells("tab_"+e),p.elmnts.tabs["tab_"+e].attachTabular({obj:f,ts:e,pwnd:p,read_only:!$p.ajax.root}))}function s(e){p.progressOn(),f.save().then(function(){p.progressOff(),p.modified=!1,"close"==e&&(t.on_select&&t.on_select(f),p.close())})["catch"](function(e){p.progressOff(),$p.record_log(e)})}function l(){p&&p.elmnts&&p.elmnts.vault&&p.elmnts.vault.unload(),p&&p.elmnts&&p.elmnts.vault_pop&&p.elmnts.vault_pop.unload(),u=null,p=null}function c(e){return setTimeout(l,1),p&&p.elmnts&&p.elmnts.vault&&p.elmnts.vault.unload(),p&&p.elmnts&&p.elmnts.vault_pop&&p.elmnts.vault_pop.unload(),!0}var d=$p.injected_data["wnd/wnd_"+this.class_name.replace(".","_")+"_obj"];if(d)return d($p,e,t);var p,_,u=this,f=t.o,m=u.metadata();return $p.is_data_obj(f)?f.is_new()&&t.on_select?u.create({},!0).then(function(e){f=e,e=null,n()}):f.is_new()&&!f.empty()?f.load().then(n):n():(e.progressOn(),u.get(t.hasOwnProperty("ref")?t.ref:t,!0).then(function(t){f=t,t=null,e.progressOff(),n()})["catch"](function(t){e.progressOff(),$p.record_log(t)})),p},DataObj.prototype.form_obj=function(e,t){return t||(t={}),t.o=this,this._manager.form_obj(e,t)},DataManager.prototype.form_selection=function(e,t){function n(){e instanceof dhtmlXCellObject?(e instanceof dhtmlXTabBarCell||"function"!=typeof e.close||e.close(),u=e,u.close=function(){(u||e)&&((u||e).detachToolbar(),(u||e).detachStatusBar(),(u||e).detachObject(!0)),c()},t.hide_header||setTimeout(function(){u.showHeader()})):(u=$p.iface.w.createWindow("wnd_"+f.class_name.replace(".","_")+"_select",0,0,900,600),u.centerOnScreen(),u.setModal(1),u.button("park").hide(),u.button("minmax").show(),u.button("minmax").enable(),u.attachEvent("onClose",d)),$p.iface.bind_help(u),u instanceof dhtmlXTabBarCell||u.setText("Список "+(-1==f.class_name.indexOf("doc.")?'справочника "':'документов "')+(m.list_presentation||m.synonym)+'"'),document.body.addEventListener("keydown",a,!1),u.elmnts={status_bar:u.attachStatusBar()},u.elmnts.status_bar.setText("<div id='"+f.class_name.replace(".","_")+"_select_recinfoArea'></div>"),u.elmnts.toolbar=u.attachToolbar(),u.elmnts.toolbar.setIconsPath(dhtmlx.image_path+"dhxtoolbar"+dhtmlx.skin_suffix()),u.elmnts.toolbar.loadStruct($p.injected_data["toolbar_selection.xml"],function(){this.attachEvent("onclick",i);var e={manager:f,toolbar:this,onchange:r,hide_filter:t.hide_filter};t.date_from&&(e.date_from=t.date_from),t.date_till&&(e.date_till=t.date_till),u.elmnts.filter=new $p.iface.Toolbar_filter(e),$p.ajax.root||(this.hideItem("btn_new"),this.hideItem("btn_edit"),this.hideItem("btn_delete")),!v&&$p.iface.docs&&$p.iface.docs.getViewName&&"oper"==$p.iface.docs.getViewName()&&(this.hideItem("btn_select"),this.hideItem("sep1"),this.addListOption("bs_more","btn_order_list","~","button","<i class='fa fa-briefcase fa-lg fa-fw'></i> Список заказов")),this.addListOption("bs_more","btn_import","~","button","<i class='fa fa-upload fa-lg fa-fw'></i> Загрузить из файла"),this.addListOption("bs_more","btn_export","~","button","<i class='fa fa-download fa-lg fa-fw'></i> Выгрузить в файл"),f instanceof CatManager||f instanceof DocManager?f.printing_plates().then(function(e){var t;for(var n in e)u.elmnts.toolbar.addListOption("bs_print",n,"~","button",e[n]),t=!0;t||u.elmnts.toolbar.hideItem("bs_print")}):u.elmnts.toolbar.hideItem("bs_print"),o()})}function a(e){function t(){var e;return $p.iface.w.forEachWindow(function(t){t.isModal()&&t!=u&&(e=!0)}),e}if(u)if(113==e.keyCode||115==e.keyCode){if(!t())return setTimeout(function(){u.elmnts.filter.input_filter&&u.elmnts.filter.input_filter.focus()}),$p.cancel_bubble(e)}else if(e.shiftKey&&116==e.keyCode){if(!t())return setTimeout(function(){u.elmnts.grid.reload()}),e.preventDefault&&e.preventDefault(),$p.cancel_bubble(e)}else 27==e.keyCode&&!t()}function r(e){h&&(e.filter?u.elmnts.cell_tree.collapse():u.elmnts.cell_tree.expand()),u.elmnts.grid.reload()}function o(){var e,n,a,r,o,i;h?(e=u.attachLayout("2U"),a=e.cells("b"),a.hideHeader(),n=u.elmnts.cell_tree=e.cells("a"),n.setWidth("220"),n.hideHeader(),r=u.elmnts.tree=n.attachDynTree(f,null,function(){setTimeout(function(){o.reload()},20)}),r.attachEvent("onSelect",function(){this.do_not_reload?delete this.do_not_reload:setTimeout(function(){o.reload()},20)}),r.attachEvent("onDblClick",function(e){s(e)})):(a=u,setTimeout(function(){o.reload()},20)),o=u.elmnts.grid=a.attachGrid(),o.setIconsPath(dhtmlx.image_path),o.setImagePath(dhtmlx.image_path),o.setPagingWTMode(!0,!0,!0,[20,30,60]),o.enablePaging(!0,30,8,f.class_name.replace(".","_")+"_select_recinfoArea"),o.setPagingSkin("toolbar",dhtmlx.skin),o.attachEvent("onBeforeSorting",_),o.attachEvent("onBeforePageChanged",function(){return!!this.getRowsNum()}),o.attachEvent("onXLE",function(){a.progressOff()}),o.attachEvent("onXLS",function(){a.progressOn()}),o.attachEvent("onDynXLS",function(e,t){var n=p(e,t);if(n)return $p.cat.load_soap_to_grid(n,o),!1}),o.attachEvent("onRowDblClicked",function(e,t){var n=null;r&&(n=r.getIndexById(e)),null!=n?r.selectItem(e,!0):s(e)}),$p.iface.docs&&$p.iface.docs.getViewName&&"oper"==$p.iface.docs.getViewName()&&o.enableMultiselect(!0),o.reload=function(){var e=p();e&&(a.progressOn(),o.clearAll(),$p.cat.load_soap_to_grid(e,o,function(n){if("object"==typeof n)$p.msg.check_soap_result(n);else if(!i){if(e.initial_value){var s=n.indexOf("set_parent"),l=n.indexOf("'>",s),c=n.substr(s+12,l-s-12);$p.is_guid(c)&&h&&(r.do_not_reload=!0,r.selectItem(c,!1)),o.selectRowById(e.initial_value)}else e.parent&&$p.is_guid(e.parent)&&h&&(r.do_not_reload=!0,r.selectItem(e.parent,!1));o.setColumnMinWidth(200,o.getColIndexById("presentation")),o.enableAutoWidth(!0,1200,600),o.setSizes(),i=!0,u.elmnts.filter.input_filter&&u.elmnts.filter.input_filter.focus(),t.on_grid_inited&&t.on_grid_inited()}b&&i&&o.setSortImgState(!0,g,b),a.progressOff()}))}}function i(e){if("btn_select"==e)s();else if("btn_new"==e)f.create({},!0).then(function(e){e._set_loaded(e.ref),$p.iface.set_hash(f.class_name,e.ref)});else if("btn_edit"==e){var t=u.elmnts.grid.getSelectedRowId();t?$p.iface.set_hash(f.class_name,t):$p.msg.show_msg({type:"alert-warning",text:$p.msg.no_selected_row.replace("%1",""),title:$p.msg.main_title})}else"prn_"==e.substr(0,4)?l(e):"btn_order_list"==e?$p.iface.set_hash("","","","def"):"btn_delete"==e?$p.msg.show_not_implemented():"btn_import"==e?f["import"]():"btn_export"==e?f["export"](u.elmnts.grid.getSelectedRowId()):"btn_requery"==e&&(y={},u.elmnts.grid.reload())}function s(n){n||(n=u.elmnts.grid.getSelectedRowId());var a;if(t.selection&&t.selection.forEach(function(e){for(var t in e)"is_folder"==t&&(a=e[t])}),u.elmnts.tree&&null!=u.elmnts.tree.getIndexById(n)&&u.elmnts.tree.getSelectedItemId()!=n)return void u.elmnts.tree.selectItem(n,!0);if(n&&a===!0&&u.elmnts.grid.cells(n,0).cell.classList.contains("cell_ref_elm"))return void $p.msg.show_msg($p.msg.select_grp);if(!n&&u.elmnts.tree||u.elmnts.tree&&u.elmnts.tree.getSelectedItemId()==n){if(a===!1)return void $p.msg.show_msg($p.msg.select_elm);n=u.elmnts.tree.getSelectedItemId()}n&&(v?f.get(n,!0).then(function(t){u.close(),v.call(e.grid||e,t)}):$p.iface.set_hash(f.class_name,n))}function l(e){var t=u.elmnts.grid.getSelectedRowId();t?f.print(t,e,u):$p.msg.show_msg({type:"alert-warning",text:$p.msg.no_selected_row.replace("%1",""),title:$p.msg.main_title})}function c(){document.body.removeEventListener("keydown",a),f=u=m=y=v=e=t=null}function d(t){return setTimeout(c,10),e.on_unload&&e.on_unload.call(e.grid||e),!0}function p(e,n){var a=u.elmnts.filter.get_filter()._mixin({action:"get_selection",class_name:f.class_name,order_by:g,direction:b,start:e||((u.elmnts.grid.currentPage||1)-1)*u.elmnts.grid.rowsBufferOutSize,count:n||u.elmnts.grid.rowsBufferOutSize,get_header:void 0==y.get_header})._mixin(t),r=h?u.elmnts.tree.getSelectedItemId():null;a.parent=!r&&!t.parent||a.filter?null:r||t.parent,h&&!a.parent&&(a.parent=$p.blank.guid);for(var o in a)if(y[o]!=a[o])return y=a,a}function _(e){var t=u.elmnts.grid.getSortingState();return g=e,b="des"==t[1]?"asc":"des",u.elmnts.grid.reload(),!0}e||(e=t&&t.pwnd?t.pwnd:{}),t||e instanceof dhtmlXCellObject||(t=e,e={}),t||(t={});var u,f=this,m=f.metadata(),h=m.hierarchical&&!(f instanceof ChartOfAccountManager),g=0,b="asc",y={},v=e.on_select||t.on_select;return h&&t.initial_value&&t.initial_value!=$p.blank.guid&&!t.parent?f.get(t.initial_value,!0).then(function(e){t.parent=e.parent.ref,t.set_parent=t.parent,n()}):n(),u},DataManager.prototype.form_list=function(e,t){return this.form_selection(e,t)},"undefined"!=typeof window&&only_in_browser(window),$p.eve.socket=new SocketMsg,$p.eve.steps={load_meta:0,authorization:1,create_managers:2,process_access:3,load_data_files:4,load_data_db:5,load_data_wsql:6,save_data_wsql:7},$p.eve.ontimer=function(){$p.eve.update_files_version()},setInterval($p.eve.ontimer,18e4),$p.eve.update_files_version=function(){"undefined"!=typeof window&&$p.job_prm&&!$p.job_prm.offline&&$p.job_prm.data_url&&($p.job_prm.files_date||($p.job_prm.files_date=$p.wsql.get_user_param("files_date","number")),
$p.ajax.get($p.job_prm.data_url+"sync.json?v="+Date.now()).then(function(e){var t=JSON.parse(e.response);$p.job_prm.confirmation||$p.job_prm.files_date==t.files_date||($p.wsql.set_user_param("files_date",t.files_date),$p.job_prm.files_date?($p.job_prm.confirmation=!0,dhtmlx.confirm({title:$p.msg.file_new_date_title,text:$p.msg.file_new_date,ok:"Перезагрузка",cancel:"Продолжить",callback:function(e){delete $p.job_prm.confirmation,e&&($p.eve.redirect=!0,location.reload(!0))}})):$p.job_prm.files_date=t.files_date)})["catch"]($p.record_log))},$p.eve.pop=function(){$p.eve.stepper.cat_ini_date;return $p.job_prm.offline||!$p.job_prm.irest_enabled?Promise.resolve(!1):Promise.resolve(!1)},$p.eve.push=function(){},$p.eve.from_json_to_data_obj=function(e){var t,n=$p.eve.stepper;if("string"==typeof e?e=JSON.parse(e):e instanceof XMLHttpRequest&&(e=e.response?JSON.parse(e.response):{}),n.do_break)$p.iface.sync.close(),$p.eve.redirect=!0,location.reload(!0);else if(e.cat_date||e.force){e.cat_date>n.cat_ini_date&&(n.cat_ini_date=e.cat_date),e.cat_date>n.cat_date&&(n.cat_date=e.cat_date),e.count_all&&(n.count_all=e.count_all),e.current&&(n.current=e.current);for(t in e.cch)_cch[t]&&_cch[t].load_array(e.cch[t]);for(t in e.cacc)_cacc[t]&&_cacc[t].load_array(e.cacc[t]);for(t in e.cat)_cat[t]&&_cat[t].load_array(e.cat[t]);for(t in e.doc)_doc[t]&&_doc[t].load_array(e.doc[t]);for(t in e.ireg)_ireg[t]&&_ireg[t].load_array(e.ireg[t]);for(t in e.areg)_areg[t]&&_areg[t].load_array(e.areg[t]);return e.current&&e.current>=n.step_size}},$p.eve.reduce_promices=function(e,t){return e.reduce(function(e,n){return e.then(function(){return n}).then(t)["catch"](t)},Promise.resolve())},$p.eve.js_time_diff=-new Date("0001-01-01").valueOf(),$p.eve.time_diff=function(){var e=$p.wsql.get_user_param("time_diff","number");return!e||isNaN(e)||621355716e5>e||e>62135622e6?$p.eve.js_time_diff:e},$p.eve.log_in=function(e){var t,n,a,r=$p.eve.stepper,o={},i=[],s=$p.job_prm.data_url||"/data/";return e($p.eve.steps.load_meta),$p.ajax.default_attr(o,$p.job_prm.irest_url()),$p.job_prm.offline||i.push($p.ajax.get_ex(o.url,o)),i.push($p.ajax.get(s+"meta.json?v="+$p.job_prm.files_date)),i.push($p.ajax.get(s+"meta_patch.json?v="+$p.job_prm.files_date)),$p.eve.reduce_promices(i,function(a){a instanceof XMLHttpRequest&&200==a.status?-1!=a.responseURL.indexOf("/hs/rest")?$p.job_prm.irest_enabled=!0:-1!=a.responseURL.indexOf("meta.json")?(e($p.eve.steps.create_managers),t=JSON.parse(a.response)):-1!=a.responseURL.indexOf("meta_patch.json")&&(n=JSON.parse(a.response)):$p.record_log(a)}).then(function(){if(t)return new Meta(t,n);throw Error("Ошибка чтения файла метаданных")}).then(function(a){return t=n=null,e($p.eve.steps.authorization),$p.job_prm.offline?a:$p.job_prm.rest||$p.job_prm.irest_enabled?$p.job_prm.irest_enabled?{root:!0}:$p.ajax.get_ex($p.job_prm.rest_url()+"?$format=json",!0).then(function(e){return{root:!0}}):_load({action:"get_meta",cache_cat_date:r.cat_ini_date,now_js:Date.now(),margin:$p.wsql.get_user_param("margin","number"),ipinfo:$p.ipinfo.hasOwnProperty("latitude")?JSON.stringify($p.ipinfo):""})})["catch"](function(e){throw $p.iface.auth.onerror&&$p.iface.auth.onerror(e),e}).then(function(t){return e($p.eve.steps.load_data_files),$p.job_prm.offline?t:($p.ajax.authorized=!0,"string"==typeof t&&(t=JSON.parse(t)),$p.msg.check_soap_result(t)?void 0:($p.wsql.get_user_param("enable_save_pwd")?$p.wsql.set_user_param("user_pwd",$p.ajax.password):$p.wsql.get_user_param("user_pwd")&&$p.wsql.set_user_param("user_pwd",""),$p.wsql.set_user_param("time_diff",t["now_1с"]-t.now_js),t.cat&&t.cat.clrs&&(_md.get("cat.clrs").predefined.white.ref=t.cat.clrs.predefined.white.ref),t.cat&&t.cat.bases&&(_md.get("cat.bases").predefined.main.ref=t.cat.bases.predefined.main.ref),t))}).then(function(e){return a=e,r.zone=($p.job_prm.demo?"1":$p.wsql.get_user_param("zone"))+"/",$p.ajax.get(s+"zones/"+r.zone+"p_0.json?v="+$p.job_prm.files_date)}).then(function(e){var t=JSON.parse(e.response);r.files=t.files-1,r.step_size=t.files>0?Math.round(t.count_all/t.files):57,r.cat_ini_date=t.cat_date,$p.eve.from_json_to_data_obj(t)}).then(function(){i=[];for(var e=1;e<=r.files;e++)i.push($p.ajax.get(s+"zones/"+r.zone+"p_"+e+".json?v="+$p.job_prm.files_date));return i.push($p.ajax.get(s+"zones/"+r.zone+"ireg.json?v="+$p.job_prm.files_date)),$p.eve.reduce_promices(i,$p.eve.from_json_to_data_obj)}).then(function(){return e($p.eve.steps.load_data_db),r.step_size=57,$p.eve.pop()}).then(function(){a.access&&(a.access.force=!0,$p.eve.from_json_to_data_obj(a.access)),_md.printing_plates(a.printing_plates),$p.ajax.hasOwnProperty("root")&&delete $p.ajax.root,$p.ajax.__define("root",{value:!!a.root,writable:!1,enumerable:!1})}).then(function(){e($p.eve.steps.save_data_wsql)})},$p.eve.auto_log_in=function(){var e,t,n,a=$p.eve.stepper,r=$p.job_prm.data_url||"/data/",o=[];return a.zone=$p.wsql.get_user_param("zone")+"/",o.push($p.ajax.get(r+"meta.json?v="+$p.job_prm.files_date)),o.push($p.ajax.get(r+"meta_patch.json?v="+$p.job_prm.files_date)),o.push($p.ajax.get(r+"zones/"+a.zone+"p_0.json?v="+$p.job_prm.files_date)),$p.eve.reduce_promices(o,function(a){a instanceof XMLHttpRequest&&200==a.status?-1!=a.responseURL.indexOf("meta.json")?e=JSON.parse(a.response):-1!=a.responseURL.indexOf("meta_patch.json")?t=JSON.parse(a.response):-1!=a.responseURL.indexOf("p_0.json")&&(n=JSON.parse(a.response)):$p.record_log(a)}).then(function(){if(e)return new $p.Meta(e,t);throw Error("Ошибка чтения файла метаданных")}).then(function(e){a.files=n.files-1,a.step_size=n.files>0?Math.round(n.count_all/n.files):57,a.cat_ini_date=n.cat_date,$p.eve.from_json_to_data_obj(n)}).then(function(){o=[];for(var e=1;e<=a.files;e++)o.push($p.ajax.get(r+"zones/"+a.zone+"p_"+e+".json?v="+$p.job_prm.files_date));return o.push($p.ajax.get(r+"zones/"+a.zone+"ireg.json?v="+$p.job_prm.files_date)),$p.eve.reduce_promices(o,$p.eve.from_json_to_data_obj)}).then(function(){a.step_size=57})},$p.injected_data._mixin({"form_auth.xml":'<?xml version="1.0" encoding="UTF-8"?>\n<items>\n	<item type="settings" position="label-left" labelWidth="150" inputWidth="230" noteWidth="230"/>\n	<item type="fieldset" name="data" inputWidth="auto" label="Авторизация">\n\n        <item type="radio" name="type" labelWidth="auto" position="label-right" checked="true" value="guest" label="Гостевой (демо) режим">\n            <item type="select" name="guest" label="Роль">\n                <option value="Дилер" label="Дилер"/>\n            </item>\n        </item>\n\n		<item type="radio" name="type" labelWidth="auto" position="label-right" value="auth" label="Есть учетная запись">\n			<item type="input" value="" name="login" label="Имя пользователя" validate="NotEmpty" />\n			<item type="password" value="" name="password" label="Пароль" validate="NotEmpty" />\n		</item>\n\n		<item type="button" value="Войти" name="submit"/>\n\n        <item type="template" name="text_options" className="order_dealer_options" inputWidth="231"\n              value="&lt;a href=\'#\' onclick=\'$p.iface.open_settings();\' &gt; &lt;i class=\'fa fa-cog fa-lg\'&gt;&lt;/i&gt; Настройки &lt;/a&gt; &lt;a href=\'//www.oknosoft.ru/feedback\' target=\'_blank\' style=\'margin-left: 9px;\' &gt; &lt;i class=\'fa fa-question-circle fa-lg\'&gt;&lt;/i&gt; Задать вопрос &lt;/a&gt;"  />\n\n	</item>\n</items>',"toolbar_add_del.xml":'<?xml version="1.0" encoding=\'utf-8\'?>\r\n<toolbar>\r\n    <item type="button" id="btn_add"    text="&lt;i class=\'fa fa-plus-circle fa-lg\'&gt;&lt;/i&gt; Добавить" title="Добавить строку"  />\r\n    <item type="button" id="btn_delete" text="&lt;i class=\'fa fa-times fa-lg\'&gt;&lt;/i&gt; Удалить"  title="Удалить строку" />\r\n</toolbar>',"toolbar_obj.xml":'<?xml version="1.0" encoding=\'utf-8\'?>\r\n<toolbar>\r\n    <item type="button" id="btn_save_close" text="&lt;b&gt;Записать и закрыть&lt;/b&gt;" title="Рассчитать, записать и закрыть" />\r\n    <item type="button" id="btn_save" text="&lt;i class=\'fa fa-floppy-o fa-lg\'&gt;&lt;/i&gt; Записать" title="Рассчитать и записать данные"/>\r\n    <item type="button" id="btn_post" enabled="false" text="&lt;i class=\'fa fa-check-square-o fa-lg\'&gt;&lt;/i&gt;" title="Провести документ" />\r\n    <item type="button" id="btn_unpost" enabled="false" text="&lt;i class=\'fa fa-square-o fa-lg\'&gt;&lt;/i&gt;" title="Отмена проведения" />\r\n\r\n    <item type="button" id="btn_files" text="&lt;i class=\'fa fa-paperclip fa-lg\'&gt;&lt;/i&gt; Файлы" title="Присоединенные файлы"/>\r\n\r\n    <item type="buttonSelect" id="bs_create_by_virtue" text="Создать" title="Создать на основании" openAll="true" >\r\n        <item type="button" id="btn_message" enabled="false" text="Сообщение" />\r\n    </item>\r\n\r\n    <item type="buttonSelect" id="bs_go_to" text="Перейти" title="" openAll="true" >\r\n        <item type="button" id="btn_go_connection" enabled="false" text="Связи" />\r\n    </item>\r\n\r\n        <item type="buttonSelect" id="bs_print" text="&lt;i class=\'fa fa-print fa-lg\'&gt;&lt;/i&gt; Печать" openAll="true">\r\n    </item>\r\n\r\n    <item type="buttonSelect"   id="bs_more"  text="&lt;i class=\'fa fa-th-large fa-fw\'&gt;&lt;/i&gt;"  title="Дополнительно" openAll="true">\r\n        <item type="button" id="btn_import" text="&lt;i class=\'fa fa-upload fa-fw\'&gt;&lt;/i&gt; Загрузить из файла" />\r\n        <item type="button" id="btn_export" text="&lt;i class=\'fa fa-download fa-fw\'&gt;&lt;/i&gt; Выгрузить в файл" />\r\n    </item>\r\n\r\n</toolbar>\r\n',"toolbar_ok_cancel.xml":'<?xml version="1.0" encoding=\'utf-8\'?>\r\n<toolbar>\r\n    <item id="btn_ok"       type="button"   img=""  imgdis=""   text="&lt;b&gt;Ок&lt;/b&gt;"  />\r\n    <item id="btn_cancel"   type="button"	img=""  imgdis=""   text="Отмена" />\r\n</toolbar>',"toolbar_selection.xml":'<?xml version="1.0" encoding=\'utf-8\'?>\r\n<toolbar>\r\n    <item id="btn_select"   type="button"   title="Выбрать элемент списка" text="&lt;b&gt;Выбрать&lt;/b&gt;"  />\r\n\r\n    <item id="sep1" type="separator"/>\r\n    <item id="btn_new"      type="button"	text="&lt;i class=\'fa fa-plus-circle fa-lg\'&gt;&lt;/i&gt;"	title="Создать" />\r\n    <item id="btn_edit"     type="button"	text="&lt;i class=\'fa fa-pencil fa-lg\'&gt;&lt;/i&gt;"	title="Изменить" />\r\n    <item id="btn_delete"   type="button"	text="&lt;i class=\'fa fa-times fa-lg\'&gt;&lt;/i&gt;"	title="Удалить" />\r\n    <item id="sep2" type="separator"/>\r\n\r\n    <item type="buttonSelect" id="bs_print" text="&lt;i class=\'fa fa-print fa-lg\'&gt;&lt;/i&gt; Печать" openAll="true" >\r\n    </item>\r\n\r\n    <item type="buttonSelect"   id="bs_more"    text="&lt;i class=\'fa fa-th-large fa-lg\'&gt;&lt;/i&gt;" title="Дополнительно" openAll="true">\r\n        <item id="btn_requery"  type="button"	text="&lt;i class=\'fa fa-refresh fa-lg fa-fw\'&gt;&lt;/i&gt; Обновить список" />\r\n    </item>\r\n\r\n</toolbar>',"log.json":{ireg:{$log:{name:"$log",note:"",synonym:"Журнал событий",dimensions:{date:{synonym:"Дата",multiline_mode:!1,tooltip:"Время события",type:{types:["number"],digits:15,fraction_figits:0}},sequence:{synonym:"Порядок",multiline_mode:!1,tooltip:"Порядок следования",type:{types:["number"],digits:6,fraction_figits:0}}},resources:{"class":{synonym:"Класс",multiline_mode:!1,tooltip:"Класс события",type:{types:["string"],str_len:100}},note:{synonym:"Комментарий",multiline_mode:!0,tooltip:"Текст события",type:{types:["string"],str_len:0}},obj:{synonym:"Объект",tooltip:"Объект, к которому относится событие",type:{types:["string"],str_len:0}}}}}}});/* Copyright 2013 William Summers, metaTribal LLC
 * adapted from https://developer.mozilla.org/en-US/docs/JXON
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var xmlToJSON=function(){this.version="1.3";var e={mergeCDATA:!0,grokAttr:!0,grokText:!0,normalize:!0,xmlns:!0,namespaceKey:"_ns",textKey:"_text",valueKey:"_value",attrKey:"_attr",cdataKey:"_cdata",attrsAsObject:!0,stripAttrPrefix:!0,stripElemPrefix:!0,childrenAsArray:!0},t=new RegExp(/(?!xmlns)^.*:/),n=new RegExp(/^\s+|\s+$/g);return this.grokType=function(e){return/^\s*$/.test(e)?null:/^(?:true|false)$/i.test(e)?"true"===e.toLowerCase():isFinite(e)?parseFloat(e):e},this.parseString=function(e,t){return this.parseXML(this.stringToXML(e),t)},this.parseXML=function(a,r){for(var o in r)e[o]=r[o];var i={},s=0,l="";if(e.xmlns&&a.namespaceURI&&(i[e.namespaceKey]=a.namespaceURI),a.attributes&&a.attributes.length>0){var c={};for(s;s<a.attributes.length;s++){var d=a.attributes.item(s);f={};var p="";p=e.stripAttrPrefix?d.name.replace(t,""):d.name,e.grokAttr?f[e.valueKey]=this.grokType(d.value.replace(n,"")):f[e.valueKey]=d.value.replace(n,""),e.xmlns&&d.namespaceURI&&(f[e.namespaceKey]=d.namespaceURI),e.attrsAsObject?c[p]=f:i[e.attrKey+p]=f}e.attrsAsObject&&(i[e.attrKey]=c)}if(a.hasChildNodes())for(var _,u,f,m=0;m<a.childNodes.length;m++)_=a.childNodes.item(m),4===_.nodeType?e.mergeCDATA?l+=_.nodeValue:i.hasOwnProperty(e.cdataKey)?(i[e.cdataKey].constructor!==Array&&(i[e.cdataKey]=[i[e.cdataKey]]),i[e.cdataKey].push(_.nodeValue)):e.childrenAsArray?(i[e.cdataKey]=[],i[e.cdataKey].push(_.nodeValue)):i[e.cdataKey]=_.nodeValue:3===_.nodeType?l+=_.nodeValue:1===_.nodeType&&(0===s&&(i={}),u=e.stripElemPrefix?_.nodeName.replace(t,""):_.nodeName,f=xmlToJSON.parseXML(_),i.hasOwnProperty(u)?(i[u].constructor!==Array&&(i[u]=[i[u]]),i[u].push(f)):(e.childrenAsArray?(i[u]=[],i[u].push(f)):i[u]=f,s++));else l||(e.childrenAsArray?(i[e.textKey]=[],i[e.textKey].push(null)):i[e.textKey]=null);if(l)if(e.grokText){var h=this.grokType(l.replace(n,""));null!==h&&void 0!==h&&(i[e.textKey]=h)}else e.normalize?i[e.textKey]=l.replace(n,"").replace(/\s+/g," "):i[e.textKey]=l.replace(n,"");return i},this.xmlToString=function(e){try{var t=e.xml?e.xml:(new XMLSerializer).serializeToString(e);return t}catch(n){return null}},this.stringToXML=function(e){try{var t=null;if(window.DOMParser){var n=new DOMParser;return t=n.parseFromString(e,"text/xml")}return t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e),t}catch(a){return null}},this}();"undefined"!=typeof module&&null!==module&&module.exports?module.exports=xmlToJSON:"function"==typeof define&&define.amd&&define(function(){return xmlToJSON});/* FileSaver.js
 * A saveAs() FileSaver implementation.
 * 1.1.20151003
 *
 * By Eli Grey, http://eligrey.com
 * License: MIT
 *   See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md
 */
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var saveAs=saveAs||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=function(){return e.URL||e.webkitURL||e},a=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in a,o=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},i=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),s=e.webkitRequestFileSystem,l=e.requestFileSystem||s||e.mozRequestFileSystem,c=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},d="application/octet-stream",p=0,_=500,u=function(t){var a=function(){"string"==typeof t?n().revokeObjectURL(t):t.remove()};e.chrome?a():setTimeout(a,_)},f=function(e,t,n){t=[].concat(t);for(var a=t.length;a--;){var r=e["on"+t[a]];if("function"==typeof r)try{r.call(e,n||e)}catch(o){c(o)}}},m=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e},h=function(t,c,_){_||(t=m(t));var h,g,b,y=this,v=t.type,w=!1,$=function(){f(y,"writestart progress write writeend".split(" "))},x=function(){if(g&&i&&"undefined"!=typeof FileReader){var a=new FileReader;return a.onloadend=function(){var e=a.result;g.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),y.readyState=y.DONE,$()},a.readAsDataURL(t),void(y.readyState=y.INIT)}if((w||!h)&&(h=n().createObjectURL(t)),g)g.location.href=h;else{var r=e.open(h,"_blank");void 0==r&&i&&(e.location.href=h)}y.readyState=y.DONE,$(),u(h)},j=function(e){return function(){return y.readyState!==y.DONE?e.apply(this,arguments):void 0}},O={create:!0,exclusive:!1};return y.readyState=y.INIT,c||(c="download"),r?(h=n().createObjectURL(t),void setTimeout(function(){a.href=h,a.download=c,o(a),$(),u(h),y.readyState=y.DONE})):(e.chrome&&v&&v!==d&&(b=t.slice||t.webkitSlice,t=b.call(t,0,t.size,d),w=!0),s&&"download"!==c&&(c+=".download"),(v===d||s)&&(g=e),l?(p+=t.size,void l(e.TEMPORARY,p,j(function(e){e.root.getDirectory("saved",O,j(function(e){var n=function(){e.getFile(c,O,j(function(e){e.createWriter(j(function(n){n.onwriteend=function(t){g.location.href=e.toURL(),y.readyState=y.DONE,f(y,"writeend",t),u(e)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&x()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=y["on"+e]}),n.write(t),y.abort=function(){n.abort(),y.readyState=y.DONE},y.readyState=y.WRITING}),x)}),x)};e.getFile(c,{create:!1},j(function(e){e.remove(),n()}),j(function(e){e.code===e.NOT_FOUND_ERR?n():x()}))}),x)}),x)):void x())},g=h.prototype,b=function(e,t,n){return new h(e,t,n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return n||(e=m(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(g.abort=function(){var e=this;e.readyState=e.DONE,f(e,"abort")},g.readyState=g.INIT=0,g.WRITING=1,g.DONE=2,g.error=g.onwritestart=g.onprogress=g.onwrite=g.onabort=g.onerror=g.onwriteend=null,b)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);return"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs}),$p});