(function(a,b){var c={};a.trafficCop=function(b,d){var e=b,f;arguments.length===2&&(e=a.extend(!0,d,{url:b})),f=JSON.stringify(e);if(f in c)for(var g in{success:1,error:1,complete:1})c[f][g](e[g]);else c[f]=a.ajax(e).always(function(){delete c[f]});return c[f]},typeof define=="function"&&define.amd&&define(function(){return a.trafficCop})})(jQuery);var hashStorage={templates:{},storeTemplate:function(a,b){this.templates[a]=b},getTemplate:function(a){return this.templates[a]},purge:function(){this.templates={}}},scriptStorage={templateIds:[],storeTemplate:function(a,b){var c=document.getElementById(a);c===null&&(this.templateIds.push(a),c=document.createElement("script"),c.type="text/html",c.id=a,document.body.appendChild(c)),c.text=b},getTemplate:function(a){return document.getElementById(a)},purge:function(){for(var a=0;a<this.templateIds.length;a++)document.body.removeChild(document.getElementById(this.templateIds[a]));this.templateIds=[]}},errorHtml="<div class='infuser-error'>The template <a href='{TEMPLATEURL}'>{TEMPLATEID}</a> could not be loaded. {STATUS}</div>",returnErrorTemplate=function(a,b,c){return errorHtml.replace("{STATUS}",a).replace("{TEMPLATEID}",b).replace("{TEMPLATEURL}",c)},errors=[],helpers={getTemplatePath:function(a){var b=a.templatePrefix+a.templateId+a.templateSuffix;return a.templateUrl===undefined||a.templateUrl===""?b:a.templateUrl+"/"+b},templateGetSuccess:function(a,b){return function(c){var d=infuser.defaults.templatePreProcessor(c);infuser.store.storeTemplate(a,d),b(infuser.store.getTemplate(a))}},templateGetError:function(a,b,c){return function(d){$.inArray(a,errors)===-1&&errors.push(a);var e=returnErrorTemplate("HTTP Status code: "+d.status,a,b);infuser.store.storeTemplate(a,e),c(infuser.store.getTemplate(a))}},getAjaxOptions:function(a){}},infuserOptions=["target","loadingTemplate","postRender","preRender","render","bindingInstruction","useLoadingTemplate","model","templateUrl","templateSuffix","templatePrefix",""],infuser={storageOptions:{hash:hashStorage,script:scriptStorage},store:hashStorage,defaults:{templateUrl:"",templateSuffix:".html",templatePrefix:"",templatePreProcessor:function(a){return a},ajax:{async:!0,dataType:"html",type:"GET"},target:function(a){return"#"+a},loadingTemplate:{content:'<div class="infuser-loading">Loading...</div>',transitionIn:function(a,b){var c=$(a);c.hide(),c.html(b),c.fadeIn()},transitionOut:function(a){$(a).html("")}},postRender:function(a){},preRender:function(a,b){},render:function(a,b){var c=$(a);c.children().length===0?c.append($(b)):c.children().replaceWith($(b))},bindingInstruction:function(a,b){return a},useLoadingTemplate:!0},get:function(a,b){var c=$.extend({},infuser.defaults,typeof a=="object"?a:{templateId:a}),d;c.ajax.url=helpers.getTemplatePath(c),d=infuser.store.getTemplate(c.ajax.url),!d||$.inArray(c.ajax.url,errors)!==-1?(c.ajax.success=helpers.templateGetSuccess(c.ajax.url,b),c.ajax.error=helpers.templateGetError(c.templateId,c.ajax.url,b),$.trafficCop(c.ajax)):b(d)},getSync:function(a){var b=$.extend({},infuser.defaults,typeof a=="object"?a:{templateId:a},{ajax:{async:!1}}),c,d;b.ajax.url=helpers.getTemplatePath(b),c=infuser.store.getTemplate(b.ajax.url);if(!c||$.inArray(b.ajax.url,errors)!==-1)d=null,b.ajax.success=function(a){d=a},b.ajax.error=function(a){$.inArray(b.ajax.url)===-1&&errors.push(b.ajax.url),d=returnErrorTemplate("HTTP Status code: exception.status",b.templateId,b.ajax.url)},$.ajax(b.ajax),d===null?d=returnErrorTemplate("An unknown error occurred.",b.templateId,b.ajax.url):(infuser.store.storeTemplate(b.ajax.url,d),c=infuser.store.getTemplate(b.ajax.url));return c},infuse:function(a,b){var c=$.extend({},infuser.defaults,typeof a=="object"?a:b,typeof a=="string"?{templateId:a}:undefined),d=typeof c.target=="function"?c.target(a):c.target;c.useLoadingTemplate&&c.loadingTemplate.transitionIn(d,c.loadingTemplate.content),infuser.get(c,function(a){var b=a;c.preRender(d,b),b=c.bindingInstruction(b,c.model),c.useLoadingTemplate&&c.loadingTemplate.transitionOut(d),c.render(d,b),c.postRender(d)})}};typeof define=="function"&&define.amd&&define(["jquery"],function(a){return infuser})