/**
 * Interactive Map Overview for OpenLayers 3
 * https://github.com/jonataswalker/ol3-interactive-overview
 * Version: v0.1.0
 * Built: 2016-09-12T13:25:51-03:00
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.InteractiveOverview=e()}(this,function(){"use strict";var t="ol-itv-overview",e="-container",n="-map",i="-overlay",o="-hidden",s="-collapsed",a="-transitionend",r="ol-control",l="ol-unselectable",c={container:t+e,map:t+n,overlay:t+i,hidden:t+o,collapsed:t+s,btn_absolute:t+a,OL_control:r,OL_unselectable:l},d={collapsed:!0,collapsible:!0,tipLabel:"Interactive overview map",label:"»",collapseLabel:"«"},p=.75,u=.1,m={isNumeric:function(t){return/^\d+$/.test(t)},classRegex:function(t){return new RegExp("(^|\\s+) "+t+" (\\s+|$)")},addClass:function(t,e,n){var i=this;if(Array.isArray(t))return void t.forEach(function(t){i.addClass(t,e)});for(var o=Array.isArray(e)?e:e.split(/\s+/),s=o.length;s--;)i.hasClass(t,o[s])||i._addClass(t,o[s],n)},_addClass:function(t,e,n){var i=this;t.classList?t.classList.add(e):t.className=(t.className+" "+e).trim(),n&&this.isNumeric(n)&&window.setTimeout(function(){i._removeClass(t,e)},n)},removeClass:function(t,e,n){var i=this;if(Array.isArray(t))return void t.forEach(function(t){i.removeClass(t,e,n)});for(var o=Array.isArray(e)?e:e.split(/\s+/),s=o.length;s--;)i.hasClass(t,o[s])&&i._removeClass(t,o[s],n)},_removeClass:function(t,e,n){var i=this;t.classList?t.classList.remove(e):t.className=t.className.replace(this.classRegex(e)," ").trim(),n&&this.isNumeric(n)&&window.setTimeout(function(){i._addClass(t,e)},n)},hasClass:function(t,e){return t.classList?t.classList.contains(e):this.classRegex(e).test(t.className)},toggleClass:function(t,e){var n=this;return Array.isArray(t)?void t.forEach(function(t){n.toggleClass(t,e)}):void(t.classList?t.classList.toggle(e):this.hasClass(t,e)?this._removeClass(t,e):this._addClass(t,e))},$:function(t){return t="#"===t[0]?t.substr(1,t.length):t,document.getElementById(t)},isElement:function(t){return"HTMLElement"in window?!!t&&t instanceof HTMLElement:!!t&&"object"==typeof t&&1===t.nodeType&&!!t.nodeName},find:function(t,e,n){void 0===e&&(e=window.document);var i=/^(#?[\w-]+|\.[\w-.]+)$/,o=/\./g,s=Array.prototype.slice,a=[];if(i.test(t))switch(t[0]){case"#":a=[this.$(t.substr(1))];break;case".":a=s.call(e.getElementsByClassName(t.substr(1).replace(o," ")));break;default:a=s.call(e.getElementsByTagName(t))}else a=s.call(e.querySelectorAll(t));return n?a:a[0]},getAllChildren:function(t,e){return[].slice.call(t.getElementsByTagName(e))},isEmpty:function(t){return!t||0===t.length},emptyArray:function(t){for(;t.length;)t.pop()},removeAllChildren:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},mergeOptions:function(t,e){var n={};for(var i in t)n[i]=t[i];for(var o in e)n[o]=e[o];return n},createFragment:function(t){var e=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)e.appendChild(n.firstChild);return e},contains:function(t,e){return!!~e.indexOf(t)},isDefAndNotNull:function(t){return null!=t},assertEqual:function(t,e,n){if(t!==e)throw new Error(n+" mismatch: "+t+" != "+e)},assert:function(t,e){if(void 0===e&&(e="Assertion failed"),!t){if("undefined"!=typeof Error)throw new Error(e);throw e}},scaleFromCenter:function(t,e){var n=(t[2]-t[0])/2*(e-1),i=(t[3]-t[1])/2*(e-1);t[0]-=n,t[2]+=n,t[1]-=i,t[3]+=i},isMapRendered:function(t){return!!t.getPixelFromCoordinate([0,0])}},h=function(t){return this.Base=t,this.Html=t.constructor.Html,this.map=void 0,this.itv_map=void 0,this};h.prototype.init=function(t){this.map=t,this.itv_map=new ol.Map({controls:[],interactions:[],target:this.Html.elements.map_div,view:this.Base.options.view}),this.Base.options.layers&&this.Base.options.layers.forEach(function(t){this.itv_map.addLayer(t)},this),this.overlay=new ol.Overlay({position:this.map.getView().getCenter(),positioning:"center-center",element:this.Html.elements.overlay_div}),this.itv_map.addOverlay(this.overlay),this.itv_map.updateSize(),this.resetExtent(),this.setListeners()},h.prototype.setListeners=function(){var t=this,e=this.Html.elements,n=function(t){t.preventDefault(),m.hasClass(e.container,c.collapsed)&&m.addClass(e.button,c.btn_absolute),m.toggleClass(e.container,c.collapsed)},i=function(t){"width"===t.propertyName&&m.hasClass(e.container,c.collapsed)&&m.removeClass(e.button,c.btn_absolute)};e.button.addEventListener("touchend",function(t){t.preventDefault(),t.target.click()},!1),e.button.addEventListener("click",n,!1),e.map_div.addEventListener("transitionend",i,!1),this.itv_map.once("postrender",function(){this.updateBox()},this),e.overlay_div.addEventListener("mousedown",function(){function e(e){var n=t.itv_map.getEventCoordinate(e),i=ol.proj.transform(n,"EPSG:3857","EPSG:4326"),s=ol.extent.containsCoordinate(o,i);s&&(t.overlay.setPosition(n),t.map.getView().setCenter(n)),console.info(i),console.info("inside",s)}function n(){window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",n)}var i=t.itv_map.getView().getProjection(),o=i.getWorldExtent();console.info(o),window.addEventListener("mousemove",e),window.addEventListener("mouseup",n)})},h.prototype.calculateCoordinateRotate=function(t,e){var n,i=this.map.getView().getCenter();return i&&(n=[e[0]-i[0],e[1]-i[1]],ol.coordinate.rotate(n,t),ol.coordinate.add(n,i)),n},h.prototype.recenter=function(){this.itv_map.getView().setCenter(this.map.getView().getCenter())},h.prototype.resetExtent=function(){if(0!==p&&0!==u){var t=this.map.getView().calculateExtent(this.map.getSize()),e=Math.log(p/u)/Math.LN2,n=1/(Math.pow(2,e/2)*u);m.scaleFromCenter(t,n),this.itv_map.getView().fit(t,this.itv_map.getSize())}},h.prototype.updateBox=function(){if(m.isMapRendered(this.map)&&m.isMapRendered(this.itv_map)){var t=this.map.getView(),e=t.calculateExtent(this.map.getSize()),n=ol.extent.getCenter(e),i=this.calculateCoordinateRotate(t.getRotation(),n);this.overlay.setPosition(i)}},h.prototype.validateExtent=function(){if(m.isMapRendered(this.map)&&m.isMapRendered(this.itv_map)){var t=this.map.getView().calculateExtent(this.map.getSize()),e=this.itv_map.getSize(),n=this.itv_map.getView().calculateExtent(e),i=this.itv_map.getPixelFromCoordinate(ol.extent.getTopLeft(t)),o=this.itv_map.getPixelFromCoordinate(ol.extent.getBottomRight(t)),s=Math.abs(i[0]-o[0]),a=Math.abs(i[1]-o[1]);s<e[0]*u||a<e[1]*u||s>e[0]*p||a>e[1]*p?this.resetExtent():ol.extent.containsExtent(n,t)||this.recenter()}};var v=function(t){return this.Base=t,this.elements={},this.Base.container=this.createContainer(),this};v.prototype.createContainer=function(){var t=document.createElement("div"),e=document.createElement("div"),n=document.createElement("button"),i=document.createElement("span"),o=document.createElement("div");return e.className=c.map,t.appendChild(e),o.className=c.overlay,o.style.boxSizing="border-box",i.textContent="»",n.setAttribute("type","button"),n.className=this.Base.options.collapsed?"":c.btn_absolute,n.title=this.Base.options.tipLabel,n.appendChild(i),t.appendChild(n),t.className=[c.container,this.Base.options.collapsed?c.collapsed:"",c.OL_control,c.OL_unselectable].join(" "),this.elements={container:t,button:n,map_div:e,overlay_div:o},t};var f=function(t){function e(n){void 0===n&&(n={}),m.assert("object"==typeof n,"@param `opt_options` should be object type!"),this.options=m.mergeOptions(d,n),e.Html=new v(this),e.Internal=new h(this),t.call(this,{element:this.container,render:this.render})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clear=function(){Object.keys(e.Internal.items).forEach(function(t){e.Html.removeMenuEntry(t)})},e.prototype.render=function(t){e.Internal.validateExtent(),e.Internal.updateBox()},e.prototype.setMap=function(t){ol.control.Control.prototype.setMap.call(this,t),t&&e.Internal.init(t)},e}(ol.control.Control);return f});
