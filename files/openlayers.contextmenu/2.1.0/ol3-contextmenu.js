/**
 * Custom Context Menu for Openlayers 3
 * https://github.com/jonataswalker/ol3-contextmenu
 * Version: v2.1.0
 * Built: 2016-05-23T15:06:24-0300
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.ContextMenu=e()}(this,function(){"use strict";var t="ol-ctx-menu",e="-container",n="-separator",i="-submenu",s="-hidden",o="-icon",a="-zoom-in",r="-zoom-out",l="ol-unselectable",c={isNumeric:function(t){return/^\d+$/.test(t)},classRegex:function(t){return new RegExp("(^|\\s+) "+t+" (\\s+|$)")},addClass:function(t,e,n){var i=this;if(Array.isArray(t))return void t.forEach(function(t){i.addClass(t,e)});for(var s=Array.isArray(e)?e:e.split(/\s+/),o=s.length;o--;)i.hasClass(t,s[o])||i._addClass(t,s[o],n)},_addClass:function(t,e,n){var i=this;t.classList?t.classList.add(e):t.className=(t.className+" "+e).trim(),n&&this.isNumeric(n)&&window.setTimeout(function(){i._removeClass(t,e)},n)},removeClass:function(t,e,n){var i=this;if(Array.isArray(t))return void t.forEach(function(t){i.removeClass(t,e,n)});for(var s=Array.isArray(e)?e:e.split(/\s+/),o=s.length;o--;)i.hasClass(t,s[o])&&i._removeClass(t,s[o],n)},_removeClass:function(t,e,n){var i=this;t.classList?t.classList.remove(e):t.className=t.className.replace(this.classRegex(e)," ").trim(),n&&this.isNumeric(n)&&window.setTimeout(function(){i._addClass(t,e)},n)},hasClass:function(t,e){return t.classList?t.classList.contains(e):this.classRegex(e).test(t.className)},toggleClass:function(t,e){var n=this;return Array.isArray(t)?void t.forEach(function(t){n.toggleClass(t,e)}):void(t.classList?t.classList.toggle(e):this.hasClass(t,e)?this._removeClass(t,e):this._addClass(t,e))},$:function(t){return t="#"===t[0]?t.substr(1,t.length):t,document.getElementById(t)},isElement:function(t){return"HTMLElement"in window?!!t&&t instanceof HTMLElement:!!t&&"object"==typeof t&&1===t.nodeType&&!!t.nodeName},find:function(t,e,n){void 0===e&&(e=window.document);var i=/^(#?[\w-]+|\.[\w-.]+)$/,s=/\./g,o=Array.prototype.slice,a=[];if(i.test(t))switch(t[0]){case"#":a=[this.$(t.substr(1))];break;case".":a=o.call(e.getElementsByClassName(t.substr(1).replace(s," ")));break;default:a=o.call(e.getElementsByTagName(t))}else a=o.call(e.querySelectorAll(t));return n?a:a[0]},getAllChildren:function(t,e){return[].slice.call(t.getElementsByTagName(e))},isEmpty:function(t){return!t||0===t.length},emptyArray:function(t){for(;t.length;)t.pop()},removeAllChildren:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},mergeOptions:function(t,e){var n={};for(var i in t)n[i]=t[i];for(var s in e)n[s]=e[s];return n},createFragment:function(t){var e=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)e.appendChild(n.firstChild);return e},contains:function(t,e){return!!~e.indexOf(t)},isDefAndNotNull:function(t){return null!=t},assertEqual:function(t,e,n){if(t!=e)throw new Error(n+" mismatch: "+t+" != "+e)},assert:function(t,e){if(void 0===e&&(e="Assertion failed"),!t){if("undefined"!=typeof Error)throw new Error(e);throw e}},events:function(){var t={},e=t.hasOwnProperty;return{subscribe:function(n,i){e.call(t,n)||(t[n]=[]);var s=t[n].push(i)-1;return{remove:function(){delete t[n][s]}}},publish:function(n,i){e.call(t,n)&&t[n].forEach(function(t){t(void 0!==i?i:{})})}}}},u={BEFOREOPEN:"beforeopen",OPEN:"open",CLOSE:"close",ADD_MENU_ENTRY:"add-menu-entry"},d={width:150,default_items:!0},h=c.events(),m=[{text:"Zoom In",classname:[t+a,t+o].join(" "),callback:function(t,e){var n=e.getView(),i=ol.animation.pan({duration:1e3,source:n.getCenter()}),s=ol.animation.zoom({duration:1e3,resolution:n.getResolution()});e.beforeRender(i,s),n.setCenter(t.coordinate),n.setZoom(+n.getZoom()+1)}},{text:"Zoom Out",classname:[t+r,t+o].join(" "),callback:function(t,e){var n=e.getView(),i=ol.animation.pan({duration:1e3,source:n.getCenter()}),s=ol.animation.zoom({duration:1e3,resolution:n.getResolution()});e.beforeRender(i,s),n.setCenter(t.coordinate),n.setZoom(+n.getZoom()-1)}}],p=function(t){return this.Base=t,this.map=void 0,this.coordinate_clicked=void 0,this.pixel_clicked=void 0,this.counter=0,this.lineHeight=0,this.items={},this.submenu={left:this.Base.options.width-15+"px",last_left:""},this};p.prototype.init=function(t){this.map=t,this.setListeners(),this.Base.constructor.Html.createMenu(),this.lineHeight=this.Base.container.offsetHeight/this.getItemsLength()},p.prototype.getItemsLength=function(){var t=this,e=0;return Object.keys(this.items).forEach(function(n){t.items[n].submenu||t.items[n].separator||e++}),e},p.prototype.getPixelClicked=function(){return this.pixel_clicked},p.prototype.getCoordinateClicked=function(){return this.coordinate_clicked},p.prototype.positionContainer=function(e){var n=this,o=this.map.getSize(),a=o[0],r=o[1],l=r-e[1],u=a-e[0],d={w:this.Base.container.offsetWidth,h:Math.round(this.lineHeight*this.getItemsLength())},h=c.find("li."+t+i+">ul",this.Base.container,!0);u>=d.w?(this.Base.container.style.right="auto",this.Base.container.style.left=e[0]+5+"px"):(this.Base.container.style.left="auto",this.Base.container.style.right="15px"),l>=d.h?(this.Base.container.style.bottom="auto",this.Base.container.style.top=e[1]-10+"px"):(this.Base.container.style.top="auto",this.Base.container.style.bottom=0),c.removeClass(this.Base.container,t+s),h.length&&(u<2*d.w?this.submenu.last_left="-"+d.w+"px":this.submenu.last_left=this.submenu.left,h.forEach(function(t){t.style.left=n.submenu.last_left}))},p.prototype.openMenu=function(t,e){this.positionContainer(t),this.Base.dispatchEvent({type:u.OPEN,pixel:t,coordinate:e})},p.prototype.closeMenu=function(){c.addClass(this.Base.container,t+s),this.Base.dispatchEvent({type:u.CLOSE})},p.prototype.getNextItemIndex=function(){return++this.counter},p.prototype.setListeners=function(){var t=this,e=this.map,n=e.getTargetElement(),i=function(i){t.coordinate_clicked=e.getEventCoordinate(i),t.pixel_clicked=e.getEventPixel(i),t.Base.dispatchEvent({type:u.BEFOREOPEN,pixel:t.pixel_clicked,coordinate:t.coordinate_clicked}),t.Base.disabled||(i.stopPropagation(),i.preventDefault(),t.openMenu(t.pixel_clicked,t.coordinate_clicked),n.addEventListener("mousedown",{handleEvent:function(e){t.closeMenu(),n.removeEventListener(e.type,this,!1)}},!1))};n.addEventListener("contextmenu",i,!1),h.subscribe(u.ADD_MENU_ENTRY,function(e){t.setItemListener(e.element,e.index)})},p.prototype.setItemListener=function(t,e){var n=this;t&&"function"==typeof this.items[e].callback&&!function(i){t.addEventListener("click",function(t){t.preventDefault();var s={coordinate:n.getCoordinateClicked(),data:n.items[e].data||null};n.closeMenu(),i.call(void 0,s,n.map)},!1)}(this.items[e].callback)};var f=function(t){return this.Base=t,this.Base.container=this.container=this.createContainer(),this};f.prototype.createContainer=function(){var n=document.createElement("ul");return n.className=[t+e,t+s,l].join(" "),n.style.width=parseInt(this.Base.options.width,10)+"px",n},f.prototype.createMenu=function(){var t=this.Base.options,e=[];return"items"in t?e=t.default_items?t.items.concat(m):t.items:t.default_items&&(e=m),0===e.length?!1:void e.forEach(this.addMenuEntry,this)},f.prototype.addMenuEntry=function(n){var s=this,o=this.Base.constructor.Internal,a=o.getNextItemIndex(),r=t+i;if(n.items&&Array.isArray(n.items)){n.classname=n.classname||"",c.contains(r,n.classname)||(n.classname+=" "+r);var l=this.generateHtmlAndPublish(this.container,n,a),u=document.createElement("ul");u.className=t+e,u.style.left=o.submenu.last_left||o.submenu.left,u.style.width=this.Base.options.width+"px",l.appendChild(u),n.items.forEach(function(t){s.generateHtmlAndPublish(u,t,o.getNextItemIndex(),!0)})}else this.generateHtmlAndPublish(this.container,n,a)},f.prototype.generateHtmlAndPublish=function(e,i,s,a){var r,l,d,m=!1,p=this.Base.constructor.Internal;return"string"==typeof i&&"-"==i.trim()?(r='<li class="'+t+n+'"><hr></li>',l=c.createFragment(r),d=[].slice.call(l.childNodes,0)[0],e.appendChild(l),m=!0):(i.classname=i.classname||"",r="<span>"+i.text+"</span>",l=c.createFragment(r),d=document.createElement("li"),i.icon&&(""===i.classname?i.classname=t+o:-1===i.classname.indexOf(t+o)&&(i.classname+=" "+t+o),d.setAttribute("style","background-image:url("+i.icon+")")),d.id="index"+s,d.className=i.classname,d.appendChild(l),e.appendChild(d)),p.items[s]={id:s,submenu:a||0,separator:m,callback:i.callback,data:i.data||null},h.publish(u.ADD_MENU_ENTRY,{index:s,element:d}),d};var y=function(t){function e(n){void 0===n&&(n={}),c.assert("object"==typeof n,"@param `opt_options` should be object type!"),this.options=c.mergeOptions(d,n),this.disabled=!1,e.Internal=new p(this),e.Html=new f(this),t.call(this,{element:this.container})}return e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clear=function(){Object.keys(e.Internal.items).forEach(function(t){delete e.Internal.items[t]}),c.removeAllChildren(this.container)},e.prototype.enable=function(){this.disabled=!1},e.prototype.disable=function(){this.disabled=!0},e.prototype.getDefaultItems=function(){return m},e.prototype.extend=function(t){c.assert(Array.isArray(t),"@param `arr` should be an Array."),t.forEach(this.push,this)},e.prototype.pop=function(){var t=this.container.lastChild;t&&this.container.removeChild(t)},e.prototype.push=function(t){c.assert(c.isDefAndNotNull(t),"@param `item` must be informed."),e.Html.addMenuEntry(t,e.Internal.getNextItemIndex()),e.Internal.positionContainer(e.Internal.getPixelClicked())},e.prototype.setMap=function(t){ol.control.Control.prototype.setMap.call(this,t),e.Internal.init(t)},e}(ol.control.Control);return y});
