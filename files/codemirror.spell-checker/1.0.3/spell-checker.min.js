/*!
 * SimpleMDE v1.0.3 (https://github.com/NextStepWebs/codemirror-spell-checker)
 * Copyright Next Step Webs, Inc.
 * Licensed under the MIT license
 */

"use strict";var Typo=function(e,t,r,n){if(n=n||{},this.platform=n.platform||"chrome",this.dictionary=null,this.rules={},this.dictionaryTable={},this.compoundRules=[],this.compoundRuleCodes={},this.replacementTable=[],this.flags=n.flags||{},e){if(this.dictionary=e,"chrome"==this.platform)t||(t=this._readFile(chrome.extension.getURL("lib/typo/dictionaries/"+e+"/"+e+".aff"))),r||(r=this._readFile(chrome.extension.getURL("lib/typo/dictionaries/"+e+"/"+e+".dic")));else{var s=n.dictionaryPath||"";t||(t=this._readFile(s+"/"+e+"/"+e+".aff")),r||(r=this._readFile(s+"/"+e+"/"+e+".dic"))}this.rules=this._parseAFF(t),this.compoundRuleCodes={};for(var i=0,a=this.compoundRules.length;a>i;i++)for(var o=this.compoundRules[i],l=0,h=o.length;h>l;l++)this.compoundRuleCodes[o[l]]=[];"ONLYINCOMPOUND"in this.flags&&(this.compoundRuleCodes[this.flags.ONLYINCOMPOUND]=[]),this.dictionaryTable=this._parseDIC(r);for(var i in this.compoundRuleCodes)0==this.compoundRuleCodes[i].length&&delete this.compoundRuleCodes[i];for(var i=0,a=this.compoundRules.length;a>i;i++){for(var u=this.compoundRules[i],c="",l=0,h=u.length;h>l;l++){var p=u[l];c+=p in this.compoundRuleCodes?"("+this.compoundRuleCodes[p].join("|")+")":p}this.compoundRules[i]=new RegExp(c,"i")}}return this};Typo.prototype={load:function(e){for(var t in e)this[t]=e[t];return this},_readFile:function(e,t){t||(t="ISO8859-1");var r=new XMLHttpRequest;return r.open("GET",e,!1),r.overrideMimeType&&r.overrideMimeType("text/plain; charset="+t),r.send(null),r.responseText},_parseAFF:function(e){var t={};e=this._removeAffixComments(e);for(var r=e.split("\n"),n=0,s=r.length;s>n;n++){var i=r[n],a=i.split(/\s+/),o=a[0];if("PFX"==o||"SFX"==o){for(var l=a[1],h=a[2],u=parseInt(a[3],10),c=[],p=n+1,f=n+1+u;f>p;p++){var i=r[p],d=i.split(/\s+/),v=d[2],g=d[3].split("/"),m=g[0];"0"===m&&(m="");var y=this.parseRuleCodes(g[1]),C=d[4],R={};R.add=m,y.length>0&&(R.continuationClasses=y),"."!==C&&(R.match=new RegExp("SFX"===o?C+"$":"^"+C)),"0"!=v&&(R.remove="SFX"===o?new RegExp(v+"$"):v),c.push(R)}t[l]={type:o,combineable:"Y"==h,entries:c},n+=u}else if("COMPOUNDRULE"===o){for(var u=parseInt(a[1],10),p=n+1,f=n+1+u;f>p;p++){var i=r[p],d=i.split(/\s+/);this.compoundRules.push(d[1])}n+=u}else if("REP"===o){var d=i.split(/\s+/);3===d.length&&this.replacementTable.push([d[1],d[2]])}else this.flags[o]=a[1]}return t},_removeAffixComments:function(e){return e=e.replace(/#.*$/gm,""),e=e.replace(/^\s\s*/m,"").replace(/\s\s*$/m,""),e=e.replace(/\n{2,}/g,"\n"),e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},_parseDIC:function(e){function t(e,t){e in n&&"object"==typeof n[e]||(n[e]=[]),n[e].push(t)}e=this._removeDicComments(e);for(var r=e.split("\n"),n={},s=1,i=r.length;i>s;s++){var a=r[s],o=a.split("/",2),l=o[0];if(o.length>1){var h=this.parseRuleCodes(o[1]);"NEEDAFFIX"in this.flags&&-1!=h.indexOf(this.flags.NEEDAFFIX)||t(l,h);for(var u=0,c=h.length;c>u;u++){var p=h[u],f=this.rules[p];if(f)for(var d=this._applyRule(l,f),v=0,g=d.length;g>v;v++){var m=d[v];if(t(m,[]),f.combineable)for(var y=u+1;c>y;y++){var C=h[y],R=this.rules[C];if(R&&R.combineable&&f.type!=R.type)for(var b=this._applyRule(m,R),F=0,x=b.length;x>F;F++){var E=b[F];t(E,[])}}}p in this.compoundRuleCodes&&this.compoundRuleCodes[p].push(l)}}else t(l.trim(),[])}return n},_removeDicComments:function(e){return e=e.replace(/^\t.*$/gm,"")},parseRuleCodes:function(e){if(!e)return[];if(!("FLAG"in this.flags))return e.split("");if("long"===this.flags.FLAG){for(var t=[],r=0,n=e.length;n>r;r+=2)t.push(e.substr(r,2));return t}return"num"===this.flags.FLAG?textCode.split(","):void 0},_applyRule:function(e,t){for(var r=t.entries,n=[],s=0,i=r.length;i>s;s++){var a=r[s];if(!a.match||e.match(a.match)){var o=e;if(a.remove&&(o=o.replace(a.remove,"")),"SFX"===t.type?o+=a.add:o=a.add+o,n.push(o),"continuationClasses"in a)for(var l=0,h=a.continuationClasses.length;h>l;l++){var u=this.rules[a.continuationClasses[l]];u&&(n=n.concat(this._applyRule(o,u)))}}}return n},check:function(e){var t=e.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(this.checkExact(t))return!0;if(t.toUpperCase()===t){var r=t[0]+t.substring(1).toLowerCase();if(this.hasFlag(r,"KEEPCASE"))return!1;if(this.checkExact(r))return!0}var n=t.toLowerCase();if(n!==t){if(this.hasFlag(n,"KEEPCASE"))return!1;if(this.checkExact(n))return!0}return!1},checkExact:function(e){var t=this.dictionaryTable[e];if("undefined"==typeof t){if("COMPOUNDMIN"in this.flags&&e.length>=this.flags.COMPOUNDMIN)for(var r=0,n=this.compoundRules.length;n>r;r++)if(e.match(this.compoundRules[r]))return!0;return!1}for(var r=0,n=t.length;n>r;r++)if(!this.hasFlag(e,"ONLYINCOMPOUND",t[r]))return!0;return!1},hasFlag:function(e,t,r){if(t in this.flags){if("undefined"==typeof r)var r=Array.prototype.concat.apply([],this.dictionaryTable[e]);if(r&&-1!==r.indexOf(this.flags[t]))return!0}return!1},alphabet:"",suggest:function(e,t){function r(e){for(var t=[],r=0,n=e.length;n>r;r++){for(var s=e[r],i=[],a=0,o=s.length+1;o>a;a++)i.push([s.substring(0,a),s.substring(a,s.length)]);for(var l=[],a=0,o=i.length;o>a;a++){var u=i[a];u[1]&&l.push(u[0]+u[1].substring(1))}for(var c=[],a=0,o=i.length;o>a;a++){var u=i[a];u[1].length>1&&c.push(u[0]+u[1][1]+u[1][0]+u[1].substring(2))}for(var p=[],a=0,o=i.length;o>a;a++){var u=i[a];if(u[1])for(var f=0,d=h.alphabet.length;d>f;f++)p.push(u[0]+h.alphabet[f]+u[1].substring(1))}for(var v=[],a=0,o=i.length;o>a;a++){var u=i[a];if(u[1])for(var f=0,d=h.alphabet.length;d>f;f++)p.push(u[0]+h.alphabet[f]+u[1])}t=t.concat(l),t=t.concat(c),t=t.concat(p),t=t.concat(v)}return t}function n(e){for(var t=[],r=0;r<e.length;r++)h.check(e[r])&&t.push(e[r]);return t}function s(e){function s(e,t){return e[1]<t[1]?-1:1}for(var i=r([e]),a=r(i),o=n(i).concat(n(a)),l={},u=0,c=o.length;c>u;u++)o[u]in l?l[o[u]]+=1:l[o[u]]=1;var p=[];for(var u in l)p.push([u,l[u]]);p.sort(s).reverse();for(var f=[],u=0,c=Math.min(t,p.length);c>u;u++)h.hasFlag(p[u][0],"NOSUGGEST")||f.push(p[u][0]);return f}if(t||(t=5),this.check(e))return[];for(var i=0,a=this.replacementTable.length;a>i;i++){var o=this.replacementTable[i];if(-1!==e.indexOf(o[0])){var l=e.replace(o[0],o[1]);if(this.check(l))return[l]}}var h=this;return h.alphabet="abcdefghijklmnopqrstuvwxyz",s(e)}},CodeMirror.defineMode("spell-checker",function(e){var t,r=0,n="",s="",i=new XMLHttpRequest;i.open("GET","https://cdn.jsdelivr.net/codemirror.spell-checker/latest/en_US.aff",!0),i.onload=function(){4===i.readyState&&200===i.status&&(n=i.responseText,r++,2==r&&(t=new Typo("en_US",n,s,{platform:"any"})))},i.send(null);var a=new XMLHttpRequest;a.open("GET","https://cdn.jsdelivr.net/codemirror.spell-checker/latest/en_US.dic",!0),a.onload=function(){4===a.readyState&&200===a.status&&(s=a.responseText,r++,2==r&&(t=new Typo("en_US",n,s,{platform:"any"})))},a.send(null);var o='!"#$%&()*+,-./:;<=>?@[\\]^_`{|}~ ',l={token:function(e){var r=e.peek(),n="";if(o.includes(r))return e.next(),null;for(;null!=(r=e.peek())&&!o.includes(r);)n+=r,e.next();return t&&!t.check(n)?"spell-error":null}},h=CodeMirror.getMode(e,e.backdrop||"text/plain");return CodeMirror.overlayMode(h,l,!0)}),String.prototype.includes||(String.prototype.includes=function(){return-1!==String.prototype.indexOf.apply(this,arguments)});