/*!
 * SimpleMDE v1.0.0 (https://github.com/NextStepWebs/codemirror-spell-checker)
 * Copyright Next Step Webs, Inc.
 * Licensed under the MIT license
 */

"use strict";var Typo=function(e,t,r,n){if(n=n||{},this.platform=n.platform||"chrome",this.dictionary=null,this.rules={},this.dictionaryTable={},this.compoundRules=[],this.compoundRuleCodes={},this.replacementTable=[],this.flags=n.flags||{},e){if(this.dictionary=e,"chrome"==this.platform)t||(t=this._readFile(chrome.extension.getURL("lib/typo/dictionaries/"+e+"/"+e+".aff"))),r||(r=this._readFile(chrome.extension.getURL("lib/typo/dictionaries/"+e+"/"+e+".dic")));else{var i=n.dictionaryPath||"";t||(t=this._readFile(i+"/"+e+"/"+e+".aff")),r||(r=this._readFile(i+"/"+e+"/"+e+".dic"))}this.rules=this._parseAFF(t),this.compoundRuleCodes={};for(var s=0,a=this.compoundRules.length;a>s;s++)for(var o=this.compoundRules[s],l=0,h=o.length;h>l;l++)this.compoundRuleCodes[o[l]]=[];"ONLYINCOMPOUND"in this.flags&&(this.compoundRuleCodes[this.flags.ONLYINCOMPOUND]=[]),this.dictionaryTable=this._parseDIC(r);for(var s in this.compoundRuleCodes)0==this.compoundRuleCodes[s].length&&delete this.compoundRuleCodes[s];for(var s=0,a=this.compoundRules.length;a>s;s++){for(var u=this.compoundRules[s],c="",l=0,h=u.length;h>l;l++){var p=u[l];c+=p in this.compoundRuleCodes?"("+this.compoundRuleCodes[p].join("|")+")":p}this.compoundRules[s]=new RegExp(c,"i")}}return this};Typo.prototype={load:function(e){for(var t in e)this[t]=e[t];return this},_readFile:function(e,t){t||(t="ISO8859-1");var r=new XMLHttpRequest;return r.open("GET",e,!1),r.overrideMimeType&&r.overrideMimeType("text/plain; charset="+t),r.send(null),r.responseText},_parseAFF:function(e){var t={};e=this._removeAffixComments(e);for(var r=e.split("\n"),n=0,i=r.length;i>n;n++){var s=r[n],a=s.split(/\s+/),o=a[0];if("PFX"==o||"SFX"==o){for(var l=a[1],h=a[2],u=parseInt(a[3],10),c=[],p=n+1,f=n+1+u;f>p;p++){var s=r[p],d=s.split(/\s+/),v=d[2],g=d[3].split("/"),m=g[0];"0"===m&&(m="");var C=this.parseRuleCodes(g[1]),R=d[4],y={};y.add=m,C.length>0&&(y.continuationClasses=C),"."!==R&&(y.match=new RegExp("SFX"===o?R+"$":"^"+R)),"0"!=v&&(y.remove="SFX"===o?new RegExp(v+"$"):v),c.push(y)}t[l]={type:o,combineable:"Y"==h,entries:c},n+=u}else if("COMPOUNDRULE"===o){for(var u=parseInt(a[1],10),p=n+1,f=n+1+u;f>p;p++){var s=r[p],d=s.split(/\s+/);this.compoundRules.push(d[1])}n+=u}else if("REP"===o){var d=s.split(/\s+/);3===d.length&&this.replacementTable.push([d[1],d[2]])}else this.flags[o]=a[1]}return t},_removeAffixComments:function(e){return e=e.replace(/#.*$/gm,""),e=e.replace(/^\s\s*/m,"").replace(/\s\s*$/m,""),e=e.replace(/\n{2,}/g,"\n"),e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},_parseDIC:function(e){function t(e,t){e in n&&"object"==typeof n[e]||(n[e]=[]),n[e].push(t)}e=this._removeDicComments(e);for(var r=e.split("\n"),n={},i=1,s=r.length;s>i;i++){var a=r[i],o=a.split("/",2),l=o[0];if(o.length>1){var h=this.parseRuleCodes(o[1]);"NEEDAFFIX"in this.flags&&-1!=h.indexOf(this.flags.NEEDAFFIX)||t(l,h);for(var u=0,c=h.length;c>u;u++){var p=h[u],f=this.rules[p];if(f)for(var d=this._applyRule(l,f),v=0,g=d.length;g>v;v++){var m=d[v];if(t(m,[]),f.combineable)for(var C=u+1;c>C;C++){var R=h[C],y=this.rules[R];if(y&&y.combineable&&f.type!=y.type)for(var b=this._applyRule(m,y),F=0,x=b.length;x>F;F++){var E=b[F];t(E,[])}}}p in this.compoundRuleCodes&&this.compoundRuleCodes[p].push(l)}}else t(l.trim(),[])}return n},_removeDicComments:function(e){return e=e.replace(/^\t.*$/gm,"")},parseRuleCodes:function(e){if(!e)return[];if(!("FLAG"in this.flags))return e.split("");if("long"===this.flags.FLAG){for(var t=[],r=0,n=e.length;n>r;r+=2)t.push(e.substr(r,2));return t}return"num"===this.flags.FLAG?textCode.split(","):void 0},_applyRule:function(e,t){for(var r=t.entries,n=[],i=0,s=r.length;s>i;i++){var a=r[i];if(!a.match||e.match(a.match)){var o=e;if(a.remove&&(o=o.replace(a.remove,"")),"SFX"===t.type?o+=a.add:o=a.add+o,n.push(o),"continuationClasses"in a)for(var l=0,h=a.continuationClasses.length;h>l;l++){var u=this.rules[a.continuationClasses[l]];u&&(n=n.concat(this._applyRule(o,u)))}}}return n},check:function(e){var t=e.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(this.checkExact(t))return!0;if(t.toUpperCase()===t){var r=t[0]+t.substring(1).toLowerCase();if(this.hasFlag(r,"KEEPCASE"))return!1;if(this.checkExact(r))return!0}var n=t.toLowerCase();if(n!==t){if(this.hasFlag(n,"KEEPCASE"))return!1;if(this.checkExact(n))return!0}return!1},checkExact:function(e){var t=this.dictionaryTable[e];if("undefined"==typeof t){if("COMPOUNDMIN"in this.flags&&e.length>=this.flags.COMPOUNDMIN)for(var r=0,n=this.compoundRules.length;n>r;r++)if(e.match(this.compoundRules[r]))return!0;return!1}for(var r=0,n=t.length;n>r;r++)if(!this.hasFlag(e,"ONLYINCOMPOUND",t[r]))return!0;return!1},hasFlag:function(e,t,r){if(t in this.flags){if("undefined"==typeof r)var r=Array.prototype.concat.apply([],this.dictionaryTable[e]);if(r&&-1!==r.indexOf(this.flags[t]))return!0}return!1},alphabet:"",suggest:function(e,t){function r(e){for(var t=[],r=0,n=e.length;n>r;r++){for(var i=e[r],s=[],a=0,o=i.length+1;o>a;a++)s.push([i.substring(0,a),i.substring(a,i.length)]);for(var l=[],a=0,o=s.length;o>a;a++){var u=s[a];u[1]&&l.push(u[0]+u[1].substring(1))}for(var c=[],a=0,o=s.length;o>a;a++){var u=s[a];u[1].length>1&&c.push(u[0]+u[1][1]+u[1][0]+u[1].substring(2))}for(var p=[],a=0,o=s.length;o>a;a++){var u=s[a];if(u[1])for(var f=0,d=h.alphabet.length;d>f;f++)p.push(u[0]+h.alphabet[f]+u[1].substring(1))}for(var v=[],a=0,o=s.length;o>a;a++){var u=s[a];if(u[1])for(var f=0,d=h.alphabet.length;d>f;f++)p.push(u[0]+h.alphabet[f]+u[1])}t=t.concat(l),t=t.concat(c),t=t.concat(p),t=t.concat(v)}return t}function n(e){for(var t=[],r=0;r<e.length;r++)h.check(e[r])&&t.push(e[r]);return t}function i(e){function i(e,t){return e[1]<t[1]?-1:1}for(var s=r([e]),a=r(s),o=n(s).concat(n(a)),l={},u=0,c=o.length;c>u;u++)o[u]in l?l[o[u]]+=1:l[o[u]]=1;var p=[];for(var u in l)p.push([u,l[u]]);p.sort(i).reverse();for(var f=[],u=0,c=Math.min(t,p.length);c>u;u++)h.hasFlag(p[u][0],"NOSUGGEST")||f.push(p[u][0]);return f}if(t||(t=5),this.check(e))return[];for(var s=0,a=this.replacementTable.length;a>s;s++){var o=this.replacementTable[s];if(-1!==e.indexOf(o[0])){var l=e.replace(o[0],o[1]);if(this.check(l))return[l]}}var h=this;return h.alphabet="abcdefghijklmnopqrstuvwxyz",i(e)}},CodeMirror.defineMode("spell-checker",function(e){function t(e,t){t||(t="ISO8859-1");var r=new XMLHttpRequest;return r.open("GET",e,!1),r.overrideMimeType&&r.overrideMimeType("text/plain; charset="+t),r.send(null),r.responseText}var r=new Typo("en_US",t("en_US.aff"),t("en_US.dic"),{platform:"any"}),n='!"#$%&()*+,-./:;<=>?@[\\\\\\]^_`{|}~ ',i={token:function(e){var t=e.peek(),i="";if(n.includes(t))return e.next(),null;for(;null!=(t=e.peek())&&!n.includes(t);)i+=t,e.next();return r&&!r.check(i)?"spell-error":null}},s=CodeMirror.getMode(e,e.backdrop||"text/plain");return CodeMirror.overlayMode(s,i,!0)});