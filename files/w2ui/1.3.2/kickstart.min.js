/* kicstart 0.x (c) http://w2ui.com/kickstart, vitmalina@gmail.com */


var app=function(app){var timer_start;var timer_lap;app.user={};app.config={};app.modules={};app.header=header;app.timer=timer;app.lap=lap;app.register=register;app.load=load;app.get=get;app.include=include;app.action=null;app.start=null;app.session=null;app.login=null;app.logout=null;app.forgot=null;init();return app;function header(msg){$("#app-header").html(msg)}function timer(){timer_start=(new Date).getTime();timer_lap=(new Date).getTime();console.log("Start Timer")}function lap(name){if(typeof name!="string")name="";else name=' "'+name+'"';console.log("Total:",(new Date).getTime()-timer_start,"Lap"+name+":",(new Date).getTime()-timer_lap);timer_lap=(new Date).getTime()}function register(name,module){if(!app.modules.hasOwnProperty(name)){console.log("ERROR: Module "+name+" is not defined. You need to define the module in /app/conf/modules.js");return false}if(app.hasOwnProperty(name)&&app[name].render=="function"){console.log("ERROR: Module "+name+" is already registered.");return false}app.get(app.modules[name].assets,function(files){var callBack=app[name].callBack;app[name]=module(files,app[name].params);callBack()})}function load(names,params,callBack){if(!$.isArray(names))names=[names];if(typeof params=="function"){callBack=params;params={}}if(!params)params={};var modCount=names.length;for(var n in names){var name=names[n];if(typeof app.modules[name]=="undefined"){modCount--;console.log('ERROR: module "'+name+'" is not defined. Define it in app/conf/modules.js.');return}app[name]=app[name]||{};app[name].params=$.extend({},params);app[name].callBack=callBack;if(app.modules[name]&&app.modules[name].isLoaded===true){modCount--;if(typeof app[name].render=="undefined"){console.log('ERROR: Loader: module "'+name+'" has no render() method.')}else{app[name].render();isFinished()}}else{$.ajax({url:app.modules[name].url,dataType:"script"}).always(function(){modCount--}).done(function(data,status,xhr){app.modules[name].isLoaded=true;isFinished()}).fail(function(xhr,err,errData){if(err=="error"){console.log('ERROR: Loader: module "'+name+'" failed to load ('+app.modules[name].url+").")}else{console.log('ERROR: Loader: module "'+name+'" is loaded ('+app.modules[name].url+"), but with a parsing error(s) in line "+errData.line+": "+errData.message);app.modules[name].isLoaded=true;isFinished()}})}}function isFinished(){if(typeof callBack=="function"&&modCount==0)callBack(true)}}function get(files,callBack){var bufferObj={};var bufferLen=files.length;for(var i in files){(function(){var index=i;var path=files[i];$.ajax({url:path,dataType:"text",success:function(data,success,responseObj){if(success!="success"){console.log("ERROR: Loader: error while getting a file "+path+".");return}bufferObj[index]=responseObj.responseText;loadDone()},error:function(data,err,errData){if(err=="error"){console.log("ERROR: Loader: failed to load "+files[i]+".")}else{console.log('ERROR: Loader: file "'+files[i]+'" is loaded, but with a parsing error(s) in line '+errData.line+": "+errData.message);bufferObj[index]=responseObj.responseText;loadDone()}}})})()}function loadDone(){bufferLen--;if(bufferLen<=0)callBack(bufferObj)}}function include(files){if(typeof files=="string")files=[files];for(var i in files){$(document).append('<script type="text/javascript" src="'+files[i]+'"></script>')}}function init(){app.get(["app/conf/session.js"],function(data){try{for(var i in data)eval(data[i])}catch(e){}if(document.location.href.indexOf("login.html")>0)return;app.user=app.session();if($.isEmptyObject(app.user)){document.location="login.html";return}var files=["app/conf/action.js","app/conf/modules.js","app/conf/config.js","app/conf/start.js"];app.get(files,function(data){try{for(var i in data)eval(data[i])}catch(e){app.include(files)}$("#app-toolbar").w2toolbar(app.config.app_toolbar);$("#app-tabs").w2tabs(app.config.app_tabs);$("#app-main").w2layout(app.config.app_layout);setTimeout(function(){$("#app-container").fadeIn(200);setTimeout(function(){var top=0;if(app.config.show.toolbar){$("#app-toolbar").css("height","30px").show();top+=30}else{$("#app-toolbar").hide()}if(app.config.show.tabs){$("#app-tabs").css({top:top+"px",height:"30px"}).show();top+=30}else{$("#app-tabs").hide()}$("#app-top").css("height",top+"px").show();if(app.config.show.header){$("#app-header").css({top:top+"px",height:"60px"}).show();top+=60}else{$("#app-header").hide()}$("#app-main").css("top",top+"px");if(typeof app.start=="function")app.start()},200)},100)})})}}(app||{});
