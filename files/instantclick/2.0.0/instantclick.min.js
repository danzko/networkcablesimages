var InstantClick=function(a,b){function m(a){var b=a.indexOf("#");return-1==b?a:a.substr(0,b)}function n(a){for(;"A"!=a.nodeName;)a=a.parentNode;return a}function o(a){for(var b=0;b<l[a].length;b++)l[a][b]()}function p(b){var c=a.implementation.createHTMLDocument("");c.documentElement.innerHTML=b,a.documentElement.replaceChild(c.body,a.body)}function q(a){w(n(a.target).href)}function r(a){var b=n(a.target);b.addEventListener("mouseout",t),k?(d=b.href,e=setTimeout(w,k)):w(b.href)}function s(a){a.which>1||a.metaKey||a.ctrlKey||(a.preventDefault(),x(n(a.target).href))}function t(){return e?(clearTimeout(e),e=!1,void 0):(!g.isPreloading||g.isPreloading&&g.isWaitingForCompletion||(g.xhr.abort(),g.isPreloading=!1,g.isWaitingForCompletion=!1),void 0)}function u(){if(!(g.xhr.readyState<4)&&0!=g.xhr.status){g.timing.ready=+new Date-g.timing.start;var b=g.xhr.responseText,c=b.indexOf("<title");c>-1&&(g.title=b.substr(b.indexOf(">",c)+1),g.title=g.title.substr(0,g.title.indexOf("</title")));var d=b.indexOf("<body");if(d>-1){g.body=b.substr(d);var e=g.body.indexOf("</body");e>-1&&(g.body=g.body.substr(0,e));var h=m(g.url);f[h]={body:g.body,title:g.title,scrollY:h in f?f[h].scrollY:0}}else g.hasBody=!1;g.isWaitingForCompletion&&(g.isWaitingForCompletion=!1,x(g.url))}}function v(d){for(var f,e=a.getElementsByTagName("a"),g=b.protocol+"//"+b.host,k=e.length-1;k>=0;k--)f=e[k],f.target||f.hasAttribute("download")||0!=f.href.indexOf(g+"/")||f.href.indexOf("#")>-1&&m(f.href)==c||(h?f.hasAttribute("data-no-instant"):!f.hasAttribute("data-instant"))||(i?f.addEventListener("mousedown",q):f.addEventListener("mouseover",r),f.addEventListener("click",s));if(!d){var n,p,t,u,l=a.getElementsByTagName("script");for(k=0,j=l.length;j>k;k++)n=l[k],n.hasAttribute("data-no-instant")||(p=a.createElement("script"),n.src&&(p.src=n.src),n.innerHTML&&(p.innerHTML=n.innerHTML),t=n.parentNode,u=n.nextSibling,t.removeChild(n),t.insertBefore(p,u))}o("change")}function w(a){!i&&"display"in g.timing&&+new Date-(g.timing.start+g.timing.display)<100||(e&&(clearTimeout(e),e=!1),a||(a=d),g.isPreloading&&a==g.url||g.isPreloading&&g.isWaitingForCompletion||(g.isPreloading=!0,g.isWaitingForCompletion=!1,g.url=a,g.body=!1,g.hasBody=!0,g.timing={},g.timing.start=+new Date,g.xhr.open("GET",a),g.xhr.send()))}function x(d){if("display"in g.timing||(g.timing.display=+new Date-g.timing.start),e)return g.url&&g.url!=d?(b.href=d,void 0):(w(d),g.isWaitingForCompletion=!0,void 0);if(!g.isPreloading||g.isPreloading&&g.isWaitingForCompletion)return b.href=d,void 0;if(!g.hasBody)return b.href=g.url,void 0;if(!g.body)return g.isWaitingForCompletion=!0,void 0;f[c].scrollY=pageYOffset,g.isPreloading=!1,g.isWaitingForCompletion=!1,p(g.body),a.title=g.title;var h=g.url.indexOf("#"),i=h>-1&&a.getElementById(g.url.substr(h+1)),j=0;if(g.url!=b.href&&i)for(;i.offsetParent;i=i.offsetParent)j+=i.offsetTop;scrollTo(0,j),history.pushState(null,null,g.url),c=m(b.href),v()}function z(){if(!y)return o("change"),void 0;if(!c){for(var d=0;d<arguments.length;d++){var e=arguments[d];e===!0?h=!0:"mousedown"==e?i=!0:"number"==typeof e&&(k=e)}c=m(b.href),f[c]={body:a.body.outerHTML,title:a.title,scrollY:pageYOffset},g.xhr=new XMLHttpRequest,g.xhr.addEventListener("readystatechange",u),g.url=!1,g.body=!1,g.hasBody=!0,g.title=!1,g.isPreloading=!1,g.isWaitingForCompletion=!1,g.timing={},v(!0),addEventListener("popstate",function(){var d=m(b.href);if(d!=c){if(!(d in f))return b.href=b.href,void 0;f[c].scrollY=pageYOffset,c=d,p(f[d].body),scrollTo(0,f[d].scrollY),a.title=f[d].title,v()}})}}function A(a,b){l[a].push(b)}function B(){return{currentLocationWithoutHash:c,p:g,pHistory:f,supported:y,useBlacklist:h}}var c,d,e,h,i,k,f={},g={},l={change:[]},y="pushState"in history;return{supported:y,init:z,on:A,debug:B}}(document,location);