var InstantClick=function(){function f(a){var b=a.indexOf("#");return-1==b?a:a.substr(0,b)}function g(a){var b=document.createEvent("HTMLEvents");b.initEvent(a,!0,!0),dispatchEvent(b)}function h(){return{currentPathname:a,p0:d[0],p1:d[1],pHistory:c,pId:b}}function i(a){for(var c,b=document.getElementsByTagName("a"),d=location.protocol+"//"+location.host,h=b.length-1;h>=0;h--)c=b[h],c.target||0!=c.href.indexOf(d+"/")||c.href.indexOf("#")>-1&&f(c.href)==f(location.href)||c.hasAttribute("data-no-instant")||!e(c.href.substr(d.length),c)||(c.addEventListener("mouseover",j),c.addEventListener("click",m));if(!a){var k,l,n,o,i=document.getElementsByTagName("script");for(h=i.length-1;h>=0;h--)k=i[h],l=document.createElement("script"),k.src&&(l.src=k.src),k.innerHTML&&(l.innerHTML=k.innerHTML),n=k.parentNode,o=k.nextSibling,n.removeChild(k),n.insertBefore(l,o)}g("page:change")}function j(a){k(a.target.href)}function k(a){var c=b;"waiting"==d[b].state&&(c^=1),d[c].state="preloading",d[c].url=a,d[c].body=!1,d[c].timingStart=+new Date,d[c].timing=!1,d[c].xhr.open("GET",a,!0),d[c].xhr.send()}function l(a){var e=a.target.id;if(!(d[e].xhr.readyState<4)){var g=d[e].xhr.responseText;d[e].timing=+new Date-d[e].timingStart;var h=g.indexOf("<body");if(h>-1){d[e].body=g.substr(g.indexOf(">",h)+1);var i=d[e].body.indexOf("</body");i>-1&&(d[e].body=d[e].body.substr(0,i)),d[e].body=d[e].body.replace(/<script[^>]+data-no-instant[^>]*>[\s\S]*<\/script>/gi,"")}var j=g.indexOf("<title");j>-1&&(d[e].title=g.substr(g.indexOf(">",j)+1),d[e].title=d[e].title.substr(0,d[e].title.indexOf("</title"))),c[f(d[e].url)]={body:d[e].body,title:d[e].title},e==b&&"waiting"==d[b].state&&n(d[b].url)}}function m(a){a.which>1||a.metaKey||a.ctrlKey||(a.preventDefault(),n(a.target.href))}function n(c){if(d[b].url!=c){if(d[1^b].url!=c)throw new Error("Clicked on a link without hovering on it first");b^=1}if(!d[b].body)return d[b].state="waiting",void 0;if(d[b].state="displayed",document.body.innerHTML=d[b].body,document.title=d[b].title,d[b].url!=location.href){if(-1==d[b].url.indexOf("#"))scrollTo(0,0);else{var e=d[b].url.substr(d[b].url.indexOf("#")+1);if(document.getElementById(e)||document.getElementsByName(e).length>0){e=document.getElementById(e)||document.getElementsByTagName(e)[0];for(var f=0;e.offsetParent;e=e.offsetParent)f+=e.offsetTop;scrollTo(0,f)}else scrollTo(0,0)}history.pushState(null,null,d[b].url)}a=location.pathname,i()}function o(){if("pushState"in history&&!d.length){0 in arguments&&(e=arguments[0]),c[f(location.href)]={body:document.body.innerHTML,title:document.title};for(var b=0;2>b;b++)d[b]={},d[b].xhr=new XMLHttpRequest,d[b].xhr.id=b,d[b].xhr.addEventListener("readystatechange",l),d[b].url=!1,d[b].body=!1,d[b].title=!1,d[b].state="",d[b].timingStart=!1,d[b].timing=!1;i(!0),addEventListener("popstate",function(){if(a!=location.pathname){var b=f(location.href);if(!(b in c))return location.href=location.href,void 0;a=location.pathname,document.body.innerHTML=c[b].body,document.title=c[b].title,i()}})}}var a=location.pathname,b=0,c={},d=[],e=function(){return!0};return{init:o,debug:h}}();