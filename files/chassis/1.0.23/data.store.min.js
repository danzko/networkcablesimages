/**
  * v1.0.23 generated on: Sat Jan 02 2016 19:27:30 GMT-0600 (CST)
  * Copyright (c) 2014-2016, Corey Butler. All Rights Reserved.
  */
"use strict";window.NGN=window.NGN||{},window.NGN.DATA=window.NGN.DATA||{},window.NGN.DATA.Store=function(e){e=e||{};var t=this;Object.defineProperties(this,{model:NGN.define(!0,!1,!1,e.model||null),_data:NGN.define(!1,!0,!1,[]),_filters:NGN.define(!1,!0,!1,[]),_index:NGN.define(!1,!0,!1,e.index||[]),_created:NGN.define(!1,!0,!1,[]),_deleted:NGN.define(!1,!0,!1,[]),_loading:NGN.define(!1,!0,!1,!1),proxy:NGN.define(!1,!0,!1,null),allowDuplicates:NGN.define(!0,!0,!1,NGN.coalesce(e.allowDuplicates,!0)),errorOnDuplicate:NGN.define(!0,!1,!1,NGN.coalesce(e.errorOnDuplicate,e.allowDuplicates,!0)),eventListener:NGN.define(!1,!1,!1,function(e){return function(i){i.datastore&&i.datastore===t&&e(i)}}),on:NGN.define(!0,!1,!1,function(e,t){return NGN.BUS?void(["record.create","record.delete","index.create","index.delete","record.duplicate"].indexOf(e)>=0?NGN.BUS.on(e,this.eventListener(t)):console.warn(e+" is not a supported NGN.DATA.Store event.")):void console.warn("NGN.DATA.Model.on('"+e+"', ...) will not work because NGN.BUS is not available.")}),add:NGN.define(!0,!1,!1,function(e,i){var n;if(e instanceof NGN.DATA.Entity)n=e;else{try{e=JSON.parse(e)}catch(r){}if("object"!=typeof e)throw new Error("Cannot add a non-object record.");n=this.model?new this.model(e):e}n.hasOwnProperty("_store")&&(n._store=t);var d=this.isDuplicate(n);if(!d||(NGN.emit("record.duplicate",n),this.allowDuplicates))this.listen(n),this.applyIndices(n,this._data.length),this._data.push(n),!this._loading&&this._created.indexOf(n)<0&&this._created.push(n),!NGN.coalesce(i,!1)&&NGN.emit("record.create",n);else if(this.errorOnDuplicate)throw new Error("Cannot add duplicate record (allowDuplicates = false).")}),isDuplicate:NGN.define(!1,!1,!1,function(e){return this._data.indexOf(e)>=0?!1:this._data.filter(function(t){return t.checksum===e.checksum}).length>0}),listen:NGN.define(!1,!1,!1,function(e){e.on("field.update",function(i){t.updateIndice(i.field,i.old,i["new"],t._data.indexOf(e))}),e.on("field.delete",function(i){t.updateIndice(i.field,i.old,void 0,t._data.indexOf(e))})}),bulk:NGN.define(!0,!1,!1,function(e,i){this._loading=!0,i.forEach(function(e){t.add(e,!0)}),this._loading=!1,this._deleted=[],this._created=[],NGN.emit(e||"load")}),load:NGN.define(!0,!1,!1,function(){var e=Array.isArray(arguments[0])?arguments[0]:NGN._slice(arguments);this.bulk("load",e)}),reload:NGN.define(!0,!1,!1,function(e){this.clear();var t=Array.isArray(arguments[0])?arguments[0]:NGN._slice(arguments);this.bulk("reload",t)}),remove:NGN.define(!0,!1,!1,function(e,t){var i,n=[];if(i="number"==typeof e?e:this._data.indexOf(e),n=this._data.splice(i,1),n.length>0){if(this.unapplyIndices(i),!this._loading){var r=this._created.indexOf(n[0]);r>=0?r>=0&&this._created.splice(r,1):this._deleted.indexOf(n[0])<0&&this._deleted.push(n[0])}!NGN.coalesce(t,!1)&&NGN.emit("record.delete",n[0])}}),clear:NGN.define(!0,!1,!1,function(){this._data=[],Object.keys(this._index).forEach(function(e){t._index[e]=[]}),NGN.emit("clear")}),data:NGN._get(function(){return this._data.map(function(e){return e.data})}),records:NGN._get(function(){return this.applyFilters(this._data)}),recordCount:NGN._get(function(){return this.applyFilters(this._data).length}),find:NGN.define(!0,!1,!1,function(e,i){if(0===this._data.length)return[];var n=[];switch(typeof e){case"function":n=this._data.filter(e);break;case"number":n=0>e||e>=this._data.length?null:this._data[e];break;case"string":var r=this.getIndices(this._data[0].idAttribute,e.trim());if(null!==r&&r.length>0)return r.forEach(function(e){n.push(t._data[e])}),n;var d=this._data.filter(function(t){return(t[t.idAttribute]||"").toString().trim()===e.trim()});n=0===d.length?null:d[0];break;case"object":var a=[],s=[],o=Object.keys(e);o.forEach(function(i){var n=t.getIndices(i,e[i]);n?a=a.concat(n||[]):null!==i&&s.push(i)}),a.filter(function(e,t){return a.indexOf(e)===t}),s.length>0&&(n=this._data.filter(function(t,i){if(a.indexOf(i)>=0)return!1;for(var n=0;n<s.length;n++)if(t[s[n]]!==e[s[n]])return!1;return!0})),n=n.concat(a.map(function(e){return t._data[e]})).filter(function(t){for(var i=0;i<o.length;i++)if(e[o[i]]!==t[o[i]])return!1;return!0});break;default:n=this._data}return null===n?null:(!NGN.coalesce(i,!1)&&this.applyFilters(n instanceof Array?n:[n]),n)}),applyFilters:NGN.define(!1,!1,!1,function(e){return 0===this._filters.length?e:(this._filters.forEach(function(t){e=e.filter(t)}),e)}),addFilter:NGN.define(!0,!1,!1,function(e){this._filters.push(e),NGN.emit("filter.create",e)}),removeFilter:NGN.define(!0,!1,!1,function(e,t){t=NGN.coalesce(t,!1);var i=[];i="number"==typeof e?this._filters.splice(e,1):this._filters.splice(this._filters.indexOf(e),1),i.length>0&&!t&&NGN.emit("filter.delete",i[0])}),clearFilters:NGN.define(!0,!1,!1,function(e){if(e=NGN.coalesce(e,!1))return void(this._filters=[]);for(;this._filters.length>0;)NGN.emit("filter.remove",this._filters.pop())}),deduplicate:NGN.define(!0,!1,!1,function(e){e=NGN.coalesce(e,!0);var i=this.data.map(function(e){return JSON.stringify(e)}),n=[];i.forEach(function(e,r){i.indexOf(e)<r&&n.push(t.find(r))}),n.forEach(function(e){t.remove(e)})}),sort:NGN.define(!0,!1,!1,function(e){if("function"==typeof e)this.records.sort(e);else if("object"==typeof e){var t=Object.keys(e);this.records.sort(function(i,n){for(var r=0;r<t.length;r++){if(i.hasOwnProperty(t[r])&&!n.hasOwnProperty(t[r]))return 1;if(!i.hasOwnProperty(t[r])&&n.hasOwnProperty(t[r]))return-1;if(i[t[r]]!==n[t[r]])switch(e[t[r]].toString().trim().toLowerCase()){case"asc":return i[t[r]]>n[t[r]]?1:-1;case"desc":return i[t[r]]<n[t[r]]?1:-1;default:return"function"==typeof e[t[r]]?e[t[r]](i,n):0}}return 0})}this.reindex()}),createIndex:NGN.define(!0,!1,!1,function(e,i){this.model.hasOwnProperty(e)||console.warn("The store's model does not contain a data field called "+e+".");var n=this._index.hasOwnProperty(e);this._index[e]=this._index[e]||[],!NGN.coalesce(i,!1)&&!n&&NGN.emit("index.created",{field:e,store:t})}),deleteIndex:NGN.define(!0,!1,!1,function(e,i){this._index.hasOwnProperty(e)&&(delete this._index[e],!NGN.coalesce(i,!1)&&NGN.emit("index.created",{field:e,store:t}))}),clearIndices:NGN.define(!1,!1,!1,function(){Object.keys(this._index).forEach(function(e){t._index[e]=[]})}),deleteIndexes:NGN.define(!0,!1,!1,function(e){e=NGN.coalesce(e,!0),Object.keys(this._index).forEach(function(i){t.deleteIndex(i,e)})}),applyIndices:NGN.define(!1,!1,!1,function(e,i){var n=Object.keys(this._index);0!==n.length&&n.forEach(function(n){if(e.hasOwnProperty(n)){for(var r=t._index[n],d=0;d<r.length;d++)if(r[d][0]===e[n])return void t._index[n][d].push(i);t._index[n].push([e[n],i])}})}),unapplyIndices:NGN.define(!1,!1,!1,function(e){Object.keys(this._index).forEach(function(i){var n=t._index[i].indexOf(e);n>=0&&t._index[i].splice(n,1)})}),updateIndice:NGN.define(!1,!1,!1,function(e,i,n,r){if(this._index.hasOwnProperty(e)&&i!==n)for(var d=0,a=0;a<t._index[e].length;a++){var s=t._index[e][a][0];if(s===i?(t._index[e][a].splice(t._index[e][a].indexOf(r),1),d++):void 0===n?d++:s===n&&(t._index[e][a].push(r),t._index[e][a].shift(),t._index[e][a].sort(),t._index[e][a].unshift(s),d++),2===d)return}}),getIndices:NGN.define(!1,!1,!1,function(e,t){if(!this._index.hasOwnProperty(e))return null;var i=this._index[e].filter(function(e){return e.length>0&&e[0]===t});return 1===i.length?(i[0].shift(),i[0]):[]}),reindex:NGN.define(!1,!1,!1,function(){this.clearIndices(),this._data.forEach(function(e,i){t.applyIndices(e,i)})})}),!NGN.BUS&&this._index.length>0&&console.warn("Indexing will not work for record updates because NGN.BUS cannot be found.");var i={};this._index.forEach(function(e){i[e]=[]}),this._index=i},NGN.DATA.util.inherit(NGN.DATA.util.EventEmitter,NGN.DATA.Store);