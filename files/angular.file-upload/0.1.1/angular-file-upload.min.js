/**!
 * AngularJS file upload directive and http post
 * @author  Danial  <danial.farid@gmail.com>
 * version 0.1.1
 */
var angularFileUpload=angular.module("angularFileUpload",[]);(function(){if(typeof jQuery==="undefined"){var t=document.createElement("script");t.setAttribute("src","//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js");document.getElementsByTagName("head")[0].appendChild(t)}if(typeof FormData==="undefined"){var t=document.createElement("script");var n=document.getElementsByTagName("script");for(var r=0;r<n.length;r++){var i=n[r].src.indexOf("angular-file-upload.js");if(i>-1){base=n[r].src.substring(0,i)}}if(typeof FileAPI==="undefined"||FileAPI.staticPath==null){FileAPI={staticPath:base}}t.setAttribute("src",base+"FileAPI.min.js");document.getElementsByTagName("head")[0].appendChild(t)}})();angularFileUpload.directive("ngFileSelect",["$parse","$http",function(e,t){if(t.uploadFile===undefined){t.uploadFile=function(e){if(typeof FormData==="undefined"){var n={url:e.url,data:e.data,complete:function(t,r){var i=/^\s*(\[|\{[^\{])/,s=/[\}\]]\s*$/,o=/^\)\]\}',?\n/;var u=r.responseText;if(typeof u=="string"){u=u.replace(o,"");if(i.test(u)&&s.test(u))u=typeof u=="string"?JSON.parse(u):u}if(n.promiseThen!=null)n.promiseThen(u,r.status,null,e);if(n.promiseError!=null)n.promiseError(u,r.status,null,e);if(n.promiseSuccess!=null)n.promiseSuccess(u,r.status,null,e)}};if(e.file!=null){n.files={file:e.file}}var r=FileAPI.upload(n);return{then:function(e){n.promiseThen=e},success:function(e){n.promiseSuccess=e},error:function(e){n.promiseError=e}}}else{return t({method:"POST",url:e.url,headers:{"Content-Type":false},transformRequest:function(t){var n=new FormData;n.append("file",e.file);for(key in e.data){n.append(key,e.data[key])}return n}})}}}return function(t,n,r){if(typeof FormData==="undefined"){n.wrap('<div class="js-fileapi-wrapper" style="position:relative; overflow:hidden">')}var i=e(r["ngFileSelect"]);n.bind("change",function(e){var n=[];if(typeof FormData!=="undefined"){var r=e.target.files;for(var s=0;s<r.length;s++){n.push(r.item(s))}}else{n=FileAPI.getFiles(e)}t.$apply(function(){i(t,{$files:n,$event:e})})})}}])