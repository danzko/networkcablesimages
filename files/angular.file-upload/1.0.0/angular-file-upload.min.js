/**!
 * AngularJS file upload/drop directive with http post and progress
 * @author  Danial  <danial.farid@gmail.com>
 * @version 1.0.0
 */
var angularFileUpload=angular.module("angularFileUpload",[]);angularFileUpload.shouldLoadShim=typeof FormData==="undefined";angularFileUpload.isShimLoaded=typeof FileAPI!=="undefined";if(angularFileUpload.shouldLoadShim&&!angularFileUpload.isShimLoaded){if(typeof jQuery==="undefined"){var script=document.createElement("script");script.setAttribute("src","//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js");document.getElementsByTagName("head")[0].appendChild(script)}var base="";if(typeof FormData==="undefined"){var script=document.createElement("script");var allScripts=document.getElementsByTagName("script");for(var i=0;i<allScripts.length;i++){var index=allScripts[i].src.indexOf("angular-file-upload.js");if(index==-1){index=allScripts[i].src.indexOf("angular-file-upload.min.js")}if(index>-1){base=allScripts[i].src.substring(0,index);break}}if(typeof FileAPI==="undefined"||FileAPI.staticPath==null){FileAPI={staticPath:base}}script.setAttribute("src",base+"FileAPI.min.js");document.getElementsByTagName("head")[0].appendChild(script);angularFileUpload.isShimLoaded=true}}angularFileUpload.XMLHttpRequest=function(){if(angularFileUpload.shouldLoadShim){window.FormData=FormData=function(){return{append:function(b,c){this[b]=c}}};var a={onreadystatechange:function(){},headers:{},responseHeaders:{},config:{complete:function(c,b){a.status=b.status;a.readyState=4;a.responseHeaders=b.getAllResponseHeaders();a.responseText=b.responseText;a.onreadystatechange()}},getAllResponseHeaders:function(){return this.responseHeaders},setRequestHeader:function(b,c){this.headers[b]=c},open:function(e,d,c){this.config.url=d},upload:{addEventListener:function(b,c){a.config.progress=c}},send:function(b){this.config.files={file:b.file};this.config.data={};for(key in b){if(key!="file"&&key!="append"){this.config.data[key]=b[key]}}this.config.headers=this.headers;FileAPI.upload(this.config)},readyState:0,status:0,responseText:null};return a}else{return new XMLHttpRequest()}};angularFileUpload.defineHttpUploadFile=function(a){if(a.uploadFile===undefined){a.uploadFile=function(e){var j=new angularFileUpload.XMLHttpRequest();var h,g,d,c;var f=new FormData();f.append("file",e.file);for(key in e.data){f.append(key,e.data[key])}j.open(e.method||"POST",e.url,true);e.headers=e.headers||{};for(key in e.headers){j.setRequestHeader(key,e.headers[key])}j.onreadystatechange=function(){if(j.readyState==4){var l=/^\s*(\[|\{[^\{])/,k=/[\}\]]\s*$/,n=/^\)\]\}',?\n/;var o=j.responseText;if(typeof o=="string"){o=o.replace(n,"");if(l.test(o)&&k.test(o)){o=(typeof o=="string")?JSON.parse(o):o}}var m=j.getAllResponseHeaders();if(200<=j.status&&j.status<300){if(h!=null){h(o,j.status,m,e)}if(g!=null){g(o,j.status,m,e)}}else{if(d!=null){d(o,j.status,m,e)}}}};j.upload.addEventListener("progress",function(k){if(c){c(k)}},false);var b={then:function(k){h=k;return b},success:function(k){g=k;return b},error:function(k){d=k;return b},progress:function(k){c=k;return b}};j.send(f);return b}}};angularFileUpload.directive("ngFileSelect",["$parse","$http",function(a,b){angularFileUpload.defineHttpUploadFile(b);return function(e,f,c){var d=a(c.ngFileSelect);if(angularFileUpload.shouldLoadShim){f.wrap('<div class="js-fileapi-wrapper" style="position:relative; overflow:hidden">')}f.bind("change",function(g){var k=[];if(!angularFileUpload.shouldLoadShim){var h=g.target.files;if(h!=null){for(var j=0;j<h.length;j++){k.push(h.item(j))}}}else{k=FileAPI.getFiles(g)}e.$apply(function(){d(e,{$files:k,$event:g})})})}}]);angularFileUpload.directive("ngFileDropAvailable",["$parse","$http",function(a,b){return function(e,f,c){if("draggable" in document.createElement("span")){var d=a(c.ngFileDropAvailable);if(!e.$$phase){e.$apply(function(){d(e)})}else{d(e)}}}}]);angularFileUpload.directive("ngFileDrop",["$parse","$http",function(a,b){angularFileUpload.defineHttpUploadFile(b);return function(e,f,c){if("draggable" in document.createElement("span")){var d=a(c.ngFileDrop);f[0].addEventListener("dragover",function(g){g.stopPropagation();g.preventDefault();f.addClass("dragover")},false);f[0].addEventListener("dragleave",function(g){f.removeClass("dragover")},false);f[0].addEventListener("drop",function(g){g.stopPropagation();g.preventDefault();f.removeClass("dragover");var k=[];var h=g.dataTransfer.files;if(h!=null){for(var j=0;j<h.length;j++){k.push(h.item(j))}}e.$apply(function(){d(e,{$files:k,$event:g})})},false)}else{f.css("display","none")}}}]);