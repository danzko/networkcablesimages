// A Cross-Browser, Event-based, Element Resize Detection.
// https://github.com/jonataswalker/watch-element-resize.js
// Version: v1.0.0
// Built: 2016-03-02T08:12:37-0300

(function(e,t){"use strict";var i=function(){var i,r=function(e,t){n.assert(Array.isArray(e)||"string"==n.typeOf(e)||n.isElement(e),"@param `target` should be Element, String or Array."),this.target=e,i=new r.Internal(this),i.init()};return r.prototype={removeListener:function(){i.removeListener()}},r.EventType={resize:"resize"},function(e,t,i){var r;e.Internal=function(e){r=this.Resize=e,this.attachEvent=i.attachEvent,this.stylesCreated=!1,this.animation={name:"resizeanim",keyframes:void 0,style:void 0,startevent:"animationstart"},this._ids=0,this.targets=[]},e.Internal.prototype={init:function(){this.setListener(this.Resize.target)},setListener:function(e){var t,i=this,r=[];e=Array.isArray(e)?e:[e],Array.prototype.push.apply(r,e),r.forEach(function(e,r){if(t=n.evaluate(e)){var s=i._ids++;t._id=s,i.targets[s]={element:t},i.addResizeListener(t)}})},removeListener:function(){var e=this;this.targets.forEach(function(t){e.removeResizeListener(t.element)}),this.targets=[]},detectAnimation:function(){var e=!1,t="animation",n="",r=["Webkit","Moz","O","ms"],s=["webkitAnimationStart","animationstart","oAnimationStart","MSAnimationStart"],o="",a=i.createElement("fakeelement");if(void 0!==a.style.animationName&&(e=!0),e===!1)for(var l=0;l<r.length;l++)if(void 0!==a.style[r[l]+"AnimationName"]){o=r[l],t=o+"Animation",n="-"+o.toLowerCase()+"-",this.animation.startevent=s[l],e=!0;break}var c=["@",n,"keyframes ",this.animation.name," { from { opacity: 0; } to { opacity: 0; }}"].join("");this.animation={keyframes:c,style:n+"animation: 1ms "+this.animation.name+";"}},trigger:function(t){r.dispatchEvent({type:e.EventType.resize,element:{target:t,offset:n.offset(t)},window:n.getWindowSize()})},scrollListener:function(t){var i=e.Internal.prototype,n=this;i.resetTriggers(this),this.__resizeRAF__&&o(this.__resizeRAF__),this.__resizeRAF__=s(function(){i.checkTriggers(n)&&(n.__resizeLast__.width=n.offsetWidth,n.__resizeLast__.height=n.offsetHeight,n.__resizeListeners__.forEach(function(){i.trigger(n)}))})},addResizeListener:function(e){var n=this;return this.attachEvent?void e.attachEvent("onresize",this.trigger):(e.__resizeTriggers__||("static"==t.getComputedStyle(e).position&&(e.style.position="relative"),this.createStyles(),e.__resizeLast__={},e.__resizeListeners__=[],(e.__resizeTriggers__=i.createElement("div")).className="resize-triggers",e.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',e.appendChild(e.__resizeTriggers__),this.resetTriggers(e),e.addEventListener("scroll",this.scrollListener,!0),this.animation.startevent&&e.__resizeTriggers__.addEventListener(this.animation.startevent,function(t){t.animationName==this.animation.name&&n.resetTriggers(e)})),void e.__resizeListeners__.push(e._id))},removeResizeListener:function(e){return this.attachEvent?void e.detachEvent("onresize",this.trigger):(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(e._id),1),void(e.__resizeListeners__.length||(e.removeEventListener("scroll",this.scrollListener),e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__))))},createStyles:function(){if(!this.stylesCreated){var e=this.animation,t=[e.keyframes?e.keyframes:"",".resize-triggers { ",e.style?e.style:"","visibility:hidden; opacity:0; } ",'.resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }'].join(""),n=i.head||i.getElementsByTagName("head")[0],r=i.createElement("style");r.type="text/css",r.styleSheet?r.styleSheet.cssText=t:r.appendChild(i.createTextNode(t)),n.appendChild(r),this.stylesCreated=!0}},resetTriggers:function(e){var t=e.__resizeTriggers__,i=t.firstElementChild,n=t.lastElementChild,r=i.firstElementChild;n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight,r.style.width=i.offsetWidth+1+"px",r.style.height=i.offsetHeight+1+"px",i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight},checkTriggers:function(e){return e.offsetWidth!=e.__resizeLast__.width||e.offsetHeight!=e.__resizeLast__.height}};var s=function(){var e=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||function(e){return t.setTimeout(e,20)};return function(t){return e(t)}}(),o=function(){var e=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.clearTimeout;return function(t){return e(t)}}()}(r,e,t),function(e,t,i){e.Utils={$:function(e){return e="#"===e[0]?e.substr(1,e.length):e,i.getElementById(e)},isElement:function(e){return"HTMLElement"in t?!!e&&e instanceof HTMLElement:!!e&&"object"==typeof e&&1===e.nodeType&&!!e.nodeName},evaluate:function(e){var t;switch(n.toType(e)){case"window":case"htmldocument":case"element":t=e;break;case"string":t=n.$(e)}return n.assert(t,"Can't evaluate: @param "+e),t},getComputedStyle:function(e,i){return e.currentStyle?e.currentStyle[i]:t.getComputedStyle?t.getComputedStyle(e,null).getPropertyValue(i):e.style[i]},offset:function(e){var n=e.getBoundingClientRect(),r=i.documentElement;return{left:n.left+t.pageXOffset-r.clientLeft,top:n.top+t.pageYOffset-r.clientTop,width:e.offsetWidth,height:e.offsetHeight}},getWindowSize:function(){return{width:t.innerWidth||i.documentElement.clientWidth||i.body.clientWidth,height:t.innerHeight||i.documentElement.clientHeight||i.body.clientHeight}},toType:function(e){return e==t&&e.doc&&e.location?"window":e==i?"htmldocument":"string"==typeof e?"string":n.isElement(e)?"element":void 0},typeOf:function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},assert:function(e,t){if(!e){if(t=t||"Assertion failed","undefined"!=typeof Error)throw new Error(t);throw t}}},e.EventDispatcher=function(){},e.EventDispatcher.prototype={constructor:e.EventDispatcher,apply:function(t){t.addEventListener=t.on=e.EventDispatcher.prototype.addEventListener,t.hasEventListener=e.EventDispatcher.prototype.hasEventListener,t.removeEventListener=t.un=e.EventDispatcher.prototype.removeEventListener,t.dispatchEvent=e.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners,n=i[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,i=t[e.type];if(void 0!==i){e.target=this;for(var n=[],r=i.length,s=0;r>s;s++)n[s]=i[s];for(s=0;r>s;s++)n[s].call(this,e)}}}}}(r,e,t),r}(),n=i.Utils;i.EventDispatcher.prototype.apply(i.prototype),"function"==typeof define&&define.amd?define(function(){return i}):"undefined"!=typeof module&&module.exports?module.exports=i:"undefined"!=typeof this&&(this.WatchElementResize=i)}).call(this,window,document);
