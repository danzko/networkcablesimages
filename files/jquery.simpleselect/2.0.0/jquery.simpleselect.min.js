/*
 * jQuery SimpleSelect
 * http://pioul.fr/jquery-simpleselect
 *
 * Copyright 2014, Philippe Masset
 * Dual licensed under the MIT or GPL Version 2 licenses
 */
!function(a){"use strict";var b=null,c=[],d=!1,e=!1,f=function(b){b=a.extend({},{fadingDuration:b&&b.fadeSpeed||0,containerMargin:5},b),this.each(function(){var c=a(this).addClass("simpleselected"),e=a('<div class="simpleselect"></div>'),f=a('<div class="placeholder"></div>').appendTo(e),g=a('<div class="options"></div>').appendTo(e),h=c.attr("id");h&&e.attr("id","simpleselect_"+h),c.off("change"),c.attr("size",2);var i={select:c,selectOptions:null,simpleselect:e,ssPlaceholder:f,ssOptionsContainer:g,ssOptionsContainerHeight:null,ssOptions:null,canBeClosed:!0,isActive:!1,isScrollable:!1,isDisabled:!1,options:b};e.data("simpleselect",i).on({mousedown:function(){i.canBeClosed=!1},click:function(b){var c=a(b.target);c.hasClass("placeholder")?s.setActive.call(i):c.hasClass("option")&&(d=!0,n.call(i,c),s.setInactive.call(i))},mouseup:function(){i.canBeClosed=!0},mouseover:function(b){var c=a(b.target);c.hasClass("option")&&l.call(i,c)}}),c.data("simpleselect",i).on({keydown:function(a){13==a.keyCode&&s.setInactive.call(i)},focus:function(){d||s.setActive.call(i)},blur:function(){i.canBeClosed&&s.setInactive.call(i)},change:function(a,b){b||a.stopImmediatePropagation();var c=m.call(i);l.call(i,c,!0)},click:function(a){a.stopPropagation()}}),c.after(e);var o=a('<div class="hidden_select_container"></div>');c.after(o).appendTo(o),j.call(i),k.call(i),s.updatePresentationDependentVariables.call(i)})},g=function(){b=a(window).height()},h=function(a){c.push(a)},i=function(b){c=a.grep(c,function(a){return a!==b})},j=function(){this.selectOptions=this.select.find("option");var b="",c=function(a){b+='<div class="option">'+a.text()+"</div>"},d=function(d){b+='<div class="optgroup">';var f=d.attr("label");f&&(b+='<div class="optgroup-label">'+e(f)+"</div>"),d.children("option").each(function(){c(a(this))}),b+="</div>"},e=function(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},f=this.select.children("optgroup, option"),g=!1;f.each(function(){var b=a(this);b.is("optgroup")?(d(b),g=!0):c(b)}),this.ssOptions=this.ssOptionsContainer.html(b).find(".option"),this.ssPlaceholder.text(m.call(this).text())},k=function(){this.isDisabled=this.select.prop("disabled"),this.simpleselect[this.isDisabled?"addClass":"removeClass"]("disabled")},l=function(a,b){if(this.ssOptions.removeClass("active"),a.addClass("active"),b&&this.isScrollable){var g,c=a.position(),d=this.ssOptionsContainer.scrollTop(),e=c.top,f=this.ssOptionsContainer.height()-(c.top+a.outerHeight());0>e?g=d+e:0>f&&(g=d-f),this.ssOptionsContainer.scrollTop(g)}},m=function(){var b=o.call(this),c=b.length?this.selectOptions.index(b):0;return a(this.ssOptions[c])},n=function(b){var c=a(this.selectOptions[this.ssOptions.index(b)]);this.select.val(c.val())},o=function(){return this.selectOptions.filter(":selected").first()},p=function(){this.ssOptionsContainer.css({height:"auto","overflow-y":"visible"})},q=function(){this.ssOptionsContainer.hide(),this.ssOptionsContainer[0].offsetHeight,this.ssOptionsContainer.show()},r=function(c){p.call(this);var d,e,f,g,h,i,j,k=a.proxy(function(){d=c.position(),e=this.ssPlaceholderOffset.top-a(window).scrollTop()-this.options.containerMargin,f=b-(e+this.options.containerMargin)-this.ssPlaceholderHeight-this.options.containerMargin,g=e-d.top,h=f-(this.ssOptionsContainerOuterHeight-d.top-this.ssPlaceholderHeight),i=0>g?Math.abs(g):0,j=0>h?Math.abs(h):0},this);k();var l=this.isScrollable;if(this.isScrollable=0>g||0>h,this.isScrollable){this.ssOptionsContainer.css({height:"auto","overflow-y":"scroll"}),this.ssOptionsContainer.height()!=this.ssOptionsContainerHeight&&(q.call(this),s.updatePresentationDependentVariables.call(this,"ssOptionsContainer",!1),k());var m=this.ssOptionsContainer.height()-i-j;this.ssOptionsContainer.css({top:-(d.top-i)}).height(m).scrollTop(i)}else this.ssOptionsContainer.css({top:-d.top}),l&&q.call(this)},s={updatePresentationDependentVariables:function(a,b){a&&"ssPlaceholder"!=a||(this.ssPlaceholderOffset=this.ssPlaceholder.offset(),this.ssPlaceholderHeight=this.ssPlaceholder.outerHeight()),a&&"ssOptionsContainer"!=a||(b!==!1&&p.call(this),this.ssOptionsContainerOuterHeight=this.ssOptionsContainer.outerHeight(!0),this.ssOptionsContainerHeight=this.ssOptionsContainer.height())},refreshContents:function(){j.call(this),s.updatePresentationDependentVariables.call(this)},refreshState:function(){k.call(this)},disable:function(){this.select.prop("disabled",!0),s.refreshState.call(this)},enable:function(){this.select.prop("disabled",!1),s.refreshState.call(this)},setActive:function(){if(!this.isActive&&!this.isDisabled&&this.ssOptions.length){this.lastValue=this.select.val(),this.simpleselect.addClass("active"),this.isActive=!0,h.call(this,this.simpleselect);var a=m.call(this);l.call(this,a),this.ssOptionsContainer.fadeTo(0,0).fadeTo(this.options.fadingDuration,1),this.select.is(":focus")||this.select.focus(),r.call(this,a),e=!0}},setInactive:function(){if(this.isActive){this.simpleselect.removeClass("active"),this.isActive=!1,i.call(this,this.simpleselect),this.ssOptionsContainer.fadeOut(this.options.fadingDuration),this.select.is(":focus")&&this.select.blur();var a=this.select.val();this.lastValue!=a&&(this.ssPlaceholder.text(o.call(this).text()),this.select.trigger("change",[!0]))}}};a.fn.simpleselect=function(b){if(s[b]){var c=Array.prototype.slice.call(arguments,1);this.each(function(){s[b].apply(a(this).data("simpleselect"),c)})}else f.apply(this,arguments);return this},a(document).ready(function(){g(),a(window).on("resize.simpleselect",function(){g()}),a(document).on("click.simpleselect keyup.simpleselect",function(a){if("click"==a.type&&(setTimeout(function(){d=!1},0),e))return e=!1,void 0;if("click"==a.type||"keyup"==a.type&&27==a.keyCode){var b=c.length;if(b)for(var f=c.slice(0),g=0;b>g;g++)f[g].simpleselect("setInactive")}})})}(jQuery);