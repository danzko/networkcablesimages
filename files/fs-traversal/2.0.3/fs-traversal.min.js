(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.FSTraversal=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var utils=require("./utils"),each=utils.each;module.exports=function(person){if(this._status==="stopped"){return}if(person.wasRedirected()){this._fetched[person.getPrimaryId()]=this._fetched[person.getRequestedId()]}var self=this,id=person.getPrimaryId(),fetched=this._fetched[id],rels={};each(person.getChildIds(),function(childId){if(!self._fetched[childId]){rels[childId]={rel:"child",depth:fetched.depth-1,distance:fetched.distance+1,path:fetched.path.concat([{rel:"child",person_id:childId}])}}});each(person.getFatherIds(),function(fatherId){if(!self._fetched[fatherId]){rels[fatherId]={rel:"father",depth:fetched.depth+1,distance:fetched.distance+1,path:fetched.path.concat([{rel:"father",person_id:fatherId}])}}});each(person.getMotherIds(),function(motherId){if(!self._fetched[motherId]){rels[motherId]={rel:"mother",depth:fetched.depth+1,distance:fetched.distance+1,path:fetched.path.concat([{rel:"mother",person_id:motherId}])}}});each(person.getSpouseIds(),function(spouseId){if(!self._fetched[spouseId]){rels[spouseId]={rel:"spouse",depth:fetched.depth,distance:fetched.distance+1,path:fetched.path.concat([{rel:"spouse",person_id:spouseId}])}}});var filtered=[rels];each(self._callbacks.filter,function(cb){filtered.push(cb.call(self,person.getPrimaryPerson(),JSON.parse(JSON.stringify(rels))))});var sortedIds=[];each(rels,function(rel,x){var filteredOut=false;each(filtered,function(f,y){if(!filtered[y][x]){filteredOut=true}});if(!filteredOut){rel.weight=self._order(rel);sortedIds.push(x)}});sortedIds.sort(function(a,b){return a.weight-b.weight});each(sortedIds,function(personId){if(!self._fetched[personId]){if(self._count<self._limit){self._count++;self._fetched[personId]=rels[personId];self._queue.push(personId,rels[personId].weight)}}});self._visited[id]=person;if(person.wasRedirected()){self._visited[person.getRequestedId()]=self._visited[id]}each(self._callbacks.person,function(cb){setTimeout(function(){if(self._isStopped()){return}cb.call(self,self._visited[id].getPrimaryPerson())})});var relationshipsCheck=[id];var marriages=person.getSpouseRelationships(),spouseCheck=[id];each(marriages,function(marriage){var husbandId=marriage.$getHusbandId(),wifeId=marriage.$getWifeId();if(id==husbandId&&wifeId){spouseCheck.push(wifeId);relationshipsCheck.push(wifeId)}if(id==wifeId&&husbandId){spouseCheck.push(husbandId);relationshipsCheck.push(husbandId)}if(self._visited[husbandId]&&self._visited[wifeId]){each(self._callbacks.marriage,function(cb){setTimeout(function(){if(self._isStopped()){return}cb.call(self,self._visited[wifeId].getPrimaryPerson(),self._visited[husbandId].getPrimaryPerson(),marriage)})})}});spouseCheck=utils.unique(spouseCheck);each(spouseCheck,function(fromSpouse){if(self._visited[fromSpouse]){var spouseIds=self._visited[fromSpouse].getSpouseIds(),allVisited=true,spouses=[];each(spouseIds,function(spouseId){if(!self._visited[spouseId]){allVisited=false}else{spouses.push(self._visited[spouseId].getPrimaryPerson())}});if(allVisited){each(self._callbacks.spouses,function(cb){setTimeout(function(){if(self._isStopped()){return}cb.call(self,self._visited[fromSpouse].getPrimaryPerson(),spouses)})})}}});var childParents=person.getChildRelationships().concat(person.getParentRelationships()),childrenCheck=[id],parentCheck=[id];each(childParents,function(childParent){var childId=childParent.$getChildId(),motherId=childParent.$getMotherId(),fatherId=childParent.$getFatherId();if(id==childId&&motherId){childrenCheck.push(motherId);relationshipsCheck.push(motherId)}if(id==childId&&fatherId){childrenCheck.push(fatherId);relationshipsCheck.push(fatherId)}if(childId&&(id==motherId||id==fatherId)){parentCheck.push(childId);relationshipsCheck.push(childId)}if(self._visited[childId]&&(!motherId||self._visited[motherId])&&(!fatherId||self._visited[fatherId])){each(self._callbacks.child,function(cb){setTimeout(function(){if(self._isStopped()){return}cb.call(self,self._visited[childId].getPrimaryPerson(),motherId?self._visited[motherId].getPrimaryPerson():undefined,fatherId?self._visited[fatherId].getPrimaryPerson():undefined,childParent)})})}if(self._visited[childId]&&motherId&&self._visited[motherId]&&(fatherId&&self._visited[fatherId]||fatherId&&!self._fetched[fatherId]||!fatherId)){each(self._callbacks.parent,function(cb){setTimeout(function(){if(self._isStopped()){return}cb.call(self,self._visited[motherId].getPrimaryPerson(),self._visited[childId].getPrimaryPerson())})})}if(self._visited[childId]&&fatherId&&self._visited[fatherId]&&(motherId&&self._visited[motherId]||motherId&&!self._fetched[motherId]||!motherId)){each(self._callbacks.parent,function(cb){setTimeout(function(){if(self._isStopped()){return}cb.call(self,self._visited[fatherId].getPrimaryPerson(),self._visited[childId].getPrimaryPerson())})})}});childrenCheck=utils.unique(childrenCheck);each(childrenCheck,function(parent){if(self._visited[parent]){var childrenIds=self._visited[parent].getChildIds(),allVisited=true,children=[];each(childrenIds,function(childId){if(!self._visited[childId]){allVisited=false}else{children.push(self._visited[childId].getPrimaryPerson())}});if(allVisited){each(self._callbacks.children,function(cb){setTimeout(function(){if(self._isStopped()){return}cb.call(self,self._visited[parent].getPrimaryPerson(),children)})})}}});parentCheck=utils.unique(parentCheck);each(parentCheck,function(child){if(self._visited[child]){var parentIds=utils.unique(self._visited[child].getFatherIds().concat(self._visited[child].getMotherIds())),allVisited=true,parents=[];each(parentIds,function(parentId){if(!self._visited[parentId]){allVisited=false}else{parents.push(self._visited[parentId].getPrimaryPerson())}});if(allVisited){each(self._callbacks.parents,function(cb){setTimeout(function(){if(self._isStopped()){return}cb.call(self,self._visited[child].getPrimaryPerson(),parents)})})}}});relationshipsCheck=utils.unique(relationshipsCheck);each(relationshipsCheck,function(relation){if(self._visited[relation]){var allVisited=true,related={};var parentIds=utils.unique(self._visited[relation].getFatherIds().concat(self._visited[relation].getMotherIds()));each(parentIds,function(parentId){if(!self._visited[parentId]){allVisited=false}else{related[parentId]=self._visited[parentId].getPrimaryPerson()}});var childrenIds=self._visited[relation].getChildIds();each(childrenIds,function(childId){if(!self._visited[childId]){allVisited=false}else{related[childId]=self._visited[childId].getPrimaryPerson()}});var spouseIds=self._visited[relation].getSpouseIds();each(spouseIds,function(spouseId){if(!self._visited[spouseId]){allVisited=false}else{related[spouseId]=self._visited[spouseId].getPrimaryPerson()}});if(allVisited){each(self._callbacks.relationships,function(cb){setTimeout(function(){if(self._isStopped()){return}cb.call(self,self._visited[relation].getPrimaryPerson(),self._visited[relation],related)})})}}});var families={};var childAndParentsList=person.getChildRelationships().concat(person.getParentRelationships());var parentIds=person.getMotherIds().concat(person.getFatherIds());each(parentIds,function(parentId){if(self._visited[parentId]){childAndParentsList=childAndParentsList.concat(self._visited[parentId].getChildRelationships())}});each(childAndParentsList,function(childParents){var familyId=childParents.$getMotherId()+":"+childParents.$getFatherId();if(!families[familyId]){families[familyId]={wifeId:childParents.$getMotherId(),husbandId:childParents.$getFatherId(),childrenIds:[]}}families[familyId].childrenIds.push(childParents.$getChildId())});each(families,function(family){var allVisited=true,wife=self._visited[family.wifeId],husband=self._visited[family.husbandId],children=[];if(family.wifeId!==id&&family.husbandId!==id&&family.childrenIds.indexOf(id)===-1){return false}if(family.wifeId){if(!wife){allVisited=false}else{wife=wife.getPrimaryPerson()}}if(family.husbandId){if(!husband){allVisited=false}else{husband=husband.getPrimaryPerson()}}each(utils.unique(family.childrenIds),function(childId){if(!self._visited[childId]){allVisited=false}else{children.push(self._visited[childId].getPrimaryPerson())}});if(allVisited){each(self._callbacks.family,function(cb){setTimeout(function(){if(self._isStopped()){return}cb.call(self,wife,husband,children)})})}})}},{"./utils":6}],2:[function(require,module,exports){var filters=module.exports={};filters.ancestry=function(personId,relationships){var persons={};for(var id in relationships){var rel=relationships[id];if(isAncestor(rel)){persons[id]=rel}}return persons};filters.descendancy=function(personId,relationships){var persons={};for(var id in relationships){var rel=relationships[id];if(isDescendant(rel)){persons[id]=rel}}return persons};filters["ancestry-descendancy"]=function(personId,relationships){var persons={};for(var id in relationships){var rel=relationships[id];if(isAncestor(rel)||isDescendant(rel)){persons[id]=rel}}return persons};function isAncestor(relationship){return relationship.depth==relationship.distance}function isDescendant(relationship){return-relationship.depth==relationship.distance}filters.cousins=function(person,relationships){var persons={};for(var id in relationships){var rel=relationships[id];if(isCousin(rel,false)){persons[id]=rel}}return persons};filters["cousins-spouses"]=function(person,relationships){var persons={};for(var id in relationships){var rel=relationships[id];if(isCousin(rel,true)){persons[id]=rel}}return persons};function isCousin(relationshipData,includeSpouses){var path=relationshipData.path,isAncestor=false,isDescendant=false,isCousin=false;for(var i=1;i<path.length;i++){var relationship=path[i].rel;if(relationship==="child"){if(isAncestor){isAncestor=false;isCousin=true}if(!isCousin){isDescendant=true}}else if(relationship==="mother"||relationship==="father"){if(isDescendant||isCousin){return false}isAncestor=true}else if(includeSpouses&&i===path.length-1){return true}else{return false}}return true}},{}],3:[function(require,module,exports){var async=require("async"),orders=require("./orders"),filters=require("./filters"),utils=require("./utils"),each=utils.each;var FSTraversal=module.exports=function(sdk){if(!(this instanceof FSTraversal)){return new FSTraversal(sdk)}if(!sdk){throw new Error("FamilySearch SDK is not defined")}this._sdk=sdk;this._status="ready";this._visited={};this._fetched={};this._count=1;this._order=orders["distance"];this._limit=Infinity;this._concurrency=5;this._queue=null;this._callbacks={filter:[],person:[],child:[],children:[],parent:[],parents:[],marriage:[],spouses:[],family:[],relationships:[],error:[],done:[]}};FSTraversal.prototype.order=function(order){if(this._status!=="ready"){throw new Error("You may only set the order before starting a traversal")}if(utils.isString(order)){if(orders[order]){this._order=orders[order]}else{throw new Error(order+" is not a valid built-in order.")}}else if(utils.isFunction(order)){this._order=order}else{throw new Error("Order must be a string or a function")}if(arguments.length>1){var additionalArgs=Array.prototype.slice.call(arguments,1),originalOrder=this._order;this._order=function(fetchObj){return originalOrder.apply(this,[fetchObj].concat(additionalArgs))}}return this};FSTraversal.prototype.filter=function(filter){if(utils.isString(filter)){if(filters[filter]){filter=filters[filter]}else{throw new Error(filter+" is not a valid built-in filter.")}}else if(!utils.isFunction(filter)){throw new Error("Order must be a string or a function")}this._registerCallback("filter",filter);return this};FSTraversal.prototype.limit=function(num){if(typeof num!=="number"){throw new Error("invalid limit")}this._limit=num;return this};FSTraversal.prototype.concurrency=function(num){if(typeof num!=="number"){throw new Error("invalid concurrency")}if(this._queue){this._queue.concurrency=num;this._concurrency=num}else{this._concurrency=num}return this};FSTraversal.prototype.pause=function(){if(this._status==="running"){this._queue.pause();this._status="paused"}};FSTraversal.prototype.resume=function(){if(this._status==="paused"){this._queue.resume();this._status="running"}};FSTraversal.prototype.stop=function(){if(this._status==="running"||this._status==="paused"){this._status="stopped";this._queue.kill()}};FSTraversal.prototype.person=function(func){this._registerCallback("person",func);return this};FSTraversal.prototype.child=function(func){this._registerCallback("child",func);return this};FSTraversal.prototype.children=function(func){this._registerCallback("children",func);return this};FSTraversal.prototype.parent=function(func){this._registerCallback("parent",func);return this};FSTraversal.prototype.parents=function(func){this._registerCallback("parents",func);return this};FSTraversal.prototype.marriage=function(func){this._registerCallback("marriage",func);return this};FSTraversal.prototype.spouses=function(func){this._registerCallback("spouses",func);return this};FSTraversal.prototype.family=function(func){this._registerCallback("family",func);return this};FSTraversal.prototype.relationships=function(func){this._registerCallback("relationships",func);return this};FSTraversal.prototype.done=function(func){this._registerCallback("done",func);return this};FSTraversal.prototype.error=function(func){this._registerCallback("error",func);return this};FSTraversal.prototype._registerCallback=function(type,func){if(typeof func!=="function"){throw new Error(type+" must register a function")}if(this._callbacks[type]==undefined){throw new Error("Unknown type "+type)}this._callbacks[type].push(func)};FSTraversal.prototype.status=function(){return this._status};FSTraversal.prototype._isStopped=function(){return this._status==="stopped"};FSTraversal.prototype.traverse=function(){var self=this;if(arguments.length==1){self._traverse(arguments[0])}else{self._sdk.getCurrentUser().done(function(response){self._traverse(response.getUser().personId)})}return self};FSTraversal.prototype._traverse=function(start){var self=this;if(typeof start==="undefined"){throw new Error("Must specify a starting person id")}if(self._status!=="ready"){throw new Error("You may only start a traversal when status is ready")}self._status="running";var fetchStart=self._fetched[start]={type:"root",depth:0,distance:0,weight:0,path:[{rel:"start",person_id:start}]};fetchStart.weight=self._order(fetchStart);self._queue=async.priorityQueue(function(personId,callback){self._sdk.getPersonWithRelationships(personId).then(function(response){self._processPerson(response);callback()}).fail(function(error){each(self._callbacks.error,function(cb){setTimeout(function(){cb.call(self,personId,error)})})})},self._concurrency);self._queue.push(start);self._queue.drain=function(){self._status="done";each(self._callbacks.done,function(cb){if(self._isStopped()){return}setTimeout(function(){cb.call(self)})})};return self};FSTraversal.prototype._processPerson=require("./_processPerson");var relConfig=require("./relConfigs");FSTraversal.prototype.pathTo=function(id){if(!this._fetched[id]||!this._visited[id]){return[]}var fetchPath=this._fetched[id].path,returnPath=[];for(var i=0;i<fetchPath.length;i++){returnPath.push({rel:fetchPath[i].rel,person:this._visited[fetchPath[i].person_id].getPrimaryPerson()})}return returnPath};FSTraversal.prototype.weight=function(personId){if(this._fetched[personId]){return this._fetched[personId].weight}};FSTraversal.prototype.relationshipTo=function(id){if(!this._fetched[id]){return""}var path=this.pathTo(id);return this._relationshipTo(path)};FSTraversal.prototype._relationshipTo=function(path){if(path.length===1){return"yourself"}var switchStr=generateSwitchString(path),relation="",remainder="",done=false;while(!done){var rel="";for(var i=0;i<relConfig.length;i++){var c=relConfig[i];if(c.regex.test(switchStr)){if(utils.isString(c.rel)){rel=c.rel}else if(utils.isFunction(c.rel)){rel=c.rel(switchStr)}else{throw new Error("Expected relConfig.rel to be a string or a function")}break}}if(rel){relation+=(relation?"'s ":"")+rel;if(remainder){switchStr=remainder;remainder=""}else{done=true}}else{remainder=switchStr.substr(-1,1)+remainder;switchStr=switchStr.substr(0,switchStr.length-1);if(!switchStr){rel+=(rel?"'s ":"")+"relative";done=true}}}return relation};function generateSwitchString(path){var switchStr="";for(var i=1;i<path.length;i++){switch(path[i].rel){case"child":switch(path[i].person.gender.type){case"http://gedcomx.org/Male":switchStr+="s";break;case"http://gedcomx.org/Female":switchStr+="d";break;default:switchStr+="c";break}break;case"mother":switchStr+="m";break;case"father":switchStr+="f";break;case"spouse":switch(path[i].person.gender.type){case"http://gedcomx.org/Male":switchStr+="h";break;case"http://gedcomx.org/Female":switchStr+="w";break;default:return""}break;default:return""}}return switchStr}},{"./_processPerson":1,"./filters":2,"./orders":4,"./relConfigs":5,"./utils":6,async:7}],4:[function(require,module,exports){var utils=require("./utils");var orders=module.exports={};orders.distance=function(fetchObj){return fetchObj.distance};orders.wrd=function(fetchObj,wrdFactors){if(!wrdFactors){wrdFactors={gPositive:1,gNegative:1,c:1,m:1}}var wrd={g:0,c:0,m:0,up:false};utils.each(fetchObj.path,function(rel){switch(rel.rel){case"child":wrd.g-=1;wrd.c=wrd.up?wrd.c+1:wrd.c;break;case"father":case"mother":wrd.g+=1;wrd.c=wrd.c==0?0:wrd.c+1;wrd.up=true;break;case"spouse":wrd.m+=1;break}});var G=(wrd.g>=0?wrdFactors.gPositive:wrdFactors.gNegative)*(Math.abs(wrd.g)+1),C=Math.pow(Math.E,wrdFactors.c*wrd.c),M=Math.pow(Math.E,wrdFactors.m*wrd.m);return G*C*M};orders["wrd-far"]=function(fetchObj){if(fetchObj.distance===1){return 1}var path=fetchObj.path,d=fetchObj.distance,s=0,c=0,dc=0;for(var i=1;i<fetchObj.path.length;i++){if(c){dc++}if(path[i].rel==="spouse"){c++}else{var currentChild=_isChildRel(path[i].rel),currentParent=_isParentRel(path[i].rel),prevChild=_isChildRel(path[i-1].rel),prevParent=_isParentRel(path[i-1].rel);if(currentChild&&prevParent||currentParent&&prevChild){c++;s+=.5}}}var w=(d-s)*Math.pow(Math.E,c*1.4)*Math.pow(Math.E,(dc-s)*1.5);return w};function _isParentRel(rel){return rel==="mother"||rel==="father"}function _isChildRel(rel){return rel==="child"}},{"./utils":6}],5:[function(require,module,exports){var each=require("./utils").each;var relConfig=module.exports=[{pattern:"f",rel:"father"},{pattern:"m",rel:"mother"},{pattern:"s",rel:"son"},{pattern:"d",rel:"daughter"},{pattern:"c",rel:"child"},{pattern:"h",rel:"husband"},{pattern:"w",rel:"wife"},{pattern:"(m|f)s",rel:"brother"},{pattern:"(m|f)d",rel:"sister"},{pattern:"(m|f)c",rel:"sibling"},{pattern:"(m|f)f",rel:"grandfather"},{pattern:"(m|f)m",rel:"grandmother"},{pattern:"(m|f){2}f",rel:"great-grandfather"},{pattern:"(m|f){2}m",rel:"great-grandmother"},{pattern:"(m|f){4,}",rel:function(str){var suffix=str.substr(-1,1)==="f"?"father":"mother",prefix="",length=str.length;if(length==4){prefix="nd"}else if(length==5){prefix="rd"}else{prefix="th"}return length-2+prefix+" great-grand"+suffix}},{pattern:"(s|d|c)s",rel:"grandson"},{pattern:"(s|d|c)d",rel:"granddaughter"},{pattern:"(s|d|c)c",rel:"grandchild"},{pattern:"(s|d|c){2}s",rel:"great-grandson"},{pattern:"(s|d|c){2}d",rel:"great-granddaughter"},{pattern:"(s|d|c){2}d",rel:"great-grandchild"},{pattern:"(s|d|c){4,}",rel:function(str){var lastChar=str.substr(-1,1),suffix="child",prefix="",length=str.length;if(lastChar==="s"){suffix="son"}else if(lastChar==="d"){suffix="daughter"}if(length==4){prefix="nd"}else if(length==5){prefix="rd"}else{prefix="th"}return length-2+prefix+" great-grand"+suffix}},{pattern:"(h|w)f",rel:"father-in-law"},{pattern:"(h|w)m",rel:"mother-in-law"},{pattern:"(h|w)(m|f)s",rel:"brother-in-law"},{pattern:"(h|w)(m|f)d",rel:"sister-in-law"},{pattern:"(m|f)dh",rel:"brother-in-law"},{pattern:"(m|f)sw",rel:"sister-in-law"},{pattern:"(h|w)(m|f)c",rel:"spouse's sibling"},{pattern:"(m|f){2}s",rel:"uncle"},{pattern:"(m|f){2}d",rel:"aunt"},{pattern:"(m|f){2}c",rel:"parent's sibling"},{pattern:"(m|f){2}(d|s|c){2}",rel:"cousin"},{pattern:"(m|f){3}s",rel:"great-uncle"},{pattern:"(m|f){3}d",rel:"great-aunt"},{pattern:"dh",rel:"son-in-law"},{pattern:"sw",rel:"daughter-in-law"},{pattern:"(m|f)(d|s|c)d",rel:"niece"},{pattern:"(m|f)(d|s|c)s",rel:"nephew"}];each(relConfig,function(c){c.regex=new RegExp("^"+c.pattern+"$")})},{"./utils":6}],6:[function(require,module,exports){var utils=module.exports;utils.each=function(obj,iterator,context){if(obj==null)return obj;if(Array.prototype.forEach&&obj.forEach===Array.prototype.forEach){obj.forEach(iterator,context)}else if(obj.length===+obj.length){for(var i=0,length=obj.length;i<length;i++){iterator.call(context,obj[i],i,obj)}}else{var keys=utils.keys(obj);for(var i=0,length=keys.length;i<length;i++){iterator.call(context,obj[keys[i]],keys[i],obj)}}return obj};utils.keys=function(obj){if(!obj===Object(obj))return[];if(Object.keys)return Object.keys(obj);var keys=[];for(var key in obj)if(hasOwnProperty.call(obj,key))keys.push(key);return keys};utils.unique=function(array){var results=[];utils.each(array,function(val){if(results.indexOf(val)==-1){results.push(val)}});return results};utils.isString=function(obj){return Object.prototype.toString.call(obj)==="[object String]"};utils.isFunction=function(obj){return Object.prototype.toString.call(obj)==="[object Function]"||typeof obj==="function"}},{}],7:[function(require,module,exports){(function(process){(function(){var async={};var root,previous_async;root=this;if(root!=null){previous_async=root.async}async.noConflict=function(){root.async=previous_async;return async};function only_once(fn){var called=false;return function(){if(called)throw new Error("Callback was already called.");called=true;fn.apply(root,arguments)}}var _toString=Object.prototype.toString;var _isArray=Array.isArray||function(obj){return _toString.call(obj)==="[object Array]"};var _each=function(arr,iterator){if(arr.forEach){return arr.forEach(iterator)}for(var i=0;i<arr.length;i+=1){iterator(arr[i],i,arr)}};var _map=function(arr,iterator){if(arr.map){return arr.map(iterator)}var results=[];_each(arr,function(x,i,a){results.push(iterator(x,i,a))});return results};var _reduce=function(arr,iterator,memo){if(arr.reduce){return arr.reduce(iterator,memo)}_each(arr,function(x,i,a){memo=iterator(memo,x,i,a)});return memo};var _keys=function(obj){if(Object.keys){return Object.keys(obj)}var keys=[];for(var k in obj){if(obj.hasOwnProperty(k)){keys.push(k)}}return keys};if(typeof process==="undefined"||!process.nextTick){if(typeof setImmediate==="function"){async.nextTick=function(fn){setImmediate(fn)};async.setImmediate=async.nextTick}else{async.nextTick=function(fn){setTimeout(fn,0)};async.setImmediate=async.nextTick}}else{async.nextTick=process.nextTick;if(typeof setImmediate!=="undefined"){async.setImmediate=function(fn){setImmediate(fn)}}else{async.setImmediate=async.nextTick}}async.each=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;_each(arr,function(x){iterator(x,only_once(done))});function done(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback()}}}};async.forEach=async.each;async.eachSeries=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;var iterate=function(){iterator(arr[completed],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback()}else{iterate()}}})};iterate()};async.forEachSeries=async.eachSeries;async.eachLimit=function(arr,limit,iterator,callback){var fn=_eachLimit(limit);fn.apply(null,[arr,iterator,callback])};async.forEachLimit=async.eachLimit;var _eachLimit=function(limit){return function(arr,iterator,callback){callback=callback||function(){};if(!arr.length||limit<=0){return callback()}var completed=0;var started=0;var running=0;(function replenish(){if(completed>=arr.length){return callback()}while(running<limit&&started<arr.length){started+=1;running+=1;iterator(arr[started-1],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;running-=1;if(completed>=arr.length){callback()}else{replenish()}}})}})()}};var doParallel=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.each].concat(args))}};var doParallelLimit=function(limit,fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[_eachLimit(limit)].concat(args))}};var doSeries=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.eachSeries].concat(args))}};var _asyncMap=function(eachfn,arr,iterator,callback){arr=_map(arr,function(x,i){return{index:i,value:x}});if(!callback){eachfn(arr,function(x,callback){iterator(x.value,function(err){callback(err)})})}else{var results=[];eachfn(arr,function(x,callback){iterator(x.value,function(err,v){results[x.index]=v;callback(err)})},function(err){callback(err,results)})}};async.map=doParallel(_asyncMap);async.mapSeries=doSeries(_asyncMap);async.mapLimit=function(arr,limit,iterator,callback){return _mapLimit(limit)(arr,iterator,callback)};var _mapLimit=function(limit){return doParallelLimit(limit,_asyncMap)};async.reduce=function(arr,memo,iterator,callback){async.eachSeries(arr,function(x,callback){iterator(memo,x,function(err,v){memo=v;callback(err)})},function(err){callback(err,memo)})};async.inject=async.reduce;async.foldl=async.reduce;async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,function(x){return x}).reverse();async.reduce(reversed,memo,iterator,callback)};async.foldr=async.reduceRight;var _filter=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.filter=doParallel(_filter);async.filterSeries=doSeries(_filter);async.select=async.filter;async.selectSeries=async.filterSeries;var _reject=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(!v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.reject=doParallel(_reject);async.rejectSeries=doSeries(_reject);var _detect=function(eachfn,arr,iterator,main_callback){eachfn(arr,function(x,callback){iterator(x,function(result){if(result){main_callback(x);main_callback=function(){}}else{callback()}})},function(err){main_callback()})};async.detect=doParallel(_detect);async.detectSeries=doSeries(_detect);async.some=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(v){main_callback(true);main_callback=function(){}}callback()})},function(err){main_callback(false)})};async.any=async.some;async.every=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(!v){main_callback(false);main_callback=function(){}}callback()})},function(err){main_callback(true)})};async.all=async.every;async.sortBy=function(arr,iterator,callback){async.map(arr,function(x,callback){iterator(x,function(err,criteria){if(err){callback(err)}else{callback(null,{value:x,criteria:criteria})}})},function(err,results){if(err){return callback(err)}else{var fn=function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0};callback(null,_map(results.sort(fn),function(x){return x.value}))}})};async.auto=function(tasks,callback){callback=callback||function(){};var keys=_keys(tasks);var remainingTasks=keys.length;if(!remainingTasks){return callback()}var results={};var listeners=[];var addListener=function(fn){listeners.unshift(fn)};var removeListener=function(fn){for(var i=0;i<listeners.length;i+=1){if(listeners[i]===fn){listeners.splice(i,1);return}}};var taskComplete=function(){remainingTasks--;_each(listeners.slice(0),function(fn){fn()})};addListener(function(){if(!remainingTasks){var theCallback=callback;callback=function(){};theCallback(null,results)}});_each(keys,function(k){var task=_isArray(tasks[k])?tasks[k]:[tasks[k]];var taskCallback=function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}if(err){var safeResults={};_each(_keys(results),function(rkey){safeResults[rkey]=results[rkey]});safeResults[k]=args;callback(err,safeResults);callback=function(){}}else{results[k]=args;async.setImmediate(taskComplete)}};var requires=task.slice(0,Math.abs(task.length-1))||[];var ready=function(){return _reduce(requires,function(a,x){return a&&results.hasOwnProperty(x)},true)&&!results.hasOwnProperty(k)};if(ready()){task[task.length-1](taskCallback,results)}else{var listener=function(){if(ready()){removeListener(listener);task[task.length-1](taskCallback,results)}};addListener(listener)}})};async.retry=function(times,task,callback){var DEFAULT_TIMES=5;var attempts=[];if(typeof times==="function"){callback=task;task=times;times=DEFAULT_TIMES}times=parseInt(times,10)||DEFAULT_TIMES;var wrappedTask=function(wrappedCallback,wrappedResults){var retryAttempt=function(task,finalAttempt){return function(seriesCallback){task(function(err,result){seriesCallback(!err||finalAttempt,{err:err,result:result})},wrappedResults)}};while(times){attempts.push(retryAttempt(task,!(times-=1)))}async.series(attempts,function(done,data){data=data[data.length-1];(wrappedCallback||callback)(data.err,data.result)})};return callback?wrappedTask():wrappedTask};async.waterfall=function(tasks,callback){callback=callback||function(){};if(!_isArray(tasks)){var err=new Error("First argument to waterfall must be an array of functions");return callback(err)}if(!tasks.length){return callback()}var wrapIterator=function(iterator){return function(err){if(err){callback.apply(null,arguments);callback=function(){}}else{var args=Array.prototype.slice.call(arguments,1);var next=iterator.next();if(next){args.push(wrapIterator(next))}else{args.push(callback)}async.setImmediate(function(){iterator.apply(null,args)})}}};wrapIterator(async.iterator(tasks))()};var _parallel=function(eachfn,tasks,callback){callback=callback||function(){};if(_isArray(tasks)){eachfn.map(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};eachfn.each(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.parallel=function(tasks,callback){_parallel({map:async.map,each:async.each},tasks,callback)};async.parallelLimit=function(tasks,limit,callback){_parallel({map:_mapLimit(limit),each:_eachLimit(limit)},tasks,callback)};async.series=function(tasks,callback){callback=callback||function(){};if(_isArray(tasks)){async.mapSeries(tasks,function(fn,callback){
if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};async.eachSeries(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.iterator=function(tasks){var makeCallback=function(index){var fn=function(){if(tasks.length){tasks[index].apply(null,arguments)}return fn.next()};fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null};return fn};return makeCallback(0)};async.apply=function(fn){var args=Array.prototype.slice.call(arguments,1);return function(){return fn.apply(null,args.concat(Array.prototype.slice.call(arguments)))}};var _concat=function(eachfn,arr,fn,callback){var r=[];eachfn(arr,function(x,cb){fn(x,function(err,y){r=r.concat(y||[]);cb(err)})},function(err){callback(err,r)})};async.concat=doParallel(_concat);async.concatSeries=doSeries(_concat);async.whilst=function(test,iterator,callback){if(test()){iterator(function(err){if(err){return callback(err)}async.whilst(test,iterator,callback)})}else{callback()}};async.doWhilst=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}var args=Array.prototype.slice.call(arguments,1);if(test.apply(null,args)){async.doWhilst(iterator,test,callback)}else{callback()}})};async.until=function(test,iterator,callback){if(!test()){iterator(function(err){if(err){return callback(err)}async.until(test,iterator,callback)})}else{callback()}};async.doUntil=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}var args=Array.prototype.slice.call(arguments,1);if(!test.apply(null,args)){async.doUntil(iterator,test,callback)}else{callback()}})};async.queue=function(worker,concurrency){if(concurrency===undefined){concurrency=1}function _insert(q,data,pos,callback){if(!q.started){q.started=true}if(!_isArray(data)){data=[data]}if(data.length==0){return async.setImmediate(function(){if(q.drain){q.drain()}})}_each(data,function(task){var item={data:task,callback:typeof callback==="function"?callback:null};if(pos){q.tasks.unshift(item)}else{q.tasks.push(item)}if(q.saturated&&q.tasks.length===q.concurrency){q.saturated()}async.setImmediate(q.process)})}var workers=0;var q={tasks:[],concurrency:concurrency,saturated:null,empty:null,drain:null,started:false,paused:false,push:function(data,callback){_insert(q,data,false,callback)},kill:function(){q.drain=null;q.tasks=[]},unshift:function(data,callback){_insert(q,data,true,callback)},process:function(){if(!q.paused&&workers<q.concurrency&&q.tasks.length){var task=q.tasks.shift();if(q.empty&&q.tasks.length===0){q.empty()}workers+=1;var next=function(){workers-=1;if(task.callback){task.callback.apply(task,arguments)}if(q.drain&&q.tasks.length+workers===0){q.drain()}q.process()};var cb=only_once(next);worker(task.data,cb)}},length:function(){return q.tasks.length},running:function(){return workers},idle:function(){return q.tasks.length+workers===0},pause:function(){if(q.paused===true){return}q.paused=true;q.process()},resume:function(){if(q.paused===false){return}q.paused=false;q.process()}};return q};async.priorityQueue=function(worker,concurrency){function _compareTasks(a,b){return a.priority-b.priority}function _binarySearch(sequence,item,compare){var beg=-1,end=sequence.length-1;while(beg<end){var mid=beg+(end-beg+1>>>1);if(compare(item,sequence[mid])>=0){beg=mid}else{end=mid-1}}return beg}function _insert(q,data,priority,callback){if(!q.started){q.started=true}if(!_isArray(data)){data=[data]}if(data.length==0){return async.setImmediate(function(){if(q.drain){q.drain()}})}_each(data,function(task){var item={data:task,priority:priority,callback:typeof callback==="function"?callback:null};q.tasks.splice(_binarySearch(q.tasks,item,_compareTasks)+1,0,item);if(q.saturated&&q.tasks.length===q.concurrency){q.saturated()}async.setImmediate(q.process)})}var q=async.queue(worker,concurrency);q.push=function(data,priority,callback){_insert(q,data,priority,callback)};delete q.unshift;return q};async.cargo=function(worker,payload){var working=false,tasks=[];var cargo={tasks:tasks,payload:payload,saturated:null,empty:null,drain:null,drained:true,push:function(data,callback){if(!_isArray(data)){data=[data]}_each(data,function(task){tasks.push({data:task,callback:typeof callback==="function"?callback:null});cargo.drained=false;if(cargo.saturated&&tasks.length===payload){cargo.saturated()}});async.setImmediate(cargo.process)},process:function process(){if(working)return;if(tasks.length===0){if(cargo.drain&&!cargo.drained)cargo.drain();cargo.drained=true;return}var ts=typeof payload==="number"?tasks.splice(0,payload):tasks.splice(0,tasks.length);var ds=_map(ts,function(task){return task.data});if(cargo.empty)cargo.empty();working=true;worker(ds,function(){working=false;var args=arguments;_each(ts,function(data){if(data.callback){data.callback.apply(null,args)}});process()})},length:function(){return tasks.length},running:function(){return working}};return cargo};var _console_fn=function(name){return function(fn){var args=Array.prototype.slice.call(arguments,1);fn.apply(null,args.concat([function(err){var args=Array.prototype.slice.call(arguments,1);if(typeof console!=="undefined"){if(err){if(console.error){console.error(err)}}else if(console[name]){_each(args,function(x){console[name](x)})}}}]))}};async.log=_console_fn("log");async.dir=_console_fn("dir");async.memoize=function(fn,hasher){var memo={};var queues={};hasher=hasher||function(x){return x};var memoized=function(){var args=Array.prototype.slice.call(arguments);var callback=args.pop();var key=hasher.apply(null,args);if(key in memo){async.nextTick(function(){callback.apply(null,memo[key])})}else if(key in queues){queues[key].push(callback)}else{queues[key]=[callback];fn.apply(null,args.concat([function(){memo[key]=arguments;var q=queues[key];delete queues[key];for(var i=0,l=q.length;i<l;i++){q[i].apply(null,arguments)}}]))}};memoized.memo=memo;memoized.unmemoized=fn;return memoized};async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments)}};async.times=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.map(counter,iterator,callback)};async.timesSeries=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.mapSeries(counter,iterator,callback)};async.seq=function(){var fns=arguments;return function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([function(){var err=arguments[0];var nextargs=Array.prototype.slice.call(arguments,1);cb(err,nextargs)}]))},function(err,results){callback.apply(that,[err].concat(results))})}};async.compose=function(){return async.seq.apply(null,Array.prototype.reverse.call(arguments))};var _applyEach=function(eachfn,fns){var go=function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();return eachfn(fns,function(fn,cb){fn.apply(that,args.concat([cb]))},callback)};if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);return go.apply(this,args)}else{return go}};async.applyEach=doParallel(_applyEach);async.applyEachSeries=doSeries(_applyEach);async.forever=function(fn,callback){function next(err){if(err){if(callback){return callback(err)}throw err}fn(next)}next()};if(typeof module!=="undefined"&&module.exports){module.exports=async}else if(typeof define!=="undefined"&&define.amd){define([],function(){return async})}else{root.async=async}})()}).call(this,require("_process"))},{_process:8}],8:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;function drainQueue(){if(draining){return}draining=true;var currentQueue;var len=queue.length;while(len){currentQueue=queue;queue=[];var i=-1;while(++i<len){currentQueue[i]()}len=queue.length}draining=false}process.nextTick=function(fun){queue.push(fun);if(!draining){setTimeout(drainQueue,0)}};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}]},{},[3])(3)});
//# sourceMappingURL=fs-traversal.min.js.map