/*
 GridJS
 (c) 2015 Sneezry http://gridjs.org
 License: MIT
*/
(function(C,A,m){function D(a,b){h=h||A.createElement("canvas");var c,d,e,f=h.getContext("2d"),g=new Image;g.addEventListener("load",function(){c=g.width;d=g.height;h.width=c;h.height=d;f.drawImage(g,0,0);e=f.getImageData(0,0,c,d);b(e)},!1);g.src=a}function v(a){var b,c,d=a.width,e=a.height,f=a.data,g={r:[],g:[],b:[],a:[]};for(b=0;b<e;b++)for(g.r[b]=[],g.g[b]=[],g.b[b]=[],g.a[b]=[],a=0;a<d;a++)c=4*(b*d+a),g.r[b][a]=f[c],g.g[b][a]=f[c+1],g.b[b][a]=f[c+2],g.a[b][a]=f[c+3]/255;return g}function x(a){var b,
c,d=a.width,e=a.height,f=a.data,g={G:[],a:[]};for(b=0;b<e;b++)for(g.G[b]=[],g.a[b]=[],a=0;a<d;a++)c=4*(b*d+a),g.G[b][a]=f[c],g.a[b][a]=f[c+3]/255;g.r=g.G;g.g=g.G;g.b=g.G;return g}function z(a){var b,c,d,e=a.a[0].length,f=a.a.length,g=h.getContext("2d").createImageData(e,f);for(c=0;c<f;c++)for(b=0;b<e;b++)d=4*(c*e+b),a.G!==m?(g.data[d]=a.G[c][b],g.data[d+1]=a.G[c][b],g.data[d+2]=a.G[c][b]):(g.data[d]=a.r[c][b],g.data[d+1]=a.g[c][b],g.data[d+2]=a.b[c][b]),g.data[d+3]=Math.round(255*a.a[c][b]);return g}
function B(a){var b=w.getContext("2d");w.width=a.width;w.height=a.height;b.putImageData(a,0,0);return w}function E(a,b){var c,d="["+a+"] ",e=arguments;b=b.split("%s");for(c=0;c<b.length-1;c++)d+=b[c]+e[c+2];d+=b[b.length-1];p.lastError=d;throw d+"\nSee http://gridjs.org/docs/API.html#index_"+a+" for more details.";}function u(a,b,c,d){var e;c=c.replace(/,\s+/,",").split(",");var f=[a,null],g=[];for(a=0;a<b.length;a++)e=typeof d[a],Array.isArray(d[a])&&Array.isArray(d[a][0])?e="two-dimensional array":
Array.isArray(d[a])?e="array":null===d[a]&&(e="undefined"),b[a]=b[a].replace(/,\s+/,","),-1===b[a].split(",").indexOf(e)&&(g.push(c[a]+" should be %s, but %s is given."),f.push(b[a].split(",").join(" or "),e));f[1]=g.join(" ");return g.length?(E.apply(null,f),!1):!0}var p=C.gridjs=C.gridjs||{},h=A.createElement("canvas"),w=A.createElement("canvas"),k;k=function(){this.originTop=this.originLeft=this.origin=this.imageData=this.pixel=this.height=this.width=null};p.lastError=null;p.getImageObject=function(a,
b){u("gridjs.getImageObject",["string, object","function"],"image, callback",[a,b])&&("string"===typeof a?p.getImageObjectFromURL(a,b):!0===Array.isArray(a.r)?b(p.getImageObjectFromPixel(a)):"object"===typeof a&&b(p.getImageObjectFromImageData(a)))};p.open=p.getImageObject;p.getImageObjectFromURL=function(a,b){u("gridjs.getImageObjectFromURL",["string","function"],"url, callback",[a,b])&&D(a,function(a){var d=new k;d.imageData=a;d.pixel=v(a);d.width=a.width;d.height=a.height;b(d)})};p.getImageObjectFromImageData=
function(a){if(u("gridjs.getImageObjectFromImageData",["object"],"imageData",[a])){var b=a.width,c=a.height,d=v(a),e=new k;e.pixel=d;e.imageData=a;e.height=c;e.width=b;return e}};p.getImageObjectFromPixel=function(a){if(u("gridjs.getImageObjectFromPixel",["object"],"pixel",[a])){var b=a.a[0].length,c=a.a.length,d=z(a),e=new k;e.pixel=a;e.imageData=d;e.height=c;e.width=b;return e}};p.convolution=function(a,b){if(u("gridjs.convolution",["two-dimensional array","two-dimensional array"],"srcArray, maskArray",
[a,b])){var c,d,e,f,g,h,l,m=[],n=a[0].length,p=a.length,k=b[0].length,v=b.length,t=Math.round(k/2)-1,q=Math.round(v/2)-1;for(d=0;d<p;d++)for(m[d]=[],c=0;c<n;c++){for(f=l=0;f<v;f++)for(e=0;e<k;e++)g=c-t+e,h=d-q+f,0<=g&&g<n&&0<=h&&h<p&&(l+=a[h][g]*b[f][e]);m[d][c]=l}return m}};p.conv=p.convolution;p.abs=function(a){if(u("gridjs.abs",["two-dimensional array"],"srcArray",[a])){var b,c,d=[],e=a[0].length,f=a.length;for(c=0;c<f;c++)for(d[c]=[],b=0;b<e;b++)d[c][b]=Math.abs(a[c][b]);return d}};p.square=function(a){if(u("gridjs.square",
["two-dimensional array"],"srcArray",[a])){var b,c,d=[],e=a[0].length,f=a.length;for(c=0;c<f;c++)for(d[c]=[],b=0;b<e;b++)d[c][b]=a[c][b]*a[c][b];return d}};p.sqrt=function(a){if(u("gridjs.sqrt",["two-dimensional array"],"srcArray",[a])){var b,c,d=[],e=a[0].length,f=a.length;for(c=0;c<f;c++)for(d[c]=[],b=0;b<e;b++)d[c][b]=Math.sqrt(a[c][b]);return d}};p.gauseCore=function(a,b,c){if(u("gridjs.gauseCore",["number","number, undefined","number, undefined"],"size, sigma, derivative",[a,b,c])){var d,e,f,
g,h=0,l=Math.round(a/2),r=[];b=b||1;for(e=0;e<a;e++)for(r[e]=[],d=0;d<a;d++){if(d<l&&e<l)switch(f=d-l+1,g=e-l+1,c){case 0:r[e][d]=-f*Math.exp(-(f*f+g*g)/(2*b*b))/(b*b*b);break;case 1:r[e][d]=-g*Math.exp(-(f*f+g*g)/(2*b*b))/(b*b*b);break;case 2:r[e][d]=f*g*Math.exp(-(f*f+g*g)/(2*b*b))/(b*b*b*b*b);break;default:r[e][d]=Math.exp(-(f*f+g*g)/(2*b*b))/b}else r[e][d]=d<l?1===c||2===c?-r[a-e-1][d]:r[a-e-1][d]:e<l?0===c||2===c?-r[e][a-d-1]:r[e][a-d-1]:0===c||1===c?-r[a-e-1][a-d-1]:r[a-e-1][a-d-1];h+=Math.abs(r[e][d])}if(c!==
m)for(e=0;e<a;e++)for(d=0;d<a;d++)r[e][d]/=h;return r}};p.gauss=function(a,b,c,d){if(u("gridjs.gauss",["two-dimensional array","number","number, undefined","number, undefined"],"srcArray, size, sigma, derivative",[a,b,c,d]))return b=p.gauseCore(b,c,d),p.convolution(a,b)};p.add=function(a,b){if(u("gridjs.add",["two-dimensional array","two-dimensional array"],"srcArray, dstArray",[a,b])){var c,d,e=[],f=a[0].length,g=a.length;for(d=0;d<g;d++)for(e[d]=[],c=0;c<f;c++)e[d][c]=a[d][c]+b[d][c];return e}};
p.minus=function(a,b){if(u("gridjs.minus",["two-dimensional array","two-dimensional array"],"srcArray, dstArray",[a,b])){var c,d,e=[],f=a[0].length,g=a.length;for(d=0;d<g;d++)for(e[d]=[],c=0;c<f;c++)e[d][c]=a[d][c]-b[d][c];return e}};p.multiply=function(a,b){if(u("gridjs.multiply",["two-dimensional array","two-dimensional array, number"],"srcArray, dstArray",[a,b])){var c,d,e=[],f=a[0].length,g=a.length;for(d=0;d<g;d++)for(e[d]=[],c=0;c<f;c++)e[d][c]=a[d][c]*(Array.isArray(b)?b[d][c]:b);return e}};
p.mul=p.multiply;p.divide=function(a,b,c){if(u("gridjs.multiply",["two-dimensional array","two-dimensional array, number","number, undefined"],"srcArray, dstArray, defaultValue",[a,b,c])){var d,e,f,g=[],h=a[0].length,l=a.length;for(e=0;e<l;e++)for(g[e]=[],d=0;d<h;d++)f=Array.isArray(b)?b[e][d]:b,g[e][d]=c!==m?0===f?c:a[e][d]/f:a[e][d]/f;return g}};p.div=p.divide;p.zeros=function(a,b){if(u("gridjs.zeros",["two-dimensional array, number","number, undefined"],"width, height",[a,b]))return Array.isArray(a)&&
(b=a.length,a=a[0].length),p.ones(a,b,0)};p.ones=function(a,b,c){if(u("gridjs.ones",["two-dimensional array, number","number, undefined","number, undefined"],"width, height, value",[a,b,c])){var d,e,f=[];Array.isArray(a)&&(c=b,b=a.length,a=a[0].length);c=c===m?1:c;for(e=0;e<b;e++)for(f[e]=[],d=0;d<a;d++)f[e][d]=c;return f}};p.normalize=function(a,b,c){if(u("gridjs.normalize",["two-dimensional array","number, undefined","number, undefined"],"srcArray, min, max",[a,b,c])){var d,e,f,g,h=a[0].length,
l=a.length;b=b===m?0:b;c=c===m?1:c;for(e=0;e<l;e++)for(d=0;d<h;d++){if(f===m||f>a[e][d])f=a[e][d];if(g===m||g<a[e][d])g=a[e][d]}for(e=0;e<l;e++)for(d=0;d<h;d++)a[e][d]=(a[e][d]-f)*(c-b)/(g-f)+b;return a}};p.norm=p.normalize;p.cutoff=function(a,b){if(u("gridjs.cutoff",["two-dimensional array","number"],"srcArray, max",[a,b])){var c,d,e=a[0].length,f=a.length;for(d=0;d<f;d++)for(c=0;c<e;c++)a[d][c]=Math.min(a[d][c],b);return a}};p.kmeans=function(a,b,c,d,e){if(u("gridjs.kmeans",["two-dimensional array",
"number","number, undefined"],"points, k, maxStep",[a,b,c])){var f,g,h,l,r,n,k,v,y,t=a.length,q=[],x=[],w=[];d=d||0;c=c||20;if(e===m)for(e=[],h=0;h<b;h++)f=a[h][0],g=a[h][1],e[h]=[f,g];for(h=0;h<t;h++){k=null;f=a[h][0];g=a[h][1];for(l=0;l<b;l++)if(n=(f-e[l][0])*(f-e[l][0])+(g-e[l][1])*(g-e[l][1]),null===k||k>n)k=n,v=f,y=g,r=l;x[r]===m?(x[r]=[v,y],w[r]=1):(x[r][0]+=v,x[r][1]+=y,w[r]++);d+1>c&&(q[r]===m&&(q[r]=[]),q[r].push([v,y]))}for(l=0;l<b;l++)x[l]===m?(e[l][0]=a[l][0],e[l][1]=a[l][1]):(e[l][0]=
x[l][0]/w[l],e[l][1]=x[l][1]/w[l]);return d+1>c?{center:e,cluster:q}:p.kmeans(a,b,c,d+1,e)}};p.blank=function(a,b,c){if(u("gridjs.blank",["number","number","array, undefined"],"width, height, fill",[a,b,c])){var d=new k,e=h.getContext("2d");c===m&&(c=[]);c[0]=c[0]||0;c[1]=c[1]||0;c[2]=c[2]||0;c[3]=c[3]||0;h.width=a;h.height=b;e.fillStyle="rgba("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+")";e.fillRect(0,0,a,b);d.width=a;d.height=b;d.imageData=e.getImageData(0,0,a,b);d.pixel=v(d.imageData);return d}};k.prototype.grayscale=
function(){var a,b,c,d=this.width,e=this.height,f={G:[],a:[]};for(b=0;b<e;b++)for(f.G[b]=[],f.a[b]=[],a=0;a<d;a++)c=.299*this.pixel.r[b][a]+.587*this.pixel.g[b][a]+.114*this.pixel.b[b][a],f.G[b][a]=Math.round(c),f.a[b][a]=this.pixel.a[b][a];f.r=f.G;f.g=f.G;f.b=f.G;this.pixel=f;this.imageData=z(f);return this};k.prototype.show=function(a){var b;"CANVAS"===a.tagName?(a.width=this.width,a.height=this.height,b=a.getContext("2d"),b.putImageData(this.imageData,0,0)):"IMG"===a.tagName&&(h.width=this.width,
h.height=this.height,b=h.getContext("2d"),b.putImageData(this.imageData,0,0),a.src=h.toDataURL());return this};k.prototype.blend=function(a,b,c,d){if(u("ImageObject.blend",["number, undefined","number, undefined","number, undefined"],"updown, offsetX, offsetY",[b,c,d])){var e,f,g=this.width,h=this.height,l=a.width,m=a.height,n={r:[],g:[],b:[],a:[]};b=b||0;c=c?Math.round(c):0;d=d?Math.round(d):0;for(f=0;f<h;f++)for(n.r[f]=[],n.g[f]=[],n.b[f]=[],n.a[f]=[],e=0;e<g;e++)0>f-d||0>e-c||f-d>=m||e-c>=l?(n.a[f][e]=
this.pixel.a[f][e],n.r[f][e]=this.pixel.r[f][e],n.g[f][e]=this.pixel.g[f][e],n.b[f][e]=this.pixel.b[f][e]):0===b?(n.a[f][e]=a.pixel.a[f-d][e-c]+this.pixel.a[f][e]*(1-a.pixel.a[f-d][e-c]),n.r[f][e]=(a.pixel.r[f-d][e-c]*a.pixel.a[f-d][e-c]+this.pixel.r[f][e]*this.pixel.a[f][e]*(1-a.pixel.a[f-d][e-c]))/n.a[f][e],n.g[f][e]=(a.pixel.g[f-d][e-c]*a.pixel.a[f-d][e-c]+this.pixel.g[f][e]*this.pixel.a[f][e]*(1-a.pixel.a[f-d][e-c]))/n.a[f][e],n.b[f][e]=(a.pixel.b[f-d][e-c]*a.pixel.a[f-d][e-c]+this.pixel.b[f][e]*
this.pixel.a[f][e]*(1-a.pixel.a[f-d][e-c]))/n.a[f][e]):(n.a[f][e]=this.pixel.a[f][e]+a.pixel.a[f-d][e-c]*(1-this.pixel.a[f][e]),n.r[f][e]=(this.pixel.r[f][e]*this.pixel.a[f][e]+a.pixel.r[f-d][e-c]*a.pixel.a[f-d][e-c]*(1-this.pixel.a[f][e]))/n.a[f][e],n.g[f][e]=(this.pixel.g[f][e]*this.pixel.a[f][e]+a.pixel.g[f-d][e-c]*a.pixel.a[f-d][e-c]*(1-this.pixel.a[f][e]))/n.a[f][e],n.b[f][e]=(this.pixel.b[f][e]*this.pixel.a[f][e]+a.pixel.b[f-d][e-c]*a.pixel.a[f-d][e-c]*(1-this.pixel.a[f][e]))/n.a[f][e]),n.r[f][e]=
Math.round(n.r[f][e]),n.g[f][e]=Math.round(n.g[f][e]),n.b[f][e]=Math.round(n.b[f][e]),.003>n.a[f][e]&&(n.a[f][e]=this.pixel.a[f][e]);this.width=g;this.height=h;this.pixel=n;this.imageData=z(n);return this}};k.prototype.copy=function(){var a,b,c=this.width,d=this.height,e=new k,f={a:[]};this.pixel.G!==m?f.G=[]:(f.r=[],f.g=[],f.b=[]);for(b=0;b<d;b++)for(this.pixel.G!==m?f.G[b]=[]:(f.r[b]=[],f.g[b]=[],f.b[b]=[]),f.a[b]=[],a=0;a<c;a++)this.pixel.G!==m?f.G[b][a]=this.pixel.G[b][a]:(f.r[b][a]=this.pixel.r[b][a],
f.g[b][a]=this.pixel.g[b][a],f.b[b][a]=this.pixel.b[b][a]),f.a[b][a]=this.pixel.a[b][a];this.pixel.G!==m&&(f.r=f.G,f.g=f.G,f.b=f.G);e.pixel=f;e.imageData=z(f);e.height=d;e.width=c;return e};k.prototype.resize=function(a,b){if(u("ImageObject.resize",["number","number"],"newWidth, newHeight",[a,b])){var c=h.getContext("2d"),d=B(this.imageData);1>a&&(a*=this.width,a=Math.round(a));1>b&&(b*=this.height,b=Math.round(b));h.width=a;h.height=b;c.drawImage(d,0,0,a,b);this.width=a;this.height=b;this.imageData=
c.getImageData(0,0,a,b);this.pixel=this.pixel.G!==m?x(this.imageData):v(this.imageData);return this}};k.prototype.rotate=function(a){if(u("ImageObject.rotate",["number"],"degree",[a])){var b=this.width,c=this.height;a=-a*Math.PI/180;var d=h.getContext("2d"),e=B(this.imageData),f,g;f=Math.abs(b*Math.cos(a))+Math.abs(c*Math.sin(a));f=Math.round(f);g=Math.abs(b*Math.sin(a))+Math.abs(c*Math.cos(a));g=Math.round(g);h.width=f;h.height=g;d.translate(f/2,g/2);d.rotate(a);d.translate(-b/2,-c/2);d.drawImage(e,
0,0);this.width=f;this.height=g;this.imageData=d.getImageData(0,0,f,g);this.pixel=this.pixel.G!==m?x(this.imageData):v(this.imageData);return this}};k.prototype.crop=function(a,b,c,d){var e=h.getContext("2d"),f=B(this.imageData);h.width=c;h.height=d;e.drawImage(f,a,b,c,d,0,0,c,d);this.width=c;this.height=d;this.imageData=e.getImageData(0,0,c,d);this.pixel=this.pixel.G!==m?x(this.imageData):v(this.imageData);return this};k.prototype.updateImageData=function(){var a=h.getContext("2d");this.pixel.G!==
m&&(this.pixel.r=this.pixel.G,this.pixel.g=this.pixel.G,this.pixel.b=this.pixel.G);this.imageData=z(this.pixel);this.width=this.imageData.width;this.height=this.imageData.height;null!==this.origin&&(h.width=this.origin.width,h.height=this.origin.height,a.putImageData(this.origin.imageData,0,0),a.putImageData(this.imageData,this.originLeft,this.originTop),this.origin.imageData=a.getImageData(0,0,this.origin.width,this.origin.height),this.origin.pixel=this.pixel.G!==m&&this.origin.pixel.G!==m?x(this.origin.imageData):
v(this.origin.imageData));return this};k.prototype.updatePixel=function(){var a=h.getContext("2d");this.pixel=this.pixel.G!==m?x(this.imageData):v(this.imageData);this.width=this.imageData.width;this.height=this.imageData.height;null!==this.origin&&(h.width=this.origin.width,h.height=this.origin.height,a.putImageData(this.origin.imageData,0,0),a.putImageData(this.imageData,this.originLeft,this.originTop),this.origin.imageData=a.getContext(0,0,this.origin.width,this.origin.height),this.origin.pixel=
this.pixel.G!==m&&this.origin.pixel.G!==m?x(this.origin.imageData):v(this.origin.imageData));return this};k.prototype.update=k.prototype.updateImageData;k.prototype.paste=function(a,b,c){if(u("ImageObject.paste",["number, undefined","number, undefined"],"left, top",[b,c])){var d=this.width,e=this.height,f=h.getContext("2d");b=b||0;c=c||0;h.width=d;h.height=e;f.putImageData(this.imageData,0,0);f.putImageData(a.imageData,b,c);this.imageData=f.getImageData(0,0,d,e);this.pixel=this.pixel.G!==m&&a.pixel.G!==
m?x(this.imageData):v(this.imageData);return this}};k.prototype.load=function(a,b,c,d){if(u("ImageObject.load",["number","number","number","number"],"left, top, width, height",[a,b,c,d])){var e=new k,f=h.getContext("2d");h.width=c;h.height=d;f.putImageData(this.imageData,-a,-b);e.width=c;e.height=d;e.imageData=f.getImageData(0,0,c,d);e.pixel=v(e.imageData);e.origin=this;e.originLeft=a;e.originTop=b;e.pixel=this.pixel.G!==m?x(e.imageData):v(e.imageData);return e}};k.prototype.flip=function(a){if(u("ImageObject.flip",
["number"],"axis",[a])){var b=this.width,c=this.height,d=h.getContext("2d"),e=w.getContext("2d");h.width=b;h.height=c;d.translate(b/2,c/2);w.width=b;w.height=c;e.putImageData(this.imageData,0,0);0===a?d.scale(-1,1):1===a?d.scale(1,-1):2===a&&d.scale(-1,-1);d.drawImage(w,-b/2,-c/2);this.imageData=d.getImageData(0,0,b,c);this.pixel=this.pixel.G!==m?x(this.imageData):v(this.imageData);return this}};k.prototype.reverse=function(){var a,b,c=this.width,d=this.height;for(b=0;b<d;b++)for(a=0;a<c;a++)this.pixel.G!==
m?this.pixel.G[b][a]=255-this.pixel.G[b][a]:(this.pixel.r[b][a]=255-this.pixel.r[b][a],this.pixel.g[b][a]=255-this.pixel.g[b][a],this.pixel.b[b][a]=255-this.pixel.b[b][a]);this.imageData=z(this.pixel);return this};k.prototype.rgba=function(){this.pixel=v(this.imageData);return this};k.prototype.rgb=function(){var a=p.blank(this.width,this.height,[255,255,255,1]);this.blend(a,1);return this};k.prototype.plot=function(a,b,c){if(u("ImageObject.plot",["array, two-dimensional array","string, undefined"],
"points, style",[a,b])){var d,e,f,g,k,l,r,n,p,w;d="blue";var y=null,t=null,q=h.getContext("2d");!0!==this.holdon&&(h.width=this.width,h.height=this.height,q.putImageData(this.imageData,0,0));"number"===typeof a&&"number"===typeof b?(a=[[a,b]],b=c):"number"===typeof a[0]&&(a=[a]);/b/.test(b)?d=this.pixel.G!==m?"#1D1D1D":"#0000FF":/g/.test(b)?d=this.pixel.G!==m?"#969696":"#00FF00":/r/.test(b)?d=this.pixel.G!==m?"#4C4C4C":"#FF0000":/c/.test(b)?d=this.pixel.G!==m?"#B3B3B3":"#00FFFF":/m/.test(b)?d=this.pixel.G!==
m?"#696969":"#FF00FF":/y/.test(b)?d=this.pixel.G!==m?"#E2E2E2":"#FFFF00":/k/.test(b)?d="#000000":/w/.test(b)&&(d="#FFFFFF");1===a.length?y=null:/--/.test(b)?y="solid":/-/.test(b)?y="dashed":/:/.test(b)?y="dotted":b===m&&(y="solid");/\./.test(b)?t="dot":/o/.test(b)?t="circle":/s/.test(b)?t="square":/\*/.test(b)?t="star":/\+/.test(b)?t="plus":/x/.test(b)&&(t="cross");q.strokeStyle=d;q.fillStyle=d;for(b=0;b<a.length;b++)if(c=a[b][0],d=a[b][1],"dot"===t?(q.beginPath(),q.arc(c,d,2,0,2*Math.PI),q.fill()):
"circle"===t?(q.beginPath(),q.arc(c,d,3,0,2*Math.PI),q.stroke()):"square"===t?(q.beginPath(),q.rect(c-2,d-2,5,5),q.fill()):"star"===t?(q.beginPath(),q.moveTo(c-3,d-3),q.lineTo(c+3,d+3),q.moveTo(c-3,d+3),q.lineTo(c+3,d-3),q.moveTo(c,d-5),q.lineTo(c,d+5),q.moveTo(c-5,d),q.lineTo(c+5,d),q.stroke()):"plus"===t?(q.beginPath(),q.moveTo(c,d-5),q.lineTo(c,d+5),q.moveTo(c-5,d),q.lineTo(c+5,d),q.stroke()):"cross"===t&&(q.beginPath(),q.moveTo(c-3,d-3),q.lineTo(c+3,d+3),q.moveTo(c-3,d+3),q.lineTo(c+3,d-3),q.stroke()),
0<b)if(g=a[b-1][0],k=a[b-1][1],"solid"===y)q.beginPath(),q.moveTo(g,k),q.lineTo(c,d),q.stroke();else if("dashed"===y||"dotted"===y){"dashed"===y?(q.lineCap="butt",n=5):(q.lineCap="round",n=2);g!==c?(l=5*Math.cos(Math.atan((d-k)/(c-g))),r=5*Math.sin(Math.atan((d-k)/(c-g)))):k!==d&&(l=5*Math.sin(Math.atan((c-g)/(d-k))),r=5*Math.cos(Math.atan((c-g)/(d-k))));q.beginPath();e=g;for(f=k;Math.abs(e-g)<=Math.abs(c-g)&&Math.abs(f-k)<=Math.abs(d-k);)p=e+n/5*l,w=f+n/5*r,q.moveTo(e,f),q.lineTo(p,w),e=p+l,f=w+
r;q.stroke()}!0!==this.holdon&&(this.imageData=q.getImageData(0,0,this.width,this.height),this.pixel=this.pixel.G!==m?x(this.imageData):v(this.imageData));return this}};k.prototype.hold=function(){var a=h.getContext("2d");this.holdon=!0;h.width=this.width;h.height=this.height;a.putImageData(this.imageData,0,0);return this};k.prototype.flush=function(){var a=h.getContext("2d");this.holdon=!1;this.imageData=a.getImageData(0,0,this.width,this.height);this.pixel=this.pixel.G!==m?x(this.imageData):v(this.imageData);
return this};k.prototype.rectangle=function(a,b,c,d,e,f){if(u("ImageObject.rectangle","number;number;number;number;array, undefined;array, undefined".split(";"),"left, top, width, height, fill, stroke",[a,b,c,d,e,f])){var g=h.getContext("2d");!0!==this.holdon&&(h.width=this.width,h.height=this.height,g.putImageData(this.imageData,0,0));e===m&&(e=[]);e[0]=e[0]||0;e[1]=e[1]||0;e[2]=e[2]||0;e[3]=e[3]||0;f===m&&(f=[]);f[0]=f[0]||0;f[1]=f[1]||0;f[2]=f[2]||0;f[3]=f[3]||0;f[4]=f[4]||0;this.pixel.G!==m&&
(e[0]=.299*e[0]+.587*e[1]+.114*e[2],e[0]=Math.round(e[0]),e[1]=e[0],e[2]=e[0],f[0]=.299*f[0]+.587*f[1]+.114*f[2],f[0]=Math.round(f[0]),f[1]=f[0],f[2]=f[0]);g.fillStyle="rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")";g.strokeStyle="rgba("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")";g.lineWidth=f[4];g.beginPath();g.rect(a,b,c,d);g.fill();g.stroke();!0!==this.holdon&&(this.imageData=g.getImageData(0,0,this.width,this.height),this.pixel=this.pixel.G!==m?x(this.imageData):v(this.imageData));return this}};k.prototype.rect=
k.prototype.rectangle;k.prototype.arc=function(a,b,c,d,e,f,g){if(u("ImageObject.arc","number;number;number;number;number;array, undefined;array, undefined".split(";"),"centerX, centerY, radius, startDegree, endDegree, fill, stroke",[a,b,c,d,e,f,g])){var k=h.getContext("2d");!0!==this.holdon&&(h.width=this.width,h.height=this.height,k.putImageData(this.imageData,0,0));f===m&&(f=[]);f[0]=f[0]||0;f[1]=f[1]||0;f[2]=f[2]||0;f[3]=f[3]||0;g===m&&(g=[]);g[0]=g[0]||0;g[1]=g[1]||0;g[2]=g[2]||0;g[3]=g[3]||0;
g[4]=g[4]||0;this.pixel.G!==m&&(f[0]=.299*f[0]+.587*f[1]+.114*f[2],f[0]=Math.round(f[0]),f[1]=f[0],f[2]=f[0],g[0]=.299*g[0]+.587*g[1]+.114*g[2],g[0]=Math.round(g[0]),g[1]=g[0],g[2]=g[0]);k.fillStyle="rgba("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")";k.strokeStyle="rgba("+g[0]+", "+g[1]+", "+g[2]+", "+g[3]+")";k.lineWidth=g[4];k.beginPath();k.arc(a,b,c,d*Math.PI/180,e*Math.PI/180);k.fill();k.stroke();!0!==this.holdon&&(this.imageData=k.getImageData(0,0,this.width,this.height),this.pixel=this.pixel.G!==
m?x(this.imageData):v(this.imageData));return this}};k.prototype.circle=function(a,b,c,d,e){if(u("ImageObject.circle",["number","number","number","array, undefined","array, undefined"],"centerX, centerY, radius, fill, stroke",[a,b,c,d,e]))return this.arc(a,b,c,0,360,d,e)};k.prototype.polygon=function(a,b,c){if(u("ImageObject.polygon",["two-dimensional array","array, undefined","array, undefined"],"points, fill, stroke",[a,b,c])){var d=h.getContext("2d");!0!==this.holdon&&(h.width=this.width,h.height=
this.height,d.putImageData(this.imageData,0,0));b===m&&(b=[]);b[0]=b[0]||0;b[1]=b[1]||0;b[2]=b[2]||0;b[3]=b[3]||0;c===m&&(c=[]);c[0]=c[0]||0;c[1]=c[1]||0;c[2]=c[2]||0;c[3]=c[3]||0;c[4]=c[4]||0;this.pixel.G!==m&&(b[0]=.299*b[0]+.587*b[1]+.114*b[2],b[0]=Math.round(b[0]),b[1]=b[0],b[2]=b[0],c[0]=.299*c[0]+.587*c[1]+.114*c[2],c[0]=Math.round(c[0]),c[1]=c[0],c[2]=c[0]);d.fillStyle="rgba("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+")";d.strokeStyle="rgba("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+")";d.lineWidth=c[4];
d.beginPath();for(b=0;b<a.length;b++)0===b?d.moveTo(a[b][0],a[b][1]):d.lineTo(a[b][0],a[b][1]);d.closePath();d.fill();d.stroke();!0!==this.holdon&&(this.imageData=d.getImageData(0,0,this.width,this.height),this.pixel=this.pixel.G!==m?x(this.imageData):v(this.imageData));return this}};k.prototype.poly=k.prototype.polygon;k.prototype.affine=function(a){if(u("ImageObject.affine",["two-dimensional array"],"matrix",[a])){var b=this.width,c=this.height,d=w.getContext("2d"),e=h.getContext("2d");w.width=
b;w.height=c;d.putImageData(this.imageData,0,0);h.width=b;h.height=c;e.transform(a[0][0],a[1][0],a[0][1],a[1][1],a[0][2],a[1][2]);e.drawImage(w,0,0);this.imageData=e.getImageData(0,0,b,c);this.pixel=this.pixel.G!==m?x(this.imageData):v(this.imageData);return this}};k.prototype.affinec=function(a,b,c,d){if(u("ImageObject.affinec",["array, undefined","array, undefined","array, undefined","array, undefined"],"topLeft, topRight, bottomLeft, bottomRight",[a,b,c,d])){var e,f,g,k,l,r=this.width,n=this.height,
p=w.getContext("2d"),z=h.getContext("2d");!0===Array.isArray(a)?(g=a[0],a=a[1],!0===Array.isArray(b)&&(e=(b[0]-g)/r,k=(b[1]-a)/r),!0===Array.isArray(c)&&(f=(c[0]-g)/n,l=(c[1]-a)/n),e===m?(e=(d[0]-g-f*n)/r,k=(d[1]-a-l*n)/r):f===m&&(f=(d[0]-g-e*r)/n,l=(d[1]-a-k*r)/n)):(e=(d[0]-a[0])/r,k=(d[1]-a[1])/r,f=(c[0]-b[0]-e*r)/n,l=(c[1]-b[1]-k*r)/n,g=c[0]-f*n,a=c[1]-l*n);w.width=r;w.height=n;p.putImageData(this.imageData,0,0);h.width=r;h.height=n;z.transform(e,k,f,l,g,a);z.drawImage(w,0,0);this.imageData=z.getImageData(0,
0,r,n);this.pixel=this.pixel.G!==m?x(this.imageData):v(this.imageData);return this}};k.prototype.text=function(a,b,c,d){if(u("ImageObject.text",["number","number","string","array, undefined"],"left, top, text, style",[a,b,c,d])){var e,f=h.getContext("2d"),g="14px",k="Arial",l=[0,0,0,1],r="start",n="top",p="normal",w="normal",y="normal";!0!==this.holdon&&(h.width=this.width,h.height=this.height,f.putImageData(this.imageData,0,0));for(e=0;e<d.length;e++){var t=d[e];"string"===typeof t?/^\d+px/.test(t)?
g=t:-1!==["start","end","center","left","right"].indexOf(t)?r=t:-1!==["top","bottom","middle","alphabetic","hanging"].indexOf(t)?n=t:-1!==["italic","oblique"].indexOf(t)?p=t:-1!==["bold","bolder","lighter"].indexOf(t)?y=t:"small-caps"===t?w=t:k=t:Array.isArray(t)&&4===t.length?l=t:"number"===typeof t&&-1!==[1,2,3,4,5,6,7,8,9].indexOf(t/100)&&(y=t)}this.pixel.G!==m&&(l[0]=.299*l[0]+.587*l[1]+.114*l[2],l[0]=Math.round(l[0]),l[1]=l[0],l[2]=l[0]);f.fillStyle="rgba("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+
")";f.textAlign=r;f.textBaseline=n;f.font=[p,w,y,g,k].join(" ");f.fillText(c,a,b);!0!==this.holdon&&(this.imageData=f.getImageData(0,0,this.width,this.height),this.pixel=this.pixel.G!==m?x(this.imageData):v(this.imageData));return this}};k.prototype.mask=function(a){var b,c,d=this.width,e=this.height;for(c=0;c<e;c++)for(b=0;b<d;b++)this.pixel.a[c][b]=a.pixel.a[c][b];this.imageData=z(this.pixel);return this}})(window,document);