/** @license SPA.js | (c) Kumararaja <sucom.kumar@gmail.com> | License (MIT) */
!function(){for(var e,a=function(){},t=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],n=t.length,s=window.console=window.console||{};n--;)e=t[n],s[e]||(s[e]=a);"none"in window||(window.none=""),"noop"in window||(window.noop=function(){})}();var isSpaHashRouteOn=!1;!function(){function __renderView(e,a){var t,n=spa.setElIdIfNot(e);return t=a&&!$.isEmptyObject(a)?spa.render("#"+n,a):spa.render("#"+n)}var win=this,spa=function(e){return e instanceof spa?e:this instanceof spa?void 0:new spa(e)};win.spa=spa,spa.VERSION="2.0.0";var isById=document.getElementById,isByName=document.all;spa.isIE=!!isByName,spa.isNonIE=!(!isById||isByName),spa.noop=function(){},spa.debug=!1,spa["debugger"]={on:function(){spa.debug=!0},off:function(){spa.debug=!1},toggle:function(){spa.debug=!spa.debug}},spa.cOut=function(e,a){spa.debug&&console[e]&&console[e](1===a.length?a[0]:a)},spa.console={clear:function(){console.clear()},assert:function(){spa.cOut("assert",arguments)},count:function(){spa.cOut("count",arguments)},debug:function(){spa.cOut("debug",arguments)},dir:function(){spa.cOut("dir",arguments)},dirxml:function(){spa.cOut("dirxml",arguments)},error:function(){spa.cOut("error",arguments)},exception:function(){spa.cOut("exception",arguments)},group:function(){spa.cOut("group",arguments)},groupCollapsed:function(){spa.cOut("groupCollapsed",arguments)},groupEnd:function(){spa.cOut("groupEnd",arguments)},info:function(){spa.cOut("info",arguments)},log:function(){spa.cOut("log",arguments)},markTimeline:function(){spa.cOut("markTimeline",arguments)},profile:function(){spa.cOut("profile",arguments)},profileEnd:function(){spa.cOut("profileEnd",arguments)},table:function(){spa.cOut("table",arguments)},time:function(){spa.cOut("time",arguments)},timeEnd:function(){spa.cOut("timeEnd",arguments)},timeStamp:function(){spa.cOut("timeStamp",arguments)},trace:function(){spa.cOut("trace",arguments)},warn:function(){spa.cOut("warn",arguments)}},spa._initWindowOnHashChange=function(){"onhashchange"in window&&(isSpaHashRouteOn=!0,spa.console.info("Registering HashRouting Listener"),window.onhashchange=function(e){var a=window.location.hash;spa.console.info("onHashChange: "+a),a?spa.route(a):spa.routesOptions.defaultPageRoute&&spa.route(spa.routesOptions.defaultPageRoute)})},spa._stopWindowOnHashChange=function(){window.onhashchange=void 0},String.prototype.trimLeftStr=function(e){return this.replace(new RegExp("^["+(e||"\\s")+"]+","g"),"")},String.prototype.trimRightStr=function(e){return this.replace(new RegExp("["+(e||"\\s")+"]+$","g"),"")},String.prototype.trimStr=function(e){return this.trimLeftStr(e).trimRightStr(e)},String.prototype.isBlankStr=function(){return""==this.trimStr()},String.prototype.ifBlankStr=function(e,a){return e=e||"",a="undefined"==typeof a?this.trimStr():a,this.isBlankStr()?(""+e).trimStr():a},String.prototype.isNumberStr=function(){return 0==(""+this).replace(/[0-9.]/g,"").trimStr().length},String.prototype.normalizeStr=function(){return this.trimStr().replace(/\s+/g," ")},String.prototype.beginsWithStr=function(e,a){a=a?"i":"";var t=new RegExp("^"+e,a);return!!this.normalizeStr().match(t)},String.prototype.beginsWithStrIgnoreCase=function(e){var a=new RegExp("^"+e,"i");return!!this.normalizeStr().match(a)},String.prototype.endsWithStr=function(e,a){a=a?"i":"";var t=new RegExp(e+"$",a);return!!this.normalizeStr().match(t)},String.prototype.endsWithStrIgnoreCase=function(e,a){var t=new RegExp(e+"$","i");return!!this.normalizeStr().match(t)},String.prototype.containsStr=function(e,a){a=a?"gi":"g";var t=new RegExp(""+e,a);return t.test(this)},String.prototype.containsStrIgnoreCase=function(e){var a=new RegExp(""+e,"gi");return a.test(this)},String.prototype.equals=function(e){return this==e},String.prototype.equalsIgnoreCase=function(e){return String(this.toLowerCase())==String(e).toLowerCase()},String.prototype.toProperCase=function(e){return("undefined"==typeof e||e?this.normalizeStr():this).toLowerCase().replace(/^(.)|\s(.)/g,function(e){return e.toUpperCase()})},spa.toJSON=function(str){var thisStr;return _.isString(str)&&(thisStr=str.trimStr(),thisStr.containsStr(":")&&!thisStr.containsStr(",")&&thisStr.containsStr(";")&&(thisStr=thisStr.replace(/\;/g,",")),thisStr.beginsWithStr("{")||thisStr.beginsWithStr("\\[")?thisStr.beginsWithStr("{")&&!thisStr.containsStr(":")&&thisStr.containsStr("=")&&(thisStr=""+thisStr.replace(/=/g,":")):thisStr=thisStr.containsStr(":")?"{"+thisStr+"}":thisStr.containsStr("=")?"{"+thisStr.replace(/=/g,":")+"}":"["+thisStr+"]"),!_.isString(str)&&_.isObject(str)?str:spa.isBlank(str)?null:eval("("+thisStr+")")},String.prototype.toJSON=function(){return spa.toJSON(this)},String.prototype.toBoolean=function(){var e=!0;switch((""+this).trimStr().toLowerCase()){case"":case"0":case"-0":case"nan":case"null":case"false":case"undefined":e=!1}return e&&(e=!(""+this).trimStr().beginsWithStr("-")),e},Boolean.prototype.toValue=function(e,a){return"undefined"==typeof e&&(e=!0),"undefined"==typeof a&&(a=!1),this.valueOf()?e:a},Boolean.prototype.toHtml=function(e,a){return $(this.valueOf()?e:a).html()},String.prototype.padStr=function(e,a,t){for(var n="",s=0;e>s;s++)n+=a;return(0===t||2===t?n:"")+this+(1===t||2===t?n:"")},spa.lastSplitResult=[],spa.getOnSplit=function(e,a,t){return spa.lastSplitResult=e.split(a),spa.getOnLastSplit(t)},spa.getOnLastSplit=function(e){return 0>e?_.last(spa.lastSplitResult):spa.lastSplitResult[e]},spa.isBlank=spa.isEmpty=function(e){var a=!0;if("undefined"!=typeof e&&null!==e)switch(!0){case _.isString(e):a=0==e.trimStr().length;break;case _.isArray(e):case _.isObject(e):a=_.isEmpty(e);break;default:a=0==(""+e).trimStr().length}return a},spa.isNumber=function(e){return 0==(""+e).replace(/[0-9.]/g,"").trimStr().length},spa.toBoolean=function(e){var a=!0;switch((""+e).trimStr().toLowerCase()){case"":case"0":case"-0":case"nan":case"null":case"false":case"undefined":a=!1}return a},spa.toInt=function(e){return e=(""+e).replace(/[^+-0123456789.]/g,""),e=spa.isBlank(e)?"0":e.indexOf(".")>=0?e.substring(0,e.indexOf(".")):e,parseInt(1*e,10)},spa.toFloat=function(e){return e=(""+e).replace(/[^+-0123456789.]/g,""),e=spa.isBlank(e)?"0":e,parseFloat(1*e)},spa.toString=function(e){spa.console.warn("spa.toString is deprecated. use spa.toStr instead.");var a=""+e;return _.isObject(e)&&(a=JSON.stringify(e)),a},spa.toStr=function(e){var a=""+e;return _.isObject(e)&&(a=JSON.stringify(e)),a},spa.dotToX=function(e,a){return e.replace(/\./g,a)},spa.dotToCamelCase=function(e){var a=e.replace(/\./g," ").toProperCase().replace(/ /g,"");return a[0].toLowerCase()+a.substring(1)},spa.dotToTitleCase=function(e){return e.replace(/\./g," ").toProperCase().replace(/ /g,"")},spa.toDottedPath=function(e){return(e||"").replace(/]/g,"").replace(/(\[)|(\\)|(\/)/g,".").replace(/(\.+)/g,".").trimStr("\\.")},spa.ifBlank=spa.ifEmpty=spa.ifNull=function(e,a,t){return a=(""+(a||"")).trimStr(),t="undefined"==typeof t?(""+e).trimStr():t,spa.isBlank(e)?a:t},spa.now=function(){return""+(new Date).getTime()},spa.year=function(e){return e=e||0,(new Date).getFullYear()+spa.toInt(e)},spa.range=function(e){var a=e.toUpperCase().split(".."),t=""+a[0],n=""+a[1],s="1";n.indexOf(":")>0&&(n=""+a[1].split(":")[0],s=""+a[1].split(":")[1]),t.indexOf("Y")>=0&&(t=spa.year(t.split(/[^0-9+-]/)[1])),n.indexOf("Y")>=0&&(n=spa.year(n.split(/[^0-9+-]/)[1]));var o=spa.toInt(t),r=spa.toInt(n),i=spa.toInt(s);return t>n?_.range(r,o+1,i).reverse():_.range(o,r+1,i)},spa.checkAndPreventKey=function(e,a){a||(a="");var t=a.indexOf("+shift")>=0,n=""+e.keyCode,s=a.padStr(1,",",2).indexOf(n.padStr(1,",",2))>=0&&(t?!!e.shiftKey:!e.shiftKey);return s&&(e.preventDefault(),spa.console.info("Key ["+n+(t?"+Shift":"")+"] has been disabled in this element.")),s},spa._trackAndControlKey=function(e){var a=e.currentTarget,t=$(a),n=(""+t.data("disableKeys")).toLowerCase();spa.checkAndPreventKey(e,n);var s=!spa.isBlank((""+t.data("focusNext")).replace(/undefined/,"").toLowerCase()),o=!spa.isBlank((""+t.data("focusBack")).replace(/undefined/,"").toLowerCase());s&&spa.checkAndPreventKey(e,"9")&&$(t.data("focusNext")).get(0).focus(),o&&spa.checkAndPreventKey(e,"9,+shift")&&$(t.data("focusBack")).get(0).focus()},spa.initKeyTracking=function(){var e=arguments.length?arguments[0]:"[data-disable-keys],[data-focus-next],[data-focus-back]";spa.console.info("Finding Key-Tracking for element(s): "+e),$(e).each(function(e,a){$(a).keydown(spa._trackAndControlKey),spa.console.info("SPA is tracking keys on element:"),spa.console.info(a)})},spa.getDocObj=function(e){var a="object"==typeof e?e:(e.beginsWithStr("#")?"":"#")+e;return $(a).get(0)},spa.getDocObjs=function(e){var a=(e.beginsWithStr("#")?"":"#")+e;return $(a).get()},spa.setFocus=function(e,a){var t=spa.getDocObj(e);t&&(t.focus(),a&&t.select())},spa.isElementExist=function(e){return!$.isEmptyObject($(e).get())},spa.swapClass=spa.swapObjClass=function(e,a,t){$(e).removeClass(a),$(e).addClass(t)},spa.docObjValue=function(e,a){var t=spa.getDocObj(e),n="";return t&&(n=t.value,2===arguments.length&&(t.value=a)),n},spa.optionSelectedIndex=function(e,a){var t=-1,n=spa.getDocObj(e);return n&&(t=n.selectedIndex,2===arguments.length&&(n.selectedIndex=a)),t},spa.optionIndexOfValue=function(e,a){var t=-1,n=spa.getDocObj(e);if(n)for(var s=0;s<n.length;s++)if((""+a).equalsIgnoreCase(n.options[s].value)){t=s;break}return t},spa.optionIndexOfText=function(e,a){var t=-1,n=spa.getDocObj(e);if(n)for(var s=0;s<n.length;s++)if(a.equalsIgnoreCase(n.options[s].text)){t=s;break}return t},spa.optionIndexOfValueBeginsWith=function(e,a){var t=-1,n=spa.getDocObj(e);if(n)for(var s=0;s<n.length;s++)if(n.options[s].value.beginsWithStrIgnoreCase(a)){t=s;break}return t},spa.optionsSelectedValues=function(e,a){return e=(e.beginsWithStr("#")?"":"#")+e,a=a||",",$.map($(e+" option:selected"),function(e){return e.value}).join(a)},spa.optionsSelectedTexts=function(e,a){return e=(e.beginsWithStr("#")?"":"#")+e,a=a||",",$.map($(e+" option:selected"),function(e){return e.text}).join(a)},spa.optionValueOfIndex=function(e,a){var t="",n=spa.getDocObj(e);return n&&a>=0&&a<n.length&&(t=n.options[a].value),t},spa.optionTextOfIndex=function(e,a){var t="",n=spa.getDocObj(e);return n&&a>=0&&a<n.length&&(t=n.options[a].text),t},spa.selectOptionForValue=function(e,a){var t=-1,n=spa.getDocObj(e);return n&&(t=spa.optionIndexOfValue(e,a),n.selectedIndex=t),t},spa.selectOptionForValueBeginsWith=function(e,a){var t=-1,n=spa.getDocObj(e);return n&&(t=spa.optionIndexOfValueBeginsWith(e,a),n.selectedIndex=t),t},spa.selectOptionsForValues=function(e,a,t){t=t||",",a=(t+a+t).toLowerCase();var n,s=spa.getDocObj(e);if(s)for(var o=0;o<s.length;o++)n=(t+s.options[o].value+t).toLowerCase(),s.options[o].selected=a.indexOf(n)>=0},spa.selectOptionForText=function(e,a){var t=-1,n=spa.getDocObj(e);return n&&(t=spa.optionIndexOfText(e,a),n.selectedIndex=t),t},spa.selectOptionsAll=function(e){var a=spa.getDocObj(e);if(a)for(var t=0;t<a.length;t++)a.options[t].selected=!0},spa.selectOptionsNone=function(e){var a=spa.getDocObj(e);if(a)for(var t=0;t<a.length;t++)a.options[t].selected=!1},spa.optionsReduceToLength=function(e,a){a=a||0;var t=spa.getDocObj(e);t&&(spa.selectOptionsNone(e),t.length=a)},spa.optionsRemoveAll=function(e){spa.optionsReduceToLength(e,0)},spa.optionRemoveForIndex=function(e,a){e=(e.beginsWithStr("#")?"":"#")+e;var t=spa.getDocObj(e);t&&((""+a).equalsIgnoreCase("first")&&(a=0),(""+a).equalsIgnoreCase("last")&&(a=t.length-1),t.remove(a))},spa.optionRemoveForValue=function(e,a){spa.optionRemoveForIndex(e,spa.optionIndexOfValue(e,a))},spa.optionRemoveForText=function(e,a){spa.optionRemoveForIndex(e,spa.optionIndexOfText(e,a))},spa.optionRemoveForValueBeginsWith=function(e,a){spa.optionRemoveForIndex(e,spa.optionIndexOfValueBeginsWith(e,a))},spa.optionAppend=function(e,a,t,n){var s=-1,o=spa.getDocObj(e);if(o)if("undefined"==typeof n){var r=o.length;o.length=r+1,o.options[r].value=a,o.options[r].text=t,s=r}else $(o).find("option").eq(n).before('<option value="'+a+'">'+t+"</option>"),s=n;return s},spa.optionsLoad=function(e,a,t,n){var s=["","key","value"];if(t=t||0,n=n||0,_.isString(a)&&a.indexOf("..")>0&&(a=spa.range(a)),t>=0&&spa.optionsReduceToLength(e,t),_.isArray(a))_.each(a,function(a){spa.optionAppend(e,a,a)});else if(n>0){var o=[];for(var r in a)o.push({key:r,value:a[r]});var i=_.sortBy(o,s[n]);_.each(i,function(a){spa.optionAppend(e,a.key,a.value)})}else _.each(a,function(a,t){spa.optionAppend(e,t,a)})},spa.checkedState=function(e,a){var t=!1,n=spa.getDocObj(e);return n&&(t=n.checked,2===arguments.length&&(n.checked=a)),t},spa.isChecked=function(e,a){return $("input[name="+a+"]:checked",e).length>0},spa.radioSelectedValue=function(e,a){var t=$("input[name="+a+"]:checked",e).val();return t?t:""},spa.radioClearSelection=function(e,a){$("input[name="+a+"]:checked",e).attr("checked",!1)},spa.radioSelectForValue=function(e,a,t){$("input[name="+a+"]:radio",e).each(function(e){e.checked=e.value.equalsIgnoreCase(t)})},spa.checkboxCheckedValues=function(e,a,t){return t=t||",",$("input[name="+a+"]:checked",e).map(function(){return this.value}).get().join(t)},spa.sleep=function(e){var a=new Date;for(a.setTime(a.getTime()+1e3*e);(new Date).getTime()<a.getTime(););},spa.filterJSON=function(e,a){return $(e).filter(function(e,t){for(var n in a)if(!t[n].toString().match(a[n]))return null;return t})},spa.randomPassword=function(e){for(var a="9a8b77C8D9E8F7G6H5I4J3c6d5e4f32L3M4N5P6Qg2h3i4j5kV6W5X4Y3Z26m7n8p9q8r7s6t5u4v3w2x3y4z5A6BK7R8S9T8U7",t="",n=0;e>n;n++){var s=Math.floor(Math.random()*a.length);t+=a.charAt(s)}return t},spa.rand=function(e,a){return Math.floor(Math.random()*(a-e+1))+e},spa.htmlEncode=function(e){return $("<div/>").text(e).html()},spa.htmlDecode=function(e){return $("<div/>").html(e).text()},spa.parseKeyStr=function(e,a){return(a?e.toLowerCase():e).replace(/[^_0-9A-Za-z]/g,"")},spa.setObjProperty=function(e,a,t,n){a=""+a,n=n||!1;var s,o=e,r=a.split(/(?=[A-Z])/),i=$.trim(a.replace(/[0-9A-Za-z]/g,""));for(i&&""!=i&&(r=a.split(i[0]));r.length>1;)s=spa.parseKeyStr(r.shift(),n),""!=$.trim(s)&&("undefined"==typeof o[s]&&(o[s]={}),o=o[s]);return s=spa.parseKeyStr(r.shift(),n),o[s]=t,e},spa.getElValue=function(e){e=$(e).get(0);var a,t;switch(e.tagName.toUpperCase()){case"INPUT":switch(e.type.toLowerCase()){case"checkbox":t=$(e).data("unchecked"),a=e.checked?e.value:"undefined"==typeof t?"":t;break;case"radio":a=e.checked?e.value:"";break;default:a=$(e).val()}break;case"SELECT":a=$.map($(e).find("option:selected"),function(e){return e.value}).join(",");break;case"TEXTAREA":a=$(e).val();break;default:a=$(e).html()}return a},spa.serializeDisabled=function(e){var a="";return $(e).find("[disabled][name]").each(function(){a+=(a?"&":"")+$(this).attr("name")+"="+spa.getElValue(this)}),a},spa.serializeForms=function(e,a){var t,n,s=$(e).serialize();return $(e).find("input:checkbox:enabled:not(:checked)[name]").each(function(){n=$(this).data("unchecked"),s+=(s?"&":"")+$(this).attr("name")+"="+("undefined"==typeof n?"":n)}),a&&(t=spa.serializeDisabled(e),s+=(s&&t?"&":"")+t),s},spa.queryStringToJson=function(e){var a={},t=e||location.search,n=(""+t).indexOf("?"),s=(""+t).indexOf("&");return t&&t.length>0&&n>=0&&(0==n||s>n)&&(t=t.substring(n+1)),_.each(t.split("&"),function(e){e=e.split("="),e[0]&&(_.has(a,e[0])?(_.isArray(a[e[0]])||(a[e[0]]=[a[e[0]]]),a[e[0]].push(decodeURIComponent(e[1]||""))):a[e[0]]=decodeURIComponent(e[1]||""))}),a},$.fn.serializeUncheckedCheckboxes=function(e){var a,t,n,s,o="object"==typeof e,r=o?e:{},i=o&&!e?"":e;return $(this).find("input:checkbox:enabled:not(:checked)[name]").each(function(e,p){a=$(p),n=a.attr("name"),t=a.data("unchecked"),s="undefined"==typeof t?"":t,o?_.has(r,n)?(_.isArray(r[n])||(r[n]=[r[n]]),r[n].push(s)):r[n]=s:i+=(i?"&":"")+n+"="+s}),o?r:i},spa.serializeUncheckedCheckboxes=function(e,a){return $(e).serializeUncheckedCheckboxes(a)},$.fn.serializeFormToJSON=$.fn.serializeFormToObject=function(e,a,t){var n,s,o=this.serializeArray(),r="object"==typeof e?e:{},i="boolean"==typeof e?e:a||!1,p=$(this).data("serializeIgnorePrefix");return t&&(p=t),$.each(o,function(){n=p?this.name.replace(p,""):this.name,r=spa.setObjProperty(r,n,this.value,i)}),$(this).find("input:checkbox:enabled:not(:checked)").each(function(){n=$(this).attr("name"),n&&(s=$(this).data("unchecked"),p&&(n=n.replace(p,"")),s=""+("undefined"==typeof s?"":s),r=spa.setObjProperty(r,n,s,i))}),r},$.fn.serializeFormToSimpleJSON=$.fn.serializeFormToSimpleObject=function(e,a){var t,n,s,o,r=this.serializeArray(),i="object"==typeof e?e:{},p="boolean"==typeof e?e:a||!1;return $.each(r,function(){i[this.name]=this.value}),p&&$(this).find("[disabled][name]").each(function(){i[this.name]=spa.getElValue(this)}),$(this).find("input:checkbox:enabled:not(:checked)[name]").each(function(){s=$(this).attr("name"),o=$(this).data("unchecked"),o=""+("undefined"==typeof o?"":o),i[s]=o}),$(this).find("[data-to-json-group][name]").each(function(){t=this.name,n=$(this).data("toJsonGroup"),n&&(i[n]||(i[n]={}),i[n][t]=spa.getElValue(this))}),i},spa.serializeFormToSimpleJSON=spa.serializeFormToSimpleObject=function(e,a,t){return $(e).serializeFormToSimpleJSON(a,t)},spa.serializeFormToJSON=spa.serializeFormToObject=function(e,a,t,n){return $(e).serializeFormToJSON(a,t,n)},spa.find=spa.locate=function(obj,path){var tObj=obj,retValue;return"undefined"!=typeof eval("tObj."+path)&&(retValue=eval("tObj."+path)),retValue},spa.findSafe=spa.locateSafe=spa.valueOfKeyPath=function(e,a,t){for(var n=0,s=spa.toDottedPath(a).split("."),o=s.length;o>n;n++){if(!e||"undefined"==typeof e)return t;e=e[s[n]]}return"undefined"==typeof e?t:e},spa.has=spa.hasKey=function(obj,path){var tObj=obj,retValue=!1;try{retValue="undefined"!=typeof eval("tObj."+path)}catch(e){spa.console.error("Key["+path+"] error in object.\n"+e.stack)}return retValue},spa.hasIgnoreCase=spa.hasKeyIgnoreCase=function(e,a){var t="",n=e||{},s=""+spa.toDottedPath(a),o=spa.keysDottedAll(n);return o&&!_.isEmpty(o)&&(spa.console.debug(o),_.some(o,function(e){var a=e.equalsIgnoreCase(s);return a||(a=e.beginsWithStrIgnoreCase(s+"."),a&&(e=e.slice(0,e.lastIndexOf(".")))),a&&(t=e),a})),t},spa.findIgnoreCase=function(e,a,t){var n=t,s=spa.hasIgnoreCase(e,a);return s&&(n=spa.findSafe(e,s,t)),n},spa.keysDottedAll=function(e){var a=spa.keysDotted(e);return a&&!_.isEmpty(a)&&(a=spa.toDottedPath(a.join(",")).split(",")),a},spa.keysDotted=function(e){e=e||{};var a,t,n,s=[];return function(e,o){if(o=o||"","object"!=typeof e)return!0;for(var r in e)n=o.substring(1),a=spa.isNumber(r)?"[":".",t=n&&"["==a?"]":"",arguments.callee(e[r],o+a+r+t)&&s.push(n+(n?a:"")+r+t);return!1}(e),s},spa.keysCamelCase=function(e){return _.map(spa.keysDotted(e),function(e){var a=e.replace(/\./g," ").toProperCase().replace(/ /g,"");return a[0].toLowerCase()+a.substring(1)})},spa.keysTitleCase=function(e){return _.map(spa.keysDotted(e),function(e){return e.replace(/\./g," ").toProperCase().replace(/ /g,"")})},spa.keys_=function(e){return _.map(spa.keysDotted(e),function(e){return e.replace(/\./g,"_")})},$.cachedScript=function(e,a){return a=$.extend(a||{},{dataType:"script",cache:!0,url:e}),spa.console.info("$.cachedScript('"+e+"')"),$.ajax(a)},$.cachedStyle=function(e,a,t){return t=$.extend(t||{},{dataType:"text",cache:!0,url:a,success:function(a){$("head").append("<style id='"+e+"' type='text/css'>"+a+"</style>")}}),spa.console.info("$.cachedScript('"+a+"')"),$.ajax(t)},spa.addScript=function(e,a){e=e.replace(/#/,""),spa.console.group("spaAddScript"),spa.isElementExist("#spaScriptsCotainer")||(spa.console.info("#spaScriptsCotainer NOT Found! Creating one..."),$("body").append("<div id='spaScriptsCotainer' style='display:none' rel='Dynamic Scripts Container'></div>")),spa.isElementExist("#"+e)?spa.console.info("script ["+e+"] already found in local."):(spa.console.info("script ["+e+"] NOT found. Added script tag with src ["+a+"]"),$("#spaScriptsCotainer").append("<script id='"+e+"' type='text/javascript' src='"+a+"'></script>")),spa.console.groupEnd("spaAddScript")},spa.addStyle=function(e,a){e=e.replace(/#/,""),spa.console.group("spaAddStyle"),spa.isElementExist("#spaStylesCotainer")||(spa.console.info("#spaStylesCotainer NOT Found! Creating one..."),$("body").append("<div id='spaStylesCotainer' style='display:none' rel='Dynamic Styles Container'></div>")),spa.isElementExist("#"+e)?spa.console.info("style ["+e+"] already found in local."):(spa.console.info("style ["+e+"] NOT found. Added link tag with href ["+a+"]"),$("#spaStylesCotainer").append("<link id='"+e+"' rel='stylesheet' type='text/css' href='"+a+"'/>")),spa.console.groupEnd("spaAddStyle")},spa.loadScript=function(e,a,t,n){return e=e.replace(/#/,""),t=t||!1,n=n||[],spa.console.group("spaScriptsLoad"),spa.isBlank(a)?spa.console.error("script path ["+a+"] for ["+e+"] NOT defined."):t?spa.addScript(e,a):n.push($.cachedScript(a).done(function(t,n){spa.console.info("Loaded script ["+e+"] from ["+a+"]. STATUS: "+n)})),spa.console.groupEnd("spaScriptsLoad"),n},spa.loadStyle=function(e,a,t,n){return e=e.replace(/#/,""),t=t||!1,n=n||[],spa.console.group("spaStylesLoad"),spa.isBlank(a)?spa.console.error("style path ["+a+"] for ["+e+"] NOT defined."):t?spa.addStyle(e,a):n.push($.cachedStyle(e,a).done(function(t,n){spa.console.info("Loaded style ["+e+"] from ["+a+"]. STATUS: "+n)})),spa.console.groupEnd("spaStylesLoad"),n},spa.addTemplateScript=function(e,a,t){e=e.replace(/#/,""),spa.isElementExist("#spaViewTemplateCotainer")||(spa.console.info("#spaViewTemplateCotainer NOT Found! Creating one..."),$("body").append("<div id='spaViewTemplateCotainer' style='display:none' rel='Template Container'></div>")),spa.console.info("Adding <script id='"+e+"' type='text/"+t+"'>"),a=a.replace(/<( )*script/gi,"<_SCRIPTTAGINTEMPLATE_").replace(/<( )*(\/)( )*script/gi,"</_SCRIPTTAGINTEMPLATE_").replace(/<( )*link/gi,"<_LINKTAGINTEMPLATE_").replace(/<( )*(\/)( )*link/gi,"</_LINKTAGINTEMPLATE_"),$("#spaViewTemplateCotainer").append("<script id='"+e+"' type='text/"+t+"'>"+a+"</script>")},spa.loadTemplate=function(e,a,t,n,s,o){if(e=e.replace(/#/g,""),a=a.ifBlankStr("inline").trimStr(),t=t||"x-template",n=n||"#DummyInlineTemplateContainer",s=s||[],spa.console.group("spaTemplateAjaxQue"),spa.isElementExist("#"+e)){var r=$("#"+e);if(o)spa.console.warn("Reload Template["+e+"] of ["+t+"]"),r.remove(),s=spa.loadTemplate(e,a,t,n,s,o);else if(spa.isBlank(r.html())){spa.console.warn("Template["+e+"] of ["+t+"] script found EMPTY!");var i=""+r.attr("path");spa.isBlank(i)||(t=(r.attr("type")||"").ifBlankStr(t).toLowerCase().replace(/text\//gi,""),spa.console.info("prepare/remove to re-load Template["+e+"]  of ["+t+"] from external path: ["+i+"]"),r.remove(),s=spa.loadTemplate(e,i,t,n,s,o))}else spa.console.info("Template["+e+"]  of ["+t+"] already found in local.")}else if(spa.console.info("Template["+e+"] of ["+t+"] NOT found. Source ["+a+"]"),a.equalsIgnoreCase("inline")||a.beginsWithStr("#")){var p=a.equalsIgnoreCase("inline")?n:a,l=$(p),c=l.html();spa.isBlank(c)?spa.console.error("Template["+e+"] of ["+t+"] NOT defined inline in ["+p+"]."):(spa.addTemplateScript(e,c,t),a.equalsIgnoreCase("inline")&&l.html(""))}else if(a.equalsIgnoreCase("none"))spa.console.warn("Template["+e+"] of ["+t+"] defined as NONE. Ignoring template.");else if(a.equalsIgnoreCase("script"))spa.console.error("Template["+e+"] of ["+t+"] NOT defined in <script>.");else{var d;o?(spa.console.warn(">>>>>>>>>> Making New Template Request"),d=$.ajax({url:a,cache:!1,dataType:"html",success:function(n){spa.addTemplateScript(e,n,t),spa.console.info("Loaded Template["+e+"] of ["+t+"] from ["+a+"]")},error:function(n,s,o){spa.console.error("Failed Loading Template["+e+"] of ["+t+"] from ["+a+"]. ["+s+":"+o+"]")}})):d=$.get(a,function(n){spa.addTemplateScript(e,n,t),spa.console.info("Loaded Template["+e+"] of ["+t+"] from ["+a+"]")},"html"),s.push(d)}return spa.console.groupEnd("spaTemplateAjaxQue"),s},spa.loadTemplatesCollection=function(e,a){e=(e.beginsWithStr("#")?"":"#")+e;var t={};return spa.isElementExist(e)?spa.console.info(e+" Found! skip template collection load from "+a):(spa.console.info(e+" NOT Found! Creating one..."),spa.isElementExist("#spaViewTemplateCotainer")||(spa.console.info("#spaViewTemplateCotainer NOT Found! Creating one..."),$("body").append("<div id='spaViewTemplateCotainer' style='display:none' rel='Template Container'></div>")),$("#spaViewTemplateCotainer").append("<div id='"+e.substring(1)+"' style='display:none' rel='Template Collection Container'></div>"),$.ajax({url:a,cache:!0,dataType:"html",async:!1,success:function(n){$(e).html(n),spa.console.info("Loaded Template Collection ["+e+"] from ["+a+"]"),spa.console.info("Found following templates in Template Collection."),$(e+" script").each(function(e,a){t[$(a).attr("id")]="script"}),spa.console.info({o:t})},error:function(t,n,s){spa.console.error("Failed Loading Template Collection ["+e+"] from ["+a+"]. ["+n+":"+s+"]")}})),t},spa.urlParams=function(e){e=e||window.location.search||"",e=e.beginsWithStr("\\?")||e.indexOf("//")<7?e.substr(e.indexOf("?")+1):e;var a={};return e.replace(/([^&=]+)=?([^&]*)(?:&+|$)/g,function(e,t,n){(a[t]=a[t]||[]).push(decodeURIComponent(n))}),_.each(a,function(e,t){a[t]=_.isArray(e)&&1==e.length?e[0]:e}),a},spa.urlParam=function(e,a){return spa.urlParams(a)[e]},spa.getLocHash=function(){return window.location.hash||""},spa.urlHash=function(e,a){var t=(spa.getLocHash()||"#").substring(1);if(e){a=a||"/",t=t.beginsWithStr(a)?t.substring(t.indexOf(a)+a.length):t;var n=t.split(a);_.isNumber(e)?t=n&&n.length>e?n[e]:"":_.isArray(e)?t=0===e.length?n:_.object(e,n):_.isString(e)&&"?"==e&&(t=t.containsStr("\\?")?spa.getOnSplit(t,"?",1):"")}return t},spa.hashParam=function(e){var a=""+spa.urlHash("?");return"undefined"==typeof e||spa.isBlank(a)||(a=spa.urlParam(""+e,a)),a},spa.routeMatch=function(e,a){var t=new RegExp(":[a-zA-Z0-9\\_\\-]+","g"),n=new RegExp(e.replace(t,"([\\w\\+\\-\\|\\.\\?]+)")),s=e.match(t),o=a.match(n),r=o&&!_.isEmpty(o)?o.shift():"",i=s&&!_.isEmpty(s)?s.join(",").replace(/:/g,"").split(","):[],o=o&&!_.isEmpty(o)?o.join(",").replace(/\?/g,"").split(","):[],p=void 0;return r&&(p={hkeys:s,params:_.zipObject(i,o)}),p},spa.i18n={},spa.i18n.loaded=!1,spa.i18n.settings={name:"Language",path:"language/",encoding:"UTF-8",cache:!0,mode:"map",callback:null},spa.i18n.setLanguage=function(e,a){$.i18n&&(e=e||$.i18n.browserLang().replace(/-/g,"_"),a=$.extend(spa.i18n.settings,a),$.i18n.properties({name:a.name,language:e,path:a.path,encoding:a.encoding,cache:a.cache,mode:a.mode,callback:function(){$.i18n.loaded="undefined"==typeof $.i18n.loaded?!$.isEmptyObject($.i18n.map):$.i18n.loaded,spa.i18n.loaded=spa.i18n.loaded||$.i18n.loaded,e.length>1&&!$.i18n.loaded&&(spa.console.warn("Error Loading Language File ["+e+"]. Loading default."),spa.i18n.setLanguage("_",a)),spa.i18n.apply(),a.callback&&a.callback($.i18n.loaded)}}))},spa.i18n.text=function(e,a){var t=$.i18n.prop(e);if(a){var n="";_.each(_.keys(a),function(e){n=""+a[e],n&&n.beginsWithStrIgnoreCase("i18n:")&&(n=$.i18n.prop(n.replace(/i18n:/gi,""))),t=t.replace(new RegExp("{"+e+"}","gi"),n)})}return t},spa.i18n.apply=spa.i18n.render=function(e,a){spa.i18n.loaded&&(e=e||"body",a=a||"",$(a+"[data-i18n]",e).each(function(e,a){var t=spa.toJSON($(a).data("i18n")||"{}"),n=t.i18ndata;n&&delete t.i18ndata,t&&!$.isEmptyObject(t)&&_.each(_.keys(t),function(e){var s=t[e],o=spa.i18n.text(s,n);_.each(e.split("_"),function(e){switch(e.toLowerCase()){case"html":$(a).html(o);break;case"text":$(a).text(o);break;default:$(a).attr(e,o)}})})}))},spa.extendBackbone=function(){window.Backbone?(spa.console.info("Found Backbone. Extending ..."),_.extend(Backbone.Model.prototype,Backbone.Events,{activeCRUD:"",diffAttributes:function(e){return window.jsondiffpatch?jsondiffpatch.diff(this.previousAttributes(),this.toJSON(),e):this.changedAttributes()},sync:function(){return this.activeCRUD=arguments[0],Backbone.sync.apply(this,arguments)},url:function(){var e,a,t,n,s,o=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();if(o)for(n="object"==typeof o?o:{defaulturl:o},n.patch=n.patch||n.update,e=_.result(n,this.activeCRUD.toLowerCase()+"url")||_.result(n,"defaulturl")||urlError(),a=e.replace(/\{crud\}/gi,this.activeCRUD.toUpperCase()).replace(/\{now\}/gi,spa.now())+(this.isNew()||e.indexOf("?")>0?"":("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id));(t=a.match(/{([\s\S]*?)}/g))&&t&&t[0];)s=t[0].replace(/[{}]/g,""),a=a.replace(new RegExp(t[0],"g"),(s.indexOf(".")>=0?spa.find(this.toJSON(),s):this.get(s))||"");return spa.console.info("Backbone Sync Url: "+a),a}})):spa.console.warn("Backbone not found. NOT extending...")},spa.loadBackboneModelClass=function(e,a){a||(a={});var t={url:e,bbclass:Backbone.Model.extend({defaults:{}}),success:!1};return $.ajax({url:t.url,dataType:"text",async:!1,success:function(e){e=e.substring(e.indexOf("{")),t.bbclass=Backbone.Model.extend(spa.toJSON(e)),t.success=!0,a.success&&a.success(e)},error:function(e,n,s){spa.console.error("Failed loading backbone class from ["+t.url+"]. ["+n+":"+s+"]"),a.fail&&a.fail(t.url,e,n,s)}}),t},spa.getModifiedElement=function(e){var a,t=void 0,n=$(e||"form:not([data-ignore-change]) :input:not(:disabled,:button,[data-ignore-change])");return _.every(n,function(e){return a||(e.tagName.match(/^(select|textarea)$/i)&&e.value!=e.defaultValue?a=!0:e.tagName.match(/^input$/i)&&(e.type.match(/^(checkbox|radio)$/i)&&e.checked!=e.defaultChecked?a=!0:e.type.match(/^(text|password|hidden|color|email|month|number|tel|time|url|range|date|datetime|datetime-local)$/i)&&e.value!=e.defaultValue&&(a=!0)),a&&(t=e)),!a}),t},spa.getModifiedElements=function(e){var a,t=[],n=$(e||"form:not([data-ignore-change]) :input:not(:disabled,:button,[data-ignore-change])");return n.each(function(e,n){a=!1,n.tagName.match(/^(select|textarea)$/i)&&n.value!=n.defaultValue?a=!0:n.tagName.match(/^input$/i)&&(n.type.match(/^(checkbox|radio)$/i)&&n.checked!=n.defaultChecked?a=!0:n.type.match(/^(text|password|hidden|color|email|month|number|tel|time|url|range|date|datetime|datetime-local)$/i)&&n.value!=n.defaultValue&&(a=!0)),a&&t.push(n)}),t},spa.initTrackElValueChanges=spa.resetElementsDefaultValue=function(e){$(e||"form :input:not(:disabled)").each(function(e,a){a.defaultValue=a.value,a.tagName.match(/^input$/i)&&a.type.match(/^(checkbox|radio)$/i)&&a.checked!=a.defaultChecked&&(a.defaultChecked=a.checked)})},spa.trash={container:[],push:function(e){this.container.push(e)},empty:function(){this.container=[]},pick:function(e){return e?this.container[e]:this.container}},spa.fillData=function(e,a,t){var n="object"==typeof e;a&&"object"==typeof a&&(t=a,a=null),a=a||"body";var s={dataParams:{},dataCache:!1,keyFormat:"aBc",selectPattern:"[name='?']",formatterCommon:null,formatterOnKeys:null,resetElDefault:!0,resetElDefaultInContext:!0,keysMap:{}};if($.extend(s,t),n||$.ajax({url:e,data:s.dataParams,cache:s.dataCache,dataType:"text",async:!1,success:function(a){e=spa.toJSON(a),n="object"==typeof e},error:function(a,t,n){spa.console.error("Failed loading data from ["+e+"]. ["+t+":"+n+"]")}}),n){var o=s.keyFormat;o=null!=o.match(/^[a-z]/)?"aBc":o,o=null!=o.match(/^[A-Z]/)?"AbC":o;var r=spa.keysDotted(e);spa.console.group("fillData"),spa.console.info(r),_.each(r,function(t){spa.console.group(">>"+t);var n=""+(t.replace(/[\[\]]/g,"_")||""),r=t.replace(/\[[0-9]+\]/g,""),i=/\[[0-9]+\]/.test(t);switch(o){case"_":n=spa.dotToX(n,"_"),r=spa.dotToX(r,"_");break;case"AbC":n=spa.dotToTitleCase(n),r=spa.dotToTitleCase(r);break;default:n=spa.dotToCamelCase(n),r=spa.dotToCamelCase(r)}var p={patternKey:n+(i?" || "+r:""),formatterKey:r,isArrayChild:i};spa.trash.push(p),spa.console.info(p),spa.trash.empty();var l=s.selectPattern.replace(/\?/g,n);(s.keysMap[n]||s.keysMap[r])&&(s.keysMap[n]=s.keysMap[n]||{},
s.keysMap[r]=s.keysMap[r]||{},s.keysMap[n].pattern=s.keysMap[n].pattern||s.keysMap[r].pattern,s.keysMap[n].pattern&&(l=s.keysMap[n].pattern.replace(/\?/g,n)),s.keysMap[r].formatter&&(s.formatterOnKeys=s.formatterOnKeys||{},s.formatterOnKeys[r]=s.keysMap[r].formatter)),spa.console.info(">> "+l+" found: "+$(l,a).length);var c=null;$(l,a).length>0&&(c=spa.find(e,t),!s.formatterOnKeys&&s.formatterCommon&&(c=s.formatterCommon(c,t,e)),s.formatterOnKeys&&(s.formatterOnKeys[r]?c=s.formatterOnKeys[r](c,t,e):s.formatterCommon&&(c=s.formatterCommon(c,t,e))),spa.console.info({value:c})),$(l,a).each(function(e,a){switch(spa.console.info(a),a.tagName.toUpperCase()){case"INPUT":switch(a.type.toLowerCase()){case"text":case"password":case"hidden":case"color":case"date":case"datetime":case"datetime-local":case"email":case"month":case"number":case"search":case"tel":case"time":case"url":case"range":case"button":case"submit":case"reset":$(a).val(c),!s.resetElDefaultInContext&&s.resetElDefault&&(a.defaultValue=a.value);break;case"checkbox":case"radio":a.checked=a.value.equalsIgnoreCase(c),!s.resetElDefaultInContext&&s.resetElDefault&&(a.defaultChecked=a.checked)}break;case"SELECT":spa.selectOptionForValue(a,c),!s.resetElDefaultInContext&&s.resetElDefault&&(a.defaultValue=a.value);break;case"TEXTAREA":$(a).val(c),!s.resetElDefaultInContext&&s.resetElDefault&&(a.defaultValue=a.value);break;default:$(a).html(c)}}),spa.console.groupEnd(">>"+t)}),spa.console.groupEnd("fillData"),s.resetElDefaultInContext&&spa.resetElementsDefaultValue(a+" :input")}},spa.toRenderDataStructure=function(e,a){var t={},n={},s={},o={};switch(a&&(o=_.isString(a)?spa.queryStringToJson(a):_.isObject(a)?a:{}),!0){case _.isString(e):e.containsStr("\\|")&&(t.dataModel=spa.getOnSplit(e,"|",0),e=spa.getOnLastSplit(1)),t.dataUrl=e,_.isEmpty(o)||(t.dataParams=o);break;case _.isArray(e):n={urls:[]},s={},_.each(e,function(e,a){s={url:e,params:o},e.containsStr("\\|")&&(s.target=spa.getOnSplit(e,"|",0),s.url=spa.getOnLastSplit(1)),n.urls.push(s)});break;case _.isObject(e):n={urls:[]},s={},_.each(_.keys(e),function(a,t){s={name:a,url:e[a],params:o},e[a].containsStr("\\|")&&(s.target=spa.getOnSplit(e[a],"|",0),s.url=spa.getOnLastSplit(1)),n.urls.push(s)})}return _.isEmpty(n.urls)||(t.dataCollection=n),t},spa.viewModels={},spa.renderHistory={},spa.renderHistoryMax=0,spa.defaults={dataTemplateEngine:"handlebars"},spa.render=function(viewContainerId,uOptions){if(arguments.length){if(1===arguments.length&&"object"==typeof viewContainerId)return uOptions=_.merge({},viewContainerId),uOptions.hasOwnProperty("target")?(viewContainerId=uOptions.target,delete uOptions.target):viewContainerId="dynRender_"+spa.now()+"_"+spa.rand(1e3,9999),void spa.render(viewContainerId,uOptions);uOptions&&!function transOptions(e){var a={template:"dataTemplate",templates:"dataTemplates",templateEngine:"dataTemplateEngine",templatesCache:"dataTemplatesCache",templatesCollectionUrl:"dataTemplatesCollectionUrl",scripts:"dataScripts",scriptsCache:"dataScriptsCache",styles:"dataStyles",stylesCache:"dataStylesCache",renderEngine:"dataRenderEngine",renderType:"dataRenderType",dataRenderCallBack:"dataRenderCallback",renderCallback:"dataRenderCallback",renderCallBack:"dataRenderCallback",callback:"dataRenderCallback",callBack:"dataRenderCallback",renderId:"dataRenderId"};_.forEach(a,function(a,t){e.hasOwnProperty(t)&&(e[a]=uOptions[t],delete e[t])})}(uOptions);var retValue={id:"",view:{},model:{},cron:"",elDataAttr:{},target:viewContainerId,iOptions:uOptions},spaAjaxRequestsQue=[],doDeepRender=!1,foundViewContainer=spa.isElementExist(viewContainerId);foundViewContainer&&(retValue.elDataAttr=$(viewContainerId).data());var spaDefaultTemplateConfig={backbone:{engine:"underscore",template:"x-underscore-template"},hogan:{engine:"hogan",template:"x-hogan-template"},unknown:{engine:"unknown",template:"x-unknown-template"}},noOfArgs=arguments.length,useOptions=noOfArgs>1,useParamData=useOptions&&uOptions.hasOwnProperty("data"),dataFound=!0,spaRVOptions={data:{},dataUrl:"",dataUrlErrorHandle:"",dataParams:{},dataModel:"",dataModelType:"",dataCache:!1,dataCollection:{},dataTemplatesCollectionUrl:"",dataTemplates:{},dataTemplateEngine:"",dataTemplate:"",dataTemplatesCache:!0,dataScripts:{},dataScriptsCache:!0,dataStyles:{},dataStylesCache:!0,dataRenderEngine:"",dataRenderCallback:"",dataRenderId:""};if(foundViewContainer||(spa.isElementExist("#spaRunTimeHtmlContainer")||$("body").append("<div id='spaRunTimeHtmlContainer' style='display:none;'></div>"),$("#spaRunTimeHtmlContainer").append("<div id='"+viewContainerId.replace(/\#/gi,"")+"'></div>")),useOptions){var saveOptions=uOptions.hasOwnProperty("saveOptions")&&uOptions.saveOptions;for(var key in uOptions)spaRVOptions[key]=uOptions[key],saveOptions&&"data"!==key&&"saveOptions"!==key&&$(viewContainerId).data(""+(""+(_.at(""+key,4)||"")).toLowerCase()+key.slice(5),spa.toStr(uOptions[key]))}var spaRenderId=(""+$(viewContainerId).data("renderId")).replace(/undefined/,"");spa.isBlank(spaRVOptions.dataRenderId)||(spaRenderId=spaRVOptions.dataRenderId),retValue.id=spaRenderId.ifBlankStr("spaRender"+spa.now()+spa.rand(1e3,9999));var spaRenderEngine=(""+$(viewContainerId).data("renderEngine")).replace(/undefined/,"");spa.isBlank(spaRVOptions.dataRenderEngine)||(spaRenderEngine=spaRVOptions.dataRenderEngine),spaRenderEngine=spaRenderEngine.ifBlankStr("unknown").toLowerCase();var spaRenderEngineKey=spaRenderEngine;spaDefaultTemplateConfig.hasOwnProperty(spaRenderEngineKey)||(spaRenderEngineKey="unknown",spaRenderEngine+="-unknown");var spaTemplateType=spaDefaultTemplateConfig[spaRenderEngineKey].template,spaTemplateEngine=(""+$(viewContainerId).data("templateEngine")).replace(/undefined/,"");switch(spa.isBlank(spaRVOptions.dataTemplateEngine)||(spaTemplateEngine=spaRVOptions.dataTemplateEngine),spa.isBlank(spaTemplateEngine)&&(spaTemplateEngine=spaRenderEngineKey.equalsIgnoreCase("unknown")?spa.defaults.dataTemplateEngine||"handlebars":spaTemplateEngine.ifBlankStr(spaDefaultTemplateConfig[spaRenderEngineKey].engine).toLowerCase()),spaTemplateEngine){case"hogan":"unknown"==spaRenderEngine&&(spaRenderEngineKey=spaRenderEngine=spaTemplateEngine,spaTemplateType=spaDefaultTemplateConfig[spaRenderEngineKey].template)}var spaBackboneModelOption={},spaViewDataModelType=(""+$(viewContainerId).data("modelType")).replace(/undefined/,"");if(spa.isBlank(spaRVOptions.dataModelType)||(spaViewDataModelType=spaRVOptions.dataModelType),spaViewDataModelType.beginsWithStrIgnoreCase("backbone:")&&(spaBackboneModelOption=spa.toJSON(spaViewDataModelType.substring(9)),spaViewDataModelType="backbone",spaRenderEngine.equalsIgnoreCase("unknown")&&(spaRenderEngine="backbone")),spaViewDataModelType=spaViewDataModelType.ifBlankStr().toLowerCase(),spa.console.group("spaLoadingViewScripts"),useOptions&&uOptions.hasOwnProperty("dataScriptsCache"))spa.console.info("Override [data-scripts-cache] with user option [dataScriptsCache]: "+spaRVOptions.dataScriptsCache);else{var scriptsCacheInTagData=(""+$(viewContainerId).data("scriptsCache")).replace(/undefined/,"");spa.isBlank(scriptsCacheInTagData)||(spaRVOptions.dataScriptsCache=scriptsCacheInTagData.toBoolean(),spa.console.info("Override [data-scripts-cache] with [data-scripts-cache] option in tag-attribute: "+spaRVOptions.dataScriptsCache))}var vScriptsList=(""+$(viewContainerId).data("scripts")).replace(/undefined/,"");vScriptsList&&spa.isBlank((vScriptsList||"").replace(/[^:'\"]/g,""))&&(vScriptsList="'"+vScriptsList.split(",").join("','")+"'");var vScripts=spa.toJSON(vScriptsList||"{}");if(!_.isObject(spaRVOptions.dataScripts)&&_.isString(spaRVOptions.dataScripts)&&(vScriptsList=(spaRVOptions.dataScripts||"").trimStr(),spa.isBlank((vScriptsList||"").replace(/[^:'\"]/g,""))&&(vScriptsList="'"+vScriptsList.split(",").join("','")+"'"),spaRVOptions.dataScripts=spa.toJSON(vScriptsList)),$.isEmptyObject(spaRVOptions.dataScripts)||(vScripts=spaRVOptions.dataScripts),_.isArray(vScripts)&&_.remove(vScripts,function(e){return!e}),spa.console.info(vScripts),vScripts&&!$.isEmptyObject(vScripts)){if(_.isArray(vScripts)){spa.console.info("Convert array of script(s) without scriptID to object with scriptID(s).");var newScriptsObj={},dynScriptIDForContainer="__scripts_"+viewContainerId.trimStr("#")+"_";_.each(vScripts,function(e,a){spa.console.log(e),e&&(newScriptsObj[dynScriptIDForContainer+a]=""+e)}),spa.console.info("Scripts(s) with scriptID(s)."),spa.console.log(newScriptsObj),vScripts=_.isEmpty(newScriptsObj)?{}:newScriptsObj}spa.console.info("External scripts to be loaded [cache:"+spaRVOptions.dataScriptsCache+"] along with view container ["+viewContainerId+"] => "+JSON.stringify(vScripts));var vScriptsNames=_.keys(vScripts);spa.console.group("kLoadingScripts"),_.each(vScriptsNames,function(e){spaAjaxRequestsQue=spa.loadScript(e,vScripts[e],spaRVOptions.dataScriptsCache,spaAjaxRequestsQue)}),spa.console.info("External Scripts Loading Status: "+JSON.stringify(spaAjaxRequestsQue)),spa.console.groupEnd("kLoadingScripts")}else spa.console.info("No scripts defined [data-scripts] in view container ["+viewContainerId+"] to load.");spa.console.groupEnd("spaLoadingViewScripts"),$.when.apply($,spaAjaxRequestsQue).then(function(){spa.console.info("External Scripts Loaded.")}).fail(function(){spa.console.error("External Scripts Loading Failed! Unexpected!? Check the Script Path/Network.")}),spa.console.group("spaDataModel");var dataModelName=(""+$(viewContainerId).data("model")).replace(/undefined/,""),viewDataModelName;spa.isBlank(spaRVOptions.dataModel)||(dataModelName=spaRVOptions.dataModel);var dataModelUrl=(""+$(viewContainerId).data("url")).replace(/undefined/,"");spa.isBlank(spaRVOptions.dataUrl)||(dataModelUrl=spaRVOptions.dataUrl);var isLocalDataModel=useParamData||dataModelUrl.beginsWithStrIgnoreCase("local:"),defaultDataModelName=dataModelUrl.beginsWithStrIgnoreCase("local:")?dataModelUrl.replace(/local:/gi,""):"data";dataModelName=dataModelName.ifBlankStr(defaultDataModelName),viewDataModelName=dataModelName.replace(/\./g,"_");var spaTemplateModelData={};if(useParamData)spaTemplateModelData[viewDataModelName]=spaRVOptions.data,spa.console.info("Loaded data model ["+dataModelName+"] from argument");else{if(useOptions&&uOptions.hasOwnProperty("dataCache"))spa.console.info("Override [data-cache] with user option [dataCache]: "+spaRVOptions.dataCache);else{var dataCacheInTagData=(""+$(viewContainerId).data("cache")).replace(/undefined/,"");spa.isBlank(dataCacheInTagData)||(spaRVOptions.dataCache=dataCacheInTagData.toBoolean(),spa.console.info("Override [data-cache] with [data-cache] option in tag-attribute: "+spaRVOptions.dataCache))}if(spa.isBlank(dataModelUrl)){spaTemplateModelData[viewDataModelName]={};var dataModelCollection=(""+$(viewContainerId).data("collection")).replace(/undefined/,"");dataModelCollection&&(dataModelCollection=spa.toJSON(dataModelCollection)),spa.isBlank(spaRVOptions.dataCollection)||(dataModelCollection=spaRVOptions.dataCollection),_.isArray(dataModelCollection)&&(dataModelCollection={urls:dataModelCollection});var dataModelUrls=dataModelCollection.urls;if(spa.isBlank(dataModelUrls))spa.console.warn("Model Data ["+dataModelName+"] or [data-url] or [data-collection] NOT found! Check the arguments or html markup. Rendering with empty data {}.");else if(_.isArray(dataModelUrls)){spa.console.info("Processing data-URLs");var dataIndexApi=0,defaultAutoDataNamePrefix=dataModelCollection.nameprefix||"data";_.each(dataModelUrls,function(dataApi){var defaultApiDataModelName=defaultAutoDataNamePrefix+dataIndexApi,apiDataModelName=_.has(dataApi,"name")?(""+dataApi.name).replace(/[^a-zA-Z0-9]/gi,""):_.has(dataApi,"target")?""+dataApi.target:defaultApiDataModelName,apiDataUrl=_.has(dataApi,"url")?dataApi.url:_.has(dataApi,"path")?dataApi.path:"";apiDataModelName.containsStr(".")&&(apiDataModelName=_.last(apiDataModelName.split("."),1)),apiDataModelName=apiDataModelName.ifBlankStr(defaultApiDataModelName),spa.console.info("processing data-api for: "+apiDataModelName),spa.console.log(dataApi),apiDataUrl?spaAjaxRequestsQue.push($.ajax({url:apiDataUrl,data:_.has(dataApi,"params")?dataApi.params:_.has(dataApi,"data")?dataApi.data:{},cache:_.has(dataApi,"cache")?dataApi.cache:spaRVOptions.dataCache,dataType:"text",success:function(result){var targetApiData,targetDataModelName=_.has(dataApi,"target")?""+dataApi.target:"",oResult=(""+result).toJSON();if(targetDataModelName.indexOf(".")>0)targetApiData=spa.hasKey(oResult,targetDataModelName)?spa.find(oResult,targetDataModelName):oResult;else try{targetApiData=oResult.hasOwnProperty(targetDataModelName)?oResult[targetDataModelName]:oResult}catch(e){spa.console.error("Error in Data Model ["+targetDataModelName+"] in URL ["+apiDataUrl+"].\n"+e.stack)}spaTemplateModelData[viewDataModelName][apiDataModelName]?(spaTemplateModelData[viewDataModelName][apiDataModelName]=[spaTemplateModelData[viewDataModelName][apiDataModelName]],spaTemplateModelData[viewDataModelName][apiDataModelName].push(targetApiData)):spaTemplateModelData[viewDataModelName][apiDataModelName]=targetApiData,spa.console.info("Loaded data model ["+apiDataModelName+"] from ["+apiDataUrl+"]");var fnApiDataSuccess=dataApi.success||dataApi.onsuccess||dataApi.onSuccess;fnApiDataSuccess||(fnApiDataSuccess=dataModelCollection.success||dataModelCollection.onsuccess||dataModelCollection.onSuccess),fnApiDataSuccess&&(_.isFunction(fnApiDataSuccess)?fnApiDataSuccess(oResult,dataApi):_.isString(fnApiDataSuccess)&&eval("("+fnApiDataSuccess+"(oResult, dataApi))"))},error:function(jqXHR,textStatus,errorThrown){spa.console.warn("Error processing data-api ["+apiDataUrl+"]");var fnOnApiDataUrlErrorHandle=dataApi.error||dataApi.onerror||dataApi.onError;fnOnApiDataUrlErrorHandle||(fnOnApiDataUrlErrorHandle=dataModelCollection.error||dataModelCollection.onerror||dataModelCollection.onError,fnOnApiDataUrlErrorHandle||spa.isBlank(spaRVOptions.dataUrlErrorHandle)||(fnOnApiDataUrlErrorHandle=spaRVOptions.dataUrlErrorHandle)),fnOnApiDataUrlErrorHandle&&(_.isFunction(fnOnApiDataUrlErrorHandle)?fnOnApiDataUrlErrorHandle(jqXHR,textStatus,errorThrown):_.isString(fnOnApiDataUrlErrorHandle)&&eval("("+fnOnApiDataUrlErrorHandle+"(jqXHR, textStatus, errorThrown))"))}})):spa.console.error("data-api-url not found. Please check the arguments or html markup. Skipped this data-api request"),dataIndexApi++})}else spa.console.warn("Invalid [data-urls].Check the arguments or html markup. Rendering with empty data {}.")}else if(dataModelUrl.beginsWithStrIgnoreCase("local:")){var localDataModelName=dataModelUrl.replace(/local:/gi,""),localDataModelObj={};if("undefined"!=typeof eval("("+localDataModelName+")")&&eval("(localDataModelObj="+localDataModelName+")"),spa.console.info("Using LOCAL Data Model: "+localDataModelName),spa.isBlank(spaViewDataModelType))if(!isLocalDataModel&&dataModelName.indexOf(".")>0)spaTemplateModelData[viewDataModelName]=spa.hasKey(localDataModelObj,dataModelName)?spa.find(localDataModelObj,dataModelName):localDataModelObj;else try{spaTemplateModelData[viewDataModelName]=localDataModelObj.hasOwnProperty(dataModelName)?localDataModelObj[dataModelName]:localDataModelObj}catch(e){spa.console.error("Error in Data Model ["+dataModelName+"] in Local Object ["+localDataModelName+"].\n"+e.stack)}else if(spa.console.info("Local Data: "+localDataModelName+" not found."),$.isEmptyObject(localDataModelObj)&&!$.isEmptyObject(spaBackboneModelOption)){var bbClassUrl=spaBackboneModelOption.classpath||"";if(spa.isBlank(bbClassUrl))spa.console.error("Backbone 'classpath' NOT defined. Please check the 'dataModelType' option.");else{if(bbClassUrl.beginsWithStrIgnoreCase("local:")){var bbClassLocal=bbClassUrl.substring(6);eval("( localDataModelObj = new "+bbClassLocal+"() )")}else{spa.console.info("loading Backbone Model Class from: "+bbClassUrl+".");var noop=function(){},loadBackboneModelClassResult=spa.loadBackboneModelClass(bbClassUrl,{success:spaBackboneModelOption.classsuccess||noop,fail:spaBackboneModelOption.classerror||noop});localDataModelObj=new loadBackboneModelClassResult.bbclass,loadBackboneModelClassResult.success&&(spaBackboneModelOption.defaults&&localDataModelObj.set(spaBackboneModelOption.defaults),localDataModelObj.fetch({async:!1,cache:!1,success:spaBackboneModelOption.fetchsuccess||noop,error:spaBackboneModelOption.fetcherror||noop}))}eval("("+localDataModelName+"=localDataModelObj)"),spaTemplateModelData[viewDataModelName]=localDataModelObj.toJSON()}}else spaTemplateModelData[viewDataModelName]=spaViewDataModelType.equalsIgnoreCase("backbone")?localDataModelObj.toJSON():localDataModelObj}else spa.console.info("Request Data ["+dataModelName+"] [cache:"+spaRVOptions.dataCache+"] from URL =>"+dataModelUrl),spaAjaxRequestsQue.push($.ajax({url:dataModelUrl,data:spaRVOptions.dataParams,cache:spaRVOptions.dataCache,dataType:"text",success:function(e){var a=(""+e).toJSON();if(dataModelName.indexOf(".")>0)spaTemplateModelData[viewDataModelName]=spa.hasKey(a,dataModelName)?spa.find(a,dataModelName):a;else try{spaTemplateModelData[viewDataModelName]=a.hasOwnProperty(dataModelName)?a[dataModelName]:a}catch(t){spa.console.error("Error in Data Model ["+dataModelName+"] in URL ["+dataModelUrl+"].\n"+t.stack)}spa.console.info("Loaded data model ["+dataModelName+"] from ["+dataModelUrl+"]")},error:function(jqXHR,textStatus,errorThrown){var fnOnDataUrlErrorHandle=(""+$(viewContainerId).data("urlErrorHandle")).replace(/undefined/,"");spa.isBlank(spaRVOptions.dataUrlErrorHandle)||(fnOnDataUrlErrorHandle=""+spaRVOptions.dataUrlErrorHandle),spa.isBlank(fnOnDataUrlErrorHandle)||eval("("+fnOnDataUrlErrorHandle+"(jqXHR, textStatus, errorThrown))")}}))}if(spa.console.info("End of Data Processing"),spa.console.log({o:spaTemplateModelData}),spa.console.groupEnd("spaDataModel"),dataFound){var vTemplate2RenderInTag=(""+$(viewContainerId).data("template")).replace(/undefined/,""),vTemplatesList=(""+$(viewContainerId).data("templates")).replace(/undefined/,"");vTemplatesList&&spa.isBlank((vTemplatesList||"").replace(/[^:'\"]/g,""))&&(vTemplatesList="'"+vTemplatesList.split(",").join("','")+"'");var vTemplates=spa.toJSON(vTemplatesList||"{}");if(!_.isObject(spaRVOptions.dataTemplates)&&_.isString(spaRVOptions.dataTemplates)&&(vTemplatesList=(spaRVOptions.dataTemplates||"").trimStr(),spa.isBlank((vTemplatesList||"").replace(/[^:'\"]/g,""))&&(vTemplatesList="'"+vTemplatesList.split(",").join("','")+"'"),spaRVOptions.dataTemplates=spa.toJSON(vTemplatesList)),$.isEmptyObject(spaRVOptions.dataTemplates)||(vTemplates=spaRVOptions.dataTemplates,vTemplatesList=""+JSON.stringify(vTemplates)),(_.isEmpty(spa.toJSON((vTemplatesList||"").trimStr()))||_.isArray(vTemplates)&&1==vTemplates.length&&spa.isBlank(vTemplates[0]))&&(vTemplates={},vTemplatesList=""),spa.console.info("Templates:"),spa.console.info(vTemplates),_.isArray(vTemplates)&&!_.isEmpty(vTemplates)){spa.console.info("Array of template(s) without templateID(s).");var newTemplatesObj={},dynTmplIDForContainer="__tmpl_"+viewContainerId.trimStr("#")+"_";_.each(vTemplates,function(e,a){spa.console.log(e),e&&(newTemplatesObj[dynTmplIDForContainer+a]=""+e)}),spa.console.info("Template(s) with template ID(s)."),spa.console.log(newTemplatesObj),_.isEmpty(newTemplatesObj)?(vTemplates={},vTemplatesList=""):(vTemplates=newTemplatesObj,vTemplatesList=""+JSON.stringify(vTemplates))}if(!vTemplates||$.isEmptyObject(vTemplates)){vTemplates={};var _dataTemplate=spaRVOptions.dataTemplate,_tmplKey="",_tmplLoc="";spa.isBlank(_dataTemplate)&&(spa.isBlank(vTemplate2RenderInTag)||(spa.console.info("Template to load from location <"+vTemplate2RenderInTag+">"),_dataTemplate=vTemplate2RenderInTag)),_dataTemplate=(_dataTemplate||"").trimStr(),spa.console.info("Primary Template: <"+_dataTemplate+">"),spa.isBlank(_dataTemplate)||_dataTemplate.equalsIgnoreCase("inline")||_dataTemplate.equals(".")?(spa.console.info("Using target container (inline) content as template."),_tmplKey="_tmplInline_"+viewContainerId.trimStr("#")):_dataTemplate.beginsWithStr("#")?(spa.console.info("Using page container <"+_dataTemplate+"> content as template."),_tmplKey=_dataTemplate.trimStr("#")):(spa.console.info("External path <"+_dataTemplate+"> content as template."),_dataTemplate.containsStr(":")&&!_dataTemplate.beginsWithIgnoreCase("http")?(_tmplKey=spa.getOnSplit(_dataTemplate,":",0).replace(/[^a-z0-9]/gi,""),_tmplLoc=spa.getOnLastSplit(1)):(_tmplKey="__tmpl_"+viewContainerId.trimStr("#")+"_"+spa.now()+spa.rand(1e3,9999),_tmplLoc=_dataTemplate)),vTemplates[_tmplKey]=_tmplLoc.replace(/['\"]/g,""),spa.console.info(vTemplates)}spa.console.group("spaView");var dataTemplatesCollectionUrl=(""+$(viewContainerId).data("templatesCollectionUrl")).replace(/undefined/,"");if(spa.isBlank(spaRVOptions.dataTemplatesCollectionUrl)||(dataTemplatesCollectionUrl=spaRVOptions.dataTemplatesCollectionUrl),!spa.isBlank(dataTemplatesCollectionUrl)){var templateCollectionId=viewContainerId+"_TemplatesCollection";spa.loadTemplatesCollection(templateCollectionId,dataTemplatesCollectionUrl)}if(vTemplates&&!$.isEmptyObject(vTemplates)){spa.console.info("Templates of ["+spaTemplateType+"] to be used in view container ["+viewContainerId+"] => "+JSON.stringify(vTemplates));var vTemplateNames=_.keys(vTemplates);if(spa.console.group("spaLoadingTemplates"),spa.console.group("spaLoadingTemplatesCache"),useOptions&&uOptions.hasOwnProperty("dataTemplatesCache"))spa.console.info("Override [data-templates-cache] with user option [dataTemplatesCache]: "+spaRVOptions.dataTemplatesCache);else{var templatesCacheInTagData=(""+$(viewContainerId).data("templatesCache")).replace(/undefined/,"");spa.isBlank(templatesCacheInTagData)||(spaRVOptions.dataTemplatesCache=templatesCacheInTagData.toBoolean(),spa.console.info("Override [data-templates-cache] with [data-templates-cache] option in tag-attribute: "+spaRVOptions.dataTemplatesCache))}spa.console.groupEnd("spaLoadingTemplatesCache"),spa.console.info("Load Templates"),spa.console.info(vTemplates),_.each(vTemplateNames,function(e,a){spa.console.info([a,e,vTemplates[e],spaTemplateType,viewContainerId]),spaAjaxRequestsQue=spa.loadTemplate(e,vTemplates[e],spaTemplateType,viewContainerId,spaAjaxRequestsQue,!spaRVOptions.dataTemplatesCache)});var vTemplate2RenderID="#"+vTemplateNames[0].trimStr("#");if(spa.console.info("External Data/Templates Loading Status: "+JSON.stringify(spaAjaxRequestsQue)),spa.console.groupEnd("spaLoadingTemplates"),spa.console.info("Render TemplateID: "+vTemplate2RenderID),spa.console.group("spaLoadingViewStyles"),useOptions&&uOptions.hasOwnProperty("dataStylesCache"))spa.console.info("Override [data-styles-cache] with user option [dataStylesCache]: "+spaRVOptions.dataStylesCache);else{var stylesCacheInTagData=(""+$(viewContainerId).data("stylesCache")).replace(/undefined/,"");spa.isBlank(stylesCacheInTagData)||(spaRVOptions.dataStylesCache=stylesCacheInTagData.toBoolean(),spa.console.info("Override [data-styles-cache] with [data-styles-cache] option in tag-attribute: "+spaRVOptions.dataStylesCache))}var vStylesList=(""+$(viewContainerId).data("styles")).replace(/undefined/,"");vStylesList&&spa.isBlank((vStylesList||"").replace(/[^:'\"]/g,""))&&(vStylesList="'"+vStylesList.split(",").join("','")+"'");var vStyles=spa.toJSON(vStylesList||"{}");if($.isEmptyObject(spaRVOptions.dataStyles)||(vStyles=spaRVOptions.dataStyles),_.isArray(vStyles)&&_.remove(vStyles,function(e){return!e}),vStyles&&!$.isEmptyObject(vStyles)){if(_.isArray(vStyles)){spa.console.info("Convert array of style(s) without styleID to object with styleID(s).");var newStylesObj={},dynStyleIDForContainer="__styles_"+viewContainerId.trimStr("#")+"_";_.each(vStyles,function(e,a){spa.console.log(e),e&&(newStylesObj[dynStyleIDForContainer+a]=""+e)}),spa.console.info("Style(s) with styleID(s)."),spa.console.log(newStylesObj),vStyles=_.isEmpty(newStylesObj)?{}:newStylesObj}spa.console.info("External styles to be loaded [cache:"+spaRVOptions.dataStylesCache+"] along with view container ["+viewContainerId+"] => "+JSON.stringify(vStyles));var vStylesNames=_.keys(vStyles);spa.console.group("spaLoadingStyles"),_.each(vStylesNames,function(e){spaAjaxRequestsQue=spa.loadStyle(e,vStyles[e],spaRVOptions.dataStylesCache,spaAjaxRequestsQue)}),spa.console.info("External Styles Loading Status: "+JSON.stringify(spaAjaxRequestsQue)),spa.console.groupEnd("spaLoadingStyles")}else spa.console.info("No styles defined [data-styles] in view container ["+viewContainerId+"] to load.");spa.console.groupEnd("spaLoadingViewStyles"),$.when.apply($,spaAjaxRequestsQue).then(function(){spa.console.group("spaRender["+spaRenderEngine+"*"+spaTemplateEngine+"] - spa.renderHistory["+retValue.id+"]"),spa.console.info("Rendering "+viewContainerId+" using master template: "+vTemplate2RenderID),$(viewContainerId).html("");try{retValue.model=spaTemplateModelData[viewDataModelName];var e,a=spaTemplateModelData[viewDataModelName];switch(spaRenderEngine){case"backbone":isLocalDataModel&&!spa.isBlank(spaViewDataModelType)||(retValue.model=new Backbone.Model(retValue.model),a=retValue.model.toJSON());break;default:if(isLocalDataModel&&!spa.isBlank(spaViewDataModelType))switch(spaViewDataModelType){case"backbone":a=retValue.model.toJSON()}}spa.viewModels[retValue.id]=retValue.model;var t=($(vTemplate2RenderID).html()||"").replace(/_SCRIPTTAGINTEMPLATE_/g,"script").replace(/_LINKTAGINTEMPLATE_/g,"link");switch(spaTemplateEngine){case"handlebar":case"handlebars":e=Handlebars.compile(t)(a);break;case"underscore":e=_.template(t)(a);break;case"underscore-as-mustache":var n={interpolate:/\{\{(.+?)\}\}/g,escape:/\{\{\{(.+?)\}\}\}/g};e=_.template(t,a,n);break;case"mustache":e=Mustache.compile(t)(a);break;case"hogan":e=Hogan.compile(t).render(a);break;default:e=t}switch(doDeepRender=!1,spaRenderEngine){case"backbone":retValue.view=new(Backbone.View.extend({el:viewContainerId,render:function(){return this.$el.html(e),this}})),retValue.view.render(),doDeepRender=!0;break;default:retValue.view=e;var s=(""+$(viewContainerId).data("renderType")).replace(/undefined/,"").toLowerCase();switch(spa.isBlank(spaRVOptions.dataRenderType)||(s=spaRVOptions.dataRenderType),s){case"value":$(viewContainerId).val(retValue.view);break;case"text":$(viewContainerId).text(retValue.view);break;default:doDeepRender=!0,$(viewContainerId).html(retValue.view)}}spa.console.info("Render: SUCCESS");var o=_.keys(spa.renderHistory),r=o.length;r>spa.renderHistoryMax&&$.each(o.splice(0,r-spa.renderHistoryMax),function(e,a){delete spa.renderHistory[a]}),retValue.cron=""+spa.now(),spa.renderHistoryMax>0&&(spa.renderHistory[retValue.id]=retValue),doDeepRender&&(spa.reflowFoundation(viewContainerId),spa.initKeyTracking(),spa.i18n.apply(viewContainerId),spa.initRoutes(viewContainerId));var i=(""+$(viewContainerId).data("renderCallback")).replace(/undefined/,"");spaRVOptions.dataRenderCallback&&(i=spaRVOptions.dataRenderCallback);var p=i.equalsIgnoreCase("off");if(spa.console.info("Processing callback: "+i),!p&&(isSpaHashRouteOn&&spa.routes&&spa.routes.hasOwnProperty("_renderCallback")&&_.isFunction(spa.routes._renderCallback)&&(spa.console.info("calling default callback: spa.routes._renderCallback"),spa.routes._renderCallback.call(void 0,retValue)),i)){var l=i;_.isString(l)&&(l=spa.findSafe(window,l)),l?_.isFunction(l)?(spa.console.info("calling callback: "+i),l.call(void 0,retValue)):spa.console.error("CallbackFunction <"+i+" = "+l+"> is NOT a valid FUNCTION."):(""+i).beginsWithStr("spa")&&(""+i).endsWithStr("_renderCallback")?spa.console.warn("Default Route renderCallback function <"+i+"> is NOT defined."):spa.console.error("CallbackFunction <"+i+"> is NOT defined.")}doDeepRender&&$(viewContainerId).find("[rel='spaRender'],[data-render],[data-sparender],[data-spa-render]").spaRender()}catch(c){spa.console.error("Error Rendering.\n"+c.stack)}spa.console.groupEnd("spaRender["+spaRenderEngine+"*"+spaTemplateEngine+"] - spa.renderHistory["+retValue.id+"]")}).fail(function(){spa.console.error("External Data/Templates/Styles/Scripts Loading failed! Unexpected!! Check the template Path / Network. Rendering aborted.")}).done(spa.runOnceOnRender)}else spa.console.error("No templates defined [data-templates] in view container ["+viewContainerId+"] to render. Check HTML markup.");spa.console.groupEnd("spaView")}return retValue}},spa.hasAutoRoutes=function(e,a){var t="[data-sparoute-default]"+(e?"[href"+(a?a:"")+"='"+e+"']":"");return $(t).length>0},spa.routeCurLocHashAttemptDelaySec=3,spa.routeCurLocHashAttempt=0,spa.routeCurLocHash=function(){var e=(spa.getLocHash()||"").ifBlankStr(spa.routesOptions.defaultPageRoute);isSpaHashRouteOn&&e&&!spa.hasAutoRoutes(e)&&(spa.console.info("Route current url-hash."),spa.route(e)||(spa.console.warn("Current url-hash-route <"+e+"> FAILED and will try after "+spa.routeCurLocHashAttemptDelaySec+"sec."),spa.routeCurLocHashAttempt<5?(spa.routeCurLocHashAttempt++,setTimeout(spa.routeCurLocHash,1e3*spa.routeCurLocHashAttemptDelaySec)):spa.console.error("5 attempts to route current url-hash failed. Aborting further attempts.")))},spa.finallyOnRender=[],spa.runOnceOnRenderFunctions=[spa.routeCurLocHash],spa.runOnceOnRender=function(){spa.console.info("Render Complete."),(spa.runOnceOnRenderFunctions&&!_.isEmpty(spa.runOnceOnRenderFunctions)||spa.finallyOnRender&&!_.isEmpty(spa.finallyOnRender))&&(spa.runOnceOnRenderFunctions||(spa.runOnceOnRenderFunctions=[]),_.isArray(spa.runOnceOnRenderFunctions)||(spa.runOnceOnRenderFunctions=[spa.runOnceOnRenderFunctions]),_.isArray(spa.runOnceOnRenderFunctions)&&(spa.finallyOnRender&&(_.isArray(spa.finallyOnRender)||(spa.finallyOnRender=[spa.finallyOnRender]),spa.runOnceOnRenderFunctions=spa.runOnceOnRenderFunctions.concat(spa.finallyOnRender)),_.each(spa.runOnceOnRenderFunctions,function(e,a){_.isFunction(e)&&e()})),spa.finallyOnRender=spa.runOnceOnRenderFunctions=void 0)},spa.setElIdIfNot=function(e){var a=$(e);return spa.isBlank(a.attr("id"))&&a.attr("id","_el_"+spa.now()+"_"+spa.rand(1e3,9999)),a.attr("id")},spa.reflowFoundation=function(e){"Foundation"in window&&$(e||document).foundation("reflow")},$.expr[":"].regex=function(e,a,t){var n=t[3].split(","),s=/^(data|css):/,o={method:n[0].match(s)?n[0].split(":")[0]:"attr",property:n.shift().replace(s,"")},r="ig",i=new RegExp(n.join("").replace(/^\s+|\s+$/g,""),r);return i.test($(e)[o.method](o.property))},$.fn.extend({spaRender:function(e){this.each(function(){__renderView(this,e)})}}),$.extend({spaRender:function(e,a){$(e).spaRender(a)}}),spa.initDataValidation=function(){spa.console.log("include validate framework lib (spa-validate.js) to use this feature!")},spa.doDataValidation=function(){spa.console.log("include validate framework lib (spa-validate.js) to use this feature!")},spa.properties={version:spa.VERSION},spa.routes={},spa.routesOptions={useHashRoute:!0,usePatterns:!0,defaultPageRoute:"",beforeRoute:"",defaultTemplateExt:".html",loadDefaultScript:!0,defaultRouteTargetContainerIdPrefix:"routeContainer_",defaultRouteTemplateContainerIdPrefix:"template_"},spa.routePatterns={routes:[],register:void 0,deregister:void 0},spa.routePatterns.register=function(e,a){if(e&&!_.isEmpty(e)){var t=function(e,a){_.has(e,"pattern")&&(e.pattern=e.pattern.replace(/\?/g,"\\?"),_.has(e,"name")||(e.name=e.pattern.replace(/[^a-z0-9_]/gi,"")),_.has(e,"routeoptions")||(e.routeoptions={}),_.find(spa.routePatterns.routes,{pattern:e.pattern})||(_.find(spa.routePatterns.routes,{name:e.name})?a&&spa.routePatterns.routes.push(e):spa.routePatterns.routes.push(e)))};_.isArray(e)?_.each(e,function(e){t(e,a)}):_.isObject(e)?t(e,a):spa.console.error("Invalid RoutePattern Options. Provide Array/Object of RouteOptions")}else spa.console.error("Empty RoutePattern Options.")},spa.routePatterns.deregister=function(e){if(e&&!_.isEmpty(e)){var a=function(e){if(e){var a=_.findIndex(spa.routePatterns.routes,function(a){return a.name==e||a.pattern==e});a>=0?_.pullAt(spa.routePatterns.routes,a):spa.console.error("Route Pattern Not Found for <"+e+">");
}};_.isArray(e)?_.each(e,function(e){a(e)}):_.isString(e)?a(e):spa.console.error("Invalid RoutePattern Name/Pattern. Provide Array/Name of RouteNames/Patterns")}},spa.routeName=function(e){var a=e||spa.urlHash();return a.containsStr("\\?")&&(a=a.split("?")[0]),a.trimLeftStr("#").replace(/[^a-z0-9]/gi,"_")},spa.routeContainerId=function(e){var a=spa.routesOptions.defaultRouteTargetContainerIdPrefix.trimLeftStr("#");return a+spa.routeName(e)},spa.routeTemplateId=function(e){var a=spa.routesOptions.defaultRouteTemplateContainerIdPrefix.trimLeftStr("#");return a+spa.routeName(e)},spa.routeRender=function(e,a){var t=e?$(e):void 0,n=t?""+t.data("sparoute")||"":"";(n.trimStr().equalsIgnoreCase("false")||n.trimStr().equalsIgnoreCase("no")||n.trimStr().equalsIgnoreCase("off"))&&(n="quit:true");var s=n?spa.toJSON(n):{};if(_.merge(s,a),!s.hasOwnProperty("quit")||!s.quit){var o="#RouteNotDefinedInHREF";t?o=t.attr("href"):a.urlhash&&(o=a.urlhash.url),o=o.trimLeftStr("#");var r="";if(o.containsStr("\\?")){var i=o.split("?");o=i[0],r=i[1]}var p=s.name||spa.routeName(o);if(o+=o.endsWithStr("/")?"index":"",spa.routes[p])spa.routes[p](t,r,s);else{spa.console.info("Route method <spa.routes."+p+"> NOT FOUND. Attempting to route using [data-sparoute] options.");var l=s.hasOwnProperty("ext")||s.hasOwnProperty("tmplext")||s.hasOwnProperty("tmplExt"),c=""+(s.target||"").trimStr(),d=l?s.ext||s.tmplext||s.tmplExt:spa.routesOptions.defaultTemplateExt||"",u=s.tmplengine||s.tmplEngine||"",f=(o+d+"?"+r).trimRightStr("\\?"),m=o+".js",h="spa.routes."+p+"_before",g="spa.routes."+p+"_renderCallback",v=spa.findIgnoreCase(s,"usetargetoptions"),y={dataRenderCallback:g,rElRouteOptions:s,rElDataAttr:t?t.data():{}};s.hasOwnProperty("template")&&!s.hasOwnProperty("templates")&&(s.templates=s.template,delete s.template),c.equalsIgnoreCase(".")?c="#"+spa.setElIdIfNot(t):spa.isBlank(c)&&(c="#"+spa.routeContainerId(p));var O=spa.isElementExist(c);spa.console.info("Render Target <"+c+">"),s.hasOwnProperty("dataCache")&&(y.dataCache=s.dataCache),s.hasOwnProperty("templatesCache")&&(y.dataTemplatesCache=s.templatesCache),s.hasOwnProperty("scriptsCache")&&(y.dataScriptsCache=s.scriptsCache),y.dataTemplates={};var S="__spaRouteTemplate_"+p;if(!s.hasOwnProperty("templates")||s.templates){var C=s.templates,b=spa.routeTemplateId(p),T="#"+b,w="__tmpl_"+b;switch(!0){case _.isString(C):var k=S,R=C.trimStr();R.equalsIgnoreCase(".")?R=f:R.equalsIgnoreCase("#")&&(k=w,R=T),y.dataTemplates[k]=R.ifBlankStr("none");break;case _.isArray(C):_.indexOf(C,".")>=0&&(y.dataTemplates[S+"_dot"]=f,_.pull(C,".")),_.indexOf(C,"#")>=0&&(y.dataTemplates[w]=T,_.pull(C,"#")),_.each(C,function(e,a){y.dataTemplates[S+"_"+(a+1)]=e.ifBlankStr("none")});break;default:y.dataTemplates[S]=f}}else spa.console.warn("Route without template"),y.dataTemplates[S]="none";u&&(y.dataTemplateEngine=u);var D=!s.hasOwnProperty("scripts")||s.scripts;if(D){y.dataScripts={};var E="__spaRouteScript_"+p;switch(!0){case _.isString(s.scripts):y.dataScripts[E]=s.scripts.equalsIgnoreCase(".")?m:s.scripts;break;case _.isArray(s.scripts):_.indexOf(s.scripts,".")>=0&&(y.dataScripts[E]=m,_.pull(s.scripts,".")),_.each(s.scripts,function(e,a){y.dataScripts[E+"_"+(a+1)]=e});break;default:spa.routesOptions.loadDefaultScript?y.dataScripts[E]=m:spa.console.warn("Script(s) not included. Use <spa.routesOptions.loadDefaultScript = true> to load default script <"+m+">.")}spa.console.log(y.dataScripts)}if(s.dataUrl||s.dataurl){var I=s.dataurl||s.dataUrl,x=spa.toRenderDataStructure(I,r);_.isEmpty(x)||_.merge(y,x)}var M=s.hasOwnProperty("after")||s.hasOwnProperty("callback")||s.hasOwnProperty("callBack");if((M||s.after||s.callback||s.callBack)&&(y.dataRenderCallback=s.after||s.callback||s.callBack||""),s.hasOwnProperty("scripts")&&spa.isBlank(s.scripts)&&(M?_.isString(y.dataRenderCallback)&&y.dataRenderCallback.equalsIgnoreCase(".")&&(y.dataRenderCallback=g):y.dataRenderCallback=""),v&&O){var N=$(c);N.data("url")&&delete y.dataUrl,(N.data("template")||N.data("templates"))&&delete y.dataTemplates,N.data("scripts")&&delete y.dataScripts,N.data("templateEngine")&&delete y.dataTemplateEngine,N.data("renderCallback")&&delete y.dataRenderCallback}spa.console.info("Route Render Options Before preRenderProcess:"),spa.console.info(y);var A={},V=s.before||s.beforeroute||s.beforeRoute||spa.routesOptions.beforeRoute;spa.console.info("callBeforeRoute: "+V),V&&(!_.isFunction(V)&&_.isString(V)&&(V.equals(h)&&(h=void 0),V=spa.findSafe(window,V)),_.isFunction(V)?(A=V.call(void 0,{el:t,target:c,renderOptions:y,routeOptions:s}),_.isObject(A)&&_.merge(y,A)):spa.console.error("CallBeforeRouteFunction <"+s.before+"> NOT FOUND.")),h&&(V=spa.findSafe(window,h),V&&_.isFunction(V)&&(A=V.call(void 0,{el:t,target:c,renderOptions:y,routeOptions:s}),_.isObject(A)&&_.merge(y,A))),spa.console.info("Route Render Options After preRenderProcess:"),spa.console.info(y),y.hasOwnProperty("render")&&!y.render||s.hasOwnProperty("render")&&!s.render||spa.render(c,y)}return!0}},spa.route=function(e,a){if(_.isString(e)&&spa.isBlank((""+e).trimStr("#")))return!1;var t=!_.isString(e);if(a=a||{},!t){var n=$("[data-sparoute][href='"+e+"']");if(t=!_.isEmpty(n))e=n.get(0);else if(spa.console.warn("Route source element NOT FOUND for route <"+e+">"),spa.routesOptions.usePatterns){spa.console.info("Searching RoutePattern.");var s,o=_.findIndex(spa.routePatterns.routes,function(a){var t=!1,n=spa.routeMatch(a.pattern,e);return n&&(t=!0,s=_.merge({},a.routeoptions||{}),s.urlhash={pattern:a.pattern.replace(/\\\?/g,"?"),url:e,urlParams:n}),t});0>o?(spa.console.warn("Pattern not found."),spa.console.info(spa.routePatterns.routes)):(spa.console.info(s),spa.routeRender(void 0,s))}else spa.console.warn("Pattern match Disabled.")}if(!t){if(!a.forceroute&&!a.forceRoute)return spa.console.warn("Exit Route."),!1;spa.console.warn("Attempt dynamic route."),t=!0,e=$("<a href='"+e+"'></a>").get(0)}return t?spa.routeRender(e,a):void 0},spa.initRoutes=function(e,a){"object"==typeof e&&(a=e,e=a.context||a.scope||""),(!a||(spa.console.info("Init routesOptions"),_.merge(spa.routesOptions,a),!isSpaHashRouteOn&&spa.routesOptions.useHashRoute&&spa._initWindowOnHashChange(),isSpaHashRouteOn&&!spa.routesOptions.useHashRoute&&spa._stopWindowOnHashChange(),a.hasOwnProperty("context")||a.hasOwnProperty("scope")))&&(spa.console.info("Init spaRoutes. Scan for [data-sparoute] in context: <"+(e||"body")+">"),$(e||"body").find("[data-sparoute]").each(function(e,a){spa.isBlank((($(a).attr("href")||"")+"#").split("#")[1])||($(a).off("click"),$(a).on("click",function(){if(isSpaHashRouteOn){var e="#"+(($(a).attr("href")||"")+"#").split("#")[1].trimStr("#"),t=spa.getLocHash();e.equals(t)&&spa.route(this)}else spa.route(this)}),a.hasAttribute("data-sparoute-default")&&spa.route(a))}))},$(document).ready(function(){spa.debug=spa.urlParam("spa.debug")||spa.hashParam("spa.debug")||spa.debug,spa.reflowFoundation();var e=$("body").data("sparouteInit");e&&spa.initRoutes(spa.toJSON(e)),spa.initRoutes("body"),spa.extendBackbone(),spa.initKeyTracking();var a=$("[rel='spaRender'],[data-render],[data-sparender],[data-spa-render]"),t=a.length;spa.console.info("Find and Render [rel='spaRender'] or [data-render] or [data-sparender] or [data-spa-render]. Found:"+t),t?a.spaRender():(spa.console.info("Init SPA Render."),$("body").append("<div id='initSpaRender0' data-template-engine='none' data-render-type='text' data-render-callback='off'></div>"),$("#initSpaRender0").spaRender())})}(this),spa.console.info("spa loaded.");
