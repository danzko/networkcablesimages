(function(){var root,sNotDefined,oModules,oVars,_null_,bUnblockUI,_false_,sVersion,FakeModule,Hydra,bDebug,ErrorHandler,Module,Bus,oChannels,isNodeEnvironment,oObjProto;function generateUniqueKey(){var sFirstToken=+new Date()+"",sSecondToken=Math.floor(Math.random()*(999999-1+1))+1;return sFirstToken+"_"+sSecondToken}function getObjectLength(oObj){var nLen,sKey;if(Object.keys){nLen=Object.keys(oObj).length}else{nLen=0;for(sKey in oObj){if(ownProp(oObj,sKey)){nLen++}}}return nLen}if(typeof Object.create!=="function"){Object.create=function(oObject){function Copy(){}Copy.prototype=oObject;return new Copy()}}isNodeEnvironment=typeof exports==="object"&&typeof module==="object"&&typeof module.exports==="object"&&typeof require==="function";sNotDefined="undefined";oObjProto=Object.prototype;root=this;_null_=null;_false_=false;oModules={};sVersion="3.1.3";bDebug=_false_;bUnblockUI=_false_;function toString(oObject){return oObjProto.toString.call(oObject)}function isFunction(fpCallback){return toString(fpCallback)==="[object Function]"}function isArray(aArray){return toString(aArray)==="[object Array]"}function setDebug(_bDebug){bDebug=_bDebug}function setUnblockUI(_bUnblockUI){bUnblockUI=_bUnblockUI}function slice(oLikeArray,nElements){return[].slice.call(oLikeArray,nElements||0)}function ownProp(oObj,sKey){return oObj.hasOwnProperty(sKey)}function startSingleModule(oWrapper,sModuleId,sIdInstance,oData,bSingle){var oModule,oInstance;oModule=oModules[sModuleId];if(bSingle&&oWrapper.isModuleStarted(sModuleId,sIdInstance)){oWrapper.stop(sModuleId,sIdInstance)}if(typeof oModule!==sNotDefined){oInstance=createInstance(sModuleId);oModule.instances[sIdInstance]=oInstance;oInstance.__instance_id__=sIdInstance;if(typeof oData!==sNotDefined){oInstance.init(oData)}else{oInstance.init()}}return oInstance}function simpleMerge(oTarget,oSource){var sKey;for(sKey in oSource){if(ownProp(oSource,sKey)){oTarget[sKey]=oSource[sKey]}}return oTarget}function wrapMethod(oInstance,sName,sModuleId,fpMethod){oInstance[sName]=(function(sName,fpMethod){return function(){var aArgs=slice(arguments,0);try{return fpMethod.apply(this,aArgs)}catch(erError){ErrorHandler.log(sModuleId,sName,erError);return false}}}(sName,fpMethod))}oChannels={global:{}};function subscribersByEvent(oChannel,sEventName){var aSubscribers=[],sEvent;if(typeof oChannel!=="undefined"){for(sEvent in oChannel){if(ownProp(oChannel,sEvent)&&sEvent===sEventName){aSubscribers=oChannel[sEvent]}}}return aSubscribers}Bus={subscribers:function(sChannelId,sEventName){return subscribersByEvent(oChannels[sChannelId],sEventName)},_getChannelEvents:function(sChannelId,sEvent){if(typeof oChannels[sChannelId]==="undefined"){oChannels[sChannelId]={}}if(typeof oChannels[sChannelId][sEvent]==="undefined"){oChannels[sChannelId][sEvent]=[]}return oChannels[sChannelId][sEvent]},_addSubscribers:function(oEventsCallbacks,sChannelId,oSubscriber){var sEvent;for(sEvent in oEventsCallbacks){if(ownProp(oEventsCallbacks,sEvent)){this.subscribeTo(sChannelId,sEvent,oEventsCallbacks[sEvent],oSubscriber)}}},unsubscribeFrom:function(sChannelId,sEventType,oSubscriber){var aChannelEvents=this._getChannelEvents(sChannelId,sEventType),oItem,nEvent=aChannelEvents.length-1;for(;nEvent>=0;nEvent--){oItem=aChannelEvents[nEvent];if(oItem.subscriber===oSubscriber){aChannelEvents.splice(nEvent,1)}}},subscribeTo:function(sChannelId,sEventType,fpHandler,oSubscriber){var aChannelEvents=this._getChannelEvents(sChannelId,sEventType);aChannelEvents.push({subscriber:oSubscriber,handler:fpHandler})},subscribe:function(oSubscriber){var sChannelId,oEventsCallbacks=oSubscriber.events;if(!oSubscriber||typeof oEventsCallbacks==="undefined"){return false}for(sChannelId in oEventsCallbacks){if(ownProp(oEventsCallbacks,sChannelId)){if(typeof oChannels[sChannelId]==="undefined"){oChannels[sChannelId]={}}this._addSubscribers(oEventsCallbacks[sChannelId],sChannelId,oSubscriber)}}return true},_removeSubscribers:function(aSubscribers,oSubscriber){var nLenSubscribers,nIndex=0,nUnsubscribed=0;if(typeof aSubscribers!==sNotDefined){nLenSubscribers=aSubscribers.length;for(;nIndex<nLenSubscribers;nIndex++){if(aSubscribers[nIndex].subscriber===oSubscriber){nUnsubscribed++;aSubscribers.splice(nIndex,1)}}}return nUnsubscribed},_removeSubscribersPerEvent:function(oEventsCallbacks,sChannelId,oSubscriber){var sEvent,aEventsParts,sChannel,sEventType,nUnsubscribed=0;for(sEvent in oEventsCallbacks){if(ownProp(oEventsCallbacks,sEvent)){aEventsParts=sEvent.split(":");sChannel=sChannelId;sEventType=sEvent;if(aEventsParts[0]==="global"){sChannel=aEventsParts[0];sEventType=aEventsParts[1]}nUnsubscribed+=this._removeSubscribers(oChannels[sChannel][sEventType],oSubscriber)}}return nUnsubscribed},unsubscribe:function(oSubscriber){var nUnsubscribed=0,sChannelId,oEventsCallbacks=oSubscriber.events;if(!oSubscriber||typeof oEventsCallbacks==="undefined"){return false}for(sChannelId in oEventsCallbacks){if(ownProp(oEventsCallbacks,sChannelId)){if(typeof oChannels[sChannelId]==="undefined"){oChannels[sChannelId]={}}nUnsubscribed=this._removeSubscribersPerEvent(oEventsCallbacks[sChannelId],sChannelId,oSubscriber)}}return nUnsubscribed>0},_avoidBlockUI:function(aSubscribers,oData,sChannelId,sEvent){var oHandlerObject,aSubs=aSubscribers.concat();setTimeout(function recall(){var nStart=+new Date();do{oHandlerObject=aSubs.shift();oHandlerObject.handler.call(oHandlerObject.subscriber,oData);if(bDebug){ErrorHandler.log(sChannelId,sEvent,oHandlerObject)}}while(aSubs.length>0&&(+new Date()-nStart<50));if(aSubs.length>0){setTimeout(recall,25)}},25)},publish:function(sChannelId,sEvent,oData){var aSubscribers=this.subscribers(sChannelId,sEvent).slice(),nLenSubscribers=aSubscribers.length,nIndex,oHandlerObject;if(nLenSubscribers===0){return false}if(bUnblockUI){this._avoidBlockUI(aSubscribers,oData,sChannelId,sEvent)}else{for(nIndex=0;nIndex<nLenSubscribers;nIndex++){oHandlerObject=aSubscribers[nIndex];oHandlerObject.handler.call(oHandlerObject.subscriber,oData);if(bDebug){ErrorHandler.log(sChannelId,sEvent,oHandlerObject)}}}return true},reset:function(){oChannels={global:{}}}};function addPropertiesAndMethodsToModule(sModuleId,Bus){var oModule,fpInitProxy;oModule=oModules[sModuleId].creator(Bus);oModule.__module_id__=sModuleId;fpInitProxy=oModule.init||function(){};oModule.__action__=Bus;oModule.events=oModule.events||{};oModule.init=function(){var aArgs=slice(arguments,0).concat(oVars);Bus.subscribe(oModule);fpInitProxy.apply(this,aArgs)};oModule.handleAction=function(oNotifier){var fpCallback=this.events[oNotifier.type];if(typeof fpCallback===sNotDefined){return}fpCallback.call(this,oNotifier)};oModule.onDestroy=oModule.onDestroy||function(){};oModule.destroy=function(){this.onDestroy();Bus.unsubscribe(oModule)};return oModule}function createInstance(sModuleId){var oInstance,sName;if(typeof oModules[sModuleId]===sNotDefined){throw new Error("The module "+sModuleId+" is not registered!")}oInstance=addPropertiesAndMethodsToModule(sModuleId,Bus);if(!bDebug){for(sName in oInstance){if(ownProp(oInstance,sName)&&isFunction(oInstance[sName])){wrapMethod(oInstance,sName,sModuleId,oInstance[sName])}}}return oInstance}ErrorHandler=root.console||{log:function(){}};Module=function(){};Module.prototype={type:"Module",getInstance:createInstance,register:function(sModuleId,fpCreator){var self=this;oModules[sModuleId]=new FakeModule(sModuleId,fpCreator);return oModules[sModuleId]},_setSuper:function(oFinalModule,oModuleBase){oFinalModule.__super__={};oFinalModule.__super__.__instance__=oModuleBase;oFinalModule.__super__.__call__=function(sKey,aArgs){var oObject=this;while(ownProp(oObject,sKey)===_false_){oObject=oObject.__instance__.__super__}oObject[sKey].apply(oFinalModule,aArgs)}},_callInSuper:function(fpCallback){return function(){var aArgs=slice(arguments,0);fpCallback.apply(this,aArgs)}},_mergeModuleExtended:function(oFinalModule,oModuleExtended){var sKey;for(sKey in oModuleExtended){if(ownProp(oModuleExtended,sKey)){if(typeof oFinalModule.__super__!==sNotDefined&&isFunction(oFinalModule[sKey])){oFinalModule.__super__[sKey]=(this._callInSuper(oFinalModule[sKey]))}oFinalModule[sKey]=oModuleExtended[sKey]}}},_mergeModuleBase:function(oFinalModule,oModuleBase){var sKey;for(sKey in oModuleBase){if(ownProp(oModuleBase,sKey)){if(sKey!=="__super__"){oFinalModule[sKey]=oModuleBase[sKey]}}}},_merge:function(oModuleBase,oModuleExtended){var oFinalModule={};this._setSuper(oFinalModule,oModuleBase);this._mergeModuleBase(oFinalModule,oModuleBase);this._mergeModuleExtended(oFinalModule,oModuleExtended);return oFinalModule},extend:function(sModuleId,oSecondParameter,oThirdParameter){var oModule,sFinalModuleId,fpCreator,oBaseModule,oExtendedModule,oFinalModule,self;self=this;oModule=oModules[sModuleId];sFinalModuleId=sModuleId;fpCreator=function(){};if(typeof oSecondParameter==="string"){sFinalModuleId=oSecondParameter;fpCreator=oThirdParameter}else{fpCreator=oSecondParameter}if(typeof oModule===sNotDefined){return}oExtendedModule=fpCreator(Bus);oBaseModule=oModule.creator(Bus);oModules[sFinalModuleId]=new FakeModule(sFinalModuleId,function(Bus){oFinalModule=self._merge(oBaseModule,oExtendedModule);oFinalModule.__action__=Bus;return oFinalModule});return oModules[sFinalModuleId]},setInstance:function(sModuleId,sIdInstance,oInstance){var oModule=oModules[sModuleId];if(!oModule){throw new Error("The module "+sModuleId+" is not registered!")}oModule.instances[sIdInstance]=oInstance;return oModule},setVars:function(oVar){if(typeof oVars!==sNotDefined){oVars=simpleMerge(oVars,oVar)}else{oVars=oVar}},getVars:function(){return simpleMerge({},oVars)},_multiModuleStart:function(aModulesIds,sIdInstance,oData,bSingle){var aInstancesIds,aData,aSingle,nIndex,nLenModules,sModuleId;if(isArray(sIdInstance)){aInstancesIds=sIdInstance.slice(0)}if(isArray(oData)){aData=oData.slice(0)}if(isArray(bSingle)){aSingle=bSingle.slice(0)}for(nIndex=0,nLenModules=aModulesIds.length;nIndex<nLenModules;nIndex++){sModuleId=aModulesIds[nIndex];sIdInstance=aInstancesIds&&aInstancesIds[nIndex]||generateUniqueKey();oData=aData&&aData[nIndex]||oData;bSingle=aSingle&&aSingle[nIndex]||bSingle;startSingleModule(this,sModuleId,sIdInstance,oData,bSingle)}},_singleModuleStart:function(sModuleId,sIdInstance,oData,bSingle){if(typeof sIdInstance!=="string"){oData=sIdInstance;bSingle=oData;sIdInstance=generateUniqueKey()}startSingleModule(this,sModuleId,sIdInstance,oData,bSingle)},start:function(sModuleId,sIdInstance,oData,bSingle){var bStartMultipleModules=isArray(sModuleId);if(bStartMultipleModules){this._multiModuleStart(sModuleId.slice(0),sIdInstance,oData,bSingle)}else{this._singleModuleStart(sModuleId,sIdInstance,oData,bSingle)}},isModuleStarted:function(sModuleId,sInstanceId){var bStarted=false;if(typeof sInstanceId===sNotDefined){bStarted=(typeof oModules[sModuleId]!==sNotDefined&&getObjectLength(oModules[sModuleId].instances)>0)}else{bStarted=(typeof oModules[sModuleId]!==sNotDefined&&typeof oModules[sModuleId].instances[sInstanceId]!==sNotDefined)}return bStarted},startAll:function(){var sModuleId,oModule;for(sModuleId in oModules){if(ownProp(oModules,sModuleId)){oModule=oModules[sModuleId];if(typeof oModule!==sNotDefined){this.start(sModuleId,generateUniqueKey())}}}},_multiModuleStop:function(oModule){var sKey,oInstances=oModule.instances,oInstance;for(sKey in oInstances){if(ownProp(oInstances,sKey)){oInstance=oInstances[sKey];if(typeof oModule!==sNotDefined&&typeof oInstance!==sNotDefined){oInstance.destroy()}}}},_singleModuleStop:function(oModule,sModuleId,sInstanceId){var oInstance=oModule.instances[sInstanceId];if(typeof oModule!==sNotDefined&&typeof oInstance!==sNotDefined){oInstance.destroy()}},stop:function(sModuleId,sInstanceId){var oModule;oModule=oModules[sModuleId];if(typeof oModule===sNotDefined){return false}if(typeof sInstanceId!==sNotDefined){this._singleModuleStop(oModule,sModuleId,sInstanceId)}else{this._multiModuleStop(oModule)}return true},_stopOneByOne:function(oInstances,sModuleId){var sInstanceId;for(sInstanceId in oInstances){if(ownProp(oInstances,sInstanceId)){this.stop(sModuleId,sInstanceId)}}},stopAll:function(){var sModuleId;for(sModuleId in oModules){if(ownProp(oModules,sModuleId)&&typeof oModules[sModuleId]!==sNotDefined){this._stopOneByOne(oModules[sModuleId].instances,sModuleId)}}},_delete:function(sModuleId){if(typeof oModules[sModuleId]!==sNotDefined){delete oModules[sModuleId]}},remove:function(sModuleId){var oModule=oModules[sModuleId];if(typeof oModule===sNotDefined){return null}if(typeof oModule!==sNotDefined){try{return oModule}finally{this._delete(sModuleId)}}return null}};FakeModule=function(sModuleId,fpCreator){if(typeof fpCreator===sNotDefined){console.log("test")}this.creator=fpCreator;this.instances={};this.sModuleId=sModuleId};FakeModule.prototype={start:function(oData){return Module.prototype.start(this.sModuleId,undefined,oData)},extend:function(oSecondParameter,oThirdParameter){return Module.prototype.extend(this.sModuleId,oSecondParameter,oThirdParameter)},stop:function(){Module.prototype.stop(this.sModuleId)}};function getErrorHandler(){return ErrorHandler}function setErrorHandler(oErrorHandler){ErrorHandler=oErrorHandler}Hydra=function(){};Hydra.version=sVersion;Hydra.bus=Bus;Hydra.errorHandler=getErrorHandler;Hydra.setErrorHandler=setErrorHandler;Hydra.module=new Module();Hydra.setUnblockUI=setUnblockUI;Hydra.setDebug=setDebug;Hydra.getDebug=function(){return bDebug};Hydra.extend=function(sIdExtension,oExtension){if(typeof this[sIdExtension]===sNotDefined){this[sIdExtension]=oExtension}else{this[sIdExtension]=simpleMerge(this[sIdExtension],oExtension)}};Hydra.noConflict=function(sOldName,oNewContext,sNewName){if(typeof this[sOldName]!==sNotDefined){oNewContext[sNewName]=this[sOldName];return true}return false};root.Hydra=Hydra;if(isNodeEnvironment){module.exports=Hydra}else{if(typeof define!=="undefined"){define("hydra",[],function(){return Hydra})}}}.call(this));