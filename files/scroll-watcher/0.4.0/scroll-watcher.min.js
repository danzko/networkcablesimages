/**
 * A lightweight, blazing fast, rAF based, scroll watcher.
 * https://github.com/jonataswalker/scroll-watcher
 * Version: v0.2.1
 * Built: 2016-10-09T09:46:29-03:00
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.ScrollWatcher=e()}(this,function(){"use strict";function t(){}t.prototype={on:function(t,e,n){var o=this.e||(this.e={});return(o[t]||(o[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){function o(){i.off(t,o),e.apply(n,arguments)}var i=this;return o._=e,this.on(t,o,n)},emit:function(t){var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),o=0,i=n.length;for(o;o<i;o++)n[o].fn.apply(n[o].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),o=n[t],i=[];if(o&&e)for(var r=0,s=o.length;r<s;r++)o[r].fn!==e&&o[r].fn._!==e&&i.push(o[r]);return i.length?n[t]=i:delete n[t],this}};var e=t,n={$:function(t){return t="#"===t[0]?t.substr(1,t.length):t,document.getElementById(t)},isElement:function(t){return"HTMLElement"in window?!!t&&t instanceof HTMLElement:!!t&&"object"==typeof t&&1===t.nodeType&&!!t.nodeName},evaluate:function(t){var e;switch(this.toType(t)){case"window":case"htmldocument":case"element":e=t;break;case"string":t="#"===t[0]||"."===t[0]?t:"#"+t,e=this.find(t);break;default:console.warn("Unknown type")}return e},toType:function(t){return t===window&&t.document&&t.location?"window":t===document?"htmldocument":"string"==typeof t?"string":this.isElement(t)?"element":void 0},find:function(t,e,n){void 0===e&&(e=window.document);var o=/^(#?[\w-]+|\.[\w-.]+)$/,i=/\./g,r=Array.prototype.slice,s=[];if(o.test(t))switch(t[0]){case"#":s=[this.$(t.substr(1))];break;case".":s=r.call(e.getElementsByClassName(t.substr(1).replace(i," ")));break;default:s=r.call(e.getElementsByTagName(t))}else s=r.call(e.querySelectorAll(t));return n?s:s[0]},mergeOptions:function(t,e){var n={};for(var o in t)n[o]=t[o];for(var i in e)n[i]=e[i];return n},isDefAndNotNull:function(t){return null!=t},assertEqual:function(t,e,n){if(t!==e)throw new Error(n+" mismatch: "+t+" != "+e)},assert:function(t,e){if(void 0===e&&(e="Assertion failed"),!t){if("undefined"!=typeof Error)throw new Error(e);throw e}},now:function(){if("performance"in window==!1&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==!1){var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-t}}return window.performance.now()},offset:function(t){var e=t.getBoundingClientRect(),n=document.documentElement;return{left:e.left+window.pageXOffset-n.clientLeft,top:e.top+window.pageYOffset-n.clientTop,width:t.offsetWidth,height:t.offsetHeight}},getScroll:function(){return[window.pageXOffset||document.documentElement&&document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop]},getViewportSize:function(){return{w:window.innerWidth||document.documentElement.clientWidth,h:window.innerHeight||document.documentElement.clientHeight}},getDocumentHeight:function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)},raf:window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,caf:function(t){var e=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame;e.call(window,t)}},o={SCROLLING:"scrolling",ENTER:"enter",FULL_ENTER:"enter:full",EXIT_PARTIAL:"exit:partial",EXIT:"exit"},i={top:0,bottom:0},r=function(t){this.Base=t,this.lastXY=[],this.watching={},this.viewport=n.getViewportSize(),this.loopBound=this.loop.bind(this),this.loopBound()};r.prototype.loop=function(){var t=this;if(this.lastXY.join()===n.getScroll().join())return n.raf.call(window,this.loopBound),!1;var e=n.getScroll(),i=e[1]>this.lastXY[1];this.lastXY=e;var r={scrollX:this.lastXY[0],scrollY:this.lastXY[1],scrollingDown:i,scrollingUp:!i};this.Base.emit(o.SCROLLING,r),Object.keys(this.watching).forEach(function(e){var n=t.watching[e];t.recalculate(n),r.target=n.node,n.isInViewport&&!n.wasInViewport&&(n.wasInViewport=!0,n.wasFullyOut=!1,n.emitter.emit(o.ENTER,r)),n.isFullyOut&&!n.wasFullyOut&&(n.wasFullyOut=!0,n.wasInViewport=!1,n.emitter.emit(o.EXIT,r)),n.isPartialOut&&!n.wasPartialOut&&(n.wasPartialOut=!0,n.wasFullyInViewport=!1,n.emitter.emit(o.EXIT_PARTIAL,r)),n.isFullyInViewport&&!n.wasFullyInViewport&&(n.wasFullyInViewport=!0,n.wasPartialOut=!1,n.emitter.emit(o.FULL_ENTER,r))}),n.raf.call(window,this.loopBound)},r.prototype.recalculate=function(t){var e={top:t.dimensions.top+t.offset.top,bottom:t.dimensions.top+t.offset.bottom+t.dimensions.height},n={top:this.lastXY[1],bottom:this.lastXY[1]+this.viewport.h};t.isAboveViewport=e.top<n.top,t.isBelowViewport=e.bottom>n.bottom,t.isInViewport=e.top<=n.bottom&&e.bottom>=n.top,t.isFullyInViewport=e.top>=n.top&&e.bottom<=n.bottom||t.isAboveViewport&&t.isBelowViewport,t.isPartialOut=t.wasFullyInViewport&&!t.isFullyInViewport,t.isFullyOut=!t.isInViewport&&t.wasInViewport};var s=function(t){function e(){t.call(this),this.counter=0,e.Internal=new r(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.watch=function(o,r){function s(t){t.isInViewport=!1,t.wasInViewport=!1,t.isAboveViewport=!1,t.wasAboveViewport=!1,t.isBelowViewport=!1,t.wasBelowViewport=!1,t.isPartialOut=!1,t.wasPartialOut=!1,t.isFullyOut=!1,t.wasFullyOut=!1,t.isFullyInViewport=!1,t.wasFullyInViewport=!1}n.assert("string"==typeof o||n.isElement(o),"@param `element` should be string type or DOM Element!"),n.assert("number"==typeof r||"object"==typeof r||"undefined"==typeof r,"@param `opt_offset` should be number or Object or undefined!");var a,l=++this.counter,u=new t,c=n.evaluate(o);return n.assert(n.isElement(c),"Couldn't evaluate ("+o+") to a valid DOM node"),a="number"==typeof r?{top:r,bottom:r}:n.mergeOptions(i,r),e.Internal.watching[l]={node:c,emitter:u,offset:a,dimensions:n.offset(c)},s(e.Internal.watching[l]),{target:c,update:function(){s(e.Internal.watching[l]),e.Internal.watching[l].dimensions=n.offset(c)},once:function(t,e){return u.once(t,e),this},on:function(t,e){return u.on(t,e),this},off:function(t,e){return u.off(t,e),this}}},e}(e);return s});
