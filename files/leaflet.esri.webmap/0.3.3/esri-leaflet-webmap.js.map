{"version":3,"file":null,"sources":["../node_modules/esri-leaflet-renderers/src/Symbols/PointSymbol.js","../node_modules/esri-leaflet-renderers/src/Symbols/LineSymbol.js","../node_modules/esri-leaflet-renderers/src/Symbols/PolygonSymbol.js","../node_modules/esri-leaflet-renderers/src/Renderers/SimpleRenderer.js","../node_modules/esri-leaflet-renderers/src/Renderers/ClassBreaksRenderer.js","../node_modules/esri-leaflet-renderers/src/Renderers/UniqueValueRenderer.js","../src/FeatureCollection/FeatureCollection.js","../src/Label/LabelMarker.js","../src/Popup/Popup.js","../src/OperationalLayer.js","../src/WebMapLoader.js","../node_modules/esri-leaflet-renderers/src/Symbols/Symbol.js","../node_modules/esri-leaflet-renderers/node_modules/leaflet-shape-markers/src/ShapeMarker.js","../node_modules/esri-leaflet-renderers/node_modules/leaflet-shape-markers/src/CrossMarker.js","../node_modules/esri-leaflet-renderers/node_modules/leaflet-shape-markers/src/XMarker.js","../node_modules/esri-leaflet-renderers/node_modules/leaflet-shape-markers/src/SquareMarker.js","../node_modules/esri-leaflet-renderers/node_modules/leaflet-shape-markers/src/DiamondMarker.js","../node_modules/esri-leaflet-renderers/src/Renderers/Renderer.js","../node_modules/esri-leaflet-renderers/src/FeatureLayerHook.js"],"sourcesContent":["import L from 'leaflet';\nimport Symbol from './Symbol';\nimport {squareMarker, xMarker, crossMarker, diamondMarker} from 'leaflet-shape-markers';\n\nexport var PointSymbol = Symbol.extend({\n\n  statics: {\n    MARKERTYPES: ['esriSMSCircle', 'esriSMSCross', 'esriSMSDiamond', 'esriSMSSquare', 'esriSMSX', 'esriPMS']\n  },\n\n  initialize: function (symbolJson, options) {\n    Symbol.prototype.initialize.call(this, symbolJson, options);\n    if (options) {\n      this.serviceUrl = options.url;\n    }\n    if (symbolJson) {\n      if (symbolJson.type === 'esriPMS') {\n        var url = this.serviceUrl + 'images/' + this._symbolJson.url;\n        this._iconUrl = options && options.token ? url + '?token=' + options.token : url;\n        if (symbolJson.imageData) {\n          this._iconUrl = 'data:' + symbolJson.contentType + ';base64,' + symbolJson.imageData;\n        }\n        // leaflet does not allow resizing icons so keep a hash of different\n        // icon sizes to try and keep down on the number of icons created\n        this._icons = {};\n        // create base icon\n        this.icon = this._createIcon(this._symbolJson);\n      } else {\n        this._fillStyles();\n      }\n    }\n  },\n\n  _fillStyles: function () {\n    if (this._symbolJson.outline && this._symbolJson.size > 0) {\n      this._styles.stroke = true;\n      this._styles.weight = this.pixelValue(this._symbolJson.outline.width);\n      this._styles.color = this.colorValue(this._symbolJson.outline.color);\n      this._styles.opacity = this.alphaValue(this._symbolJson.outline.color);\n    } else {\n      this._styles.stroke = false;\n    }\n    if (this._symbolJson.color) {\n      this._styles.fillColor = this.colorValue(this._symbolJson.color);\n      this._styles.fillOpacity = this.alphaValue(this._symbolJson.color);\n    } else {\n      this._styles.fillOpacity = 0;\n    }\n\n    if (this._symbolJson.style === 'esriSMSCircle') {\n      this._styles.radius = this.pixelValue(this._symbolJson.size) / 2.0;\n    }\n  },\n\n  _createIcon: function (options) {\n    var width = this.pixelValue(options.width);\n    var height = width;\n    if (options.height) {\n      height = this.pixelValue(options.height);\n    }\n    var xOffset = width / 2.0;\n    var yOffset = height / 2.0;\n\n    if (options.xoffset) {\n      xOffset += this.pixelValue(options.xoffset);\n    }\n    if (options.yoffset) {\n      yOffset += this.pixelValue(options.yoffset);\n    }\n\n    var icon = L.icon({\n      iconUrl: this._iconUrl,\n      iconSize: [width, height],\n      iconAnchor: [xOffset, yOffset]\n    });\n    this._icons[options.width.toString()] = icon;\n    return icon;\n  },\n\n  _getIcon: function (size) {\n    // check to see if it is already created by size\n    var icon = this._icons[size.toString()];\n    if (!icon) {\n      icon = this._createIcon({width: size});\n    }\n    return icon;\n  },\n\n  pointToLayer: function (geojson, latlng, visualVariables, options) {\n    var size = this._symbolJson.size || this._symbolJson.width;\n    if (!this._isDefault) {\n      if (visualVariables.sizeInfo) {\n        var calculatedSize = this.getSize(geojson, visualVariables.sizeInfo);\n        if (calculatedSize) {\n          size = calculatedSize;\n        }\n      }\n      if (visualVariables.colorInfo) {\n        var color = this.getColor(geojson, visualVariables.colorInfo);\n        if (color) {\n          this._styles.fillColor = this.colorValue(color);\n          this._styles.fillOpacity = this.alphaValue(color);\n        }\n      }\n    }\n\n    if (this._symbolJson.type === 'esriPMS') {\n      var layerOptions = L.extend({}, {icon: this._getIcon(size)}, options);\n      return L.marker(latlng, layerOptions);\n    }\n    size = this.pixelValue(size);\n\n    switch (this._symbolJson.style) {\n      case 'esriSMSSquare':\n        return squareMarker(latlng, size, L.extend({}, this._styles, options));\n      case 'esriSMSDiamond':\n        return diamondMarker(latlng, size, L.extend({}, this._styles, options));\n      case 'esriSMSCross':\n        return crossMarker(latlng, size, L.extend({}, this._styles, options));\n      case 'esriSMSX':\n        return xMarker(latlng, size, L.extend({}, this._styles, options));\n    }\n    this._styles.radius = size / 2.0;\n    return L.circleMarker(latlng, L.extend({}, this._styles, options));\n  }\n});\n\nexport function pointSymbol (symbolJson, options) {\n  return new PointSymbol(symbolJson, options);\n}\n\nexport default pointSymbol;\n","import Symbol from './Symbol';\n\nexport var LineSymbol = Symbol.extend({\n  statics: {\n    // Not implemented 'esriSLSNull'\n    LINETYPES: ['esriSLSDash', 'esriSLSDot', 'esriSLSDashDotDot', 'esriSLSDashDot', 'esriSLSSolid']\n  },\n  initialize: function (symbolJson, options) {\n    Symbol.prototype.initialize.call(this, symbolJson, options);\n    this._fillStyles();\n  },\n\n  _fillStyles: function () {\n    // set the defaults that show up on arcgis online\n    this._styles.lineCap = 'butt';\n    this._styles.lineJoin = 'miter';\n    this._styles.fill = false;\n    this._styles.weight = 0;\n\n    if (!this._symbolJson) {\n      return this._styles;\n    }\n\n    if (this._symbolJson.color) {\n      this._styles.color = this.colorValue(this._symbolJson.color);\n      this._styles.opacity = this.alphaValue(this._symbolJson.color);\n    }\n\n    if (!isNaN(this._symbolJson.width)) {\n      this._styles.weight = this.pixelValue(this._symbolJson.width);\n\n      var dashValues = [];\n\n      switch (this._symbolJson.style) {\n        case 'esriSLSDash':\n          dashValues = [4, 3];\n          break;\n        case 'esriSLSDot':\n          dashValues = [1, 3];\n          break;\n        case 'esriSLSDashDot':\n          dashValues = [8, 3, 1, 3];\n          break;\n        case 'esriSLSDashDotDot':\n          dashValues = [8, 3, 1, 3, 1, 3];\n          break;\n      }\n\n      // use the dash values and the line weight to set dash array\n      if (dashValues.length > 0) {\n        for (var i = 0; i < dashValues.length; i++) {\n          dashValues[i] *= this._styles.weight;\n        }\n\n        this._styles.dashArray = dashValues.join(',');\n      }\n    }\n  },\n\n  style: function (feature, visualVariables) {\n    if (!this._isDefault && visualVariables) {\n      if (visualVariables.sizeInfo) {\n        var calculatedSize = this.pixelValue(this.getSize(feature, visualVariables.sizeInfo));\n        if (calculatedSize) {\n          this._styles.weight = calculatedSize;\n        }\n      }\n      if (visualVariables.colorInfo) {\n        var color = this.getColor(feature, visualVariables.colorInfo);\n        if (color) {\n          this._styles.color = this.colorValue(color);\n          this._styles.opacity = this.alphaValue(color);\n        }\n      }\n    }\n    return this._styles;\n  }\n});\n\nexport function lineSymbol (symbolJson, options) {\n  return new LineSymbol(symbolJson, options);\n}\n\nexport default lineSymbol;\n","import Symbol from './Symbol';\nimport lineSymbol from './LineSymbol';\n\nexport var PolygonSymbol = Symbol.extend({\n  statics: {\n    // not implemented: 'esriSFSBackwardDiagonal','esriSFSCross','esriSFSDiagonalCross','esriSFSForwardDiagonal','esriSFSHorizontal','esriSFSNull','esriSFSVertical'\n    POLYGONTYPES: ['esriSFSSolid']\n  },\n  initialize: function (symbolJson, options) {\n    Symbol.prototype.initialize.call(this, symbolJson, options);\n    if (symbolJson) {\n      this._lineStyles = lineSymbol(symbolJson.outline, options).style();\n      this._fillStyles();\n    }\n  },\n\n  _fillStyles: function () {\n    if (this._lineStyles) {\n      if (this._lineStyles.weight === 0) {\n        // when weight is 0, setting the stroke to false can still look bad\n        // (gaps between the polygons)\n        this._styles.stroke = false;\n      } else {\n        // copy the line symbol styles into this symbol's styles\n        for (var styleAttr in this._lineStyles) {\n          this._styles[styleAttr] = this._lineStyles[styleAttr];\n        }\n      }\n    }\n\n    // set the fill for the polygon\n    if (this._symbolJson) {\n      if (this._symbolJson.color &&\n          // don't fill polygon if type is not supported\n          PolygonSymbol.POLYGONTYPES.indexOf(this._symbolJson.style >= 0)) {\n        this._styles.fill = true;\n        this._styles.fillColor = this.colorValue(this._symbolJson.color);\n        this._styles.fillOpacity = this.alphaValue(this._symbolJson.color);\n      } else {\n        this._styles.fill = false;\n        this._styles.fillOpacity = 0;\n      }\n    }\n  },\n\n  style: function (feature, visualVariables) {\n    if (!this._isDefault && visualVariables && visualVariables.colorInfo) {\n      var color = this.getColor(feature, visualVariables.colorInfo);\n      if (color) {\n        this._styles.fillColor = this.colorValue(color);\n        this._styles.fillOpacity = this.alphaValue(color);\n      }\n    }\n    return this._styles;\n  }\n});\n\nexport function polygonSymbol (symbolJson, options) {\n  return new PolygonSymbol(symbolJson, options);\n}\n\nexport default polygonSymbol;\n","import Renderer from './Renderer';\n\nexport var SimpleRenderer = Renderer.extend({\n  initialize: function (rendererJson, options) {\n    Renderer.prototype.initialize.call(this, rendererJson, options);\n    this._createSymbol();\n  },\n\n  _createSymbol: function () {\n    if (this._rendererJson.symbol) {\n      this._symbols.push(this._newSymbol(this._rendererJson.symbol));\n    }\n  },\n\n  _getSymbol: function () {\n    return this._symbols[0];\n  }\n});\n\nexport function simpleRenderer (rendererJson, options) {\n  return new SimpleRenderer(rendererJson, options);\n}\n\nexport default simpleRenderer;\n","import Renderer from './Renderer';\n\nexport var ClassBreaksRenderer = Renderer.extend({\n  initialize: function (rendererJson, options) {\n    Renderer.prototype.initialize.call(this, rendererJson, options);\n    this._field = this._rendererJson.field;\n    if (this._rendererJson.normalizationType && this._rendererJson.normalizationType === 'esriNormalizeByField') {\n      this._normalizationField = this._rendererJson.normalizationField;\n    }\n    this._createSymbols();\n  },\n\n  _createSymbols: function () {\n    var symbol;\n    var classbreaks = this._rendererJson.classBreakInfos;\n\n    this._symbols = [];\n\n    // create a symbol for each class break\n    for (var i = classbreaks.length - 1; i >= 0; i--) {\n      if (this.options.proportionalPolygon && this._rendererJson.backgroundFillSymbol) {\n        symbol = this._newSymbol(this._rendererJson.backgroundFillSymbol);\n      } else {\n        symbol = this._newSymbol(classbreaks[i].symbol);\n      }\n      symbol.val = classbreaks[i].classMaxValue;\n      this._symbols.push(symbol);\n    }\n    // sort the symbols in ascending value\n    this._symbols.sort(function (a, b) {\n      return a.val > b.val ? 1 : -1;\n    });\n    this._createDefaultSymbol();\n    this._maxValue = this._symbols[this._symbols.length - 1].val;\n  },\n\n  _getSymbol: function (feature) {\n    var val = feature.properties[this._field];\n    if (this._normalizationField) {\n      var normValue = feature.properties[this._normalizationField];\n      if (!isNaN(normValue) && normValue !== 0) {\n        val = val / normValue;\n      } else {\n        return this._defaultSymbol;\n      }\n    }\n\n    if (val > this._maxValue) {\n      return this._defaultSymbol;\n    }\n    var symbol = this._symbols[0];\n    for (var i = this._symbols.length - 1; i >= 0; i--) {\n      if (val > this._symbols[i].val) {\n        break;\n      }\n      symbol = this._symbols[i];\n    }\n    return symbol;\n  }\n});\n\nexport function classBreaksRenderer (rendererJson, options) {\n  return new ClassBreaksRenderer(rendererJson, options);\n}\n\nexport default classBreaksRenderer;\n","import Renderer from './Renderer';\n\nexport var UniqueValueRenderer = Renderer.extend({\n  initialize: function (rendererJson, options) {\n    Renderer.prototype.initialize.call(this, rendererJson, options);\n    this._field = this._rendererJson.field1;\n    this._createSymbols();\n  },\n\n  _createSymbols: function () {\n    var symbol;\n    var uniques = this._rendererJson.uniqueValueInfos;\n\n    // create a symbol for each unique value\n    for (var i = uniques.length - 1; i >= 0; i--) {\n      symbol = this._newSymbol(uniques[i].symbol);\n      symbol.val = uniques[i].value;\n      this._symbols.push(symbol);\n    }\n    this._createDefaultSymbol();\n  },\n\n  _getSymbol: function (feature) {\n    var val = feature.properties[this._field];\n    // accumulate values if there is more than one field defined\n    if (this._rendererJson.fieldDelimiter && this._rendererJson.field2) {\n      var val2 = feature.properties[this._rendererJson.field2];\n      if (val2) {\n        val += this._rendererJson.fieldDelimiter + val2;\n        var val3 = feature.properties[this._rendererJson.field3];\n        if (val3) {\n          val += this._rendererJson.fieldDelimiter + val3;\n        }\n      }\n    }\n\n    var symbol = this._defaultSymbol;\n    for (var i = this._symbols.length - 1; i >= 0; i--) {\n      // using the === operator does not work if the field\n      // of the unique renderer is not a string\n      /*eslint-disable */\n      if (this._symbols[i].val == val) {\n        symbol = this._symbols[i];\n      }\n      /*eslint-enable */\n    }\n    return symbol;\n  }\n});\n\nexport function uniqueValueRenderer (rendererJson, options) {\n  return new UniqueValueRenderer(rendererJson, options);\n}\n\nexport default uniqueValueRenderer;\n","import L from 'leaflet';\r\n\r\nimport { classBreaksRenderer, uniqueValueRenderer, simpleRenderer } from 'esri-leaflet-renderers';\r\n\r\nexport var FeatureCollection = L.GeoJSON.extend({\r\n  options: {\r\n    data: {}, // Esri Feature Collection JSON or Item ID\r\n    opacity: 1,\r\n    renderer: {}\r\n  },\r\n\r\n  initialize: function (layers, options) {\r\n    L.setOptions(this, options);\r\n\r\n    this.data = this.options.data;\r\n    this.opacity = this.options.opacity;\r\n    this.renderer = this.options.renderer;\r\n    this._layers = {};\r\n\r\n    var i, len;\r\n\r\n    if (layers) {\r\n      for (i = 0, len = layers.length; i < len; i++) {\r\n        this.addLayer(layers[i]);\r\n      }\r\n    }\r\n\r\n    if (typeof this.data === 'string') {\r\n      this._getFeatureCollection(this.data);\r\n    } else {\r\n      this._parseFeatureCollection(this.data);\r\n    }\r\n  },\r\n\r\n  _getFeatureCollection: function (itemId) {\r\n    var url = 'https://www.arcgis.com/sharing/rest/content/items/' + itemId + '/data';\r\n    L.esri.request(url, {}, function (err, res) {\r\n      if (err) {\r\n        console.log(err);\r\n      } else {\r\n        this._parseFeatureCollection(res);\r\n      }\r\n    }, this);\r\n  },\r\n\r\n  _parseFeatureCollection: function (data) {\r\n    var features = data.layers[0].featureSet.features;\r\n    var geometryType = data.layers[0].layerDefinition.geometryType; // 'esriGeometryPoint' | 'esriGeometryMultipoint' | 'esriGeometryPolyline' | 'esriGeometryPolygon' | 'esriGeometryEnvelope'\r\n    var geojson = this._featureCollectionToGeoJSON(features, geometryType);\r\n\r\n    this._setRenderers(data.layers[0].layerDefinition);\r\n    this.addData(geojson);\r\n  },\r\n\r\n  _featureCollectionToGeoJSON: function (features, geometryType) {\r\n    var geojson = {\r\n      type: 'FeatureCollection',\r\n      features: []\r\n    };\r\n    var featuresArray = [];\r\n    var i, len;\r\n\r\n    for (i = 0, len = features.length; i < len; i++) {\r\n      var f;\r\n      var mercatorToLatlng, coordinates;\r\n      var j, k;\r\n\r\n      if (geometryType === 'esriGeometryPoint') {\r\n        mercatorToLatlng = L.Projection.SphericalMercator.unproject(L.point(features[i].geometry.x, features[i].geometry.y));\r\n        coordinates = [mercatorToLatlng.lng, mercatorToLatlng.lat];\r\n\r\n        f = {\r\n          type: 'Feature',\r\n          geometry: { type: 'Point', coordinates: coordinates },\r\n          properties: features[i].attributes\r\n        };\r\n      } else if (geometryType === 'esriGeometryMultipoint') {\r\n        var plen;\r\n        var points = [];\r\n\r\n        for (j = 0, plen = features[i].geometry.points.length; j < plen; j++) {\r\n          mercatorToLatlng = L.Projection.SphericalMercator.unproject(L.point(features[i].geometry.points[j][0], features[i].geometry.points[j][1]));\r\n          coordinates = [mercatorToLatlng.lng, mercatorToLatlng.lat];\r\n          points.push(coordinates);\r\n        }\r\n\r\n        f = {\r\n          type: 'Feature',\r\n          geometry: { type: 'MultiPoint', coordinates: points },\r\n          properties: features[i].attributes\r\n        };\r\n      } else if (geometryType === 'esriGeometryPolyline') {\r\n        var pathlen, pathslen;\r\n        var paths = [];\r\n\r\n        for (j = 0, pathslen = features[i].geometry.paths.length; j < pathslen; j++) {\r\n          var path = [];\r\n          for (k = 0, pathlen = features[i].geometry.paths[j].length; k < pathlen; k++) {\r\n            mercatorToLatlng = L.Projection.SphericalMercator.unproject(L.point(features[i].geometry.paths[j][k][0], features[i].geometry.paths[j][k][1]));\r\n            coordinates = [mercatorToLatlng.lng, mercatorToLatlng.lat];\r\n            path.push(coordinates);\r\n          }\r\n          paths.push(path);\r\n        }\r\n\r\n        f = {\r\n          type: 'Feature',\r\n          geometry: { type: 'MultiLineString', coordinates: paths },\r\n          properties: features[i].attributes\r\n        };\r\n      } else if (geometryType === 'esriGeometryPolygon') {\r\n        var ringlen, ringslen;\r\n        var rings = [];\r\n\r\n        for (j = 0, ringslen = features[i].geometry.rings.length; j < ringslen; j++) {\r\n          var ring = [];\r\n          for (k = 0, ringlen = features[i].geometry.rings[j].length; k < ringlen; k++) {\r\n            mercatorToLatlng = L.Projection.SphericalMercator.unproject(L.point(features[i].geometry.rings[j][k][0], features[i].geometry.rings[j][k][1]));\r\n            coordinates = [mercatorToLatlng.lng, mercatorToLatlng.lat];\r\n            ring.push(coordinates);\r\n          }\r\n          rings.push(ring);\r\n        }\r\n\r\n        f = {\r\n          type: 'Feature',\r\n          geometry: { type: 'MultiPolygon', coordinates: rings },\r\n          properties: features[i].attributes\r\n        };\r\n      } else if (geometryType === 'esriGeometryEnvelope') {\r\n\r\n      }\r\n\r\n      featuresArray.push(f);\r\n    }\r\n\r\n    geojson.features = featuresArray;\r\n\r\n    return geojson;\r\n  },\r\n\r\n  _checkForProportionalSymbols: function (geometryType, renderer) {\r\n    this._hasProportionalSymbols = false;\r\n    if (geometryType === 'esriGeometryPolygon') {\r\n      if (renderer.backgroundFillSymbol) {\r\n        this._hasProportionalSymbols = true;\r\n      }\r\n      // check to see if the first symbol in the classbreaks is a marker symbol\r\n      if (renderer.classBreakInfos && renderer.classBreakInfos.length) {\r\n        var sym = renderer.classBreakInfos[0].symbol;\r\n        if (sym && (sym.type === 'esriSMS' || sym.type === 'esriPMS')) {\r\n          this._hasProportionalSymbols = true;\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  _setRenderers: function (layerDefinition) {\r\n    var rend;\r\n    var rendererInfo = this.renderer;\r\n\r\n    var options = {};\r\n\r\n    if (this.options.pane) {\r\n      options.pane = this.options.pane;\r\n    }\r\n    if (layerDefinition.drawingInfo.transparency) {\r\n      options.layerTransparency = layerDefinition.drawingInfo.transparency;\r\n    }\r\n    if (this.options.style) {\r\n      options.userDefinedStyle = this.options.style;\r\n    }\r\n\r\n    switch (rendererInfo.type) {\r\n      case 'classBreaks':\r\n        this._checkForProportionalSymbols(layerDefinition.geometryType, rendererInfo);\r\n        if (this._hasProportionalSymbols) {\r\n          this._createPointLayer();\r\n          var pRend = classBreaksRenderer(rendererInfo, options);\r\n          pRend.attachStylesToLayer(this._pointLayer);\r\n          options.proportionalPolygon = true;\r\n        }\r\n        rend = classBreaksRenderer(rendererInfo, options);\r\n        break;\r\n      case 'uniqueValue':\r\n        console.log(rendererInfo, options);\r\n        rend = uniqueValueRenderer(rendererInfo, options);\r\n        break;\r\n      default:\r\n        rend = simpleRenderer(rendererInfo, options);\r\n    }\r\n    rend.attachStylesToLayer(this);\r\n  }\r\n});\r\n\r\nexport function featureCollection (geojson, options) {\r\n  return new FeatureCollection(geojson, options);\r\n}\r\n\r\nexport default featureCollection;\r\n","import L from 'leaflet';\r\n\r\nexport var LabelMarker = L.Marker.extend({\r\n  options: {\r\n    properties: {},\r\n    labelingInfo: {},\r\n    offset: [0, 0]\r\n  },\r\n\r\n  initialize: function (latlng, options) {\r\n    L.setOptions(this, options);\r\n    this._latlng = L.latLng(latlng);\r\n\r\n    var labelText = this._createLabelText(this.options.properties, this.options.labelingInfo);\r\n    this._setLabelIcon(labelText, this.options.offset);\r\n  },\r\n\r\n  _createLabelText: function (properties, labelingInfo) {\r\n    var r = /\\[([^\\]]*)\\]/g;\r\n    var labelText = labelingInfo[0].labelExpression;\r\n\r\n    labelText = labelText.replace(r, function (s) {\r\n      var m = r.exec(s);\r\n      return properties[m[1]];\r\n    });\r\n\r\n    return labelText;\r\n  },\r\n\r\n  _setLabelIcon: function (text, offset) {\r\n    var icon = L.divIcon({\r\n      iconSize: null,\r\n      className: 'esri-leaflet-webmap-labels',\r\n      html: '<div>' + text + '</div>',\r\n      iconAnchor: offset\r\n    });\r\n\r\n    this.setIcon(icon);\r\n  }\r\n});\r\n\r\nexport function labelMarker (latlng, options) {\r\n  return new LabelMarker(latlng, options);\r\n}\r\n\r\nexport default labelMarker;\r\n","export function createPopupContent (popupInfo, properties) {\r\n  // console.log(popupInfo, properties);\r\n  var r = /\\{([^\\]]*)\\}/g;\r\n  var titleText = '';\r\n  var content = '';\r\n\r\n  if (popupInfo.title !== undefined) {\r\n    titleText = popupInfo.title;\r\n  }\r\n\r\n  titleText = titleText.replace(r, function (s) {\r\n    var m = r.exec(s);\r\n    return properties[m[1]];\r\n  });\r\n\r\n  content = '<div class=\"leaflet-popup-content-title\"><h4>' + titleText + '</h4></div><div class=\"leaflet-popup-content-description\" style=\"max-height:200px;overflow:auto;\">';\r\n\r\n  for (var i = 0; i < popupInfo.fieldInfos.length; i++) {\r\n    if (popupInfo.fieldInfos[i].visible === true) {\r\n      content += '<div style=\"font-weight:bold;color:#999;margin-top:5px;word-break:break-all;\">' + popupInfo.fieldInfos[i].label + '</div><p style=\"margin-top:0;margin-bottom:5px;word-break:break-all;\">' + properties[popupInfo.fieldInfos[i].fieldName] + '</p>';\r\n    }\r\n  }\r\n\r\n  content += '</div>';\r\n\r\n  if (popupInfo.mediaInfos.length > 0) {\r\n    // It does not support mediaInfos for popup contents.\r\n  }\r\n\r\n  return content;\r\n}\r\n\r\nexport var Popup = {\r\n  createPopupContent: createPopupContent\r\n};\r\n\r\nexport default Popup;\r\n","import L from 'leaflet';\r\nimport { featureCollection } from './FeatureCollection/FeatureCollection';\r\nimport { labelMarker } from './Label/LabelMarker';\r\nimport { createPopupContent } from './Popup/Popup';\r\n\r\nexport function operationalLayer (layer, layers, map) {\r\n  return _generateEsriLayer(layer, layers, map);\r\n}\r\n\r\nexport function _generateEsriLayer (layer, layers, map) {\r\n  console.log('generateEsriLayer: ', layer.title, layer);\r\n  var lyr;\r\n  var labels = [];\r\n  var labelsLayer;\r\n\r\n  if (layer.featureCollection !== undefined) {\r\n    // Supporting only point geometry\r\n    console.log('create FeatureCollection');\r\n\r\n    if (layer.featureCollection.layers[0].layerDefinition.drawingInfo.labelingInfo && layer.featureCollection.layers[0].featureSet) {\r\n      layer.featureCollection.layers[0].featureSet.features.map(function (feature) {\r\n        var mercatorToLatlng = L.Projection.SphericalMercator.unproject(L.point(feature.geometry.x, feature.geometry.y));\r\n        var labelingInfo = layer.featureCollection.layers[0].layerDefinition.drawingInfo.labelingInfo;\r\n\r\n        var label = labelMarker(mercatorToLatlng, {\r\n          zIndexOffset: 1,\r\n          properties: feature.attributes,\r\n          labelingInfo: labelingInfo,\r\n          offset: [20, 20]\r\n        });\r\n\r\n        labels.push(label);\r\n      });\r\n    }\r\n\r\n    lyr = featureCollection([], {\r\n      data: layer.itemId || layer.featureCollection,\r\n      opacity: layer.opacity,\r\n      renderer: layer.featureCollection.layers[0].layerDefinition.drawingInfo.renderer,\r\n      onEachFeature: function (geojson, l) {\r\n        if (layer.featureCollection.layers[0].popupInfo !== undefined) {\r\n          var popupContent = createPopupContent(layer.featureCollection.layers[0].popupInfo, geojson.properties);\r\n          l.bindPopup(popupContent);\r\n        }\r\n      }\r\n    });\r\n\r\n    if (labels.length > 0) {\r\n      labelsLayer = L.featureGroup(labels);\r\n      lyr = L.layerGroup([lyr, labelsLayer]);\r\n    }\r\n\r\n    layers.push({ type: 'FC', title: layer.title || '', layer: lyr });\r\n\r\n    return lyr;\r\n  } else if (layer.layerType === 'ArcGISFeatureLayer' && layer.layerDefinition !== undefined) {\r\n    var where = '1=1';\r\n    if (layer.layerDefinition.drawingInfo !== undefined) {\r\n      if (layer.layerDefinition.drawingInfo.renderer.type === 'heatmap') {\r\n        console.log('create HeatmapLayer');\r\n        var gradient = {};\r\n\r\n        layer.layerDefinition.drawingInfo.renderer.colorStops.map(function (stop) {\r\n          // gradient[stop.ratio] = 'rgba(' + stop.color[0] + ',' + stop.color[1] + ',' + stop.color[2] + ',' + (stop.color[3]/255) + ')';\r\n          // gradient[Math.round(stop.ratio*100)/100] = 'rgb(' + stop.color[0] + ',' + stop.color[1] + ',' + stop.color[2] + ')';\r\n          gradient[(Math.round(stop.ratio * 100) / 100 + 6) / 7] = 'rgb(' + stop.color[0] + ',' + stop.color[1] + ',' + stop.color[2] + ')';\r\n        });\r\n\r\n        lyr = L.esri.Heat.heatmapFeatureLayer({ // Esri Leaflet 2.0\r\n        // lyr = L.esri.heatmapFeatureLayer({ // Esri Leaflet 1.0\r\n          url: layer.url,\r\n          minOpacity: 0.5,\r\n          max: layer.layerDefinition.drawingInfo.renderer.maxPixelIntensity,\r\n          blur: layer.layerDefinition.drawingInfo.renderer.blurRadius,\r\n          radius: layer.layerDefinition.drawingInfo.renderer.blurRadius * 1.3,\r\n          gradient: gradient\r\n        });\r\n\r\n        layers.push({ type: 'HL', title: layer.title || '', layer: lyr });\r\n\r\n        return lyr;\r\n      } else {\r\n        console.log('create ArcGISFeatureLayer (with layerDefinition.drawingInfo)');\r\n\r\n        if (layer.layerDefinition.definitionExpression !== undefined) {\r\n          where = layer.layerDefinition.definitionExpression;\r\n        }\r\n\r\n        labelsLayer = L.featureGroup(labels);\r\n        lyr = L.esri.featureLayer({\r\n          url: layer.url,\r\n          where: where,\r\n          drawingInfo: layer.layerDefinition.drawingInfo,\r\n          onEachFeature: function (geojson, l) {\r\n            if (layer.popupInfo !== undefined) {\r\n              var popupContent = createPopupContent(layer.popupInfo, geojson.properties);\r\n              l.bindPopup(popupContent);\r\n            }\r\n            if (layer.layerDefinition.drawingInfo.labelingInfo !== undefined) {\r\n              var labelingInfo = layer.layerDefinition.drawingInfo.labelingInfo;\r\n\r\n              var labelPos;\r\n              var centralKey;\r\n              var c, c2;\r\n              var offset = [0, 0];\r\n\r\n              if (l.feature.geometry.type === 'Point') {\r\n                labelPos = l.feature.geometry.coordinates.reverse();\r\n                offset = [20, 20];\r\n              } else if (l.feature.geometry.type === 'LineString') {\r\n                c = l.feature.geometry.coordinates;\r\n                centralKey = Math.round(c.length / 2);\r\n                labelPos = c[centralKey].reverse();\r\n              } else if (l.feature.geometry.type === 'MultiLineString') {\r\n                c = l.feature.geometry.coordinates;\r\n                centralKey = Math.round(c.length / 2);\r\n                c2 = c[centralKey];\r\n                centralKey = Math.round(c2.length / 2);\r\n\r\n                labelPos = c2[centralKey].reverse();\r\n              } else {\r\n                labelPos = l.getBounds().getCenter();\r\n              }\r\n\r\n              var label = labelMarker(labelPos, {\r\n                zIndexOffset: 1,\r\n                properties: geojson.properties,\r\n                labelingInfo: labelingInfo,\r\n                offset: offset\r\n              });\r\n\r\n              labelsLayer.addLayer(label);\r\n            }\r\n          }\r\n        });\r\n\r\n        lyr = L.layerGroup([lyr, labelsLayer]);\r\n\r\n        layers.push({ type: 'FL', title: layer.title || '', layer: lyr });\r\n\r\n        return lyr;\r\n      }\r\n    } else {\r\n      console.log('create ArcGISFeatureLayer (without layerDefinition.drawingInfo)');\r\n\r\n      if (layer.layerDefinition.definitionExpression !== undefined) {\r\n        where = layer.layerDefinition.definitionExpression;\r\n      }\r\n\r\n      lyr = L.esri.featureLayer({\r\n        url: layer.url,\r\n        where: where,\r\n        onEachFeature: function (geojson, l) {\r\n          if (layer.popupInfo !== undefined) {\r\n            var popupContent = createPopupContent(layer.popupInfo, geojson.properties);\r\n            l.bindPopup(popupContent);\r\n          }\r\n        }\r\n      });\r\n\r\n      layers.push({ type: 'FL', title: layer.title || '', layer: lyr });\r\n\r\n      return lyr;\r\n    }\r\n  } else if (layer.layerType === 'ArcGISFeatureLayer') {\r\n    console.log('create ArcGISFeatureLayer');\r\n    lyr = L.esri.featureLayer({\r\n      url: layer.url,\r\n      onEachFeature: function (geojson, l) {\r\n        if (layer.popupInfo !== undefined) {\r\n          var popupContent = createPopupContent(layer.popupInfo, geojson.properties);\r\n          l.bindPopup(popupContent);\r\n        }\r\n      },\r\n      pointToLayer: function (geojson, latlng) {\r\n        var f = L.marker(latlng, {\r\n          // icon: icon,\r\n          opacity: layer.opacity\r\n        });\r\n\r\n        return f;\r\n      }\r\n    });\r\n\r\n    layers.push({ type: 'FL', title: layer.title || '', layer: lyr });\r\n\r\n    return lyr;\r\n  } else if (layer.layerType === 'ArcGISImageServiceLayer') {\r\n    console.log('create ArcGISImageServiceLayer');\r\n    lyr = L.esri.imageMapLayer({\r\n      url: layer.url\r\n    });\r\n\r\n    layers.push({ type: 'IML', title: layer.title || '', layer: lyr });\r\n\r\n    return lyr;\r\n  } else if (layer.layerType === 'ArcGISMapServiceLayer') {\r\n    lyr = L.esri.dynamicMapLayer({\r\n      url: layer.url\r\n    });\r\n\r\n    layers.push({ type: 'DML', title: layer.title || '', layer: lyr });\r\n\r\n    return lyr;\r\n  } else if (layer.layerType === 'ArcGISTiledMapServiceLayer') {\r\n    try {\r\n      lyr = L.esri.basemapLayer(layer.title);\r\n    } catch (e) {\r\n      lyr = L.esri.tiledMapLayer({\r\n        url: layer.url\r\n      });\r\n\r\n      L.esri.request(layer.url, {}, function (err, res) {\r\n        if (err) {\r\n          console.log(err);\r\n        } else {\r\n          var maxWidth = (map.getSize().x - 55);\r\n          var tiledAttribution = '<span class=\"esri-attributions\" style=\"line-height:14px; vertical-align: -3px; text-overflow:ellipsis; white-space:nowrap; overflow:hidden; display:inline-block; max-width:' + maxWidth + 'px;\">' + res.copyrightText + '</span>';\r\n          map.attributionControl.addAttribution(tiledAttribution);\r\n        }\r\n      });\r\n    }\r\n\r\n    layers.push({ type: 'TML', title: layer.title || '', layer: lyr });\r\n\r\n    return lyr;\r\n  } else if (layer.layerType === 'OpenStreetMap') {\r\n    lyr = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\r\n      attribution: '&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\r\n    });\r\n\r\n    layers.push({ type: 'TL', title: layer.title || layer.id || '', layer: lyr });\r\n\r\n    return lyr;\r\n  } else if (layer.layerType === 'WebTiledLayer') {\r\n    var lyrUrl = _esriWTLUrlTemplateToLeaflet(layer.templateUrl);\r\n    lyr = L.tileLayer(lyrUrl, {\r\n      attribution: layer.copyright\r\n    });\r\n\r\n    layers.push({ type: 'TL', title: layer.title || layer.id || '', layer: lyr });\r\n\r\n    return lyr;\r\n  } else {\r\n    lyr = L.featureGroup([]);\r\n    console.log('Unsupported Layer: ', layer);\r\n    return lyr;\r\n  }\r\n}\r\n\r\nexport function _esriWTLUrlTemplateToLeaflet (url) {\r\n  var newUrl = url;\r\n\r\n  newUrl = newUrl.replace(/\\{level}/g, '{z}');\r\n  newUrl = newUrl.replace(/\\{col}/g, '{x}');\r\n  newUrl = newUrl.replace(/\\{row}/g, '{y}');\r\n\r\n  return newUrl;\r\n}\r\n\r\nexport var OperationalLayer = {\r\n  operationalLayer: operationalLayer,\r\n  _generateEsriLayer: _generateEsriLayer,\r\n  _esriWTLUrlTemplateToLeaflet: _esriWTLUrlTemplateToLeaflet\r\n};\r\n\r\nexport default OperationalLayer;\r\n","/*\r\n * L.esri.WebMap\r\n * A leaflet plugin to display ArcGIS Web Map. https://github.com/ynunokawa/L.esri.WebMap\r\n * (c) 2016 Yusuke Nunokawa\r\n *\r\n * @example\r\n *\r\n * ```js\r\n * var webmap = L.webmap('22c504d229f14c789c5b49ebff38b941', { map: L.map('map') });\r\n * ```\r\n */\r\n\r\nimport { version } from '../package.json';\r\n\r\nimport L from 'leaflet';\r\nimport { operationalLayer } from './OperationalLayer';\r\n\r\nexport var WebMap = L.Evented.extend({\r\n  options: {\r\n    // L.Map\r\n    map: {},\r\n    // access token for secure contents on ArcGIS Online\r\n    token: null\r\n  },\r\n\r\n  initialize: function (webmapId, options) {\r\n    L.setOptions(this, options);\r\n\r\n    this._map = this.options.map;\r\n    this._token = this.options.token;\r\n    this._webmapId = webmapId;\r\n    this._loaded = false;\r\n    this._metadataLoaded = false;\r\n\r\n    this.layers = []; // Check the layer types here -> https://github.com/ynunokawa/L.esri.WebMap/wiki/Layer-types\r\n    this.title = ''; // Web Map Title\r\n    this.bookmarks = []; // Web Map Bookmarks -> [{ name: 'Bookmark name', bounds: <L.latLngBounds> }]\r\n    this.portalItem = {}; // Web Map Metadata\r\n\r\n    this.VERSION = version;\r\n\r\n    this._loadWebMapMetaData(webmapId);\r\n    this._loadWebMap(webmapId);\r\n  },\r\n\r\n  _loadWebMapMetaData: function (id) {\r\n    var map = this._map;\r\n    var webmap = this;\r\n    var webmapMetaDataRequestUrl = 'https://www.arcgis.com/sharing/rest/content/items/' + id;\r\n\r\n    L.esri.request(webmapMetaDataRequestUrl, {}, function (error, response) {\r\n      if (error) {\r\n        console.log(error);\r\n      } else {\r\n        console.log('WebMap MetaData: ', response);\r\n        webmap.portalItem = response;\r\n        webmap.title = response.title;\r\n        webmap._metadataLoaded = true;\r\n        webmap.fire('metadataLoad');\r\n        map.fitBounds([response.extent[0].reverse(), response.extent[1].reverse()]);\r\n      }\r\n    });\r\n  },\r\n\r\n  _loadWebMap: function (id) {\r\n    var map = this._map;\r\n    var layers = this.layers;\r\n    var webmapRequestUrl = 'https://www.arcgis.com/sharing/rest/content/items/' + id + '/data';\r\n\r\n    L.esri.request(webmapRequestUrl, {}, function (error, response) {\r\n      if (error) {\r\n        console.log(error);\r\n      } else {\r\n        console.log('WebMap: ', response);\r\n\r\n        // Add Basemap\r\n        response.baseMap.baseMapLayers.map(function (baseMapLayer) {\r\n          var lyr = operationalLayer(baseMapLayer, layers, map).addTo(map);\r\n          if (lyr !== undefined && baseMapLayer.visibility === true) {\r\n            lyr.addTo(map);\r\n          }\r\n        });\r\n\r\n        // Add Operational Layers\r\n        response.operationalLayers.map(function (layer) {\r\n          var lyr = operationalLayer(layer, layers, map);\r\n          if (lyr !== undefined && layer.visibility === true) {\r\n            lyr.addTo(map);\r\n          }\r\n        });\r\n\r\n        // Add Bookmarks\r\n        if (response.bookmarks !== undefined && response.bookmarks.length > 0) {\r\n          response.bookmarks.map(function (bookmark) {\r\n            // Esri Extent Geometry to L.latLngBounds\r\n            var northEast = L.Projection.SphericalMercator.unproject(L.point(bookmark.extent.xmax, bookmark.extent.ymax));\r\n            var southWest = L.Projection.SphericalMercator.unproject(L.point(bookmark.extent.xmin, bookmark.extent.ymin));\r\n            var bounds = L.latLngBounds(southWest, northEast);\r\n            this.bookmarks.push({ name: bookmark.name, bounds: bounds });\r\n          }.bind(this));\r\n        }\r\n\r\n        this._loaded = true;\r\n        this.fire('load');\r\n      }\r\n    }.bind(this));\r\n  }\r\n});\r\n\r\nexport function webMap (webmapId, options) {\r\n  return new WebMap(webmapId, options);\r\n}\r\n\r\nexport default webMap;\r\n","import L from 'leaflet';\n\nexport var Symbol = L.Class.extend({\n  initialize: function (symbolJson, options) {\n    this._symbolJson = symbolJson;\n    this.val = null;\n    this._styles = {};\n    this._isDefault = false;\n    this._layerTransparency = 1;\n    if (options && options.layerTransparency) {\n      this._layerTransparency = 1 - (options.layerTransparency / 100.0);\n    }\n  },\n\n  // the geojson values returned are in points\n  pixelValue: function (pointValue) {\n    return pointValue * 1.333;\n  },\n\n  // color is an array [r,g,b,a]\n  colorValue: function (color) {\n    return 'rgb(' + color[0] + ',' + color[1] + ',' + color[2] + ')';\n  },\n\n  alphaValue: function (color) {\n    var alpha = color[3] / 255.0;\n    return alpha * this._layerTransparency;\n  },\n\n  getSize: function (feature, sizeInfo) {\n    var attr = feature.properties;\n    var field = sizeInfo.field;\n    var size = 0;\n    var featureValue = null;\n\n    if (field) {\n      featureValue = attr[field];\n      var minSize = sizeInfo.minSize;\n      var maxSize = sizeInfo.maxSize;\n      var minDataValue = sizeInfo.minDataValue;\n      var maxDataValue = sizeInfo.maxDataValue;\n      var featureRatio;\n      var normField = sizeInfo.normalizationField;\n      var normValue = attr ? parseFloat(attr[normField]) : undefined;\n\n      if (featureValue === null || (normField && ((isNaN(normValue) || normValue === 0)))) {\n        return null;\n      }\n\n      if (!isNaN(normValue)) {\n        featureValue /= normValue;\n      }\n\n      if (minSize !== null && maxSize !== null && minDataValue !== null && maxDataValue !== null) {\n        if (featureValue <= minDataValue) {\n          size = minSize;\n        } else if (featureValue >= maxDataValue) {\n          size = maxSize;\n        } else {\n          featureRatio = (featureValue - minDataValue) / (maxDataValue - minDataValue);\n          size = minSize + (featureRatio * (maxSize - minSize));\n        }\n      }\n      size = isNaN(size) ? 0 : size;\n    }\n    return size;\n  },\n\n  getColor: function (feature, colorInfo) {\n    // required information to get color\n    if (!(feature.properties && colorInfo && colorInfo.field && colorInfo.stops)) {\n      return null;\n    }\n\n    var attr = feature.properties;\n    var featureValue = attr[colorInfo.field];\n    var lowerBoundColor, upperBoundColor, lowerBound, upperBound;\n    var normField = colorInfo.normalizationField;\n    var normValue = attr ? parseFloat(attr[normField]) : undefined;\n    if (featureValue === null || (normField && ((isNaN(normValue) || normValue === 0)))) {\n      return null;\n    }\n\n    if (!isNaN(normValue)) {\n      featureValue /= normValue;\n    }\n\n    if (featureValue <= colorInfo.stops[0].value) {\n      return colorInfo.stops[0].color;\n    }\n    var lastStop = colorInfo.stops[colorInfo.stops.length - 1];\n    if (featureValue >= lastStop.value) {\n      return lastStop.color;\n    }\n\n    // go through the stops to find min and max\n    for (var i = 0; i < colorInfo.stops.length; i++) {\n      var stopInfo = colorInfo.stops[i];\n\n      if (stopInfo.value <= featureValue) {\n        lowerBoundColor = stopInfo.color;\n        lowerBound = stopInfo.value;\n      } else if (stopInfo.value > featureValue) {\n        upperBoundColor = stopInfo.color;\n        upperBound = stopInfo.value;\n        break;\n      }\n    }\n\n    // feature falls between two stops, interplate the colors\n    if (!isNaN(lowerBound) && !isNaN(upperBound)) {\n      var range = upperBound - lowerBound;\n      if (range > 0) {\n        // more weight the further it is from the lower bound\n        var upperBoundColorWeight = (featureValue - lowerBound) / range;\n        if (upperBoundColorWeight) {\n          // more weight the further it is from the upper bound\n          var lowerBoundColorWeight = (upperBound - featureValue) / range;\n          if (lowerBoundColorWeight) {\n            // interpolate the lower and upper bound color by applying the\n            // weights to each of the rgba colors and adding them together\n            var interpolatedColor = [];\n            for (var j = 0; j < 4; j++) {\n              interpolatedColor[j] = Math.round(lowerBoundColor[j] * lowerBoundColorWeight + upperBoundColor[j] * upperBoundColorWeight);\n            }\n            return interpolatedColor;\n          } else {\n            // no difference between featureValue and upperBound, 100% of upperBoundColor\n            return upperBoundColor;\n          }\n        } else {\n          // no difference between featureValue and lowerBound, 100% of lowerBoundColor\n          return lowerBoundColor;\n        }\n      }\n    }\n    // if we get to here, none of the cases apply so return null\n    return null;\n  }\n});\n\n// export function symbol (symbolJson) {\n//   return new Symbol(symbolJson);\n// }\n\nexport default Symbol;\n","import L from 'leaflet';\n\nexport var ShapeMarker = L.Path.extend({\n\n  initialize: function (latlng, size, options) {\n    L.setOptions(this, options);\n    this._size = size;\n    this._latlng = L.latLng(latlng);\n    this._svgCanvasIncludes();\n  },\n\n  toGeoJSON: function () {\n    return L.GeoJSON.getFeature(this, {\n      type: 'Point',\n      coordinates: L.GeoJSON.latLngToCoords(this.getLatLng())\n    });\n  },\n\n  _svgCanvasIncludes: function () {\n    // implement in sub class\n  },\n\n  _project: function () {\n    this._point = this._map.latLngToLayerPoint(this._latlng);\n  },\n\n  _update: function () {\n    if (this._map) {\n      this._updatePath();\n    }\n  },\n\n  _updatePath: function () {\n    // implement in sub class\n  },\n\n  setLatLng: function (latlng) {\n    this._latlng = L.latLng(latlng);\n    this.redraw();\n    return this.fire('move', {latlng: this._latlng});\n  },\n\n  getLatLng: function () {\n    return this._latlng;\n  },\n\n  setSize: function (size) {\n    this._size = size;\n    return this.redraw();\n  },\n\n  getSize: function () {\n    return this._size;\n  }\n});\n","import L from 'leaflet';\nimport { ShapeMarker } from './ShapeMarker';\n\nexport var CrossMarker = ShapeMarker.extend({\n\n  initialize: function (latlng, size, options) {\n    ShapeMarker.prototype.initialize.call(this, latlng, size, options);\n  },\n\n  _updatePath: function () {\n    this._renderer._updateCrossMarker(this);\n  },\n\n  _svgCanvasIncludes: function () {\n    L.Canvas.include({\n      _updateCrossMarker: function (layer) {\n        var latlng = layer._point;\n        var offset = layer._size / 2.0;\n        var ctx = this._ctx;\n\n        ctx.beginPath();\n        ctx.moveTo(latlng.x, latlng.y + offset);\n        ctx.lineTo(latlng.x, latlng.y - offset);\n        this._fillStroke(ctx, layer);\n\n        ctx.moveTo(latlng.x - offset, latlng.y);\n        ctx.lineTo(latlng.x + offset, latlng.y);\n        this._fillStroke(ctx, layer);\n      }\n    });\n\n    L.SVG.include({\n      _updateCrossMarker: function (layer) {\n        var latlng = layer._point;\n        var offset = layer._size / 2.0;\n\n        if (L.Browser.vml) {\n          latlng._round();\n          offset = Math.round(offset);\n        }\n\n        var str = 'M' + latlng.x + ',' + (latlng.y + offset) +\n          'L' + latlng.x + ',' + (latlng.y - offset) +\n          'M' + (latlng.x - offset) + ',' + latlng.y +\n          'L' + (latlng.x + offset) + ',' + latlng.y;\n\n        this._setPath(layer, str);\n      }\n    });\n  }\n});\n\nexport var crossMarker = function (latlng, size, options) {\n  return new CrossMarker(latlng, size, options);\n};\n\nexport default crossMarker;\n","import L from 'leaflet';\nimport { ShapeMarker } from './ShapeMarker';\n\nexport var XMarker = ShapeMarker.extend({\n\n  initialize: function (latlng, size, options) {\n    ShapeMarker.prototype.initialize.call(this, latlng, size, options);\n  },\n\n  _updatePath: function () {\n    this._renderer._updateXMarker(this);\n  },\n\n  _svgCanvasIncludes: function () {\n    L.Canvas.include({\n      _updateXMarker: function (layer) {\n        var latlng = layer._point;\n        var offset = layer._size / 2.0;\n        var ctx = this._ctx;\n\n        ctx.beginPath();\n\n        ctx.moveTo(latlng.x + offset, latlng.y + offset);\n        ctx.lineTo(latlng.x - offset, latlng.y - offset);\n        this._fillStroke(ctx, layer);\n      }\n    });\n\n    L.SVG.include({\n      _updateXMarker: function (layer) {\n        var latlng = layer._point;\n        var offset = layer._size / 2.0;\n\n        if (L.Browser.vml) {\n          latlng._round();\n          offset = Math.round(offset);\n        }\n\n        var str = 'M' + (latlng.x + offset) + ',' + (latlng.y + offset) +\n          'L' + (latlng.x - offset) + ',' + (latlng.y - offset) +\n          'M' + (latlng.x - offset) + ',' + (latlng.y + offset) +\n          'L' + (latlng.x + offset) + ',' + (latlng.y - offset);\n\n        this._setPath(layer, str);\n      }\n    });\n  }\n});\n\nexport var xMarker = function (latlng, size, options) {\n  return new XMarker(latlng, size, options);\n};\n\nexport default xMarker;\n","import L from 'leaflet';\nimport { ShapeMarker } from './ShapeMarker';\n\nexport var SquareMarker = ShapeMarker.extend({\n  options: {\n    fill: true\n  },\n\n  initialize: function (latlng, size, options) {\n    ShapeMarker.prototype.initialize.call(this, latlng, size, options);\n  },\n\n  _updatePath: function () {\n    this._renderer._updateSquareMarker(this);\n  },\n\n  _svgCanvasIncludes: function () {\n    L.Canvas.include({\n      _updateSquareMarker: function (layer) {\n        var latlng = layer._point;\n        var offset = layer._size / 2.0;\n        var ctx = this._ctx;\n\n        ctx.beginPath();\n\n        ctx.moveTo(latlng.x + offset, latlng.y + offset);\n        ctx.lineTo(latlng.x - offset, latlng.y + offset);\n        ctx.lineTo(latlng.x - offset, latlng.y - offset);\n        ctx.lineTo(latlng.x + offset, latlng.y - offset);\n\n        ctx.closePath();\n\n        this._fillStroke(ctx, layer);\n      }\n    });\n\n    L.SVG.include({\n      _updateSquareMarker: function (layer) {\n        var latlng = layer._point;\n        var offset = layer._size / 2.0;\n\n        if (L.Browser.vml) {\n          latlng._round();\n          offset = Math.round(offset);\n        }\n\n        var str = 'M' + (latlng.x + offset) + ',' + (latlng.y + offset) +\n          'L' + (latlng.x - offset) + ',' + (latlng.y + offset) +\n          'L' + (latlng.x - offset) + ',' + (latlng.y - offset) +\n          'L' + (latlng.x + offset) + ',' + (latlng.y - offset);\n\n        str = str + (L.Browser.svg ? 'z' : 'x');\n\n        this._setPath(layer, str);\n      }\n    });\n  }\n});\n\nexport var squareMarker = function (latlng, size, options) {\n  return new SquareMarker(latlng, size, options);\n};\n\nexport default squareMarker;\n","import L from 'leaflet';\nimport { ShapeMarker } from './ShapeMarker';\n\nexport var DiamondMarker = ShapeMarker.extend({\n  options: {\n    fill: true\n  },\n\n  initialize: function (latlng, size, options) {\n    ShapeMarker.prototype.initialize.call(this, latlng, size, options);\n  },\n\n  _updatePath: function () {\n    this._renderer._updateDiamondMarker(this);\n  },\n\n  _svgCanvasIncludes: function () {\n    L.Canvas.include({\n      _updateDiamondMarker: function (layer) {\n        var latlng = layer._point;\n        var offset = layer._size / 2.0;\n        var ctx = this._ctx;\n\n        ctx.beginPath();\n\n        ctx.moveTo(latlng.x, latlng.y + offset);\n        ctx.lineTo(latlng.x - offset, latlng.y);\n        ctx.lineTo(latlng.x, latlng.y - offset);\n        ctx.lineTo(latlng.x + offset, latlng.y);\n\n        ctx.closePath();\n\n        this._fillStroke(ctx, layer);\n      }\n    });\n\n    L.SVG.include({\n      _updateDiamondMarker: function (layer) {\n        var latlng = layer._point;\n        var offset = layer._size / 2.0;\n\n        if (L.Browser.vml) {\n          latlng._round();\n          offset = Math.round(offset);\n        }\n\n        var str = 'M' + latlng.x + ',' + (latlng.y + offset) +\n          'L' + (latlng.x - offset) + ',' + latlng.y +\n          'L' + latlng.x + ',' + (latlng.y - offset) +\n          'L' + (latlng.x + offset) + ',' + latlng.y;\n\n        str = str + (L.Browser.svg ? 'z' : 'x');\n\n        this._setPath(layer, str);\n      }\n    });\n  }\n});\n\nexport var diamondMarker = function (latlng, size, options) {\n  return new DiamondMarker(latlng, size, options);\n};\n\nexport default diamondMarker;\n","import L from 'leaflet';\n\nimport pointSymbol from '../Symbols/PointSymbol';\nimport lineSymbol from '../Symbols/LineSymbol';\nimport polygonSymbol from '../Symbols/PolygonSymbol';\n\nexport var Renderer = L.Class.extend({\n  options: {\n    proportionalPolygon: false,\n    clickable: true\n  },\n\n  initialize: function (rendererJson, options) {\n    this._rendererJson = rendererJson;\n    this._pointSymbols = false;\n    this._symbols = [];\n    this._visualVariables = this._parseVisualVariables(rendererJson.visualVariables);\n    L.Util.setOptions(this, options);\n  },\n\n  _parseVisualVariables: function (visualVariables) {\n    var visVars = {};\n    if (visualVariables) {\n      for (var i = 0; i < visualVariables.length; i++) {\n        visVars[visualVariables[i].type] = visualVariables[i];\n      }\n    }\n    return visVars;\n  },\n\n  _createDefaultSymbol: function () {\n    if (this._rendererJson.defaultSymbol) {\n      this._defaultSymbol = this._newSymbol(this._rendererJson.defaultSymbol);\n      this._defaultSymbol._isDefault = true;\n    }\n  },\n\n  _newSymbol: function (symbolJson) {\n    if (symbolJson.type === 'esriSMS' || symbolJson.type === 'esriPMS') {\n      this._pointSymbols = true;\n      return pointSymbol(symbolJson, this.options);\n    }\n    if (symbolJson.type === 'esriSLS') {\n      return lineSymbol(symbolJson, this.options);\n    }\n    if (symbolJson.type === 'esriSFS') {\n      return polygonSymbol(symbolJson, this.options);\n    }\n  },\n\n  _getSymbol: function () {\n    // override\n  },\n\n  attachStylesToLayer: function (layer) {\n    if (this._pointSymbols) {\n      layer.options.pointToLayer = L.Util.bind(this.pointToLayer, this);\n    } else {\n      layer.options.style = L.Util.bind(this.style, this);\n      layer._originalStyle = layer.options.style;\n    }\n  },\n\n  pointToLayer: function (geojson, latlng) {\n    var sym = this._getSymbol(geojson);\n    if (sym && sym.pointToLayer) {\n      // right now custom panes are the only option pushed through\n      return sym.pointToLayer(geojson, latlng, this._visualVariables, this.options);\n    }\n    // invisible symbology\n    return L.circleMarker(latlng, {radius: 0, opacity: 0});\n  },\n\n  style: function (feature) {\n    var userStyles;\n    if (this.options.userDefinedStyle) {\n      userStyles = this.options.userDefinedStyle(feature);\n    }\n    // find the symbol to represent this feature\n    var sym = this._getSymbol(feature);\n    if (sym) {\n      return this.mergeStyles(sym.style(feature, this._visualVariables), userStyles);\n    } else {\n      // invisible symbology\n      return this.mergeStyles({opacity: 0, fillOpacity: 0}, userStyles);\n    }\n  },\n\n  mergeStyles: function (styles, userStyles) {\n    var mergedStyles = {};\n    var attr;\n    // copy renderer style attributes\n    for (attr in styles) {\n      if (styles.hasOwnProperty(attr)) {\n        mergedStyles[attr] = styles[attr];\n      }\n    }\n    // override with user defined style attributes\n    if (userStyles) {\n      for (attr in userStyles) {\n        if (userStyles.hasOwnProperty(attr)) {\n          mergedStyles[attr] = userStyles[attr];\n        }\n      }\n    }\n    return mergedStyles;\n  }\n});\n\nexport default Renderer;\n","import L from 'leaflet';\n\nimport classBreaksRenderer from './Renderers/ClassBreaksRenderer';\nimport uniqueValueRenderer from './Renderers/UniqueValueRenderer';\nimport simpleRenderer from './Renderers/SimpleRenderer';\n\nL.esri.FeatureLayer.addInitHook(function () {\n  if (this.options.ignoreRenderer) {\n    return;\n  }\n  var oldOnAdd = L.Util.bind(this.onAdd, this);\n  var oldUnbindPopup = L.Util.bind(this.unbindPopup, this);\n  var oldOnRemove = L.Util.bind(this.onRemove, this);\n  L.Util.bind(this.createNewLayer, this);\n\n  this.onAdd = function (map) {\n    this.metadata(function (error, response) {\n      if (error) {\n        console.warn('failed to load metadata from the service.');\n        return\n      } if (response && response.drawingInfo) {\n        if(this.options.drawingInfo) {\n          // allow L.esri.webmap (and others) to override service symbology with info provided in layer constructor\n          var serviceMetadata = response;\n          serviceMetadata.drawingInfo = this.options.drawingInfo;\n          this._setRenderers(serviceMetadata);\n        } else {\n          this._setRenderers(response);\n        }\n        this._setRenderers(response);\n        oldOnAdd(map);\n        this._addPointLayer(map);\n      }\n    }, this);\n  };\n\n  this.onRemove = function (map) {\n    oldOnRemove(map);\n    if (this._pointLayer) {\n      var pointLayers = this._pointLayer.getLayers();\n      for (var i in pointLayers) {\n        map.removeLayer(pointLayers[i]);\n      }\n    }\n  };\n\n  this.unbindPopup = function () {\n    oldUnbindPopup();\n    if (this._pointLayer) {\n      var pointLayers = this._pointLayer.getLayers();\n      for (var i in pointLayers) {\n        pointLayers[i].unbindPopup();\n      }\n    }\n  };\n\n  this._addPointLayer = function (map) {\n    if (this._pointLayer) {\n      this._pointLayer.addTo(map);\n      this._pointLayer.bringToFront();\n    }\n  };\n\n  this._createPointLayer = function () {\n    if (!this._pointLayer) {\n      this._pointLayer = L.geoJson();\n      // store the feature ids that have already been added to the map\n      this._pointLayerIds = {};\n\n      if (this._popup) {\n        var popupFunction = function (feature, layer) {\n          layer.bindPopup(this._popup(feature, layer), this._popupOptions);\n        };\n        this._pointLayer.options.onEachFeature = L.Util.bind(popupFunction, this);\n      }\n    }\n  };\n\n  this.createNewLayer = function (geojson) {\n    var fLayer = L.GeoJSON.geometryToLayer(geojson, this.options);\n\n    // add a point layer when the polygon is represented as proportional marker symbols\n    if (this._hasProportionalSymbols) {\n      var centroid = this.getPolygonCentroid(geojson.geometry.coordinates);\n      if (!(isNaN(centroid[0]) || isNaN(centroid[0]))) {\n        this._createPointLayer();\n\n        var featureId = geojson.id.toString();\n        // only add the feature if it does not already exist on the map\n        if (!this._pointLayerIds[featureId]) {\n          var pointjson = this.getPointJson(geojson, centroid);\n\n          this._pointLayer.addData(pointjson);\n          this._pointLayerIds[featureId] = true;\n        }\n\n        this._pointLayer.bringToFront();\n      }\n    }\n    return fLayer;\n  };\n\n  this.getPolygonCentroid = function (coordinates) {\n    var pts = coordinates[0][0];\n    if (pts.length === 2) {\n      pts = coordinates[0];\n    }\n\n    var twicearea = 0;\n    var x = 0;\n    var y = 0;\n    var nPts = pts.length;\n    var p1;\n    var p2;\n    var f;\n\n    for (var i = 0, j = nPts - 1; i < nPts; j = i++) {\n      p1 = pts[i]; p2 = pts[j];\n      twicearea += p1[0] * p2[1];\n      twicearea -= p1[1] * p2[0];\n      f = p1[0] * p2[1] - p2[0] * p1[1];\n      x += (p1[0] + p2[0]) * f;\n      y += (p1[1] + p2[1]) * f;\n    }\n    f = twicearea * 3;\n    return [x / f, y / f];\n  };\n\n  this.getPointJson = function (geojson, centroid) {\n    return {\n      type: 'Feature',\n      properties: geojson.properties,\n      id: geojson.id,\n      geometry: {\n        type: 'Point',\n        coordinates: [centroid[0], centroid[1]]\n      }\n    };\n  };\n\n  this._checkForProportionalSymbols = function (geometryType, renderer) {\n    this._hasProportionalSymbols = false;\n    if (geometryType === 'esriGeometryPolygon') {\n      if (renderer.backgroundFillSymbol) {\n        this._hasProportionalSymbols = true;\n      }\n      // check to see if the first symbol in the classbreaks is a marker symbol\n      if (renderer.classBreakInfos && renderer.classBreakInfos.length) {\n        var sym = renderer.classBreakInfos[0].symbol;\n        if (sym && (sym.type === 'esriSMS' || sym.type === 'esriPMS')) {\n          this._hasProportionalSymbols = true;\n        }\n      }\n    }\n  };\n\n  this._setRenderers = function (geojson) {\n    var rend;\n    var rendererInfo = geojson.drawingInfo.renderer;\n\n    var options = {\n      url: this.options.url\n    };\n\n    if (this.options.token) {\n      options.token = this.options.token;\n    }\n    if (this.options.pane) {\n      options.pane = this.options.pane;\n    }\n    if (geojson.drawingInfo.transparency) {\n      options.layerTransparency = geojson.drawingInfo.transparency;\n    }\n    if (this.options.style) {\n      options.userDefinedStyle = this.options.style;\n    }\n\n    switch (rendererInfo.type) {\n      case 'classBreaks':\n        this._checkForProportionalSymbols(geojson.geometryType, rendererInfo);\n        if (this._hasProportionalSymbols) {\n          this._createPointLayer();\n          var pRend = classBreaksRenderer(rendererInfo, options);\n          pRend.attachStylesToLayer(this._pointLayer);\n          options.proportionalPolygon = true;\n        }\n        rend = classBreaksRenderer(rendererInfo, options);\n        break;\n      case 'uniqueValue':\n        rend = uniqueValueRenderer(rendererInfo, options);\n        break;\n      default:\n        rend = simpleRenderer(rendererInfo, options);\n    }\n    rend.attachStylesToLayer(this);\n  };\n\n  this.metadata(function (error, response) {\n    if (error) {\n      return;\n    } if (response && response.drawingInfo) {\n      // if drawingInfo from a webmap is supplied in the layer constructor, use that instead\n      if (this.options.drawingInfo) {\n        response.drawingInfo = this.options.drawingInfo;\n      }\n      this._setRenderers(response);\n    } if (this._alreadyAdded) {\n      this.setStyle(this._originalStyle);\n    }\n  }, this);\n});\n"],"names":["pointSymbol","symbolJson","options","PointSymbol","lineSymbol","LineSymbol","polygonSymbol","PolygonSymbol","simpleRenderer","rendererJson","SimpleRenderer","classBreaksRenderer","ClassBreaksRenderer","uniqueValueRenderer","UniqueValueRenderer","featureCollection","geojson","FeatureCollection","labelMarker","latlng","LabelMarker","createPopupContent","popupInfo","properties","r","titleText","content","undefined","title","replace","s","m","exec","i","fieldInfos","length","visible","label","fieldName","mediaInfos","operationalLayer","layer","layers","map","_generateEsriLayer","console","log","lyr","labelsLayer","labels","layerDefinition","drawingInfo","labelingInfo","featureSet","features","feature","mercatorToLatlng","L","Projection","SphericalMercator","unproject","point","geometry","x","y","zIndexOffset","attributes","offset","push","data","itemId","opacity","renderer","onEachFeature","l","popupContent","bindPopup","featureGroup","layerGroup","type","layerType","where","gradient","colorStops","stop","Math","round","ratio","color","esri","Heat","heatmapFeatureLayer","url","minOpacity","max","maxPixelIntensity","blur","blurRadius","radius","definitionExpression","featureLayer","labelPos","centralKey","c","c2","coordinates","reverse","getBounds","getCenter","addLayer","pointToLayer","f","marker","imageMapLayer","dynamicMapLayer","basemapLayer","e","tiledMapLayer","request","err","res","maxWidth","getSize","tiledAttribution","copyrightText","attributionControl","addAttribution","tileLayer","attribution","id","lyrUrl","_esriWTLUrlTemplateToLeaflet","templateUrl","copyright","newUrl","webMap","webmapId","WebMap","Symbol","Class","extend","initialize","this","_symbolJson","val","_styles","_isDefault","_layerTransparency","layerTransparency","pixelValue","pointValue","colorValue","alphaValue","alpha","sizeInfo","attr","field","size","featureValue","featureRatio","minSize","maxSize","minDataValue","maxDataValue","normField","normalizationField","normValue","parseFloat","isNaN","getColor","colorInfo","stops","lowerBoundColor","upperBoundColor","lowerBound","upperBound","value","lastStop","stopInfo","range","upperBoundColorWeight","lowerBoundColorWeight","interpolatedColor","j","ShapeMarker","Path","setOptions","_size","_latlng","latLng","_svgCanvasIncludes","toGeoJSON","GeoJSON","getFeature","latLngToCoords","getLatLng","_project","_point","_map","latLngToLayerPoint","_update","_updatePath","setLatLng","redraw","fire","setSize","CrossMarker","prototype","call","_renderer","_updateCrossMarker","Canvas","include","ctx","_ctx","beginPath","moveTo","lineTo","_fillStroke","SVG","Browser","vml","_round","str","_setPath","crossMarker","XMarker","_updateXMarker","xMarker","SquareMarker","fill","_updateSquareMarker","closePath","svg","squareMarker","DiamondMarker","_updateDiamondMarker","diamondMarker","statics","MARKERTYPES","serviceUrl","_iconUrl","token","imageData","contentType","_icons","icon","_createIcon","_fillStyles","outline","stroke","weight","width","fillColor","fillOpacity","style","height","xOffset","yOffset","xoffset","yoffset","iconUrl","iconSize","iconAnchor","toString","_getIcon","visualVariables","calculatedSize","layerOptions","circleMarker","LINETYPES","lineCap","lineJoin","dashValues","dashArray","join","POLYGONTYPES","_lineStyles","styleAttr","indexOf","Renderer","proportionalPolygon","clickable","_rendererJson","_pointSymbols","_symbols","_visualVariables","_parseVisualVariables","Util","visVars","_createDefaultSymbol","defaultSymbol","_defaultSymbol","_newSymbol","_getSymbol","attachStylesToLayer","bind","_originalStyle","sym","userStyles","userDefinedStyle","mergeStyles","styles","mergedStyles","hasOwnProperty","_createSymbol","symbol","_field","normalizationType","_normalizationField","_createSymbols","classbreaks","classBreakInfos","backgroundFillSymbol","classMaxValue","sort","a","b","_maxValue","field1","uniques","uniqueValueInfos","fieldDelimiter","field2","val2","val3","field3","FeatureLayer","addInitHook","ignoreRenderer","oldOnAdd","onAdd","oldUnbindPopup","unbindPopup","oldOnRemove","onRemove","createNewLayer","metadata","error","response","warn","serviceMetadata","_setRenderers","_addPointLayer","_pointLayer","pointLayers","getLayers","removeLayer","addTo","bringToFront","_createPointLayer","geoJson","_pointLayerIds","_popup","popupFunction","_popupOptions","fLayer","geometryToLayer","_hasProportionalSymbols","centroid","getPolygonCentroid","featureId","pointjson","getPointJson","addData","pts","p1","p2","twicearea","nPts","_checkForProportionalSymbols","geometryType","rend","rendererInfo","pane","transparency","pRend","_alreadyAdded","setStyle","_layers","len","_getFeatureCollection","_parseFeatureCollection","_featureCollectionToGeoJSON","featuresArray","k","lng","lat","plen","points","pathlen","pathslen","paths","path","ringlen","ringslen","rings","ring","Marker","labelText","_createLabelText","_setLabelIcon","labelExpression","text","divIcon","className","html","setIcon","Evented","_token","_webmapId","_loaded","_metadataLoaded","bookmarks","portalItem","VERSION","version","_loadWebMapMetaData","_loadWebMap","webmap","webmapMetaDataRequestUrl","fitBounds","extent","webmapRequestUrl","baseMap","baseMapLayers","baseMapLayer","visibility","operationalLayers","bookmark","northEast","xmax","ymax","southWest","xmin","ymin","bounds","latLngBounds","name"],"mappings":"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"}