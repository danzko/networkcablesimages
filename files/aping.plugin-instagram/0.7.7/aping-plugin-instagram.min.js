/**
    @name: aping-plugin-instagram 
    @version: 0.7.7 (28-01-2016) 
    @author: Jonathan Hornung 
    @url: https://github.com/JohnnyTheTank/apiNG-plugin-instagram 
    @license: MIT
*/
"use strict";angular.module("jtt_aping_instagram",["jtt_instagram"]).directive("apingInstagram",["instagramFactory","apingInstagramHelper","apingUtilityHelper",function(a,b,c){return{require:"?aping",restrict:"A",replace:"false",link:function(d,e,f,g){var h=g.getAppSettings(),i=c.parseJsonFromAttributes(f.apingInstagram,b.getThisPlatformString(),h);i.forEach(function(d){var e={model:h.model};"undefined"!=typeof h.getNativeData?e.getNativeData=h.getNativeData:e.getNativeData=!1;var f={access_token:c.getApiCredentials(b.getThisPlatformString(),"access_token")};return"undefined"!=typeof d.items?f.count=d.items:f.count=h.items,0===f.count||"0"===f.count?!1:((f.count<0||isNaN(f.count))&&(f.count=void 0),f.count>33&&(f.count=33),void(d.userId?(f.userId=d.userId,a.getMediaFromUserById(f).then(function(a){g.concatToResults(b.getObjectByJsonData(a,e))})):d.tag?(f.tag=d.tag,a.getMediaByTag(f).then(function(a){g.concatToResults(b.getObjectByJsonData(a,e))})):d.locationId?(f.locationId=d.locationId,a.getMediaFromLocationById(f).then(function(a){g.concatToResults(b.getObjectByJsonData(a,e))})):d.lat&&d.lng&&(f.lat=d.lat,f.lng=d.lng,d.distance&&(f.distance=d.distance),a.getMediaByCoordinates(f).then(function(a){g.concatToResults(b.getObjectByJsonData(a,e))}))))})}}}]),angular.module("jtt_aping_instagram").service("apingInstagramHelper",["apingModels","apingTimeHelper","apingUtilityHelper",function(a,b,c){this.getThisPlatformString=function(){return"instagram"},this.getThisPlatformLink=function(){return"https://instagram.com/"},this.replaceHashtagWithoutSpaces=function(a){return a&&"string"==typeof a&&(a=a.replace(/#/g," #"),a=a.replace(/  #/g," #")),a},this.getObjectByJsonData=function(a,b){var c=[];if(a){var d=this;a.data&&a.data.data&&angular.forEach(a.data.data,function(a,e){var f;f=b.getNativeData===!0||"true"===b.getNativeData?d.getNativeItemByJsonData(a,b.model):d.getItemByJsonData(a,b.model),f&&c.push(f)})}return c},this.getItemByJsonData=function(a,b){var c={};if(a&&b)switch(b){case"social":c=this.getSocialItemByJsonData(a);break;case"video":c=this.getVideoItemByJsonData(a);break;case"image":c=this.getImageItemByJsonData(a);break;default:return!1}return c},this.getSocialItemByJsonData=function(b){var c=a.getNew("social",this.getThisPlatformString());return angular.extend(c,{blog_name:b.user.full_name||"@"+b.user.username,blog_id:"@"+b.user.username,blog_link:this.getThisPlatformLink()+b.user.username,intern_type:b.type,timestamp:1e3*parseInt(b.created_time),post_url:b.link,intern_id:b.id,text:b.caption?b.caption.text:void 0,likes:b.likes?b.likes.count:void 0,comments:b.comments?b.likes.comments:void 0,thumb_url:b.images.low_resolution.url,img_url:b.images.standard_resolution.url,native_url:b.images.standard_resolution.url.replace("s640x640/","")}),c.date_time=new Date(c.timestamp),c.text=this.replaceHashtagWithoutSpaces(c.text),"video"==b.type&&(c.type="video",c.source=b.videos),c},this.getVideoItemByJsonData=function(b){if("video"!=b.type)return!1;var c=a.getNew("video",this.getThisPlatformString());return angular.extend(c,{blog_name:b.user.full_name||"@"+b.user.username,blog_id:"@"+b.user.username,blog_link:this.getThisPlatformLink()+b.user.username,intern_type:b.type,timestamp:1e3*parseInt(b.created_time),post_url:b.link,intern_id:b.id,text:b.caption?b.caption.text:void 0,likes:b.likes?b.likes.count:void 0,comments:b.comments?b.likes.comments:void 0,type:"video",source:b.videos.standard_resolution?b.videos.standard_resolution.url:void 0,width:b.videos.standard_resolution?b.videos.standard_resolution.width:void 0,height:b.videos.standard_resolution?b.videos.standard_resolution.height:void 0,thumb_url:b.images.low_resolution.url,img_url:b.images.standard_resolution.url,native_url:b.images.standard_resolution.url.replace("s640x640/","")}),c.date_time=new Date(c.timestamp),c.text=this.replaceHashtagWithoutSpaces(c.text),c},this.getImageItemByJsonData=function(b){if("image"!=b.type)return!1;var c=a.getNew("image",this.getThisPlatformString());return angular.extend(c,{blog_name:b.user.full_name||"@"+b.user.username,blog_id:"@"+b.user.username,blog_link:this.getThisPlatformLink()+b.user.username,intern_type:b.type,timestamp:1e3*parseInt(b.created_time),post_url:b.link,intern_id:b.id,text:b.caption?b.caption.text:void 0,likes:b.likes?b.likes.count:void 0,comments:b.comments?b.likes.comments:void 0,thumb_url:b.images.low_resolution.url,thumb_width:b.images.low_resolution.width,thumb_height:b.images.low_resolution.height,img_url:b.images.standard_resolution.url,img_width:b.images.standard_resolution.width,img_height:b.images.standard_resolution.height,native_url:b.images.standard_resolution.url.replace("s640x640/",""),type:"image"}),c.date_time=new Date(c.timestamp),c.text=this.replaceHashtagWithoutSpaces(c.text),c},this.getNativeItemByJsonData=function(a,b){var c={};switch(b){case"image":if("image"!=a.type)return!1;c=a;break;case"video":if("video"!=a.type)return!1;c=a}return c=a}}]),angular.module("jtt_instagram",[]).factory("instagramFactory",["$http","instagramSearchDataService",function(a,b){var c={};return c.getUserById=function(c){var d=b.getNew("userById",c);return a.jsonp(d.url,{method:"GET",params:d.object})},c.getMediaFromUserById=function(c){var d=b.getNew("mediaFromUserById",c);return a.jsonp(d.url,{method:"GET",params:d.object})},c.getMediaByTag=function(c){var d=b.getNew("mediaByTag",c);return a.jsonp(d.url,{method:"GET",params:d.object})},c.getMediaFromLocationById=function(c){var d=b.getNew("mediaFromLocationById",c);return a.jsonp(d.url,{method:"GET",params:d.object})},c.getMediaByCoordinates=function(c){var d=b.getNew("mediaByCoordinates",c);return a.jsonp(d.url,{method:"GET",params:d.object})},c}]).service("instagramSearchDataService",function(){this.getApiBaseUrl=function(a){return"https://api.instagram.com/v1/"},this.fillDataInObjectByList=function(a,b,c){return angular.forEach(c,function(c,d){"undefined"!=typeof b[c]&&(a.object[c]=b[c])}),a},this.getNew=function(a,b){var c={object:{access_token:b.access_token,callback:"JSON_CALLBACK"},url:""};switch("undefined"!=typeof b.count&&(c.object.count=b.count),a){case"userById":c.object.count=void 0,c.url=this.getApiBaseUrl()+"users/"+b.userId;break;case"mediaFromUserById":c=this.fillDataInObjectByList(c,b,["max_id","min_id","min_timestamp","max_timestamp"]),c.url=this.getApiBaseUrl()+"users/"+b.userId+"/media/recent";break;case"mediaByTag":c=this.fillDataInObjectByList(c,b,["max_tag_id","min_tag_id","min_timestamp","max_timestamp"]),c.url=this.getApiBaseUrl()+"tags/"+b.tag+"/media/recent";break;case"mediaFromLocationById":c=this.fillDataInObjectByList(c,b,["max_id","min_id","min_timestamp","max_timestamp"]),c.url=this.getApiBaseUrl()+"locations/"+b.locationId+"/media/recent";break;case"mediaByCoordinates":c=this.fillDataInObjectByList(c,b,["lat","lng","distance","min_timestamp","max_timestamp"]),c.url=this.getApiBaseUrl()+"media/search"}return c}});