/*!
 * SharepointPlus v3.0.8
 * Copyright 2014, Aymeric (@aymkdn)
 * Contact: http://kodono.info
 * Documentation: http://aymkdn.github.com/SharepointPlus/
 * License: GPL v2 (http://aymkdn.github.com/SharepointPlus/license.txt)
 */
;if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){if(this==null){throw new TypeError()}var d=Object(this);var a=d.length>>>0;if(a===0){return -1}var e=0;if(arguments.length>1){e=Number(arguments[1]);if(e!=e){e=0}else{if(e!=0&&e!=Infinity&&e!=-Infinity){e=(e>0||-1)*Math.floor(Math.abs(e))}}}if(e>=a){return -1}var b=e>=0?e:Math.max(a-Math.abs(e),0);for(;b<a;b++){if(b in d&&d[b]===c){return b}}return -1}}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}_SP_APPROVED=0;_SP_REJECTED=1;_SP_PENDING=2;_SP_DRAFT=3;_SP_SCHEDULED=4;_SP_CACHE_FORMFIELDS=null;(function(window){var fastMap=function(source,fn){var iterations=source.length;var dest=new Array(iterations);var _n=iterations/8;var _caseTest=iterations%8;for(var i=iterations-1;i>-1;i--){var n=_n;var caseTest=_caseTest;do{switch(caseTest){case 0:dest[i]=fn(source[i]);i--;case 7:dest[i]=fn(source[i]);i--;case 6:dest[i]=fn(source[i]);i--;case 5:dest[i]=fn(source[i]);i--;case 4:dest[i]=fn(source[i]);i--;case 3:dest[i]=fn(source[i]);i--;case 2:dest[i]=fn(source[i]);i--;case 1:dest[i]=fn(source[i]);i--}caseTest=0}while(--n>0)}return dest};var decode_b64=function(d,b,c,u,r,q,x){b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(r=q=x="";c=d.charAt(x++);~c&&(u=q%4?u*64+c:c,q++%4)?r+=String.fromCharCode(255&u>>(-2*q&6)):0){c=b.indexOf(c)}return r};var encode_b64=function(a,b,c,d,e,f){b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";c="=";for(d=f="";e&=3,a.charAt(d++)||(b="=",e);f+=b.charAt(63&c>>++e*2)){c=c<<8|a.charCodeAt(d-=!e)}return f};function SharepointPlus(){if(!(this instanceof arguments.callee)){return new arguments.callee()}}SharepointPlus.prototype={data:[],length:0,listQueue:[],needQueue:false,getVersion:function(){return"3.0.4"},list:function(list,url){this.reset();if(url){if(url.substring(url.length-1,url.length)==="/"){url=url.substring(0,url.length-1)}this.url=url}else{this._getURL()}this.listID=list.replace(/&/g,"&amp;");return this},_getURL:function(){if(this.url===undefined&&typeof L_Menu_BaseUrl==="undefined"&&jQuery("body").data("sp-currenturl")===undefined){this.needQueue=true;var _this=this;var body="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><WebUrlFromPageUrl xmlns='http://schemas.microsoft.com/sharepoint/soap/' ><pageUrl>"+window.location.href.replace(/&/g,"&amp;")+"</pageUrl></WebUrlFromPageUrl></soap:Body></soap:Envelope>";var url=window.location.protocol+"//"+window.location.host+"/_vti_bin/Webs.asmx";jQuery.ajax({type:"POST",cache:false,async:true,url:url,data:body,contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(data){var result=data.getElementsByTagName("WebUrlFromPageUrlResult");if(result.length){_this.url=result[0].firstChild.nodeValue.toLowerCase();jQuery("body").data("sp-currenturl",_this.url)}_this.needQueue=false}})}else{this.url=this.url||jQuery("body").data("sp-currenturl")||(window.location.protocol+"//"+window.location.host+L_Menu_BaseUrl)}return this},_addInQueue:function(args){this.listQueue.push(args);if(this.listQueue.length===1){this._testQueue()}return this},_testQueue:function(){if(this.needQueue){var _this=this;setTimeout(function(){_this._testQueue.call(_this)},25)}else{if(this.listQueue.length>0){var todo=this.listQueue.shift();todo.callee.apply(this,Array.prototype.slice.call(todo))}this.needQueue=(this.listQueue.length>0);if(this.needQueue){var _this=this;setTimeout(function(){_this._testQueue.call(_this)},25)}}},parse:function(q,escapeChar){var queryString=q.replace(/(\s+)?(=|~=|<=|>=|<>|<|>| LIKE | like )(\s+)?/g,"$2").replace(/""|''/g,"Null").replace(/==/g,"=");var factory=[];escapeChar=(escapeChar===false?false:true);var limitMax=q.length;var closeOperator="",closeTag="",ignoreNextChar=false;var lastField="";var parenthesis={open:0};var lookupId=false;for(var i=0;i<queryString.length;i++){var letter=queryString.charAt(i);switch(letter){case"(":var start=i;var openedApos=false;while(queryString.charAt(i)=="("&&i<limitMax){i++;parenthesis.open++}while(parenthesis.open>0&&i<limitMax){i++;var charAtI=queryString.charAt(i);if(charAtI=="\\"){ignoreNextChar=true}else{if(!ignoreNextChar&&charAtI=="'"){openedApos=!openedApos}else{if(!ignoreNextChar&&charAtI==")"&&!openedApos){parenthesis.open--}else{ignoreNextChar=false}}}}var lastIndex=factory.length-1;if(lastIndex>=0){if(closeOperator!=""){factory[0]="<"+closeOperator+">"+factory[0]}factory[0]+=this.parse(queryString.substring(start+1,i));if(closeOperator!=""){factory[0]+="</"+closeOperator+">"}closeOperator=""}else{factory[0]=this.parse(queryString.substring(start+1,i))}break;case">":case"<":i++;if(queryString.charAt(i)=="="){factory.push("<"+(letter==">"?"G":"L")+"eq>");closeTag="</"+(letter==">"?"G":"L")+"eq>"}else{if(letter=="<"&&queryString.charAt(i)==">"){factory.push("<Neq>");closeTag="</Neq>"}else{i--;factory.push("<"+(letter==">"?"G":"L")+"t>");closeTag="</"+(letter==">"?"G":"L")+"t>"}}break;case"~":if(queryString.charAt(i+1)=="="){lookupId=true}break;case"=":factory.push("<Eq>");closeTag="</Eq>";break;case" ":if(queryString.substring(i,i+5).toUpperCase()==" AND "){closeOperator="And";i+=4}else{if(queryString.substring(i,i+4).toUpperCase()==" OR "){closeOperator="Or";i+=3}else{if(queryString.slice(i,i+6).toUpperCase()==" LIKE "){i+=5;factory.push("<Contains>");closeTag="</Contains>"}else{lastField+=letter}}}break;case'"':case"'":var apos=letter;var word="",other="";while((letter=queryString.charAt(++i))!=apos&&i<limitMax){if(letter=="\\"){letter=queryString.charAt(++i)}word+=letter}lastIndex=factory.length-1;factory[lastIndex]+='<FieldRef Name="'+lastField+'" '+(word=="[Me]"?'LookupId="True" ':"")+"/>";lastField="";var type="Text";if(/\d{4}-\d\d?-\d\d?((T| )\d{2}:\d{2}:\d{2})?/.test(word)){type="DateTime";if(/\d{4}-\d\d?-\d\d?((T| )\d{2}:\d{2}:\d{2})/.test(word)){other=' IncludeTimeValue="TRUE"'}}if(escapeChar){word=this._cleanString(word)}if(word==="[Me]"){word='<UserID Type="Integer" />';type="Integer"}else{if(word.slice(0,6)=="[Today"){type="DateTime";word='<Today OffsetDays="'+(1*word.slice(6,-1))+'" />'}}factory[lastIndex]+='<Value Type="'+type+'"'+other+">"+word+"</Value>";factory[lastIndex]+=closeTag;closeTag="";if(lastIndex>0){if(closeOperator!=""){factory[0]="<"+closeOperator+">"+factory[0]}factory[0]+=factory[lastIndex];if(closeOperator!=""){factory[0]+="</"+closeOperator+">"}delete (factory[lastIndex]);closeOperator=""}break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":if(closeTag!=""){var value=letter;while(!isNaN(letter=queryString.charAt(++i))&&i<limitMax){value+=""+letter}lastIndex=factory.length-1;factory[lastIndex]+='<FieldRef Name="'+lastField+'"'+(lookupId?' LookupId="True"':"")+" />";lastField="";factory[lastIndex]+='<Value Type="'+(lookupId?"Integer":"Number")+'">'+value.replace(/ $/,"")+"</Value>";factory[lastIndex]+=closeTag;closeTag="";if(lastIndex>0){if(closeOperator!=""){factory[0]="<"+closeOperator+">"+factory[0]}factory[0]+=factory[lastIndex];if(closeOperator!=""){factory[0]+="</"+closeOperator+">"}delete (factory[lastIndex]);closeOperator=""}i-=2;break}default:if(closeTag==""){lastField+=letter}else{if(letter.toLowerCase()=="n"&&queryString.substring(i,i+4).toLowerCase()=="null"){lastIndex=factory.length-1;if(closeTag=="</Neq>"){factory[lastIndex]="<IsNotNull>";closeTag="</IsNotNull>"}else{if(closeTag=="</Eq>"){factory[lastIndex]="<IsNull>";closeTag="</IsNull>"}}i+=3;factory[lastIndex]+='<FieldRef Name="'+lastField+'" />';lastField="";factory[lastIndex]+=closeTag;closeTag="";if(lastIndex>0){if(closeOperator!=""){factory[0]="<"+closeOperator+">"+factory[0]}factory[0]+=factory[lastIndex];if(closeOperator!=""){factory[0]+="</"+closeOperator+">"}delete (factory[lastIndex]);closeOperator=""}}}}}return factory.join("")},_parseOn:function(q){var factory=[];var queryString=q.replace(/(\s+)?(=)(\s+)?/g,"$2").replace(/==/g,"=").split(" AND ");for(var i=0;i<queryString.length;i++){var mtch=queryString[i].match(/'([^']+)'\.([a-zA-Z0-9_]+)='([^']+)'\.([a-zA-Z0-9_]+)/);if(mtch&&mtch.length==5){var tmp={};tmp[mtch[1]]=mtch[2];tmp[mtch[3]]=mtch[4];factory.push(tmp)}}return factory},_cleanString:function(str){return str.replace(/&(?!amp;|lt;|gt;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},cleanResult:function(str,separator){if(str===null||typeof str==="undefined"){return""}separator=separator||";";return(typeof str==="string"?str.replace(/;#[0-9]+;#/g,separator).replace(/^[0-9]+;#/,"").replace(/^;#|;#$/g,"").replace(/;#/g,separator).replace(/string;#/,""):str)},get:function(setup,fct){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined){throw"Error 'get': you have to define the list ID/Name"}if(arguments.length===1&&typeof setup==="function"){return this.get({},setup)}setup=setup||{};if(this.url==undefined){throw"Error 'get': not able to find the URL!"}setup.fields=setup.fields||"";setup.where=setup.where||"";setup.orderby=setup.orderby||"";setup.groupby=setup.groupby||"";setup.rowlimit=setup.rowlimit||0;setup.whereEscapeChar=(setup.whereEscapeChar===false?false:true);setup.paging=(setup.paging===true?true:false);if(setup.paging&&setup.rowlimit===0){setup.rowlimit=5000}setup.expandUserField=(setup.expandUserField===true?"True":"False");setup.dateInUTC=(setup.dateInUTC===true?"True":"False");setup.folderOptions=setup.folderOptions||null;setup.view=setup.view||"";setup.results=setup.results||[];setup.ListItemCollectionPositionNext=setup.ListItemCollectionPositionNext||"";if(typeof setup.where==="object"){if(setup.originalWhere==undefined){setup.originalWhere=setup.where.slice(0)}setup.nextWhere=setup.where.slice(1);setup.where=setup.where.shift()}else{setup.originalWhere=setup.where;setup.nextWhere=[]}setup.progress=setup.progress||(function(){});if(setup.view!==""){if(setup.view.charAt(0)!=="{"){var _this=this;_this.view(setup.view,function(data,viewID){setup.view=viewID;var where=(setup.whereCAML?setup.where:_this.parse(setup.where));where+=data.whereCAML;if(setup.where!==""&&data.whereCAML!==""){where="<And>"+where+"</And>"}setup.where=where;setup.fields+=(setup.fields===""?"":",")+data.fields.join(",");setup.orderby+=(setup.orderby===""?"":",")+data.orderby;setup.whereCAML=true;setup.useOWS=true;delete setup.view;return _this.get.call(_this,setup,fct)});return this}if(setup.whereCAML!==true){setup.where=this.parse(setup.where,setup.whereEscapeChar);setup.whereCAML=true}}var useOWS=true;var fields="";if(setup.fields==""||setup.fields==[]){fields=""}else{if(typeof setup.fields=="string"){setup.fields=setup.fields.replace(/^\s+/,"").replace(/\s+$/,"").replace(/( )?,( )?/g,",").split(",")}for(var i=0;i<setup.fields.length;i++){fields+='<FieldRef Name="'+setup.fields[i]+'" />'}}var orderby="";if(setup.orderby!=""){var fieldsDir=setup.orderby.split(",");for(i=0;i<fieldsDir.length;i++){var direction="ASC";var splt=jQuery.trim(fieldsDir[i]).split(" ");if(splt.length>0){if(splt.length==2){direction=splt[1].toUpperCase()}orderby+=(useOWS?'<FieldRef Name="'+splt[0]+'" Ascending="'+(direction=="ASC")+'" />':'<OrderField Name="'+splt[0]+'" Direction="'+direction+'" />')}}}var groupby="";if(setup.groupby!=""){var gFields=setup.groupby.split(",");for(i=0;i<gFields.length;i++){groupby+='<FieldRef Name="'+gFields[i]+'" />'}}var body="";var aReturn=[];if(setup.queryOptions===undefined){setup._queryOptions="<DateInUtc>"+setup.dateInUTC+'</DateInUtc><Paging ListItemCollectionPositionNext="'+setup.ListItemCollectionPositionNext+'"></Paging><IncludeAttachmentUrls>True</IncludeAttachmentUrls>'+(fields===""?"":"<IncludeMandatoryColumns>False</IncludeMandatoryColumns>")+"<ExpandUserField>"+setup.expandUserField+"</ExpandUserField>";if(setup.folderOptions){var viewAttr;switch(setup.folderOptions.show){case"FilesAndFolders_Recursive":viewAttr="RecursiveAll";break;case"FilesOnly_InFolder":viewAttr="FilesOnly";break;case"FilesAndFolders_InFolder":viewAttr="";break;case"FilesOnly_Recursive":default:viewAttr="Recursive"}setup._queryOptions+='<ViewAttributes Scope="'+viewAttr+'"></ViewAttributes>';if(setup.folderOptions.path){setup.queryOptions+="<Folder>"+this.url+this.listID+"/"+setup.folderOptions.path+"</Folder>"}}else{setup._queryOptions+='<ViewAttributes Scope="Recursive"></ViewAttributes>'}}else{setup._queryOptions=setup.queryOptions}var _this=this;if(useOWS){body='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+this.listID+"</listName><viewName>"+setup.view+"</viewName><query><Query>"+(setup.where!=""?"<Where>"+(setup.whereCAML?setup.where:this.parse(setup.where))+"</Where>":"")+(groupby!=""?"<GroupBy>"+groupby+"</GroupBy>":"")+(orderby!=""?"<OrderBy>"+orderby+"</OrderBy>":"")+"</Query></query><viewFields><ViewFields Properties='True'>"+fields+"</ViewFields></viewFields><rowLimit>"+setup.rowlimit+"</rowLimit><queryOptions><QueryOptions>"+setup._queryOptions+"</QueryOptions></queryOptions></GetListItems></soap:Body></soap:Envelope>";var url=this.url+"/_vti_bin/Lists.asmx";jQuery.ajax({type:"POST",cache:false,async:true,url:url,data:body,contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(data){var rows=data.getElementsByTagName("z:row");if(rows.length==0){rows=data.getElementsByTagName("row")}aReturn=fastMap(rows,function(row){return myElem(row)});if(setup.joinData){var on=setup.joinData.noindex;var aResult=[];var prevIndex="";var listIndexFound={length:0};if(!on.length){alert("$SP.get() -- Error 'get': you must define the ON clause with JOIN is used.")}for(var i=0,stop=aReturn.length;i<stop;i++){var index="";for(var j=0;j<on.length;j++){index+=aReturn[i].getAttribute(on[j][_this.listID])}if(setup.joinData[index]){if(prevIndex!==index){listIndexFound[setup.joinIndex[index]]=true;listIndexFound.length++;prevIndex=index}for(var j=0,joinDataLen=setup.joinData[index].length;j<joinDataLen;j++){var tmp=[];var attributesReturn=aReturn[i].getAttributes();for(var attr=attributesReturn.length;attr--;){tmp[_this.listID+"."+attributesReturn[attr].nodeName.slice(4)]=attributesReturn[attr].nodeValue}var attributesJoinData=setup.joinData[index][j].getAttributes();for(var attr in attributesJoinData){tmp[attr]=setup.joinData[index][j].getAttribute(attr)}aResult.push(new extendMyObject(tmp))}}if(setup.innerjoin){setup.join=setup.innerjoin}if(setup.outerjoin){setup.join=setup.outerjoin;setup.join.outer=true}}aReturn=aResult;if(setup.outer){var joinIndexLen=setup.joinIndex.length;if(listIndexFound.length<joinIndexLen){for(i=0;i<joinIndexLen;i++){if(listIndexFound[i]!==true){var idx=setup.joinIndex[i];if(idx===undefined||setup.joinData[idx]===undefined){continue}for(var j=0,joinDataLen=setup.joinData[idx].length;j<joinDataLen;j++){var tmp=[];var attributesJoinData=setup.joinData[idx][j].getAttributes();for(var attr in attributesJoinData){tmp[attr]=setup.joinData[idx][j].getAttribute(attr)}aResult.push(new extendMyObject(tmp))}}}}}}if(setup.outerjoin){setup.join=setup.outerjoin;setup.join.outer=true}else{if(setup.innerjoin){setup.join=setup.innerjoin}}if(setup.join){var joinData=[],joinIndex=[];var on=_this._parseOn(setup.join.on);joinData.noindex=on;for(var i=0,stop=aReturn.length;i<stop;i++){var index="",tmp=[];for(var j=0;j<on.length;j++){index+=aReturn[i].getAttribute(on[j][_this.listID])||aReturn[i].getAttribute(_this.listID+"."+on[j][_this.listID])}if(!joinData[index]){joinIndex[index]=joinIndex.length;joinIndex.push(index);joinData[index]=[]}if(setup.joinData){joinData[index].push(aReturn[i])}else{var attributes=aReturn[i].getAttributes();for(var j=attributes.length;j--;){tmp[_this.listID+"."+attributes[j].nodeName.slice(4)]=attributes[j].nodeValue}joinData[index].push(new extendMyObject(tmp))}}delete setup.joinData;var sp=$SP().list(setup.join.list,setup.join.url||_this.url);setup.join.joinData=joinData;setup.join.joinIndex=joinIndex;sp.get(setup.join,fct)}else{if(setup.results.length>0){for(var i=0,stop=aReturn.length;i<stop;i++){setup.results.push(aReturn[i])}}if(typeof setup.originalWhere!=="string"){setup.progress(setup.originalWhere.length-setup.nextWhere.length,setup.originalWhere.length)}if(setup.paging){var collection=data.getElementsByTagName("rs:data")[0];if(collection.length==0){collection=data.getElementsByTagName("data")}if(setup.results.length===0){setup.results=aReturn}var nextPage=collection.getAttribute("ListItemCollectionPositionNext");if(nextPage){setup.ListItemCollectionPositionNext=_this._cleanString(collection.getAttribute("ListItemCollectionPositionNext"));_this.get(setup,fct)}else{if(typeof fct=="function"){fct.call(_this,setup.results)}}}else{if(setup.nextWhere.length>0){if(setup.results.length===0){setup.results=aReturn}setup.where=setup.nextWhere.slice(0);_this.get(setup,fct)}else{if(typeof fct=="function"){setup.where=setup.originalWhere;fct.call(_this,(setup.results.length>0?setup.results:aReturn))}}}}},error:function(jqXHR,textStatus,errorThrown){var res=jqXHR.responseXML;var err=res.getElementsByTagName("errorstring");if(err&&err[0]){fct.call(_this,[],"Error: "+err[0].firstChild.nodeValue)}else{fct.call(_this,[],textStatus+": "+errorThrown)}}})}return this},createFile:function(setup){setup=setup||{};if(setup.content==undefined){throw"Error 'createFile': not able to find the file content."}if(setup.destination==undefined){throw"Error 'createFile': not able to find the file destination path."}setup.url=setup.url||this.url;if(!setup.url){this._getURL();return this._addInQueue(arguments)}if(setup.url==undefined){throw"Error 'createFile': not able to find the URL!"}setup.after=setup.after||(function(){});setup.encoded=(setup.encoded==undefined?false:setup.encoded);var _this=this;var soapEnv='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><CopyIntoItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><SourceUrl>http://null</SourceUrl><DestinationUrls><string>'+setup.destination+"</string></DestinationUrls><Fields><FieldInformation Type='File' /></Fields><Stream>"+(setup.encoded?setup.content:encode_b64(setup.content))+"</Stream></CopyIntoItems></soap:Body></soap:Envelope>";jQuery.ajax({url:setup.url+"/_vti_bin/copy.asmx",type:"POST",dataType:"xml",data:soapEnv,beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/CopyIntoItems")},contentType:'text/xml; charset="utf-8"',success:function(data){var a=data.getElementsByTagName("CopyResult");if(a&&a[0]&&a[0].getAttribute("ErrorCode")!="Success"){throw"Error 'createFile': "+a[0].getAttribute("ErrorCode")+" - "+a[0].getAttribute("ErrorMessage")}if(typeof setup.after=="function"){setup.after.call(_this)}}});return this},createFolder:function(setup){setup=setup||{};if(setup.path==undefined){throw"Error 'createFolder': please provide the 'path'."}if(setup.library==undefined){throw"Error 'createFolder': please provide the library name."}setup.url=setup.url||this.url;if(!setup.url){this._getURL();return this._addInQueue(arguments)}if(setup.url==undefined){throw"Error 'createFolder': not able to find the URL!"}setup.after=setup.after||(function(){});var path=setup.path.split("/"),toAdd=[],tmpPath="";for(var i=0;i<path.length;i++){tmpPath+=(i>0?"/":"")+path[i];toAdd.push({FSObjType:1,BaseName:tmpPath})}this.list(setup.library,setup.url).add(toAdd,{after:setup.after});return this},checkin:function(setup){setup=setup||{};if(setup.destination==undefined){throw"Error 'checkin': not able to find the file destination path."}setup.url=setup.url||this.url;if(!setup.url){this._getURL();return this._addInQueue(arguments)}if(this.url==undefined){throw"Error 'checkin': not able to find the URL!"}setup.url=this.url;setup.comments=setup.comments||"";setup.success=setup.success||(function(){});setup.error=setup.error||(function(){});setup.after=setup.after||(function(){});var _this=this;var soapEnv='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><CheckInFile xmlns="http://schemas.microsoft.com/sharepoint/soap/"><pageUrl>'+setup.destination+"</pageUrl><comment>"+setup.comments+"</comment><CheckinType>1</CheckinType></CheckInFile></soap:Body></soap:Envelope>";jQuery.ajax({url:setup.url+"/_vti_bin/Lists.asmx",type:"POST",dataType:"xml",data:soapEnv,beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/CheckInFile")},contentType:"text/xml; charset=utf-8",success:function(data){var res=data.getElementsByTagName("CheckInFileResult");if(res&&res[0]&&res[0].firstChild.nodeValue!="true"){setup.error.call(_this)}else{setup.success.call(_this)}setup.after.call(_this)}})},getAttachment:function(itemID,fct,passed){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined){throw"Error 'getAttachment': you have to define the list ID/Name"}if(arguments.length===1&&typeof itemID==="function"){throw"Error 'getAttachment': you have to define the item ID"}if(this.url==undefined){throw"Error 'getAttachment': not able to find the URL!"}if(typeof itemID!=="object"){itemID=itemID.split(",")}passed=passed||[];var body='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"> <soap:Body> <GetAttachmentCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/"> <listName>'+this.listID+"</listName> <listItemID>"+itemID.shift()+"</listItemID> </GetAttachmentCollection> </soap:Body></soap:Envelope>";var _this=this;var url=this.url+"/_vti_bin/lists.asmx";var aReturn=[];jQuery.ajax({type:"POST",cache:false,async:true,url:url,data:body,contentType:"text/xml; charset=utf-8",beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetAttachmentCollection")},dataType:"xml",success:function(data){var a=data.getElementsByTagName("Attachment");for(var i=0;i<a.length;i++){aReturn.push(a[i].firstChild.nodeValue)}if(aReturn.length===0){aReturn=""}else{if(aReturn.length===1){aReturn=aReturn[0]}}passed.push(aReturn);if(itemID.length===0){if(typeof fct==="function"){fct.call(_this,passed)}}else{_this.getAttachment(itemID,fct,passed)}}});return this},info:function(fct){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined){throw"Error 'info': you have to define the list ID"}if(this.url==undefined){throw"Error 'info': not able to find the URL!"}var body='<?xml version="1.0" encoding="utf-8"?>';body+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">';body+="  <soap:Body>";body+='    <GetList xmlns="http://schemas.microsoft.com/sharepoint/soap/">';body+="      <listName>"+this.listID+"</listName>";body+="    </GetList>";body+="  </soap:Body>";body+="</soap:Envelope>";var _this=this;var url=this.url+"/_vti_bin/lists.asmx";var aReturn=[];jQuery.ajax({type:"POST",cache:false,async:true,url:url,data:body,contentType:"text/xml; charset=utf-8",beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetList")},dataType:"xml",success:function(data){var arr=data.getElementsByTagName("Field");var index=0,aIndex,attributes,attrName,lenDefault;for(var i=0;i<arr.length;i++){if(arr[i].getAttribute("ID")){aReturn[index]=[];aIndex=aReturn[index];attributes=arr[i].attributes;for(var j=attributes.length;j--;){attrName=attributes[j].nodeName;attrValue=attributes[j].nodeValue;if(attrName==="Type"){switch(attrValue){case"Choice":case"MultiChoice":aIndex.FillInChoice=arr[i].getAttribute("FillInChoice");var a=arr[i].getElementsByTagName("CHOICE");var r=[];for(var k=0;k<a.length;k++){r.push(a[k].firstChild.nodeValue)}aIndex.Choices=r;break;case"Lookup":case"LookupMulti":aIndex.Choices={list:arr[i].getAttribute("List"),field:arr[i].getAttribute("ShowField")};break;default:aIndex.Choices=[]}}aIndex[attrName]=attrValue}lenDefault=arr[i].getElementsByTagName("Default").length;if(lenDefault>0){nodeDefault=arr[i].getElementsByTagName("Default");aReturn[index]["DefaultValue"]=[];for(var q=0;q<lenDefault;q++){nodeDefault[q].firstChild&&aReturn[index]["DefaultValue"].push(nodeDefault[q].firstChild.nodeValue)}if(lenDefault===1){aReturn[index]["DefaultValue"]=aReturn[index]["DefaultValue"][0]}}else{aReturn[index]["DefaultValue"]=null}index++}}if(typeof fct=="function"){fct.call(_this,aReturn)}}});return this},view:function(viewID,fct){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined){throw"Error 'view': you have to define the list ID/Name"}if(arguments.length===1&&typeof viewID==="function"){return this.view("",viewID)}list=this.listID;if(this.url==undefined){throw"Error 'view': not able to find the URL!"}viewID=viewID||"";var viewName=arguments[2]||viewID;viewName=viewName.toLowerCase();var savedView=jQuery("body").data("sp-view");if(savedView!=undefined){for(var i=savedView.length;i--;){if(savedView[i].url===this.url&&(savedView[i].viewID===viewID||savedView[i].viewName===viewName)){fct.call(this,savedView[i].data,viewID);return this}}}else{savedView=[]}if(viewID.charAt(0)!=="{"){this.views(function(views){var found=false;for(var i=views.length;i--;){if(views[i]["Name"]===viewID){this.view(views[i]["ID"],fct,viewID);found=true;break}}if(!found){throw"Error 'view': not able to find the view called '"+viewID+"' at "+this.url}});return this}var body='<?xml version="1.0" encoding="utf-8"?>';body+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">';body+="  <soap:Body>";body+='    <GetView xmlns="http://schemas.microsoft.com/sharepoint/soap/">';body+="      <listName>"+this.listID+"</listName>";body+="      <viewName>"+viewID+"</viewName>";body+="    </GetView>";body+="  </soap:Body>";body+="</soap:Envelope>";var url=this.url+"/_vti_bin/Views.asmx";var aReturn=["fields","orderby","whereCAML"];var _this=this;jQuery.ajax({type:"POST",cache:false,async:true,url:url,data:body,contentType:"text/xml; charset=utf-8",beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetView")},dataType:"xml",success:function(data){aReturn.fields=[];var arr=data.getElementsByTagName("ViewFields")[0].getElementsByTagName("FieldRef");for(var i=0;i<arr.length;i++){aReturn.fields.push(arr[i].getAttribute("Name"))}aReturn.orderby="";arr=data.getElementsByTagName("OrderBy");if(arr.length){var orderby=[];arr=arr[0].getElementsByTagName("FieldRef");for(var i=0;i<arr.length;i++){orderby.push(arr[i].getAttribute("Name")+" "+(arr[i].getAttribute("Ascending")==undefined?"ASC":"DESC"))}aReturn.orderby=orderby.join(",")}aReturn.whereCAML="";var where=data.getElementsByTagName("Where");if(where.length){where=where[0].xml||(new XMLSerializer()).serializeToString(where[0]);where=where.match(/<Where [^>]+>(.*)<\/Where>/);if(where.length==2){aReturn.whereCAML=where[1]}}savedView.push({url:_this.url,data:aReturn,viewID:viewID,viewName:viewName});jQuery("body").data("sp-view",savedView);if(typeof fct=="function"){fct.call(_this,aReturn,viewID)}}});return this},views:function(fct){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined){throw"Error 'views': you have to define the list ID"}if(this.url==undefined){throw"Error 'views': not able to find the URL!"}fct=fct||function(){};var savedViews=jQuery("body").data("sp-views");if(savedViews!=undefined){for(var i=savedViews.length;i--;){if(savedViews[i].url==this.url){fct.call(this,savedViews[i].data);return this}}}else{savedViews=[]}var body='<?xml version="1.0" encoding="utf-8"?>';body+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">';body+="  <soap:Body>";body+='    <GetViewCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/">';body+="      <listName>"+this.listID+"</listName>";body+="    </GetViewCollection>";body+="  </soap:Body>";body+="</soap:Envelope>";var url=this.url+"/_vti_bin/Views.asmx";var aReturn=[];var _this=this;jQuery.ajax({type:"POST",cache:false,async:true,url:url,data:body,contentType:"text/xml; charset=utf-8",beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetViewCollection")},dataType:"xml",success:function(data){var arr=data.getElementsByTagName("View");for(var i=0;i<arr.length;i++){aReturn[i]=[];aReturn[i]["ID"]=arr[i].getAttribute("Name");aReturn[i]["Name"]=arr[i].getAttribute("DisplayName");aReturn[i]["Url"]=arr[i].getAttribute("Url")}savedViews.push({url:_this.url,data:aReturn});jQuery("body").data("sp-views",savedViews);fct.call(_this,aReturn)}});return this},lists:function(setup,fct){if(arguments.length===1&&typeof setup==="function"){return this.lists({},setup)}setup=setup||{};setup.url=setup.url||this.url;if(!setup.url){this._getURL();return this._addInQueue(arguments)}else{this.url=setup.url}if(this.url==undefined){throw"Error 'lists': not able to find the URL!"}var body='<?xml version="1.0" encoding="utf-8"?>';body+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">';body+="  <soap:Body>";body+='    <GetListCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/">';body+="    </GetListCollection>";body+="  </soap:Body>";body+="</soap:Envelope>";var savedLists=jQuery("body").data("sp-lists");if(savedLists!=undefined){for(var i=savedLists.length;i--;){if(savedLists[i].url==this.url){if(typeof fct=="function"){fct(savedLists[i].data)}else{this.data=savedLists[i].data;this.length=this.data.length}return this}}}else{savedLists=[]}var url=this.url+"/_vti_bin/lists.asmx";var aReturn=[];var _this=this;jQuery.ajax({type:"POST",cache:false,async:true,url:url,data:body,contentType:"text/xml; charset=utf-8",beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetListCollection")},dataType:"xml",success:function(data){var arr=data.getElementsByTagName("List");for(var i=0;i<arr.length;i++){aReturn[i]=[];aReturn[i]["ID"]=arr[i].getAttribute("ID");aReturn[i]["Name"]=arr[i].getAttribute("Title");aReturn[i]["Url"]=arr[i].getAttribute("DefaultViewUrl");aReturn[i]["Description"]=arr[i].getAttribute("Description")}savedLists.push({url:_this.url,data:aReturn});jQuery("body").data("sp-lists",savedLists);if(typeof fct=="function"){fct.call(_this,aReturn)}}});return this},add:function(items,setup){if(this.needQueue){return this._addInQueue(arguments)}if(arguments.length===0||(arguments.length===1&&typeof items!=="object")){throw"Error 'add': you need to define the list of items"}if(this.listID===undefined){throw"Error 'add': you need to use list() to define the list name."}setup=setup||{};if(this.url==undefined){throw"Error 'add': not able to find the URL!"}setup.success=setup.success||(function(){});setup.error=setup.error||(function(){});setup.after=setup.after||(function(){});setup.escapeChar=(setup.escapeChar==undefined)?true:setup.escapeChar;setup.progress=setup.progress||(function(){});if(typeof items==="object"&&items.length==undefined){items=[items]}var itemsLength=items.length;setup.progressVar=setup.progressVar||{current:0,max:itemsLength,passed:[],failed:[],eventID:"spAdd"+(""+Math.random()).slice(2)};if(itemsLength>15){var nextPacket=items.slice(0);var cutted=nextPacket.splice(0,15);var _this=this;jQuery(document).on(setup.progressVar.eventID,function(event){jQuery(document).off(setup.progressVar.eventID);_this.add(nextPacket,event.setup)});this.add(cutted,setup);return this}else{if(itemsLength==0){setup.progress(1,1);setup.error([]);setup.success([]);setup.after();return this}}setup.progressVar.current+=itemsLength;var updates='<Batch OnError="Continue" ListVersion="1"  ViewName="">';var _this=this;for(var i=0;i<items.length;i++){updates+='<Method ID="'+(i+1)+'" Cmd="New">';updates+="<Field Name='ID'>New</Field>";jQuery.each(items[i],function(key,value){if(typeof value==="object"&&value.items!=undefined){value=";#"+value.join(";#")+";#"}if(setup.escapeChar&&typeof value==="string"){value=_this._cleanString(value)}updates+="<Field Name='"+key+"'>"+value+"</Field>"});updates+="</Method>"}updates+="</Batch>";var body='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+this.listID+"</listName><updates>"+updates+"</updates></UpdateListItems></soap:Body></soap:Envelope>";var url=this.url+"/_vti_bin/lists.asmx";var _this=this;jQuery.ajax({type:"POST",cache:false,async:true,url:url,data:body,beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(data){var result=data.getElementsByTagName("Result");var len=result.length;var passed=setup.progressVar.passed,failed=setup.progressVar.failed;for(var i=0;i<len;i++){if(result[i].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue=="0x00000000"){var rows=result[i].getElementsByTagName("z:row");if(rows.length==0){rows=result[i].getElementsByTagName("row")}items[i].ID=rows[0].getAttribute("ows_ID");passed.push(items[i])}else{items[i].errorMessage=result[i].getElementsByTagName("ErrorText")[0].firstChild.nodeValue;failed.push(items[i])}}setup.progress(setup.progressVar.current,setup.progressVar.max);if(setup.progressVar.current<setup.progressVar.max){jQuery(document).trigger({type:setup.progressVar.eventID,setup:setup})}else{if(failed.length>0){setup.error.call(_this,failed)}if(passed.length>0){setup.success.call(_this,passed)}setup.after.call(_this)}}});return this},update:function(items,setup){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID===undefined){throw"Error 'update': you need to use list() to define the list name."}setup=setup||{};if(this.url==undefined){throw"Error 'update': not able to find the URL!"}setup.where=setup.where||"";setup.success=setup.success||(function(){});setup.error=setup.error||(function(){});setup.after=setup.after||(function(){});setup.escapeChar=(setup.escapeChar==undefined)?true:setup.escapeChar;setup.progress=setup.progress||(function(){});if(typeof items==="object"&&items.length==undefined){items=[items]}var itemsLength=items.length;if(itemsLength==1&&setup.where){delete items[0].ID;var _this=this;this.get({fields:"ID",where:setup.where},function(data){var clone=function(obj){var newObj={};for(var k in obj){newObj[k]=obj[k]}return newObj};var aItems=[];for(var i=data.length;i--;){var it=clone(items[0]);it.ID=data[i].getAttribute("ID");aItems.push(it)}delete setup.where;_this.update(aItems,setup)});return this}setup.progressVar=setup.progressVar||{current:0,max:itemsLength,passed:[],failed:[],eventID:"spUpdate"+(""+Math.random()).slice(2)};if(itemsLength>15){var nextPacket=items.slice(0);var cutted=nextPacket.splice(0,15);var _this=this;jQuery(document).on(setup.progressVar.eventID,function(event){jQuery(document).off(setup.progressVar.eventID);_this.update(nextPacket,event.setup)});this.update(cutted,setup);return this}else{if(itemsLength==0){setup.progress(1,1);setup.error([]);setup.success([]);setup.after();return this}}setup.progressVar.current+=itemsLength;var updates='<Batch OnError="Continue" ListVersion="1"  ViewName="">';var _this=this;for(var i=0;i<itemsLength;i++){updates+='<Method ID="'+(i+1)+'" Cmd="Update">';if(items[i].ID==undefined){throw"Error 'update': you have to provide the item ID called 'ID'"}jQuery.each(items[i],function(key,value){if(typeof value==="object"&&value.length!=undefined){value=";#"+value.join(";#")+";#"}if(setup.escapeChar&&typeof value==="string"){value=_this._cleanString(value)}updates+="<Field Name='"+key+"'>"+value+"</Field>"});updates+="</Method>"}updates+="</Batch>";var body='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+this.listID+"</listName><updates>"+updates+"</updates></UpdateListItems></soap:Body></soap:Envelope>";var url=this.url+"/_vti_bin/lists.asmx";var _this=this;jQuery.ajax({type:"POST",cache:false,async:true,url:url,data:body,beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(data){var result=data.getElementsByTagName("Result");var len=result.length;var passed=setup.progressVar.passed,failed=setup.progressVar.failed;for(var i=0;i<len;i++){if(result[i].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue=="0x00000000"){passed.push(items[i])}else{items[i].errorMessage=result[i].getElementsByTagName("ErrorText")[0].firstChild.nodeValue;failed.push(items[i])}}setup.progress(setup.progressVar.current,setup.progressVar.max);if(setup.progressVar.current<setup.progressVar.max){jQuery(document).trigger({type:setup.progressVar.eventID,setup:setup})}else{if(failed.length>0){setup.error.call(_this,failed)}if(passed.length>0){setup.success.call(_this,passed)}setup.after.call(_this)}}});return this},history:function(params,returnFct){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID===undefined){throw"Error 'history': you need to use list() to define the list name."}if(arguments.length!==2){throw"Error 'history': you need to provide two parameters."}if(typeof params!=="object"){throw"Error 'history': the first parameter must be an object."}else{if(params.ID===undefined||params.Name===undefined){throw"Error 'history': the first parameter must be an object with ID and Name."}}if(typeof returnFct!=="function"){throw"Error 'history': the second parameter must be a function."}var body='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetVersionCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/"><strlistID>'+this.listID+"</strlistID><strlistItemID>"+params.ID+"</strlistItemID><strFieldName>"+params.Name+"</strFieldName></GetVersionCollection></soap:Body></soap:Envelope>";var url=this.url+"/_vti_bin/lists.asmx";var _this=this;jQuery.ajax({type:"POST",cache:false,async:true,url:url,data:body,beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetVersionCollection")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(data){returnFct.call(_this,data.getElementsByTagName("Version"))}});return this},moderate:function(items,setup){if(this.needQueue){return this._addInQueue(arguments)}if(arguments.length===0||(arguments.length===1&&typeof items==="object"&&items.length===undefined)){throw"Error 'moderate': you need to define the list of items"}if(this.listID===undefined){throw"Error 'moderate': you need to use list() to define the list name."}setup=setup||{};if(this.url==undefined){throw"Error 'moderate': not able to find the URL!"}setup.async=(setup.async==undefined)?true:setup.async;setup.success=setup.success||(function(){});setup.error=setup.error||(function(){});setup.after=setup.after||(function(){});setup.progress=setup.progress||(function(){});if(typeof items==="object"&&items.length==undefined){items=[items]}var itemsLength=items.length;setup.progressVar=setup.progressVar||{current:0,max:itemsLength,passed:[],failed:[],eventID:"spModerate"+(""+Math.random()).slice(2)};if(itemsLength>15){var nextPacket=items.slice(0);var cutted=nextPacket.splice(0,15);var _this=this;jQuery(document).on(setup.progressVar.eventID,function(event){jQuery(document).off(setup.progressVar.eventID);_this.moderate(nextPacket,event.setup)});this.moderate(cutted,setup);return this}else{if(itemsLength==0){setup.progress(1,1);setup.success([]);setup.error([]);setup.after();return this}}setup.progressVar.current+=itemsLength;var updates='<Batch OnError="Continue" ListVersion="1"  ViewName="">';var thisObject=this;for(var i=0;i<itemsLength;i++){updates+='<Method ID="'+(i+1)+'" Cmd="Moderate">';if(items[i].ID==undefined){throw"Error 'moderate': you have to provide the item ID called 'ID'"}else{if(items[i].ApprovalStatus==undefined){throw"Error 'moderate': you have to provide the approval status 'ApprovalStatus' (Approved, Rejected, Pending, Draft or Scheduled)"}}jQuery.each(items[i],function(key,value){if(key=="ApprovalStatus"){key="_ModerationStatus";switch(value.toLowerCase()){case"approve":case"approved":value=0;break;case"reject":case"deny":case"denied":case"rejected":value=1;break;case"pending":value=2;break;case"draft":value=3;break;case"scheduled":value=4;break;default:value=2;break}}updates+="<Field Name='"+key+"'>"+value+"</Field>"});updates+="</Method>"}updates+="</Batch>";var body='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+this.listID+"</listName><updates>"+updates+"</updates></UpdateListItems></soap:Body></soap:Envelope>";var url=this.url+"/_vti_bin/lists.asmx";var _this=this;jQuery.ajax({type:"POST",cache:false,async:true,url:url,data:body,beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(data){var result=data.getElementsByTagName("Result");var len=result.length;var passed=setup.progressVar.passed,failed=setup.progressVar.failed;var rows;for(var i=0;i<len;i++){rows=result[i].getElementsByTagName("z:row");if(rows.length==0){rows=data.getElementsByTagName("row")}var item=myElem(rows[0]);if(result[i].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue=="0x00000000"){passed.push(item)}else{items[i].errorMessage=result[i].getElementsByTagName("ErrorText")[0].firstChild.nodeValue;failed.push(items[i])}}setup.progress(setup.progressVar.current,setup.progressVar.max);if(setup.progressVar.current<setup.progressVar.max){jQuery(document).trigger({type:setup.progressVar.eventID,setup:setup})}else{if(passed.length>0){setup.success.call(_this,passed)}if(failed.length>0){setup.error.call(_this,failed)}setup.after.call(_this)}}});return this},remove:function(items,setup){if(this.needQueue){return this._addInQueue(arguments)}if(!setup&&items.where){setup=items;items=[]}setup=setup||{};if(this.url==undefined){throw"Error 'remove': not able to find the URL!"}setup.error=setup.error||(function(){});setup.success=setup.success||(function(){});setup.after=setup.after||(function(){});setup.progress=setup.progress||(function(){});if(typeof items==="object"&&items.length==undefined){items=[items]}var itemsLength=items.length;if(setup.where){if(itemsLength==1){delete items[0].ID}var _this=this;this.get({fields:"ID,FileRef",where:setup.where},function(data){var clone=function(obj){var newObj={};for(var k in obj){newObj[k]=obj[k]}return newObj};var aItems=[],fileRef;for(var i=data.length;i--;){var it=clone(items[0]);it.ID=data[i].getAttribute("ID");fileRef=data[i].getAttribute("FileRef");if(fileRef){it.FileRef=$SP().cleanResult(fileRef)}aItems.push(it)}delete setup.where;_this.remove(aItems,setup)});return this}else{if(itemsLength==0){setup.progress(1,1);setup.error.call(_this,[]);setup.success.call(_this,[]);setup.after.call(_this);return _this}}setup.progressVar=setup.progressVar||{current:0,max:itemsLength,passed:[],failed:[],eventID:"spRemove"+(""+Math.random()).slice(2)};if(itemsLength>15){var nextPacket=items.slice(0);var cutted=nextPacket.splice(0,15);var _this=this;jQuery(document).on(setup.progressVar.eventID,function(event){jQuery(document).off(setup.progressVar.eventID);_this.remove(nextPacket,event.setup)});this.remove(cutted,setup);return this}setup.progressVar.current+=itemsLength;var updates='<Batch OnError="Continue" ListVersion="1"  ViewName="">';for(var i=0;i<items.length;i++){updates+='<Method ID="'+(i+1)+'" Cmd="Delete">';if(items[i].ID==undefined){throw"Error 'delete': you have to provide the item ID called 'ID'"}updates+="<Field Name='ID'>"+items[i].ID+"</Field>";if(items[i].FileRef!=undefined){updates+="<Field Name='FileRef'>"+items[i].FileRef+"</Field>"}updates+="</Method>"}updates+="</Batch>";var body='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+this.listID+"</listName><updates>"+updates+"</updates></UpdateListItems></soap:Body></soap:Envelope>";var _this=this;var url=this.url+"/_vti_bin/lists.asmx";jQuery.ajax({type:"POST",cache:false,async:true,url:url,data:body,beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(data){var result=data.getElementsByTagName("Result");var len=result.length;var passed=setup.progressVar.passed,failed=setup.progressVar.failed;for(var i=0;i<len;i++){if(result[i].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue=="0x00000000"){passed.push(items[i])}else{items[i].errorMessage=result[i].getElementsByTagName("ErrorText")[0].firstChild.nodeValue;failed.push(items[i])}}setup.progress(setup.progressVar.current,setup.progressVar.max);if(setup.progressVar.current<setup.progressVar.max){jQuery(document).trigger({type:setup.progressVar.eventID,setup:setup})}else{if(failed.length>0){setup.error.call(_this,failed)}if(passed.length>0){setup.success.call(_this,passed)}setup.after.call(_this)}}});return this},del:function(items,setup){return this.remove(items,setup)},usergroups:function(username,setup,fct){switch(arguments.length){case 1:if(typeof username==="object"){return this.usergroups("",username,function(){})}else{if(typeof username==="function"){return this.usergroups("",{},username)}}break;case 2:if(typeof username==="string"&&typeof setup==="function"){return this.usergroups(username,{},setup)}if(typeof username==="object"&&typeof setup==="function"){return this.usergroups("",username,setup)}}setup=setup||{};if(setup.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else{setup.url=this.url}}else{this.url=setup.url}fct=fct||(function(){});if(!username){throw"Error 'usergroups': you have to set an username."}username=username.toLowerCase();setup.url=setup.url.toLowerCase();var cache=jQuery("body").data("sp-usergroups")||[];for(var i=cache.length;i--;){if(cache[i].user.toLowerCase()==username&&cache[i].url.toLowerCase()==setup.url){fct.call(this,cache[i].data);return this}}var body="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><GetGroupCollectionFromUser xmlns='http://schemas.microsoft.com/sharepoint/soap/directory/'><userLoginName>"+username+"</userLoginName></GetGroupCollectionFromUser></soap:Body></soap:Envelope>";var _this=this;var url=setup.url+"/_vti_bin/usergroup.asmx";jQuery.ajax({type:"POST",cache:false,url:url,data:body,beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/directory/GetGroupCollectionFromUser")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(data){var aResult=[];data=data.getElementsByTagName("Group");for(var i=0,len=data.length;i<len;i++){aResult.push(data[i].getAttribute("Name"))}cache.push({user:username,url:setup.url,data:aResult});jQuery("body").data("sp-usergroups",cache);fct.call(_this,aResult)},error:function(req,textStatus,errorThrown){if(setup.error===false){fct.call(_this,[])}else{var error=req.responseXML.getElementsByTagName("errorstring");if(typeof console==="object"){console.error("Error 'usergroups': "+error[0].firstChild.nodeValue)}}}});return this},getWorkflowID:function(setup){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined){throw"Error 'getWorkflowID': you have to define the list ID/Name"}if(this.url==undefined){throw"Error 'getWorkflowID': not able to find the URL!"}setup=setup||{};if(setup.ID==undefined||setup.workflowName==undefined||setup.after==undefined){throw"Error 'getWorkflowID': all parameters are mandatory"}this.get({fields:"FieldRef",where:"ID = "+setup.ID},function(d){if(d.length===0){throw"Error 'getWorkflowID': I'm not able to find the item ID "+setup.ID}var fileRef=this.cleanResult(d[0].getAttribute("FileRef"));var c=fileRef.substring(0,fileRef.indexOf("/Lists"));var d=this.url.substring(0,this.url.indexOf(c));fileRef=d+fileRef;var body='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetWorkflowDataForItem xmlns="http://schemas.microsoft.com/sharepoint/soap/workflow/"><item>'+fileRef+"</item></GetWorkflowDataForItem></soap:Body></soap:Envelope>";var _this=this;jQuery.ajax({type:"POST",cache:false,async:true,url:this.url+"/_vti_bin/Workflow.asmx",data:body,beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/workflow/GetWorkflowDataForItem")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(data){var rows=data.getElementsByTagName("WorkflowTemplate");if(rows.length===0){throw"Error 'getWorkflowID': No workflow found for this item"}for(var i=rows.length;i--;){if(rows[i].getAttribute("Name")==setup.workflowName){setup.after.call(_this,{fileRef:fileRef,workflowID:"{"+rows[i].getElementsByTagName("WorkflowTemplateIdSet")[0].getAttribute("TemplateId")+"}"});return _this}}setup.after.call(_this,"Error 'getWorkflowID': impossible to find this workflow name!")},error:function(jqXHR,textStatus,errorThrown){throw"Error 'getWorkflowID': Something went wrong with the request over the Workflow Web Service..."}})});return this},startWorkflow:function(setup){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined){throw"Error 'startWorkflow': you have to define the list ID/Name"}if(this.url==undefined){throw"Error 'startWorkflow': not able to find the URL!"}setup=setup||{};setup.after=setup.after||(function(){});if(!setup.workflowName&&!setup.workflowID){throw"Error 'startWorkflow': Please provide the workflow name!"}if(!setup.ID){throw"Error 'startWorkflow': Please provide the item ID!"}if(!setup.fileRef&&!setup.workflowID){this.getWorkflowID({ID:setup.ID,workflowName:setup.workflowName,after:function(params){setup.fileRef=params.fileRef;setup.workflowID=params.workflowID;this.startWorkflow(setup)}})}else{var workflowParameters="<root />";if(setup.parameters){var p;if(setup.parameters.length==undefined){setup.parameters=[setup.parameters]}p=setup.parameters.slice(0);workflowParameters="<Data>";for(var i=0;i<p.length;i++){workflowParameters+="<"+p[i].name+">"+p[i].value+"</"+p[i].name+">"}workflowParameters+="</Data>"}var body='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><StartWorkflow xmlns="http://schemas.microsoft.com/sharepoint/soap/workflow/"><item>'+setup.fileRef+"</item><templateId>"+setup.workflowID+"</templateId><workflowParameters>"+workflowParameters+"</workflowParameters></StartWorkflow></soap:Body></soap:Envelope>";var _this=this;var url=this.url+"/_vti_bin/Workflow.asmx";jQuery.ajax({type:"POST",cache:false,async:true,url:url,data:body,beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/workflow/StartWorkflow")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(data){setup.after.call(_this)},error:function(jqXHR,textStatus,errorThrown){setup.after.call(_this)}})}return this},distributionLists:function(username,setup,fct){switch(arguments.length){case 1:if(typeof username==="object"){return this.distributionLists("",username,function(){})}else{if(typeof username==="function"){return this.distributionLists("",{},username)}}break;case 2:if(typeof username==="string"&&typeof setup==="function"){return this.distributionLists(username,{},setup)}if(typeof username==="object"&&typeof setup==="function"){return this.distributionLists("",username,setup)}}setup=setup||{};if(setup.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else{setup.url=this.url}}else{this.url=setup.url}fct=fct||(function(){});if(!username){throw"Error 'distributionLists': you have to set an username."}username=username.toLowerCase();setup.url=setup.url.toLowerCase();var cache=jQuery("body").data("sp-distributionLists")||[];for(var i=cache.length;i--;){if(cache[i].user===username&&cache[i].url===setup.url){fct.call(this,cache[i].data);return this}}var body="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><GetCommonMemberships xmlns='http://microsoft.com/webservices/SharePointPortalServer/UserProfileService'><accountName>"+username+"</accountName></GetCommonMemberships></soap:Body></soap:Envelope>";var _this=this;var url=setup.url+"/_vti_bin/UserProfileService.asmx";jQuery.ajax({type:"POST",cache:false,url:url,data:body,beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/GetUserMemberships")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(data){var aResult=[];data=data.getElementsByTagName("MembershipData");for(var i=0,len=data.length;i<len;i++){if(data[i].getElementsByTagName("Source")[0].firstChild.nodeValue==="DistributionList"){aResult.push({SourceReference:data[i].getElementsByTagName("SourceReference")[0].firstChild.nodeValue,DisplayName:data[i].getElementsByTagName("DisplayName")[0].firstChild.nodeValue,MailNickname:data[i].getElementsByTagName("MailNickname")[0].firstChild.nodeValue,Url:data[i].getElementsByTagName("Url")[0].firstChild.nodeValue})}}cache.push({user:username,url:setup.url,data:aResult});jQuery("body").data("sp-distributionLists",cache);fct.call(_this,aResult)},error:function(req,textStatus,errorThrown){fct.call(_this,[])}});return this},groupMembers:function(groupname,setup,fct){switch(arguments.length){case 1:if(typeof groupname==="object"){return this.groupMembers("",groupname,function(){})}else{if(typeof groupname==="function"){return this.groupMembers("",{},groupname)}}break;case 2:if(typeof groupname==="string"&&typeof setup==="function"){return this.groupMembers(groupname,{},setup)}if(typeof groupname==="object"&&typeof setup==="function"){return this.groupMembers("",groupname,setup)}}setup=setup||{};if(setup.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else{setup.url=this.url}}else{this.url=setup.url}fct=fct||(function(){});if(!groupname){throw"Error 'groupMembers': you have to set an groupname."}groupname=groupname.toLowerCase();setup.url=setup.url.toLowerCase();var cache=jQuery("body").data("sp-groupMembers")||[];for(var i=cache.length;i--;){if(cache[i].group===groupname&&cache[i].url===setup.url){fct.call(this,cache[i].data);return this}}var body="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><GetUserCollectionFromGroup xmlns='http://schemas.microsoft.com/sharepoint/soap/directory/'><groupName>"+this._cleanString(groupname)+"</groupName></GetUserCollectionFromGroup></soap:Body></soap:Envelope>";var _this=this;var url=setup.url+"/_vti_bin/usergroup.asmx";jQuery.ajax({type:"POST",cache:false,url:url,data:body,beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/directory/GetUserCollectionFromGroup")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(data){var aResult=[];data=data.getElementsByTagName("User");for(var i=0,len=data.length;i<len;i++){aResult.push({ID:data[i].getAttribute("ID"),Name:data[i].getAttribute("Name"),LoginName:data[i].getAttribute("LoginName"),Email:data[i].getAttribute("Email")})}cache.push({group:groupname,url:setup.url,data:aResult});jQuery("body").data("sp-groupMembers",cache);fct.call(_this,aResult)},error:function(req,textStatus,errorThrown){if(setup.error===false){fct.call(_this,[])}else{var error=req.responseXML.getElementsByTagName("errorstring");if(typeof console==="object"){console.error("Error 'groupMembers': "+error[0].firstChild.nodeValue)}}}});return this},isMember:function(setup,fct){setup=setup||{};if(setup.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else{setup.url=this.url}}else{this.url=setup.url}fct=fct||(function(){});if(!setup.user){throw"Error 'isMember': you have to set an user."}if(!setup.group){throw"Error 'isMember': you have to set a group."}setup.group=setup.group.toLowerCase();this.usergroups(setup.user,{error:false},function(groups){for(var i=groups.length;i--;){if(groups[i].toLowerCase()===setup.group){fct.call(this,true);return this}}this.groupMembers(setup.group,{error:false},function(m){var members=[];for(var i=m.length;i--;){members.push(m[i].Name.toLowerCase())}this.distributionLists(setup.user,function(distrib){for(var i=distrib.length;i--;){if(members.indexOf(distrib[i].DisplayName.toLowerCase())>-1){fct.call(this,true);return this}}fct.call(this,false);return this})})});return this},people:function(username,setup,fct){switch(arguments.length){case 1:if(typeof username==="object"){return this.people("",username,function(){})}else{if(typeof username==="function"){return this.people("",{},username)}}username=undefined;break;case 2:if(typeof username==="string"&&typeof setup==="function"){return this.people(username,{},setup)}if(typeof username==="object"&&typeof setup==="function"){return this.people("",username,setup)}}setup=setup||{};if(setup.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else{setup.url=this.url}}else{this.url=setup.url}fct=fct||(function(){});username=username||"";var body="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><GetUserProfileByName xmlns='http://microsoft.com/webservices/SharePointPortalServer/UserProfileService'><AccountName>"+username+"</AccountName></GetUserProfileByName></soap:Body></soap:Envelope>";var _this=this;var url=setup.url+"/_vti_bin/UserProfileService.asmx";jQuery.ajax({type:"POST",cache:false,url:url,data:body,beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/GetUserProfileByName")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(data){var aResult=[];data=data.getElementsByTagName("PropertyData");for(var i=0,len=data.length;i<len;i++){var name=data[i].getElementsByTagName("Name")[0].firstChild.nodeValue;var value=data[i].getElementsByTagName("Value");if(value&&value.length>=1){value=value[0].firstChild.nodeValue}else{value="No Value"}aResult.push(name);aResult[name]=value}fct.call(_this,aResult)},error:function(req,textStatus,errorThrown){var error=req.responseXML.getElementsByTagName("faultstring");fct.call(_this,"Error 'people': "+error[0].firstChild.nodeValue)}});return this},whoami:function(setup,fct){if(typeof setup==="function"){fct=setup;setup={}}return this.people("",setup,fct)},addressbook:function(username,setup,fct){switch(arguments.length){case 1:if(typeof username==="object"){return this.addressbook("",username,function(){})}else{if(typeof username==="function"){return this.addressbook("",{},username)}else{if(typeof username==="string"){return this.addressbook(username,{},function(){})}}}username=undefined;break;case 2:if(typeof username==="string"&&typeof setup==="function"){return this.addressbook(username,{},setup)}if(typeof username==="object"&&typeof setup==="function"){return this.addressbook("",username,setup)}}setup=setup||{};if(setup.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else{setup.url=this.url}}else{this.url=setup.url}setup.limit=setup.limit||10;setup.type=setup.type||"User";fct=fct||(function(){});username=username||"";var body="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><SearchPrincipals xmlns='http://schemas.microsoft.com/sharepoint/soap/'><searchText>"+username+"</searchText><maxResults>"+setup.limit+"</maxResults><principalType>"+setup.type+"</principalType></SearchPrincipals></soap:Body></soap:Envelope>";var _this=this;var url=setup.url+"/_vti_bin/People.asmx";jQuery.ajax({type:"POST",cache:false,url:url,data:body,beforeSend:function(xhr){xhr.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/SearchPrincipals")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(data){var aResult=[];data=data.getElementsByTagName("PrincipalInfo");for(var i=0,lenR=data.length;i<lenR;i++){var children=data[i].childNodes;aResult[i]=[];for(var j=0,lenC=children.length;j<lenC;j++){var name=children[j].nodeName;var value=children[j].firstChild;if(value){value=value.nodeValue}aResult[i].push(name);aResult[i][name]=value}}fct.call(_this,aResult)}});return this},reset:function(){this.data=[];this.length=0;this.listID="";this.needQueue=false;this.listQueue=[];delete this.url},toDate:function(strDate){if(strDate instanceof Date){return strDate}if(strDate.length!=19&&strDate.length!=20){throw"toDate: '"+strDate+"' is invalid."}var year=strDate.substring(0,4);var month=strDate.substring(5,7);var day=strDate.substring(8,10);var hour=strDate.substring(11,13);var min=strDate.substring(14,16);var sec=strDate.substring(17,19);return(strDate.indexOf("Z")>-1?new Date(Date.UTC(year,month-1,day,hour,min,sec)):new Date(year,month-1,day,hour,min,sec))},toSPDate:function(oDate,includeTime){var pad=function(p_str){if(p_str.toString().length==1){p_str="0"+p_str}return p_str};var month=pad(oDate.getMonth()+1);var day=pad(oDate.getDate());var year=oDate.getFullYear();var hours=pad(oDate.getHours());var minutes=pad(oDate.getMinutes());var seconds=pad(oDate.getSeconds());return year+"-"+month+"-"+day+(includeTime?" "+hours+":"+minutes+":"+seconds:"")},toCurrency:function(n,dec,sign){n=Number(n);if(dec===undefined){dec=-1}if(sign===undefined){sign="$"}var m="";if(n<0){m="-";n*=-1}var s=n;if(dec===-1){s=s.toFixed(2).replace(".00","")}else{s=s.toFixed(dec)}var digits=(Math.floor(n)+"").length;for(var i=0,j=0,mod=digits%3;i<digits;i++){if(i==0||i%3!=mod){continue}s=s.substr(0,i+j)+","+s.substr(i+j);j++}return(sign!=""?sign:"")+m+s+(sign!=""?"":" "+sign)},getLookup:function(str){if(!str){return{id:"",value:""}}var a=str.split(";#");return{id:a[0],value:a[1]}},toXSLString:function(str){if(typeof str!=="string"){throw"Error 'toXLSString': '"+str+"' is not a string...."}var FullEscape=function(strg,exceptNumeric){exceptNumeric=exceptNumeric||false;var hexVals=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F");var rstr="";for(var i=0;i<strg.length;i++){var c=strg.charAt(i);var num=c.charCodeAt(0);var temp=0;var hexString="";while(num>=16){temp=num%16;num=Math.floor(num/16);hexString+=hexVals[temp]}hexString+=hexVals[num];var tmpStr="";for(var k=hexString.length-1;k>=0;k--){tmpStr+=hexString.charAt(k)}rstr+="%"+tmpStr}return rstr};var aSpaces=str.split(" ");var ret="";if(/^[0-9]/.test(aSpaces[0])&&aSpaces[0].length<5){ret=FullEscape(str.charAt(0));str=str.substring(1)}for(var i=0;i<str.length;i++){var c=str.charAt(i);if(/[0-9A-Za-z_]/.test(c)===false){ret+=FullEscape(c).toLowerCase()}else{ret+=c}}return ret.replace(/%([a-zA-Z0-9][a-zA-Z0-9])/g,"_x00$1_").substring(0,32)},formfields:function(fields,settings){this.reset();if(arguments.length==1&&typeof fields==="object"&&typeof fields.length==="undefined"){settings=fields;fields=undefined}settings=settings||{};fields=fields||[];settings.cache=(settings.cache===false?false:true);var aReturn=[],bigLimit=10000;if(typeof fields==="string"){fields=(fields===""?[]:fields.split(","))}var limit=(fields.length>0?fields.length:bigLimit);if(limit===bigLimit&&!settings.mandatory){settings.includeAll=true}if(_SP_CACHE_FORMFIELDS!==null){var allFields=_SP_CACHE_FORMFIELDS.slice(0);if(settings.includeAll){this.length=allFields.length;this.data=allFields;return this}var done=0,i,len=allFields.length,idx;var fieldNames=[];for(i=0;i<len;i++){fieldNames.push(allFields[i]._name)}for(i=0;i<limit;i++){idx=fieldNames.indexOf(fields[i]);if(idx>-1){aReturn.push(allFields[idx])}}for(i=0,len=(settings.mandatory?allFields.length:0);i<len;i++){if(allFields[i]._isMandatory&&fields.indexOf(allFields[i]._name)===-1){aReturn.push(allFields[i])}}this.length=aReturn.length;this.data=aReturn;return this}if(settings.cache){settings.includeAll=true}var selectorSupported=(typeof document.querySelector!=="undefined");var table=null;if(!selectorSupported){for(var a=document.getElementsByTagName("table"),i=0,len=a.length;i<len;i++){if(a[i].className.indexOf("ms-formtable")>-1){table=a[i];break}}}else{table=document.querySelector("table.ms-formtable")}if(!table){throw"Error: unable to find the table.ms-formtable!"}var closestTR=function(nobr){var tr=nobr;do{tr=tr.parentNode}while(tr.tagName.toLowerCase()!=="tr");return tr};var getText=function(elem){var i,node,nodeType=elem.nodeType,ret="";if(nodeType){if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{if(typeof elem.innerText==="string"){return elem.innerText.replace(/\r/g,"")}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}}else{if(nodeType===3||nodeType===4){return elem.nodeValue}}}else{for(i=0;(node=elem[i]);i++){if(node.nodeType!==8){ret+=getText(node)}}}return ret};if(settings.includeAll){limit=bigLimit}for(var a=table.getElementsByTagName("nobr"),i=-1,len=a.length,done=0;i<len&&done<limit;i++){var nobr,tr,isMandatory=false,html,txt,includeThisField=false;var search;if(settings.includeAll){includeThisField=true}if(i===-1){if(includeThisField||fields.indexOf("Content Type")>-1){txt=html="Content Type";includeThisField=true}}else{tr=undefined;nobr=a[i];html=nobr.innerHTML;txt=getText(nobr);if(html.indexOf("ms-formvalidation")>-1){html=html.slice(0,-39);if(html.charAt(html.length-2)=="<"&&(html.charAt(html.length-1)=="s"||html.charAt(html.length-1)=="S")){html=html.slice(0,-2)}if(settings.mandatory){includeThisField=true}txt=txt.slice(0,-2);isMandatory=true}if(limit!==bigLimit){for(var k=0,lenk=limit;k<lenk;k++){if(fields[k].trim()===txt){includeThisField=true;done++;break}}}}if(includeThisField){var fieldName=txt;var obj={_name:fieldName,_isMandatory:isMandatory,_description:"",_elements:null,_tr:null,_type:null};if(fieldName==="Content Type"){if(selectorSupported){obj._elements=document.querySelector('.ms-formbody select[title="Content Type"]')}else{for(var a=document.getElementsByTagName("td"),aa=0;aa<a.length;aa++){if(a[aa].className.indexOf("ms-formbody")>-1){for(var b=document.getElementsByTagName("select"),bb=0;bb<b.length;bb++){if(b[bb].title==="Content Type"){aa=a.length;obj._elements=b[bb];break}}}}}obj._type="content type";if(obj._elements){obj._tr=closestTR(obj._elements)}else{continue}}else{obj._tr=(tr===undefined?closestTR(nobr):tr)}obj.val=function(){};obj.elem=function(){return this._elements};obj.description=function(){return this._description};obj.type=function(){return this._type};obj.row=function(){return this._tr};obj.name=function(){return this._name};obj.isMandatory=function(){return this._isMandatory};obj.options=function(){};tr=(obj._tr.length?obj._tr[0]:obj._tr);var td=tr.getElementsByTagName("td")[1].getElementsByTagName("span")[0];var elem=[];if(obj._name==="Attachments"){obj._type="attachments";elem=td.getElementsByTagName("tr")}else{if(obj._name==="Content Type"){elem=[obj._elements]}else{var input=td.getElementsByTagName("input");var continueToSearch=false;for(var inp=0;inp<input.length;inp++){if(input[inp].getAttribute("data-sp-ignore")!=="true"){var type=input[inp].getAttribute("type");switch(type){case"text":if(input[inp].className.indexOf("ms-input")>-1||input[inp].className.indexOf("ms-long")>-1){elem.push(input[inp]);if(!obj._type){obj._type="text"}if(input[inp].id.search(/DateTimeFieldDate$/)>-1){continueToSearch=true;obj._type="date"}else{if(input[inp].id.search(/_UrlFieldUrl$|_UrlFieldDescription$/)>-1){obj._type="url";elem.pop();elem.push(input[inp].previousElementSibling||input[inp].previousSibling);elem.push(input[inp])}else{inp=input.length}}}else{if(input[inp].title.indexOf("Specify your own value:")>-1){elem.push(input[inp]);if(obj._type.slice(0,7)==="choices"){obj._type+=" plus"}}}break;case"radio":if(input[inp].id.search(/_DropDownButton$/)>-1){obj._type="choices plus";do{elem.push(input[inp]);if(!inp){elem.push("")}}while(++inp<input.length);continueToSearch=true}else{elem.push(input[inp]);elem.push(input[inp].nextSibling);obj._type="choices radio"}break;case"checkbox":elem.push(input[inp]);if(input[inp].id.search(/_BooleanField$/)>-1){obj._type="boolean"}else{obj._type="choices checkbox"}if(obj._type!=="boolean"){elem.push(input[inp].nextSibling)}break}}}if(elem.length===0||continueToSearch){var select=td.getElementsByTagName("select");for(inp=0;inp<select.length;inp++){if(select[inp].className.indexOf("ms-RadioText")>-1||select[inp].id.search(/_cbRate$|_Lookup$|_SelectResult$|_SelectCandidate$|_DateTimeFieldDateHours$|_DateTimeFieldDateMinutes$/)>-1){if(select[inp].id.search(/_SelectCandidate$|_SelectResult$|_DateTimeFieldDateHours$|_DateTimeFieldDateMinutes$/)>-1){if(select[inp].id.indexOf("DateTimeField")>-1){obj._type="date time"}elem.push(select[inp]);if(select[inp].id.indexOf("_SelectCandidate")>-1){var buttons=td.getElementsByTagName("button");if(buttons.length===2){elem.push(buttons[0]);elem.push(buttons[1]);obj._type="lookup multiple"}}}else{if(continueToSearch){if(obj._type==="choices plus"){elem[1]=select[inp]}else{elem.push(select[inp])}}else{elem.push(select[inp]);if(select[inp].id.search(/_Lookup$/)>-1){obj._type="lookup"}else{if(!obj._type){obj._type="choices"}}}break}}}}if(elem.length===0){var other=td.getElementsByTagName("div");for(inp=0;inp<other.length;inp++){if(other[inp].className.indexOf("ms-inputuserfield")>-1){elem.push(other[inp]);obj._type="people";break}}other=td.getElementsByTagName("textarea");for(inp=0;inp<other.length;inp++){if(other[inp].className.indexOf("ms-long")>-1||other[inp].className.indexOf("ms-input")>-1){elem.push(other[inp]);if(!obj._type){obj._type="text multiple"}else{if(obj._type==="people"){other=td.getElementsByTagName("a");for(inp=0;inp<other.length;inp++){elem.push(other[inp])}break}}other=other[inp].nextSibling;if(other&&other.className&&other.className.indexOf("ms-rtetoolbarmenu")>-1){elem=td.getElementsByTagName("iframe")}else{other=td.getElementsByTagName("span");for(inp=other.length;inp--;){if(other[inp].className.indexOf("ms-formdescription")>-1){elem.push(other[inp]);break}}break}}}}if(td.nextSibling){var descro=td.nextSibling;if(descro.nodeType==3){obj._description=getText(descro).trim()}}}}obj._elements=elem;switch(obj.type()){case"attachments":obj.val=function(v){if(v){alert("$SP.formfields Error: You cannot define a value for the Attachments")}else{var elem=this.elem();var ret=[];for(v=0;v<elem.length;v++){ret.push(getText(elem[v]).slice(0,-6).trim())}return ret}};break;case"date":case"text":case"text multiple":obj.val=function(v){var e=this.elem();var type=this.type();if(e[0].tagName.toLowerCase()==="iframe"){var ifrm=(e.length===1?e[0]:e[1]);var doc=(ifrm.contentDocument?ifrm.contentDocument:ifrm.contentWindow.document);if(v){doc.getElementsByTagName("div")[0].innerHTML=v}else{return doc.getElementsByTagName("div")[0].innerHTML}}else{if(v!==undefined){if(type==="text"||type==="date"){e[0].value=v}else{e[0].innerHTML=v}}else{return e[0].value}}return this};break;case"date time":obj.val=function(v){var ret=[];var e=this.elem();if(v!==undefined){if(typeof v==="string"){v=[v]}e[0].value=v[0];for(var h=1;h<3;h++){if(v[h]){var options=e[h].getElementsByTagName("option");for(var i=options.length;i--;){if(options[i].value===v[h]){options[i].selected=true}}}}}else{for(var i=0;i<e.length;i++){if(e[i].tagName.toLowerCase()==="input"){ret.push(e[i].value)}else{var options=e[i].getElementsByTagName("option");for(var o=options.length;o--;){if(options[o].selected){ret.push(options[o].value);break}}}}return ret}return this};break;case"url":obj.val=function(v){if(v!==undefined){if(typeof v==="string"){v=[v,v]}else{if(v.length===1){v=[v[0],v[0]]}}}var ret=[];var e=this.elem();for(var i=0,idx=0;i<e.length;i++){if(e[i].tagName.toLowerCase()==="input"){if(v!==undefined){e[i].value=v[idx++]}else{ret.push(e[i].value)}}}return(v!==undefined?this:ret)};break;case"boolean":obj.val=function(v){if(typeof v==="boolean"){this.elem()[0].checked=v;return this}else{return this.elem()[0].checked}};break;case"people":obj.val=function(v){var e=this.elem();if(v!==undefined){e[0].innerHTML=v;e[1].value=v;return this}else{v=e[0].innerHTML.replace(/(<([^>]+)>)/ig,"").replace(/^\s+|\s+$|&#160;/g,"").replace(/<br>|&nbsp;/g,"").replace(/;$/,"").split(";");var ret=[];for(var x=0;x<v.length;x++){v[x]=v[x].trim();if(v[x]!==""){ret.push(v[x])}}if(ret.length===1){return ret[0]}if(ret.length===0){return""}return ret}};break;case"content type":obj.val=function(v){var e=this.elem();var options=e[0].getElementsByTagName("option");for(var i=0;i<options.length;i++){if(v==options[i].value||v==options[i].innerHTML){options[i].selected=true;eval("!function() {"+e[0].getAttribute("onchange").replace(/javascript:/,"")+"}()");return this}if(!v&&options[i].selected){return options[i].innerHTML}}return this};obj.options=function(){var ret=[];var e=this.elem();var options=e[0].getElementsByTagName("option");for(var i=0;i<options.length;i++){ret.push(options[i].value+";#"+options[i].innerHTML)}return ret};break;case"lookup":case"choices":case"choices plus":obj.val=function(v){var e=this.elem();var type=this.type();var options=(type.slice(-4)==="plus"?e[1].getElementsByTagName("option"):e[0].getElementsByTagName("option"));for(var i=0;i<options.length;i++){if(v==options[i].value||v==options[i].innerHTML){options[i].selected=true;if(type==="choices plus"){e[0].checked=true}return this}if(v===undefined&&options[i].selected){if((type==="lookup"||type==="choices")||(type==="choices plus"&&e[0].checked)){return options[i].innerHTML}}}if(type==="choices plus"&&e.length===4){if(v!==undefined){e[2].checked=true;e[3].value=v}else{if(e[2].checked){return e[3].value}}}};obj.options=function(){var ret=[];var e=this.elem();var type=this.type();var options=(type.slice(-4)==="plus"?e[1].getElementsByTagName("option"):e[0].getElementsByTagName("option"));for(var i=0;i<options.length;i++){ret.push(options[i].value+(type==="lookup"?";#"+options[i].innerHTML:""))}if(type==="choices plus"&&e.length===4&&e[3].value!=""){ret.push(e[3].value)}return ret};break;case"lookup multiple":obj.val=function(v){var e=this.elem();var type=this.type();var options,i;if(typeof v==="string"){v=[v]}if(v!==undefined){var optValues=[],optText=[],idx;options=e[3].getElementsByTagName("option");for(i=0;i<options.length;i++){options[i].selected=true}eval("!function() {"+e[2].getAttribute("onclick")+"}()");options=e[0].getElementsByTagName("option");for(idx=0;idx<options.length;idx++){options[idx].selected=false}for(i=0;i<v.length;i++){for(idx=0;idx<options.length;idx++){if(options[idx].innerHTML==v[i]||options[idx].value==v[i]){options[idx].selected=true;eval("!function() {"+e[1].getAttribute("onclick")+"}()");options=e[0].getElementsByTagName("option");break}}}return this}else{var ret=[];options=e[3].getElementsByTagName("option");for(i=0;i<options.length;i++){ret.push(options[i].innerHTML)}return ret}};obj.options=function(){var ret=[];var e=this.elem();var options=e[0].getElementsByTagName("option");for(i=0;i<options.length;i++){ret.push(options[i].value+";#"+options[i].innerHTML)}options=e[3].getElementsByTagName("option");for(i=0;i<options.length;i++){ret.push(options[i].value+";#"+options[i].innerHTML)}return ret};break;case"choices radio":case"choices radio plus":case"choices checkbox":case"choices checkbox plus":obj.val=function(v){var e=this.elem();var type=this.type();var ret=[],done=[];if(typeof v==="string"){v=[v]}for(var i=0;i<e.length;i++){if(v!==undefined&&e[i].tagName.toLowerCase()==="label"&&v.indexOf(e[i].innerHTML)>-1){e[i-1].checked=true;done.push(e[i].innerHTML);if(type.slice(0,13)==="choices radio"){return this}}else{if(v!==undefined&&e[i].tagName.toLowerCase()==="label"){e[i-1].checked=false}else{if(v===undefined&&e[i].checked){if(type==="choices radio plus"){if(e[i+1].innerHTML==="Specify your own value:"){return e[i+2].value}return e[i+1].innerHTML}else{ret.push(e[i+1].innerHTML==="Specify your own value:"?e[i+2].value:e[i+1].innerHTML)}}}}}if(v===undefined){return ret}if(v!==undefined){if(type==="choices radio plus"){e[e.length-3].checked=true;e[e.length-1].value=v}else{if(type==="choices checkbox plus"){var rest=[];for(var i=v.length;i--;){if(done.indexOf(v[i])===-1){rest.push(v[i])}}if(rest.length>0){e[e.length-3].checked=true;e[e.length-1].value=rest.join(" ")}}}return this}};obj.options=function(){var e=this.elem();var ret=[];var type=this.type().slice(-4);for(var i=0;i<e.length;i++){if(e[i].tagName.toLowerCase()==="label"){if(e[i].innerHTML==="Specify your own value:"&&type==="plus"){continue}ret.push(e[i].innerHTML)}else{if(type==="plus"&&e[i].type==="text"&&e[i].value!=""){ret.push(e[i].value)}}}return ret};break}aReturn.push(obj)}}if(settings.cache){_SP_CACHE_FORMFIELDS=aReturn.slice(0);settings.includeAll=false;return this.formfields(fields,settings)}else{this.length=aReturn.length;this.data=aReturn;return this}},each:function(fct){for(var i=0,len=this.data.length;i<len;i++){fct.call(this.data[i])}return this},val:function(str){if(typeof str==="object"&&str.identity!==undefined){identity=str.identity;str=undefined}else{identity=false}if(str===undefined){var aReturn=[];this.each(function(){if(identity){aReturn[this.name()]=this.val()}else{aReturn.push(this.val())}});return(aReturn.length===1?aReturn[0]:aReturn)}else{if(typeof str!=="object"){this.each(function(){this.val(str)})}else{var i=0;if(this.length>1){if(str.length!==this.length){throw new Error("$SP.formfields.val: the array passed for val() must have the same size as the number of fields in formfields()")}this.each(function(){this.val(str[i++])})}else{this.each(function(){this.val(str)})}}}return this},elem:function(){var aReturn=[];var hasJQuery=(typeof jQuery==="function");this.each(function(){var e=this.elem();aReturn.push(e.length===1?e[0]:e)});switch(aReturn.length){case 0:return hasJQuery?jQuery():null;case 1:return hasJQuery?jQuery(aReturn[0]):aReturn[0];default:return hasJQuery?jQuery(aReturn):aReturn}},row:function(){var aReturn=[];var hasJQuery=(typeof jQuery==="function");this.each(function(){aReturn.push(this.row())});switch(aReturn.length){case 0:return null;case 1:return(hasJQuery?jQuery(aReturn[0]):aReturn[0]);default:return(hasJQuery?jQuery(aReturn):aReturn)}},type:function(){var aReturn=[];this.each(function(){aReturn.push(this.type())});switch(aReturn.length){case 0:return"";case 1:return aReturn[0];default:return aReturn}},description:function(){var aReturn=[];this.each(function(){aReturn.push(this.description())});switch(aReturn.length){case 0:return"";case 1:return aReturn[0];default:return aReturn}},registerPlugin:function(name,fct){var $html=$("html");var plugins=$html.data("sp-plugins")||[];if(typeof plugins[name]!=="undefined"){throw"Error 'registerPlugin': '"+name+"' is already registered."}plugins[name]=fct;$html.data("sp-plugins",plugins);return true},plugin:function(name,options){var plugins=$("html").data("sp-plugins")||[];options=options||{};if(typeof plugins[name]==="function"){plugins[name].call(this,options)}else{throw"Error $SP().plugin: the plugin '"+name+"' is not registered."}return this}};var myElem=(function(){var myElem=function(elem){return new MyElemConstruct(elem)},MyElemConstruct=function(elem){this.mynode=elem;this.singleList=true;return this};myElem.fn=MyElemConstruct.prototype={getAttribute:function(id){return this.mynode.getAttribute("ows_"+id.replace(/ /g,""))},getAttributes:function(){return this.mynode.attributes}};return myElem})();var extendMyObject=function(arr){this.attributes=arr};extendMyObject.prototype.getAttribute=function(attr){return this.attributes[attr]};extendMyObject.prototype.getAttributes=function(){return this.attributes};SharepointPlus.prototype.noConflict=function(){window._$SP=window._SharepointPlus=window.$SP};return window.$SP=window.SharepointPlus=SharepointPlus})(window);