/*! Collision Detection for EaselJS - MIT license - (c) 2012 Olaf Horstmann */
this.ndgmr=this.ndgmr||{},function(){var a=document.createElement("canvas"),b=a.getContext("2d");b.save();var c=document.createElement("canvas"),d=c.getContext("2d");d.save();var e=[],f=function(a,b){var c,d;return c=m(a),d=m(b),l(c,d)};ndgmr.checkRectCollision=f;var g=function(e,g,k,l){(ndgmr.DEBUG||ndgmr.DEBUG_COLLISION)&&(document.body.appendChild(a),document.body.appendChild(c)),l=l||!1;var m,o,p,q;return(m=h(e,g))?(intersection=f(e,g))?(k=k||0,k=Math.min(.99999,k),a.width=intersection.width,a.height=intersection.height,c.width=intersection.width,c.height=intersection.height,o=i(intersection,e,b,1),p=i(intersection,g,d,2),(q=j(o,p,intersection.width,intersection.height,k,l))?(q.x+=intersection.x,q.x2+=intersection.x,q.y+=intersection.y,q.y2+=intersection.y,q):!1):!1:!1};ndgmr.checkPixelCollision=g;var h=function(a,b){var c,d,e,f;return e=a.localToGlobal(0,0),f=b.localToGlobal(0,0),c=a instanceof createjs.Bitmap?{width:a.image.width,height:a.image.height}:a.spriteSheet.getFrame(a.currentFrame).rect,d=b instanceof createjs.Bitmap?{width:b.image.width,height:b.image.height}:b.spriteSheet.getFrame(b.currentFrame).rect,Math.abs(f.x-e.x)<d.width*b.scaleX+c.width*a.scaleX&&Math.abs(f.y-e.y)<d.height*b.scaleY+c.height*b.scaleY},i=function(a,b,c,d){var f,g,h,i;return b instanceof createjs.Bitmap?g=b.image:b instanceof createjs.Sprite&&(frame=b.spriteSheet.getFrame(b.currentFrame),h=frame.image.src+":"+frame.rect.x+":"+frame.rect.y+":"+frame.rect.width+":"+frame.rect.height,e[h]?g=e[h]:e[h]=g=createjs.SpriteSheetUtils.extractFrame(b.spriteSheet,b.currentFrame)),f=b.globalToLocal(a.x,a.y),c.restore(),c.save(),c.rotate(k(b,"rotation")*(Math.PI/180)),c.scale(k(b,"scaleX","*"),k(b,"scaleY","*")),c.translate(-f.x-a["rect"+d].regX,-f.y-a["rect"+d].regY),void 0!=(i=b.sourceRect)?c.drawImage(g,i.x,i.y,i.width,i.height,0,0,i.width,i.height):c.drawImage(g,0,0,g.width,g.height),c.getImageData(0,0,a.width,a.height).data},j=function(a,b,c,d,e,f){var g,h,i,j,k=3,l={x:1/0,y:1/0,x2:-1/0,y2:-1/0};for(j=0;d>j;++j)for(i=0;c>i;++i){if(g=a.length>k+1?a[k]/255:0,h=b.length>k+1?b[k]/255:0,g>e&&h>e){if(!f)return{x:i,y:j,width:1,height:1};i<l.x&&(l.x=i),i>l.x2&&(l.x2=i),j<l.y&&(l.y=j),j>l.y2&&(l.y2=j)}k+=4}return 1/0!=l.x?(l.width=l.x2-l.x+1,l.height=l.y2-l.y+1,l):null},k=function(a,b,c){if(c=c||"+",a.parent&&a.parent[b]){var d=a[b],e=k(a.parent,b,c);return"*"==c?d*e:d+e}return a[b]},l=function(a,b){var c,d,e={},f={};return e.cx=a.x+(e.hw=a.width/2),e.cy=a.y+(e.hh=a.height/2),f.cx=b.x+(f.hw=b.width/2),f.cy=b.y+(f.hh=b.height/2),c=Math.abs(e.cx-f.cx)-(e.hw+f.hw),d=Math.abs(e.cy-f.cy)-(e.hh+f.hh),0>c&&0>d?(c=Math.min(Math.min(a.width,b.width),-c),d=Math.min(Math.min(a.height,b.height),-d),{x:Math.max(a.x,b.x),y:Math.max(a.y,b.y),width:c,height:d,rect1:a,rect2:b}):null};ndgmr.calculateIntersection=l;var m=function(a){var b={x:1/0,y:1/0,width:0,height:0};if(a instanceof createjs.Container){b.x2=-1/0,b.y2=-1/0;var e,f,c=a.children,d=c.length;for(f=0;d>f;f++)e=m(c[f]),e.x<b.x&&(b.x=e.x),e.y<b.y&&(b.y=e.y),e.x+e.width>b.x2&&(b.x2=e.x+e.width),e.y+e.height>b.y2&&(b.y2=e.y+e.height);1/0==b.x&&(b.x=0),1/0==b.y&&(b.y=0),1/0==b.x2&&(b.x2=0),1/0==b.y2&&(b.y2=0),b.width=b.x2-b.x,b.height=b.y2-b.y,delete b.x2,delete b.y2}else{var g,h,i,j,l,k={};if(a instanceof createjs.Bitmap)l=a.sourceRect||a.image,k.width=l.width,k.height=l.height;else if(a instanceof createjs.Sprite)if(a.spriteSheet._frames&&a.spriteSheet._frames[a.currentFrame]&&a.spriteSheet._frames[a.currentFrame].image){var n=a.spriteSheet.getFrame(a.currentFrame);k.width=n.rect.width,k.height=n.rect.height,k.regX=n.regX,k.regY=n.regY}else b.x=a.x||0,b.y=a.y||0;else b.x=a.x||0,b.y=a.y||0;k.regX=k.regX||0,k.width=k.width||0,k.regY=k.regY||0,k.height=k.height||0,b.regX=k.regX,b.regY=k.regY,g=a.localToGlobal(0-k.regX,0-k.regY),h=a.localToGlobal(k.width-k.regX,k.height-k.regY),i=a.localToGlobal(k.width-k.regX,0-k.regY),j=a.localToGlobal(0-k.regX,k.height-k.regY),b.x=Math.min(Math.min(Math.min(g.x,h.x),i.x),j.x),b.y=Math.min(Math.min(Math.min(g.y,h.y),i.y),j.y),b.width=Math.max(Math.max(Math.max(g.x,h.x),i.x),j.x)-b.x,b.height=Math.max(Math.max(Math.max(g.y,h.y),i.y),j.y)-b.y}return b};ndgmr.getBounds=m}();