(function(e,j,d){var l=function(){},f=j.Notifier=j.Model.extend({defaults:{baseCls:"notifier",types:["warning","error","info","success"],dialog:!1,theme:"plastic",message:"",closeBtn:!1,title:void 0,hideOnClick:!0,type:null,cls:null,ms:1E4,loader:!1,destroy:!1,modal:!1,opacity:1,offsetY:0,fadeInMs:500,fadeOutMs:500,position:"top",screenOpacity:0.65,zIndex:1E4,width:void 0,modules:void 0},transitions:{top:{"in":function(a,b,c,d,h){a.css({display:"block",top:-1E3});a.css({top:-b.innerHeight()}).animate({top:c.offsetY,
opacity:c.opacity},d,h||l)},out:function(a,b,c,d,h){a.animate({top:-b.innerHeight(),opacity:0},d,h||l)}},center:{"in":function(a,b,c,d,h){a.css({top:c.offsetY-40,display:"block"}).animate({top:"50%",marginTop:-b.innerHeight()/2,opacity:c.opacity},d,h||l)},out:function(a,b,c,d,h){a.animate({top:"0%",opacity:0},d,h||l)}},bottom:{"in":function(a,b,c,d,h){a.css({bottom:c.offsetY-40,top:"auto",display:"block"}).animate({bottom:b.innerHeight()+c.offsetY,opacity:c.opacity},d,h||l)},out:function(a,b,c,d,
h){a.animate({bottom:-b.height(),opacity:0},d,h||l)}}},template:function(a){var b=['<div class="'+a.wrapperCls+'">','<div class="'+a.innerCls+'">',a.title?'<div class="'+a.baseCls+'-title">'+a.title+"</div>":"",a.closeBtn?'<button class="'+a.baseCls+'-close" data-handler="destroy"><span>x</span></button>':""];a.dialog?b.push('<div class="'+a.baseCls+'-message">'+a.message+(a.loader?'<div class="'+a.baseCls+'-loader"></div>':"")+"</div>"):b.push('<div class="'+a.baseCls+'-message">'+a.message+"</div>",
a.loader?'<div class="'+a.baseCls+'-loader"></div>':"");if(a.buttons){var c=e("<div />");d.each(a.buttons,function(a){c.append(e("<button/>",a))});b.push('<div class="'+a.baseCls+'-btns">'+c.html()+"</div>")}b.push("</div></div>");return b.join("")},initEl:function(){var a=this.el?this.el:"body",a=d.isObject(a)?a:e(a);if(!a.length)return e(e.proxy(this.initEl,this));this.$el=a;this._cssPos=a.get(0)===document.body?"fixed":"absolute";a.get(0)!==document.body&&a.css("position","relative");"absolute"===
this._cssPos&&a.css("overflow","hidden")},initialize:function(a){var b=this;this.el=a&&a.el;this.initEl.call(this,a&&a.el);this.current={};b.NotificationView=j.View.extend({defaults:b.attributes,on:function(a,b){var c=b,i=this;d.isString(b)&&(c=function(){i[b].apply(i,arguments)});return j.View.prototype.on.call(this,a,c)}});var c=function(a){b[a]=b[a]||function(c){d.isString(c)&&(c={message:c});c=d.extend({},{type:""},c);c.type=c.type?a+" "+c.type:a;return b.notify(c)}};d.each(b.attributes.types,
function(a){c(a)});if(b.attributes){var i=this.attributes.modules;i&&e.each(i,function(a,b){b.name=d.isArray(i)?b.name:a;f.regModule(b)});b.attributes.modules=void 0}},calcZIndex:function(){if("absolute"===this._cssPos)return this.attributes.zIndex;var a=this.attributes.zIndex+1;d.each(this.current,function(b){a=b.zIndex>a?b.zIndex:a});return++a},destroyAll:function(a,b){var c=0;d.isFunction(a)?d.each(this.current,function(b){a(b)&&(b.destroy.call(b),c++)}):void 0!==a?d.each(this.current,function(d){d.settings[a]===
b&&(d.destroy.call(d),c++)}):d.each(this.current,function(a){a.destroy.call(a);c++});return c},getWrapperCls:function(a){return e.trim(a.baseCls+" "+(a.type?a.type+" ":"")+("theme-"+a.theme+" ")+(a.dialog?"dialog ":"")+("pos-"+a.position+" ")+(a.buttons?"with-buttons ":"")+(a.loader?"with-loader ":"")+(a.closeBtn?"with-close-btn ":"")).split(" ").join(" "+a.baseCls+"-")+" "+(a.cls||"")},getSettings:function(a){d.isString(a)&&(a={message:a});var b=e.extend({},this.attributes,a);b.title&&void 0===a.dialog&&
(b.dialog=!0);if((b.modal||b.dialog)&&void 0===a.hideOnClick)b.hideOnClick=!1;b.dialog&&void 0===a.ms&&(b.ms=null);b.dialog&&void 0===a.position&&(b.position="center");return b},notify:function(a){var a=a||{},b=this,c=this.getSettings(a);d.isObject(c.destroy)?c.destroy instanceof b.NotificationView?c.destroy.destroy():b.destroyAll.apply(b,d.isArray(c.destroy)?c.destroy:[c.destroy]):!0===c.destroy&&b.destroyAll();a=a.zIndex||b.calcZIndex.call(b);c.wrapperCls=b.getWrapperCls(c);c.innerCls=c.baseCls+
"-inner";var i=e(b.template(c)),h=i.find("."+c.innerCls);c.width&&h.css({width:c.width});f._modulesBinder.trigger("beforeAppendMsgEl",b,c,i,h);i.css({display:"none",opacity:0,position:b._cssPos,zIndex:c.modal?++a:a}).prependTo(b.$el);var g=new b.NotificationView({el:i});g.settings=c;if(c.buttons||h.find("button").length)h.on("click","button[data-handler]",function(){var a=e(this).data("handler");(d.isFunction(a)?a:g[a]).apply(g,arguments)}),h.on("button click",function(a){g.trigger("click:"+e(a.target).data("role"))});
var l=g.destroy=function(a){d.isObject(a)&&a.preventDefault&&(a.preventDefault(),a.stopPropagation());g.trigger("beforeHide",g,i);c.modal&&g.screenEl.fadeOut(300,function(){g.trigger("screenHide",g,i);g.screenEl.remove()});f._modulesBinder.trigger("beforeHideMsgEl",b,c,i,h,g);(e.isFunction(c.out)?c.out:b.transitions[c.position].out).call(b,i,h,c,c.fadeOutMs,function(){g.remove();g.trigger("destroy",g,i);f._modulesBinder.trigger("afterDestroyMsgEl",b,c,i,h,g);d.isFunction(a)&&a.call(g,g,i)});g.timeoutId&&
clearTimeout(g.timeoutId);delete g.timeoutId;delete b.current[g.cid]},j=function(a){a&&(a.preventDefault(),a.stopPropagation())};c.modal&&(g.screenEl=e("<div/>",{"class":c.baseCls+"-screen "+c.baseCls+"-theme-"+c.theme,css:{position:b._cssPos,top:0,left:0,width:"100%",height:"100%",opacity:0,zIndex:a-1}}).prependTo(b.$el).click(function(a){a.preventDefault();a.stopPropagation();return!1}).fadeTo(300,c.screenOpacity));if(0<c.ms||0===c.ms)g.timeoutId=setTimeout(function(){g.trigger("timeout",g,i);l()},
c.ms);h.click(c.hideOnClick?l:j);c.css&&h.css(c.css);j=e.isFunction(c["in"])?c["in"]:b.transitions[c.position]["in"];b.current[g.cid]=g;g.zIndex=a;f._modulesBinder.trigger("beforeAnimateInMsgEl",b,c,i,h,g);j.call(b,i,h,c,c.fadeInMs,function(){f._modulesBinder.trigger("afterAnimateInMsgEl",b,c,i,h,g)});return g}});f.getModule=function(a){return d.isObject(a)?a:f.modules[a]};var k={},m=Array.prototype.shift;d.extend(k,j.Events);f._modulesBinder=k;f.regModule=function(a,b){1===arguments.length?(b=e.isFunction(a)?
a():a,a=b.name):(b=e.isFunction(b)?b():b,b.name=a);if(!a)throw"module name is not defined.";b.extend&&e.each(b.extend,function(a,i){var h=f.prototype[a];f.prototype[a]=d.isFunction(i)||h===void 0?function(){return i.apply({scope:this,supr:h,module:b},arguments)}:d.isObject(i)?e.extend(true,{},h,i):i});(f.modules=f.modules||{})[a]=b;e.isFunction(b.register)&&b.register.call(b,f);b.enabled&&f.enableModule(b);return b};f.enableModule=function(a){var b=f.getModule(a);return b?(b._handlers=b._handlers||
{},b.events&&e.each(b.events,function(a,d){var h=b._handlers[a]=function(){var a=m.call(arguments);d.apply({module:b,scope:a},arguments)};f._modulesBinder.on(a,h)}),b.enabled=!0,e.isFunction(b.enable)&&b.enable.call(b,f),b):!1};f.disableModule=function(a){return(a=f.getModule(a))?(e.each(a._handlers,function(a,c){f._modulesBinder.off(a,c)}),a.enabled=!1,e.isFunction(a.disable)&&a.disable.call(a,f),a):!1}})(jQuery,Backbone,_);
(function(e,j,d){e.regModule({name:"template",enabled:!0,extend:{template:function(e){if(e.data){var f=d.template(e.message);e.message=f(e.data)}return this.supr.call(this.scope,e)}}})})(Backbone.Notifier,jQuery,_);
(function(e,j){e.regModule({name:"3d",enabled:!1,extend:{defaults:{"3d":!0}},events:{beforeAnimateInMsgEl:function(d,e,f,k){if(d["3d"]){var m=this.module,d=k.handle3d=function(){m.mouseMoveHandler.apply(m,arguments)};j("body").bind("mousemove",{msgInner:f},d)}},beforeHideMsgEl:function(d,e,f,k){d["3d"]&&j("body").unbind("mousemove",k.handle3d)}},mouseMoveHandler:function(d){var e=j(window).innerHeight(),f=j(window).innerWidth(),k=2*(0.5-d.clientX/f),f=-(10*k).toFixed(2),m=2*(0.5-d.clientY/e),e=(20*
m).toFixed(2),a=10*k,b=10*m,c=Math.abs(a)+Math.abs(b),k=0.8-0.4*((Math.abs(k)+Math.abs(m))/2),k=a.toFixed(2)+"px "+b.toFixed(2)+"px "+c.toFixed(2)+"px rgba(0,0,0,"+k.toFixed(2)+")",a={};a[this.transformAttr]="perspective(800px) rotateX("+e+"deg) rotateY("+f+"deg)";a[this.shadowAttr]=k;d.data.msgInner.css(a)},register:function(){this.transformAttr=(j.browser.webkit?"-webkit-":j.browser.mozilla?"-moz-":j.browser.msie?"-ms-":"")+"transform";this.shadowAttr=(j.browser.webkit?"-webkit-":"")+"box-shadow"},
enable:function(){},disable:function(){}})})(Backbone.Notifier,jQuery);
(function(e,j){e.regModule({name:"logger",enabled:!0,extend:{defaults:{showInLog:!0},initialize:function(){this.scope._loggerNotifierId=++this.module._notifiers;this.module._log("initializing notifier #"+this.scope._loggerNotifierId);return this.supr.apply(this.scope,arguments)}},events:{beforeAppendMsgEl:function(d){d._loggerNotificationId=++this.module._notifications;d.showInLog&&this.module._log("beforeAppendMsgEl #"+d._loggerNotificationId,d)},beforeAnimateInMsgEl:function(d){d.showInLog&&this.module._log("beforeAnimateInMsgEl #"+
d._loggerNotificationId)},afterAnimateInMsgEl:function(d){d.showInLog&&this.module._log("afterAnimateInMsgEl #"+d._loggerNotificationId)},beforeHideMsgEl:function(d){d.showInLog&&this.module._log("beforeHideMsgEl #"+d._loggerNotificationId)},afterDestroyMsgEl:function(d){d.showInLog&&this.module._log("afterDestroyMsgEl #"+d._loggerNotificationId)}},_log:function(d,e){window.console&&window.console.log&&(d="logger: "+d,2<=arguments.length?(e=_.isString(e)?e:j.browser.msie?" "+JSON.stringify(e):e,console.log(d,
e)):console.log(d))},register:function(){this._notifiers=this._notifications=0;this._log(this.name+" module was registered")},enable:function(){this._log(this.name+" module was enabled")},disable:function(){this._log(this.name+" module was disabled")}})})(Backbone.Notifier,jQuery);
